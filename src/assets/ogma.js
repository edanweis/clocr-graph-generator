/**
 * Ogma
 * @description Graph visualization library
 * @version 4.3.5 (built on Wed Nov 02 2022 16:11:35 GMT+0000 (Coordinated Universal Time))
 * @author Linkurious SAS
 * @license (c) Linkurious 2022. All rights reserved.
 * @preserve
 */
!function(A,w){"object"==typeof exports&&"undefined"!=typeof module?module.exports=w().default:"function"==typeof define&&define.amd?define(w):((A="undefined"!=typeof globalThis?globalThis:A||self).Ogma=w(),A.Ogma=A.Ogma&&A.Ogma.default?A.Ogma.default:A.Ogma)}(this,(function(){"use strict";var Ogma=(()=>{var A=Object.create,w=Object.defineProperty,T=Object.defineProperties,C=Object.getOwnPropertyDescriptor,k=Object.getOwnPropertyDescriptors,N=Object.getOwnPropertyNames,O=Object.getOwnPropertySymbols,j=Object.getPrototypeOf,G=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable,Wb=(A,T,C)=>T in A?w(A,T,{enumerable:!0,configurable:!0,writable:!0,value:C}):A[T]=C,re=(A,w)=>{for(var T in w||(w={}))G.call(w,T)&&Wb(A,T,w[T]);if(O)for(var T of O(w))H.call(w,T)&&Wb(A,T,w[T]);return A},ke=(A,w)=>T(A,k(w)),Kb=(A,w)=>()=>(w||A((w={exports:{}}).exports,w),w.exports),Ua=(A,T)=>{for(var C in T)w(A,C,{get:T[C],enumerable:!0})},Yb=(A,T,k,O)=>{if(T&&"object"==typeof T||"function"==typeof T)for(let j of N(T))!G.call(A,j)&&j!==k&&w(A,j,{get:()=>T[j],enumerable:!(O=C(T,j))||O.enumerable});return A},Mg=(T,C,k)=>(k=null!=T?A(j(T)):{},Yb(!C&&T&&T.__esModule?k:w(k,"default",{value:T,enumerable:!0}),T)),W=Kb(((A,w)=>{
/**
 * Ogma Parsers
 * @description Parsers for Ogma
 * @version 0.0.12 (built on Tue Aug 09 2022 09:51:38 GMT+0000 (Coordinated Universal Time))
 * @author Alexander Milevski - Leo Nicolle - Sylvain Milan - Marco Liberati
 * @license (c) Linkurious 2022. All rights reserved.
 * @preserve
 */
var T,C;T=A,C=function(A){function t(A,w,T){T=T||w,w in A&&(A.attributes[T]=A[w])}function o(A,w,T){if(A&&"object"==typeof A){if(Array.isArray(A))return A.forEach((A=>o(A,w,T)));if(function r(A){return"vertex"===A.type||"vertex"===A._type||A.inE||A.outE||A._inE||A._outE}(A)){let C={};A.properties&&Object.keys(A.properties).forEach((w=>{C[w]=A.properties[w][0].value}));let k=a(A);w.push({id:k,data:{id:A.id+"",categories:[A.label],properties:C}});for(let C in A)"properties"!==C&&o(A[C],w,T);return}if(function i(A){return"edge"===A.type||"edge"===A._type||A.inV||A.outV||A._outV||A._inV}(A)){let C=a(A);T.push({id:C,source:s(A,["inV","_inV"]),target:s(A,["outV","_outV"]),data:{id:C,type:A.label,properties:A.properties||{}}});for(let C in A)"properties"!==C&&o(A[C],w,T);return}Object.keys(A).forEach((C=>o(A[C],w,T)))}}function s(A,w){for(let T of w)if(A[T])return a(A[T])}function a(A){if("string"==typeof A||isFinite(A))return String(A);let w=A;return String(w.id||w._id)}let l=A=>A.charCodeAt(0),w=l(" "),T=l("<"),C=l(">"),k=l('"'),N=l("\n"),O=l("\r"),j=l("/"),G=l("\\"),H=l("a"),W=l("z"),$=l("A"),Z=l("Z"),se=l("0"),ue=l("9"),ge=l(":");function z(A,w,T,C){let k=C.length;if(T-w!==k)return!1;for(let T=0;T<k;++T)if(A[w+T]!==C[T])return!1;return!0}function J(A,w,T,C){return X(A.tags,w,T,C)}function X(A,w,T,C){let k=A.length;for(let N=0;N<k;++N)if(z(w,T,C,A[N]))return N;return A.push(w.slice(T,C)),k}function Q(A,w,T){let N=K(w,T),O=w[N];if(O===C||O===j)return N;let H=N;N=he(w,N);let W=function ee(A,w,T,C){return X(A.attributes,w,T,C)}(A,w,H,N);for(;w[N]!==k;)++N;for(++N,H=N;(O=w[N])!==k;)O===G&&++N,++N;return A.tokens.push(-3,W,H,N),N+1}function B(A){return A===w||A===N||A===O}function K(A,w){for(;B(A[w]);)++w;return w}function ne(A){return A>=H&&A<=W||A>=$&&A<=Z||A===ge||A>=se&&A<=ue}function he(A,w){for(;ne(A[w]);)++w;return w}function ie(A,w){let T=["return {","  id: undefined,","  attributes: {","    text: undefined,","    color: undefined,",`    ${A?"radius":"width"}: undefined`,A?"  ,x: undefined":"",A?"  ,y: undefined":"","  },"];A||T.push("  source: undefined,","  target: undefined,");let C=Object.keys(w);C.length&&T.push("  data: {");for(let A=0;A<C.length;++A){let k=w[C[A]],N=k.title;T.push(`  "${N}": ${void 0!==k.default?JSON.stringify(k.default):void 0}${A===C.length-1?"":","}`)}return C.length&&T.push("}"),T.push("};"),new Function(T.join("\n"))}function Ae(A){return-1===A.indexOf("\\")||(A=A.replace(/\\"/g,'"')),A}function Y(A,w){let T=0;for(let C=0;C<20;++C){let k=T+A[C]+w[C];T=+(k>=10),A[C]=k%10}}let ce=new class ye{constructor(){this._decimalPowerOfTwo=new Uint8Array(20),this._binaryNumber=new Uint8Array(64),this._decimalNumber=new Uint8Array(20)}int64ToString({low:A,high:w}){if(0===A&&0===w)return"0";(function Fe(A,w,T){for(let w=0;w<32;++w)T[w]=+!!(A&1<<w);for(let A=0;A<32;++A)T[A+32]=+!!(w&1<<A);return T})(A,w,this._binaryNumber),this._decimalNumber.fill(0),this._decimalPowerOfTwo.fill(0),this._decimalPowerOfTwo[0]=1;let T=1===this._binaryNumber[63];T&&function Xe(A){for(let w=0;w<64;++w)A[w]^=1;for(let w=0;w<64&&!(A[w]^=1);++w);}(this._binaryNumber);for(let A=0;A<64;++A)this._binaryNumber[A]&&Y(this._decimalNumber,this._decimalPowerOfTwo),Y(this._decimalPowerOfTwo,this._decimalPowerOfTwo);let C=[],k=this._decimalNumber.length-1;for(T&&C.push("-");!this._decimalNumber[k];)k-=1;for(let A=k;A>=0;--A)C.push(String(this._decimalNumber[A]));return C.join("")}};function Oe(A){return ce.int64ToString(A)}function te(A){return"object"==typeof A&&"high"in A&&"low"in A}function xe(A,w,T,C){if(w)if(Array.isArray(w))w.forEach((w=>xe(A,w,T,C)));else if((A=>"segments"in A)(w))!function we(A,w,T,C){w.segments.forEach((w=>{xe(A,w.start,T,C),xe(A,w.end,T,C),xe(A,w.relationship,T,C)}))}(A,w,T,C);else if(function le(A){if("object"!=typeof A||null===A)throw new Error("Ogma can only retrieve nodes and relationships from Neo4j. Please make sure that your Cypher query returns nodes and edges, not values.");let w=Object.keys(A.properties);for(let T of w){let w=A.properties[T];te(w)&&(A.properties[T]=Oe(w))}if(void 0!==A.identity){if(te(A.identity)&&(A.identity=Oe(A.identity)),function F(A){return"start"in A&&"end"in A}(A)){let w=A.start.identity||A.start,T=A.end.identity||A.end;te(w)&&(A.start=Oe(w)),te(T)&&(A.end=Oe(T))}}else A.id&&(A.identity=A.id)}(w),(A=>"start"in A&&"end"in A&&"type"in A)(w))C.has(w.identity)||(C.add(w.identity),A.edges.push({id:w.identity,source:w.start,target:w.end,data:{neo4jType:w.type,neo4jProperties:w.properties}}));else{let C=w;T.has(C.identity)||(T.add(C.identity),A.nodes.push({id:C.identity,attributes:{},data:{neo4jLabels:C.labels,neo4jProperties:C.properties}}))}}let _e={boolean:A=>"true"===A.toLowerCase(),int:parseFloat,long:parseFloat,float:parseFloat,double:parseFloat,string:A=>A};function Be(A,w,T){let C=A.getElementsByTagName("data"),k={};for(let A=0;A<C.length;A++){let T=C[A],N=T.getAttribute("key");if(null===N)continue;let O=w[N];void 0===O?k[N]=T.textContent:T.textContent&&0!==T.textContent.length&&(k[O.name]=O.parse(T.textContent))}for(let A in T)A in k||(k[A]=T[A]);return k}function yt(A){return A.color?A.color:A.r&&A.g&&A.b?`rgb(${A.r}, ${A.g}, ${A.b})`:void 0}let me=new Set(["x","y","size","color","r","g","b","label"]);function Gt(A){let w={};for(let T in A)me.has(T)||void 0===A[T]||(w[T]=A[T]);return w}A.gexf=function Ne(A){if(-1===A.indexOf("<gexf"))throw new Error("not a GEXF file");let w=function R(A){let w=new Int32Array(A.length);for(let T=0,C=A.length;T<C;++T)w[T]=A.charCodeAt(T);return w}(A),k=function ae(A,w){let k,N,O={tags:[],attributes:[],tokens:[]},G=O.tokens,H=K(A,w);for(;H<A.length;){let w=A[H];if(w===T){if(H=K(A,++H),A[H]===j)for(G.push(-2);A[++H]!==C;);else{k=H,H=he(A,k);let T=J(O,A,k,H);for(G.push(-1,T),w=A[H];w!==C&&w!==j;)H=Q(O,A,H),w=A[H];if(w===j)for(G.push(-2);A[++H]!==C;);}H+=1}else{for(k=H;A[++H]!==T;);for(N=H-1;B(A[N]);)--N;G.push(-4,k,N+1)}H=K(A,H)}return O}(w,A.indexOf("<gexf ")),N={},O={};k.tags.forEach(((A,w)=>{let T=String.fromCharCode.apply(null,A);N[T]=w})),k.attributes.forEach(((A,w)=>{let T=String.fromCharCode.apply(null,A);O[T]=w}));let G,H,W=N.attributes,$=N.attribute,Z=N.node,se=N.edge,ue=N.default,ge=N["viz:position"],ce=N["viz:size"],_e=N["viz:color"],me=N.attvalue,pe=O.class,be=O.id,Se=O.type,Ee=O.title,Te=O.label,Ce=O.source,Ie=O.target,ze=O.x,Pe=O.y,Re=O.r,Ue=O.g,Ve=O.b,He=O.a,We=O.value,$e=O.for,Ye=O.weight,qe={float:1,double:1,integer:2,boolean:3,string:4,"list-string":5},Qe=0,Ke=k.tokens,et=Ke.length,st=new Array(16),at=0,ut=0,gt=0,_t=!0,mt={},vt={},St="",kt="",Mt="",Nt={attributes:{}},Dt=0,Bt=0,Ht=0,Wt=1,Xt="",Yt=!1,qt=!0,Zt=null,Qt=null,Kt=[],ei=[],ti=0,si={};for(;Qe<et;){let T=Ke[Qe];if(-1===T)ut=at,at=Ke[Qe+1],st[gt]=at,gt+=1,at===Z?(Zt||(Zt=ie(!0,mt)),Nt=Zt(),qt=!0,si=mt):at===se&&(Qt||(Qt=ie(!1,vt)),Nt=Qt(),qt=!1,si=vt),Qe+=2;else if(-2===T){if(St&&at===$){si=_t?mt:vt;let A=qe[kt],w=G;w&&(1===A?w=+w:2===A?w=0|+w:3===A?w="true"===w:5===A&&(w=w.split(" ").filter((A=>A)))),si[St]={title:Mt||St,default:w,type:A},St="",Mt="",kt="",G=void 0}else if(at===Z&&4===gt)Yt&&Nt.attributes&&(Nt.attributes.color=`rgba(${Dt}, ${Bt}, ${Ht}, ${Wt})`,Dt=0,Bt=0,Ht=0,Wt=1,Yt=!1),Nt.id||(Nt.id=++ti),Kt.push(Nt);else if(at===se&&4===gt)Nt.id||(Nt.id=++ti),ei.push(Nt);else if(at===me&&6===gt&&Xt){let A=(qt?mt:vt)[Xt];if(A){if(void 0===H)H=A.default;else{let T=A.type;T&&(1===T?H=+H:2===T?H=0|+H:3===T?H="true"===H:5===T?H=H.split(" ").filter((A=>A)).map((A=>Ae(A))):"string"==typeof w&&(H=Ae(H)))}Nt.data[si[Xt].title]=H}Xt="",H=null}gt-=1,at=ut,ut=st[gt-2],Qe+=1}else if(-3===T){let w=Ke[Qe+1],T=A.substring(Ke[Qe+2],Ke[Qe+3]);if(at===W)w===pe&&(_t="edge"!==T&&"edges"!==T);else if(at===$)w===be?St=T:w===Se?kt=T:w===Ee&&(Mt=T);else if(at!==Z&&at!==se||4!==gt)if(at===ge&&5===gt){if(w===ze)Nt.attributes.x=parseFloat(T);else if(w===Pe){let A=parseFloat(T);Nt.attributes.y=0===A?A:-A}}else at===_e&&5===gt?(Yt=!0,w===Re?Dt=parseInt(T):w===Ue?Bt=parseInt(T):w===Ve?Ht=parseInt(T):w===He&&(Wt=parseFloat(T))):at===ce&&5===gt?w===We&&(qt?Nt.attributes.radius=+T:Nt.attributes.width=+T):at===me&&6===gt&&(w===$e||w===be?Xt=T:w===We&&(H=T));else w===be?Nt.id=T:w===Te?Nt.attributes.text=T:w===Ce?Nt.source=T:w===Ie?Nt.target=T:w===Ye&&(Nt.attributes.width=+T);Qe+=4}else{if(-4!==T)throw new Error(`at index ${Qe}: token ${T}`);{let w=A.substring(Ke[Qe+1],Ke[Qe+2]);at===ue&&(G=w),Qe+=3}}}return{nodes:Kt,edges:ei}},A.graphml=function er(A,w){if(!w){if("undefined"==typeof DOMParser)throw new Error("DOMParser is not available. You need to provide a DOMParser instance as second argument, if you are not in the browser environment");w=new DOMParser}let T=w.parseFromString(A,"application/xml"),C=T.getElementsByTagName("key"),k=T.getElementsByTagName("node"),N=T.getElementsByTagName("edge"),{definitions:O,defaults:j}=function Ge(A){let w={graph:{},node:{},edge:{}},T={graph:{},node:{},edge:{}};for(let C=0;C<A.length;C++){let k=A[C],N=k.getAttribute("for")||"node",O=k.getAttribute("id"),j=k.getAttribute("attr.name"),G=k.getAttribute("attr.type")||"string",H=k.getElementsByTagName("default"),W=0!==H.length?H[0].textContent:void 0;w[N][O]={name:j,parse:_e[G]},void 0!==W&&(T[N][j]=W)}return{definitions:w,defaults:T}}(C),G=[],H=new Set;for(let A=0;A<k.length;A++){let w=k[A],T=w.getAttribute("id"),C=w.getAttribute("href")||void 0,N=Be(w,O.node,j.node);H.add(T);let W={id:T,attributes:{x:N.x,y:N.y,radius:N.size,color:yt(N),text:N.label},data:Gt(N)};void 0!==N.x&&(W.attributes.x=N.x),void 0!==N.y&&(W.attributes.y=N.y),void 0!==N.size&&(W.attributes.radius=N.size),void 0!==N.label&&(W.attributes.text=N.label);let $=yt(N);void 0!==$&&(W.attributes.color=$),void 0!==C&&(W.data.href=C),G.push(W)}let W=[];for(let A=0;A<N.length;A++){let w=N[A],T=w.getAttribute("id")||A,C=w.getAttribute("source"),k=w.getAttribute("target"),G=w.getAttribute("xlink:href")||void 0;if(!H.has(C)||!H.has(k))throw new Error(`Invalid edge: ${C} -> ${k}`);let $=Be(w,O.edge,j.edge),Z={id:T,source:C,target:k,attributes:{},data:Gt($)},se=yt($);void 0!==se&&(Z.attributes.color=se),void 0!==G&&(Z.data.href=G),W.push(Z)}return{nodes:G,edges:W}},A.janus=function d(A){let w=[],T=[];return o("string"==typeof A?JSON.parse(A):A,w,T),{nodes:w,edges:T}},A.json=function e(A,w=(A=>A)){let T=w(JSON.parse(A)),C=T.nodes||[],k=T.edges||[];for(let A=0;A<C.length;A++){let w=C[A];w.attributes||(w.attributes={}),"string"==typeof w.size&&(w.size=+w.size),"string"==typeof w.x&&(w.x=+w.x),"string"==typeof w.y&&(w.y=+w.y),t(w,"x"),t(w,"y"),t(w,"size","radius"),t(w,"color"),t(w,"text")}for(let A=0;A<k.length;A++){let w=k[A];w.attributes||(w.attributes={}),"string"==typeof w.size&&(w.size=+w.size),t(w,"size","width"),t(w,"color"),t(w,"text")}return{nodes:C,edges:k}},A.neo4j=function dt(A){let w="string"==typeof A?JSON.parse(A):A,T={nodes:[],edges:[]},C=new Set,k=new Set;return(A=>"queryKeys"in A&&"values"in A)(w)&&(w=function pt(A){let w=[];return A.values.forEach((A=>{let{nodes:T=[],relationships:C=[],segments:k=[]}=A.adapted,N=[{segments:k,properties:{}}];w.push({_fields:[...T,...C,...N]})})),{records:w}}(w)),w.records.forEach((({_fields:A})=>A.forEach((A=>xe(T,A,C,k))))),T},Object.defineProperty(A,"__esModule",{value:!0})},"object"==typeof A&&void 0!==w?C(A):"function"==typeof define&&define.amd?define(["exports"],C):C((T="undefined"!=typeof globalThis?globalThis:T||self)["Ogma-Parsers"]={})})),$=Kb(((A,w)=>{
/**
 * Ogma Generators
 * @description Graphs Generators for Ogma
 * @version 0.0.6 (built on Mon Jun 07 2021 15:49:42 GMT+0000 (Coordinated Universal Time))
 * @author Alexander Milevski - Leo Nicolle - Sylvain Milan - Marco Liberati
 * @license (c) Linkurious 2021. All rights reserved.
 * @preserve
 */
var T,C;T=A,C=function(A){var w={configure:({nodes:A=10,edges:w=10,texts:T=!1,scale:C=100}={})=>({nodes:A,edges:w,texts:T,scale:C}),generate:function e({nodes:A,scale:w,texts:T,edges:C}){let k=[],N=[];for(let C=0;C<A;C++)k.push({id:C,attributes:{x:Math.random()*w,y:Math.random()*w,text:T?`Node ${C}`:void 0}});for(let w=0;w<C;w++)N.push({id:w,source:Math.random()*A|0,target:Math.random()*A|0,attributes:{text:T?`Edge ${w}`:void 0}});return{nodes:k,edges:N}}},T={configure:({rows:A=4,columns:w=4,columnDistance:T=20,rowDistance:C=20,xmin:k=0,ymin:N=0}={})=>({rows:A,columns:w,columnDistance:T,rowDistance:C,xmin:k,ymin:N}),generate:function o({rows:A,columns:w,columnDistance:T,rowDistance:C,xmin:k,ymin:N}){let O={nodes:[],edges:[]},j=0;for(let G=0;G<A;++G)for(let H=0;H<w;++H){let W=G*w+H;O.nodes.push({id:W,attributes:{x:k+H*T,y:N+G*C}}),H!==w-1&&(O.edges.push({id:j,source:W,target:G*w+H+1}),j++),G!==A-1&&(O.edges.push({id:j,source:W,target:(G+1)*w+H}),j++)}return O}},C={configure:({length:A=5,scale:w=100}={})=>({length:A,scale:w}),generate:function d({length:A,scale:w}){let T={nodes:[],edges:[]};if(A<=0)return T;T.nodes.push({id:0,attributes:{x:Math.random()*w,y:Math.random()*w}});for(let C=1;C<A;++C)T.nodes.push({id:C,attributes:{x:Math.random()*w,y:Math.random()*w}}),T.edges.push({id:C-1,source:C-1,target:C});return T}};function h(A){return"number"==typeof A&&isFinite(A)?A:void 0}var k={configure:function m({children:A=2,height:w=3}={}){if(!function c(A){return"number"==typeof A&&isFinite(A)&&A>0?A:void 0}(A))throw new TypeError('Invalid argument: "children" is not a positive number, was '+A);if(!function u(A){return"number"==typeof A&&isFinite(A)&&A>=0?A:void 0}(w))throw new TypeError('Invalid argument: "height" is not a positive number, was '+w);return{children:A,height:w}},generate:function g({children:A,height:w}){w+=1;let T=Math.pow(A,w),C=[],k=[],N=1,O=0,j=0;for(let G=0;G<w;++G){let H=T/(N+1)/1.5;for(let T=0;T<N;++T){let N=O++;if(C.push({id:N,attributes:{x:(T+1)*H*10,y:20*G}}),G!==w-1)for(let w=0;w<A;++w)k.push({id:j,source:N,target:N*A+w+1}),j+=1}N*=A}return{nodes:C,edges:k}}},N={configure:function f({nodes:A=20,edges:w,p:T,scale:C=100}={}){if(!h(A)||A<3)throw new TypeError("Invalid argument: options.nodes is not a number >= 3, was "+A);if(void 0!==w&&void 0!==T)throw new TypeError("Invalid argument: choose between options.edges and options.p");return void 0===w&&void 0===T&&(T=.1),void 0===T&&(T=-1),void 0===w&&(w=-1),{nodes:A,p:T,edges:w,scale:C}},generate:function _(A){let w={nodes:[],edges:[]},T=A.nodes,C=A.p,k=A.scale;if(C>=0){let A=0;for(let N=0;N<T;N++){w.nodes.push({id:N,attributes:{x:Math.random()*k,y:Math.random()*k}});for(let T=0;T<N;T++)Math.random()<C&&w.edges.push({id:A++,source:N,target:T})}}else{let C=[],k=A.edges;for(let A=0;A<T;A++){w.nodes.push({id:A,attributes:{x:100*Math.random(),y:100*Math.random()}});for(let w=A+1;w<T;w++)C.push({source:A,target:w})}let N=C.length-1;for(let A=0;A<k;A++){let T=C.splice(Math.floor(Math.random()*N),1)[0];T.id=A,w.edges.push(T),N--}}return w}},O={configure:function b({nodes:A=40,m0:w=5,m:T=1,scale:C=100}={}){if(!h(A)||A<3)throw new TypeError("Invalid argument: options.nodes is not a number >= 3, was "+A);if(!h(w)||w>=A)throw new TypeError(`Invalid argument: options.m0 is not a number < ${A}, was ${w}`);if(!h(w)||T>=w)throw new TypeError(`Invalid argument: options.m is not a number <= ${w}, was ${T}`);if(!h(C)||C<0)throw new TypeError("Invalid argument: options.scale is not a number or is less than 0");return{nodes:A,m0:w,m:T,scale:C}},generate:function y({scale:A,nodes:w,m0:T,m:C}){let k={nodes:[],edges:[]},N={},O=[],j=A/10,G=0;for(let A=0;A<T;A++)k.nodes.push({id:A,attributes:{x:Math.random()*j,y:Math.random()*j}}),O[A]=0;for(let A=0;A<T;A++)for(let w=A+1;w<T;w++){let T={id:G++,source:A,target:w};N[T.source+"-"+T.target]=T,k.edges.push(T),O[A]++,O[w]++}for(let j=T;j<w;j++){k.nodes.push({id:j,attributes:{x:Math.random()*A,y:Math.random()*A}}),O[j]=0;let w=0;for(let A=0;A<j;A++)w+=O[A];let T=0;for(let A=0;A<C;A++){let C=Math.random(),H=0;for(let W=0;W<j;W++)if(!N[`${j}-${W}`]&&!N[`${W}-${j}`]&&(H=1===j?1:H+O[W]/w+T/(j-A),C<=H)){T+=O[W]/w;let A={id:G++,source:j,target:W};N[`${A.source}-${A.target}`]=A,k.edges.push(A),O[j]++,O[W]++;break}}}return k}},j={configure:function D({nodes:A=50,width:w=100,height:T=100,x:C=0,y:k=0}={}){if(!isFinite(A)||A<1)throw new RangeError("Tree generator: number of nodes must be a positive integer");return{nodes:A,width:w,height:T,x:C,y:k}},generate:function v({nodes:A,x:w,y:T,width:C,height:k}){let N=w-C/2,O=T-k/2;return{nodes:new Array(A).fill(0).map(((A,w)=>({id:w,attributes:{x:N+Math.random()*C,y:O+Math.random()*k}}))),edges:new Array(A-1).fill(0).map(((A,w)=>({id:w,source:Math.floor(Math.sqrt(w)),target:w+1})))}}};function ee(A){return 10*Math.pow(2.7,A)}function X(A){return 5+ee(A)/10}function Q(A,w,T,C,k){if(0===T)return k;let N=ee(T),O=X(T),j=.2*O,G=-Math.PI,H=2*Math.PI/w,W=C.attributes.x||0,$=C.attributes.y||0;for(let Z=0;Z<w;++Z){let Z={id:k,attributes:{x:W+N*Math.cos(G),y:$+N*Math.sin(G),radius:O}},se={id:k,source:C.id,target:k,attributes:{width:j}};A.nodes.push(Z),A.edges.push(se),k=Q(A,w,T-1,Z,k+1),G+=H}return k}var G={configure:function z({depth:A=3,breadth:w=3,nbNodes:T}){return void 0!==T?(w=5,A=Math.ceil(Math.log(T)/Math.log(5))):T=-1,{depth:A,breadth:w,nbNodes:T}},generate:function J({depth:A,breadth:w,nbNodes:T}){let C={id:0,attributes:{x:0,y:0,radius:X(A+1)}},k={nodes:[C],edges:[]};return Q(k,w,A,C,1),void 0!==T&&T>=0&&(k.nodes=k.nodes.slice(0,T),k.edges=k.edges.slice(0,Math.max(T-1,0))),k}};A.balancedTree=k,A.barabasiAlbert=O,A.erdosRenyi=N,A.flower=G,A.grid=T,A.path=C,A.random=w,A.randomTree=j,Object.defineProperty(A,"__esModule",{value:!0})},"object"==typeof A&&void 0!==w?C(A):"function"==typeof define&&define.amd?define(["exports"],C):C((T="undefined"!=typeof globalThis?globalThis:T||self)["Ogma-Generators"]={})})),Z={};Ua(Z,{BoundingBox:()=>ws,Edge:()=>Xi,EdgeList:()=>Yi,Neo4JEdgeData:()=>tm.Neo4JEdgeData,Neo4JNodeData:()=>tm.Neo4JNodeData,Node:()=>Vi,NodeList:()=>Gi,NonObjectPropertyWatcher:()=>sh,ObjectPropertyWatcher:()=>rh,StyleClass:()=>al,StyleRule:()=>fh,Transformation:()=>Hu,default:()=>im});var se={},ue={},ge={},kg=A=>null;if("object"==typeof global&&(ue=global),"object"==typeof window&&(ge=window),"object"==typeof module&&"function"==typeof module.require){let A=module.require.bind(module);kg=w=>{try{return A(w)}catch(A){return null}}}else"function"==typeof ue.require&&(kg=A=>{let w=module.require;try{return w(A)}catch(A){return null}});function $t(A,{throwOnError:w}={}){let T=null;if(!T&&A&&(T=se[A]),!T&&A&&(T=kg(A)),!T&&A&&(T=ge[A]),!T&&A&&(T=ue[A]),!T&&w){let w=[`unable to find module "${A}"; make sure one of these statements is true:`,`- Ogma.libraries['${A}'] is set to the right library`,`- require('${A}') returns the right library`,`- window['${A}'] is set to the right library`].join("\n");throw new Error(w)}return T}function Ho(A,w){for(let T=1,C=A.length;T<C;T++){let C=A[T],k=T;for(;k>0&&w.get(A[k-1])>w.get(C);)A[k]=A[k-1],--k;A[k]=C}return A}function BN(A,w){for(let T=1,C=A.length;T<C;T++){let C=A[T],k=T;for(;k>0&&w.get(A[k-1])<w.get(C);)A[k]=A[k-1],--k;A[k]=C}return A}function At(A){return Array.isArray(A)||ArrayBuffer.isView(A)}function Wo(A){return Array.isArray(A)?A:[A]}function Gg(A){let w=[];for(let T=0;T<A.length;++T){let C=A[T];if(Array.isArray(C))for(let A=0;A<C.length;++A)w.push(C[A]);else w.push(C)}return w}function GN(...A){if(0===A.length)return[];let w=A[0].constructor,T=0;for(let w of A)T+=w.length;let C=new w(T),k=0;for(let w of A){for(let A=0;A<w.length;A++)C[k+A]=w[A];k+=w.length}return C}function zN(A,w){let T=A.indexOf(w);return-1!==T&&(A.splice(T,1),!0)}function zg(A,w){let T,C,k=0,N=A.length-1;for(;k<=N;)if(T=(k+N)/2|0,C=A[T],C<w)k=T+1;else{if(!(C>w))return T;N=T-1}return-1}var ji=(A,w)=>{let T=new Array(A.length);for(let C=0;C<A.length;C++)T[C]=w[A[C]];return T};function UN(A){return"number"==typeof A&&A%1==0}function Br(A){if(!A)return[];if("string"==typeof A)return A.split(".");if(Array.isArray(A)){for(let w=0;w<A.length;++w)if("string"!=typeof A[w])throw new TypeError(`${A[w]} is not a string`);return A.slice()}throw new TypeError(`invalid property path "${A}": expected string or array of strings`)}function Va(A,w,T){let C,k,N;if(0===w)return function(){A.apply(T,arguments)};let s=function(){C=!1,k&&(N.apply(T,k),k=null)};return N=function(){let N;return C?k=arguments:(N=A.apply(T,arguments),setTimeout(s,w),C=!0),N},N}function VN(A,w,T){let C,k,N,O,j,G=0===w||void 0===w?100:w;function l(){let w=Date.now()-O;w<G&&w>=0?C=setTimeout(l,G-w):(C=null,T||(j=A.apply(N,k),N=k=null))}let u=function(){N=this,k=arguments,O=Date.now();let G=T&&!C;return C||(C=setTimeout(l,w)),G&&(j=A.apply(N,k),N=k=null),j};return u.clear=function(){C&&(clearTimeout(C),C=null)},u.flush=function(){C&&(j=A.apply(N,k),N=k=null,clearTimeout(C),C=null)},u}function jb(A,w,T,C,k){T(A[w],w,A,C,k).then((N=>{w===A.length-1?C(N):jb(A,w+1,T,C,k)})).catch(k)}function HN(A,w){return new Promise(((T,C)=>jb(A,0,w,T,C)))}function Zi(){return 120===new Uint8Array(new Uint32Array([305419896]).buffer)[0]}function Ug(A){return A.reduce(((A,w)=>A.then(w)),Promise.resolve())}function rc(A,w,T,C,k,N,O,j){return A+k+256*(w+N)+65536*(T+O)+16777216*(C+j)}function WN(A,w){return A<w?A*w+Math.pow(w-A-1,2)/4:A*w+Math.pow(A-w-1,2)/4}function wn(A){return!(null===A||"object"!=typeof A||At(A)||A instanceof RegExp||"undefined"!=typeof HTMLElement&&A instanceof HTMLElement)}function $i(A){let w=Object.keys(A),T=new Array(w.length);for(let C=0;C<w.length;++C)T[C]=A[w[C]];return T}function cr(A,w,T){if(Array.isArray(A))return A.forEach(w,T);if(!wn(A))throw new Error("forEach: invalid argument "+JSON.stringify(A));let C=Object.keys(A);if(void 0!==T)for(let k=0;k<C.length;++k){let N=C[k];w.call(T,A[N],N)}else for(let T=0;T<C.length;++T){let k=C[T];w(A[k],k)}}function nt(A){if(Array.isArray(A)){let w=new Array(A.length);for(let T=0;T<A.length;++T)w[T]=nt(A[T]);return w}if(!wt(A))return A;let w={},T=Object.keys(A);for(let C of T)w[C]=nt(A[C]);return w}function XN(A,w){w.forEach((w=>{-1===A.indexOf(w)&&A.push(w)}))}function Nr(A,w,T){let C="string"==typeof w?w.split("."):w;for(let w=0;w<C.length-1;++w){let T=C[w],k=A[T];k||(k={},A[T]=k),A=k}A[C[C.length-1]]=T}function Tt(A,w){let T=Br(w);if(!T.length)return A;if(A){for(let w=0;w<T.length-1;++w){let C=A[T[w]];if(!C)return;A=C}return A[T[T.length-1]]}}function Qi(A,w,T="."){w||(w=A=>!wn(A));let C={},k=Object.keys(A);for(let N=0;N<k.length;++N){let O=k[N],j=A[O];if(w(j))C[O]=j;else{let A=Qi(j,w),k=Object.keys(A);for(let w=0;w<k.length;w++){let N=k[w];C[`${O}${T}${N}`]=A[N]}}}return C}function nc(A){let w={},T=Object.keys(A);for(let C=0;C<T.length;++C){let k=T[C];Nr(w,k,A[k])}return w}function Rn(A,w,T=[]){let C=Object.keys(A);for(let k=0;k<C.length;++k){let N=C[k],O=A[N],j=w?w+N:N;wt(O)?Rn(O,j+".",T):T.push(j)}return T}function Zb(A,w){let T,C=[A];for(;C.length>0;)if(T=C.pop(),T)if(wt(T))for(let A in T)T.hasOwnProperty(A)&&C.push(T[A]);else w(T)}function KN(A){let w={};return Zb(A,(A=>w[A.getName()]=A)),w}function Ha(A,w=[]){if(wt(A)){let T=Object.keys(A);for(let C of T)Ha(A[C],w)}else w.push(A);return w}function Ji(A){for(let w in A)"function"==typeof A[w]&&delete A[w];return A}function Ft(A,w){if(void 0===A)return nt(w);if(!wn(A))return A;let T={},C=Object.keys(w);for(let k of C){let C=w[k],N=A[k];wn(C)?T[k]=Ft(N,C):T[k]=void 0===N?nt(C):N}return T}function wt(A){return A&&(A.constructor===Object||!A.constructor)}function Wa(A,w){if(!wt(w)||!wt(A))return w;let T=Object.assign({},A),C=Object.keys(w);for(let A of C)T[A]=Wa(T[A],w[A]);return T}function ic(A,w){return null==w?A:w.reduce(((w,T)=>(w[T]=A[T],w)),{})}var nr=(...A)=>{let w={};for(let T=0;T<A.length;T++){let C=A[T];for(let A in C)C.hasOwnProperty(A)&&(Array.isArray(w[A])&&Array.isArray(C[A])?w[A]=Array.from(new Set(w[A].concat(C[A]))):wt(w[A])&&wt(C[A])?w[A]=nr(w[A],C[A]):w[A]=C[A])}return w},ce=(()=>{let A=0;return"undefined"!=typeof requestAnimationFrame?requestAnimationFrame:function(w){let T=Date.now(),C=Math.min(16,Math.max(0,16-(T-A))),k=A=T+C;return setTimeout((()=>w(k)),C)}})(),_e="undefined"!=typeof cancelAnimationFrame?cancelAnimationFrame:function(A){return clearTimeout(A)};function Xa(A,w){return ce((T=>{A.call(w,T)}))}function Vg(A){A&&_e(A)}var me="object"==typeof global&&null!==global&&void 0!==global.it,pe="undefined"!=typeof document,be="undefined"!=typeof window,Se=be&&!window.__OGMA_HEADLESS,Ee=Se&&pe,Te="undefined"!=typeof performance&&performance.now?()=>0|performance.now():()=>Date.now(),Ce=Te();function Ut(){return Te()-Ce}function Hg(){let A=new Date,w=A.getDate(),T=A.getMonth()+1;return`${A.getFullYear()}-${T<10?"0"+T:T}-${w<10?"0"+w:w}`}function Wg(){let A=new Date;return`[${oc((A.getUTCHours()-(A.getTimezoneOffset()/60|0))%24)}:${oc(A.getUTCMinutes())}:${oc(A.getUTCSeconds())}:${oc(A.getUTCMilliseconds(),3)}]`}function oc(A,w=2){let T=Math.pow(10,w-1),C=String(A);for(;T>1;)A<T&&(C="0"+C),T/=10;return C}function zr(A){!me&&console.warn(Wg()+" "+A)}var Ie,ze,Pe,Re,Ze=()=>{},ro=()=>!1,ni=()=>!0,ii=()=>null,ur=A=>A,Ue=class{constructor(){this.method=null,this.url=null,this.status=0,this.readyState=0,this.headers={},this.responseText=null,this.response=null,Ue.onCreate&&Ue.onCreate(this)}open(A,w){this.method=A,this.url=w,Ue.onSend&&Ue.onSend(this)}respond(A,w,T){this.readyState=4,this.status=A,this.headers=w,this.responseText=T,this.response=T,this.onreadystatechange()}send(){this.readyState=4}},Ve=Ue;Ve.onCreate=Ze,Ve.onSend=Ze;var He=class{constructor(){this.onload=Ze,He.onCreate&&He.onCreate(this)}readAsDataURL(A){this._blob=A,He.onRead&&He.onRead(this)}load(A){this.result="function"==typeof A?A(this._blob):A,this.onload&&this.onload()}},We=He;function Ur(){return ze||{createElementNS:()=>null,createElement:()=>null,implementation:{createDocument(){throw new Error('unable to create XML document; if you use Node JS install the "xmldom" package')}}}}function Yg(A,w){if(document&&document.defaultView){let T=A.style[w];if((!T||"auto"===T)&&Ur().defaultView){let C=document.defaultView.getComputedStyle(A,null);T=C?C[w]:null}return"auto"===T?null:T?T.toString():null}return null}We.onCreate=Ze,We.onRead=Ze,Ie=$t("xmldom"),ze=pe?document:Ie?(new Ie.DOMImplementation).createDocument():null,Pe="undefined"!=typeof XMLHttpRequest?XMLHttpRequest:Ve,Re="undefined"!=typeof FileReader?FileReader:We;var $e=class{constructor(){this.onmousewheel=Ze,this.__dummy=!0,this.style={},this.clientWidth=0,this.clientHeight=0,this.childNodes=[],this.style={width:"0px",height:"0px",top:void 0,left:void 0,position:"",backgroundColor:void 0}}get offsetWidth(){return parseFloat(this.style.width||"0")}get offsetHeight(){return parseFloat(this.style.height||"0")}get firstChild(){return null}get parentNode(){return null}get classList(){return{length:0,value:"",add(){},remove(){},contains:A=>!1,item:null}}get innerHTML(){return""}set innerHTML(A){}appendChild(A){return this.childNodes.push(A),A}removeChild(){}addEventListener(){}removeEventListener(){}insertBefore(){}contains(A){return!1}};function Zo(){return new $e}var Ye=be?()=>window.devicePixelRatio:()=>1;function eE(A){let w,T,C,k=";base64,";if(-1===A.indexOf(k))return w=A.split(","),T=w[0].split(":")[1],C=decodeURIComponent(w[1]),jo(C,T);w=A.split(k),T=w[0].split(":")[1],C=window.atob(w[1]);let N=C.length,O=new Uint8Array(N);for(let A=0;A<N;++A)O[A]=C.charCodeAt(A);return jo([O],T)}var qe=class{constructor(A,w){this.data=A,this.type=w}};function jo(A,w){return"undefined"!=typeof Blob?new Blob(A,{type:w}):new qe(A,w)}function ZN(A){return"undefined"!=typeof Blob&&A instanceof Blob||A instanceof qe}function fr(A,w,T){if(!Se)return A;let C=null,k=null,N=null;window.Blob?(C=function $N(A,w){return"blob"===w?A:"dataURL"===w?eE(A):jo([A],"text/xml")}(A,T),k=window.URL.createObjectURL(C)):N="data:text/xml;charset=UTF-8,"+encodeURIComponent('<?xml version="1.0" encoding="UTF-8"?>')+encodeURIComponent(A);let O=document.createElement("a");return O.setAttribute("href",k||N),O.setAttribute("download",w),document.body.appendChild(O),O.click(),document.body.removeChild(O),k&&setTimeout((()=>window.URL.revokeObjectURL(k)),0),A}function $o(A,w,T,C=Ye()){if(rn(A,w+"px",T+"px"),"IMG"===A.tagName||"CANVAS"===A.tagName){let k=A;k.width=w*C,k.height=T*C}}function dc(A,w){cr(w,((w,T)=>{void 0!==w&&A.setAttribute(T,w)}))}var Qe="http://www.w3.org/2000/svg",Ke="http://www.w3.org/2000/xmlns/",et="http://www.w3.org/1999/xlink";function lt(A,w){let T=ze.createElementNS(Qe,A);return T.style||(T.style={}),w&&dc(T,w),T}function cc(A){let w=ze.createElement("div"),T=A.trim().replace(/\s+/g," ");if(w.innerHTML=T,!w.firstChild||1!==w.firstChild.nodeType)throw new Error(`Failed to create element from: "${A}". Expected an HTML string`);return w.firstChild}function Ya(A){if(ze)return ze.createTextNode(A)}function jg(A){return"undefined"==typeof Image?Promise.resolve(null):new Promise((w=>{let T=new Image;T.src=A,T.onload=()=>w(T),T.onerror=()=>w(null)}))}function tE(A){if(0===A.indexOf("http://")||0===A.indexOf("https://"))return A;let w=window.location.origin,T=window.location.pathname,C=T.lastIndexOf("/");return-1===C?w+"/"+A:w+T.substr(0,C)+"/"+A}function no(A){return new Promise(((w,T)=>{let C=new Pe;C.open("GET",tE(A),!0),C.onreadystatechange=function(){if(4===C.readyState){let k=C.status;200===k?w(C.responseText):T(0!==k?new Error(`cannot retrieve file at url "${A}"; the server responded with status code ${k}.`):new Error(`cannot send XMLHttpRequest to url "${A}"; if you're using the local file protocol this is most likely the cause.`))}},C.onerror=function(){T(new Error(`cannot retrieve file at url "${A}"; the XMLHttpRequest failed.`))},C.send()}))}function Zg(A){return"undefined"!=typeof HTMLElement&&A instanceof HTMLElement}function Qo(A,w){A.style.cursor=w,A.style.cursor!==w&&(A.style.cursor=`-webkit-${w}`)}function rE(A){return new Promise(((w,T)=>{let C=new Pe;C.responseType="blob",C.open("GET",tE(A),!0),C.onreadystatechange=()=>{if(4===C.readyState){if(200===C.status)return w(C.response);T(C.status)}},C.onerror=A=>T(A),C.send()}))}function $g(A){return rE(A).then((A=>new Promise(((w,T)=>{let C=new Re;C.onerror=T,C.onload=()=>w(C.result),C.readAsDataURL(A)}))))}function oi(A,w=!0){let T=w?"&#13;":"\n";return(""+A).replace(/&/g,"&amp;").replace(/'/g,"&apos;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r\n/g,T).replace(/[\r\n]/g,T)}var st={0:"left",1:"middle",2:"right"};function Qg(A){if(A.baseURI)return A.baseURI;let w=A.getElementsByTagName("base");return w.length>0?w[0].href:A.URL||A.location.href}function Jg(A,w,T,C){return new Promise((k=>{let N=w,O=Date.now(),j=(T-w)*Math.min(1,1/(C/16));!function d(){Date.now()-O<C?(N=Math.min(1,Math.max(0,N+j)),A.style.opacity=N.toString(),Xa(d)):k()}()}))}function rn(A,w,T){A.style.width=w,A.style.height=T}var at=be&&!!window.PointerEvent,ut="pointerdown",gt="pointermove",_t="pointerup",mt="pointercancel",vt={},St=0,iE=A=>"mouse"===A.pointerType,oE=A=>"mouse"!==A.pointerType;function dE(A){vt[A.pointerId]=A}function lE(A){vt[A.pointerId]&&(vt[A.pointerId]=A)}function mc(A){delete vt[A.pointerId]}function _c(A,w){A.touches=[];for(let w in vt)A.touches.push(vt[w]);A.changedTouches=[A],w(A)}function tp(A,w,T,C){return"touchstart"===T?A(w,ut,C,!1):"touchmove"===T?A(w,gt,C,!1):"touchend"===T?(A(w,_t,C,!1),A(w,mt,C,!1)):void 0}var kt=class{constructor(A){this._ogma=A}_setModules(A){this._modules=A}onMounted(){}onReady(A){}destroy(A){}},Mt=["graphics","legend","brand"],Nt=class extends kt{constructor(A,{width:w=300,height:T=300}={}){super(A),this._layers={},this._focus=!1,this._container=null,this._isFullScreen=!1,this._beforeNextFramePromises=[],this._afterNextFramePromises=[],this._refreshUntil=0,this._currentTime=Ut(),this._timeouts=[],this._isDestroyed=!1,this._onDetachDom=[],this._isRealBrowser=Se,this._isDocumentReady=Ee,this._inFrame=!1,this._mustRefresh=!1,this._nextFrame=null,this._onWindowResize=()=>this._resize(),this._onWindowFocus=()=>this.refresh(),this._onFullscreenChange=()=>{this._isFullScreen=Za()},this._width=w,this._height=T}onMounted(){this._modules.settings.register("minimumWidth",300,(()=>this._resize()),!1),this._modules.settings.register("minimumHeight",300,(()=>this._resize()),!1),this._modules.events.register(["beforeNewFrame","newFrame","afterNewFrame","setContainer","resize"]),this._onDetachDom=[],function sE(){if(pe&&0===St&&at){let A=document.documentElement;A.addEventListener(ut,dE,!0),A.addEventListener(gt,lE,!0),A.addEventListener(_t,mc,!0),A.addEventListener(mt,mc,!0)}St++}(),this.addWindowEventListener("resize",this._onWindowResize).addWindowEventListener("focus",this._onWindowFocus)}onReady(A){A.container&&this.setContainer(A.container)}addWindowEventListener(A,w,T){return this._isRealBrowser&&this.addElementEventListener(window,A,w,T),this}addDirectWindowEventListener(A,w,T){this._isRealBrowser&&window.addEventListener(A,w,T)}removeDirectWindowEventListener(A,w){this._isRealBrowser&&window.removeEventListener(A,w)}addDocumentEventListener(A,w,T){return this._isDocumentReady&&this.addElementEventListener(document.documentElement,A,w,T),w}removeDocumentEventListener(A,w){this._isDocumentReady&&document.documentElement.removeEventListener(A,w)}addMediaListener(A,w){if(this._isDocumentReady&&"function"==typeof window.matchMedia){let T=window.matchMedia(A);T.addListener(w),this._onDetachDom.push((()=>T.removeListener(w)))}}addElementEventListener(A,w,T,C){return this._isDestroyed||(A.addEventListener(w,T,C),this._onDetachDom.push((()=>A.removeEventListener(w,T,C)))),T}detachFromDom(){this._onDetachDom.forEach((A=>A())),this._onDetachDom=[],this._emptyContainer()}setTimeout(A,w=0){let T=setTimeout((()=>{this._timeouts.splice(this._timeouts.indexOf(T),1),A()}),w);return this._timeouts.push(T),T}clearTimeout(A){return A&&(clearTimeout(A),this._timeouts.splice(this._timeouts.indexOf(A),1)),null}clearAllTimeouts(){this._timeouts.forEach(clearTimeout),this._timeouts=[]}stopFrames(){this._isDestroyed=!0,this._nextFrame&&(Vg(this._nextFrame),this._nextFrame=null)}isDestroyed(){return this._isDestroyed}getDimensions(){return{width:this._width,height:this._height}}setDimensions(A){this._resize(A)}setLayer(A,w,{automaticResize:T=!1}={}){w&&(w._ogmaLayer=A,T&&(w.style.position="absolute",w.style.top="0px",w.style.left="0px",$o(w,this._width,this._height,Ye()))),this._layers[A]={element:w,automaticResize:T},this._updateContainerContent()}setContainer(A){let w;if("string"==typeof A){if(w=document.getElementById(A),!w)throw new Error(`unable to find DOM element with id "${A}"`)}else w=A;if(w===this._container)return;null===w&&this._emptyContainer();let T=this._container;this._isFullScreen=!1,this._container=w,this._container&&["fullscreenchange","webkitfullscreenchange"].forEach((A=>{this.addElementEventListener(this._container,A,this._onFullscreenChange)})),this._resize(),this._updateContainerContent(),this._modules.events.fire("setContainer",{element:w,prevElement:T})}getContainer(){return this._container}appendElement(A){null!==this._container&&this._container.appendChild(A)}focus(){this._focus=!0}blur(){this._focus=!1}hasFocus(){return this._focus}forceResize(){this._resize()}_beforeOrAfterNextFrame(A){let w=A?this._afterNextFramePromises:this._beforeNextFramePromises,T=new Promise((A=>{w.push((()=>(A(void 0),T)))}));return this._refresh(),T}beforeNextFrame(){return this._beforeOrAfterNextFrame(!1)}afterNextFrame(){return this._beforeOrAfterNextFrame(!0)}refresh(A){A&&(this._refreshUntil=Math.max(this._refreshUntil,A)),this._refresh()}_emptyContainer(){if(this._container){let A=[];for(let w=0;w<this._container.childNodes.length;++w){let T=this._container.childNodes[w];T._ogmaLayer&&A.push(T)}for(let w=0;w<A.length;++w)this._container.removeChild(A[w])}}_fillContainer(){if(this._container){let A=Yg(this._container,"position");"absolute"!==A&&"relative"!==A&&"fixed"!==A&&(this._container.style.position="relative");let w=this._container.firstChild;Mt.forEach((A=>{let T=this._layers[A];T&&T.element&&this._container&&this._container.insertBefore(T.element,w)}))}}_updateContainerContent(){this._emptyContainer(),this._fillContainer()}_resize(A){if(!this._container&&!A)return;let w,T,C=this._width,k=this._height;if(this._container){let C=this._modules.settings.get("minimumWidth"),k=this._modules.settings.get("minimumHeight"),N=this._container.clientWidth||1,O=this._container.clientHeight||1;w=Math.max(C,A?A.width:N),T=Math.max(k,A?A.height:O)}else null!=A&&(w=A.width,T=A.height);(w!==C||T!==k)&&(this._width=w,this._height=T,cr(this._layers,(({element:A,automaticResize:C})=>{C&&$o(A,w,T)})),this._modules.events.fire("resize",{prevWidth:C,prevHeight:k,width:w,height:T,difWidth:w-C,difHeight:T-k}))}_refresh(){this._inFrame?this._mustRefresh=!0:!this._nextFrame&&!this._isDestroyed&&(this._nextFrame=Xa((()=>this._playFrame())))}_playFrame(){let A=Ut(),w=A-this._currentTime,T=Gg([this._beforeNextFramePromises,()=>this._modules.events.fire("beforeNewFrame",{elapsed:w}),()=>this._modules.events.fire("newFrame",{elapsed:w}),()=>this._modules.events.fire("afterNewFrame",{elapsed:w}),this._afterNextFramePromises,()=>{this._inFrame=!1,(this._mustRefresh||A<this._refreshUntil+17)&&(this._mustRefresh=!1,this._refresh())}]);this._inFrame=!0,this._nextFrame=null,this._mustRefresh=!1,this._currentTime=A,this._beforeNextFramePromises=[],this._afterNextFramePromises=[],T.reduce(((A,w)=>A.then((()=>{if(!this._isDestroyed)return w()}))),Promise.resolve())}isPlayingFrame(){return this._inFrame||!!this._nextFrame}setFullScreen(A){let w=Promise.resolve();return A!==this._isFullScreen?(this._container&&(w=A?function tT(A){return Za()?Promise.resolve():A.requestFullscreen?A.requestFullscreen():A.requestFullScreen?A.requestFullScreen():A.webkitRequestFullScreen?Promise.resolve(A.webkitRequestFullScreen()):A.mozRequestFullScreen?A.mozRequestFullScreen():A.msRequestFullscreen?A.msRequestFullscreen():Promise.resolve()}(this._container):function rT(){return Za()&&"undefined"!=typeof document?document.exitFullscreen?document.exitFullscreen():document.cancelFullScreen?document.cancelFullScreen():document.webkitCancelFullScreen?Promise.resolve(document.webkitCancelFullScreen()):document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():Promise.resolve():Promise.resolve()}()),w.then((()=>new Promise((A=>{this.setTimeout((()=>{this._isFullScreen=Za(),A(void 0)}),200)}))))):w}isFullScreen(){return Za()}debounceBeforeFrame(A){let w=!1,T=[],o=()=>{let C=T;w=!1,T=[],A(),C.forEach((A=>A()))};return()=>new Promise((A=>{T.push(A),w||(w=!0,this.beforeNextFrame().then(o))}))}destroy(){(function aE(){if(St--,pe&&0===St){let A=document.documentElement;A.removeEventListener(ut,dE,!0),A.removeEventListener(gt,lE,!0),A.removeEventListener(_t,mc,!0),A.removeEventListener(mt,mc,!0)}})(),this.detachFromDom(),this.clearAllTimeouts(),this.stopFrames()}};function Za(){return"undefined"!=typeof document&&!!(document.fullscreenElement||document.msFullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement)}var Dt=class extends kt{constructor(){super(...arguments),this._nodeChanges=[],this._edgeChanges=[],this._shouldTriggerEvents=!1}onMounted(){this._nodeDataList=this._modules.graph.createAttribute(!0,{name:"data",storage:"any"},!1),this._edgeDataList=this._modules.graph.createAttribute(!1,{name:"data",storage:"any"},!1),this._nodeList=this._modules.graph.getNodeAttribute("object"),this._edgeList=this._modules.graph.getEdgeAttribute("object"),this._modules.events.register(["setData","updateNodeData","updateEdgeData"]),this._modules.events.on("addNodes",(({nodes:A,objects:w})=>this._onAddElements(A,w))).on("addEdges",(({edges:A,objects:w})=>this._onAddElements(A,w))).on("beforeNewFrame",(()=>{this._shouldTriggerEvents&&(this._shouldTriggerEvents=!1,this._triggerEvents())}))}_onAddElements(A,w){let{isNode:T,size:C,_indexes:k}=A,N=this[T?"_nodeDataList":"_edgeDataList"];for(let A=0;A<C;++A)N.set(k[A],w[A].data)}setProperty(A,w,T,{dispatch:C=!1}={}){this._setDataProperty(A.isNode,A._indexes,w,T,C),this._modules.events.fire("setData",{elements:A})}getProperty(A,w){return this._getDataProperty(A.isNode,A._indexes,w)}_setDataProperty(A,w,T,C,k){k&&"function"==typeof C&&(k=!1);let N=fE(T),O="function"==typeof C,j=A?this._nodeList:this._edgeList,G=A?this._nodeDataList:this._edgeDataList,H=function nT(A,w){for(let T=0;T<A.length;++T){let C=A[T],k=C.property;if(null===w&&null===k)return C;if(w&&k&&k.length===w.length){let A=!0;for(let T=0;T<k.length;++T)if(k[T]!==w[T]){A=!1;break}if(A)return C}}let T={property:w&&w.slice(),indexes:[],previousValues:[],newValues:[],nodes:null,edges:null};return A.push(T),T}(A?this._nodeChanges:this._edgeChanges,N);for(let A=0;A<w.length;++A){let T,W,$=w[A],Z=G.get($),se=j.get($),ue=k?C[A]:C;if(null===N)T=Z,W=O?ue(se):ue,G.set($,W);else{null==Z&&(Z={},G.set($,Z));let A=N.length;for(let w=0;w<A;w++){let C=N[w],k=Z[C];w<A-1?(null==k&&(k={},Z[C]=k),Z=k):(T=k,W=O?ue(se):ue,Z[C]=W)}}H.indexes.push($),H.previousValues.push(T),H.newValues.push(W)}this._scheduleEvents()}_getDataProperty(A,w,T,C){let k=fE(T);C||(C=new Array(w.length));let N=A?this._nodeDataList:this._edgeDataList;for(let A=0;A<w.length;++A){let T,O=w[A],j=N.get(O);if(null!==k&&k.length)if(null==j)T=void 0;else{let A=k.length;for(let w=0;w<A&&j;++w)T=j=j[k[w]]}else T=j;C[A]=T}return C}_scheduleEvents(){this._shouldTriggerEvents=!0,this._modules.dom.refresh()}_triggerEvents(){let A=this._prepareEvtPayload(!0),w=this._prepareEvtPayload(!1);this._modules.events.fire("updateNodeData",A),this._modules.events.fire("updateEdgeData",w)}_prepareEvtPayload(A){let w=A?this._modules.graph.nodeList:this._modules.graph.edgeList,T=A?"_nodeChanges":"_edgeChanges",C=[],k=this[T];this[T]=[];let N=[];for(let T=0;T<k.length;++T){let{indexes:O,property:j,newValues:G,previousValues:H}=k[T];C=C.concat(O||[]),A?N.push({property:j,newValues:G,previousValues:H,nodes:w(O)}):N.push({property:j,newValues:G,previousValues:H,edges:w(O)})}return A?{nodes:w(C).dedupe(),isNode:A,changes:N}:{edges:w(C).dedupe(),isNode:A,changes:N}}};function fE(A){return"string"==typeof A?A.split("."):At(A)?A:null}var Bt={1:rp(1),2:rp(2),4:rp(4),8:(A,w)=>A[w],16:(A,w)=>A[w],32:(A,w)=>A[w],int8:(A,w)=>A[w],int16:(A,w)=>A[w],int32:(A,w)=>A[w],float:(A,w)=>A[w],any:(A,w)=>A[w]},Ht={1:np(1),2:np(2),4:np(4),8:(A,w,T)=>{A[w]=T},16:(A,w,T)=>{A[w]=T},32:(A,w,T)=>{A[w]=T},int8:(A,w,T)=>{A[w]=T},int16:(A,w,T)=>{A[w]=T},int32:(A,w,T)=>{A[w]=T},float:(A,w,T)=>{A[w]=T},any:(A,w,T)=>{A[w]=T}};function rp(A){let w=8/A,T=(1<<A)-1;return(C,k)=>C[k/w|0]>>k%w*A&T}function np(A){let w=8/A,T=Math.pow(2,A)-1;return(C,k,N)=>{let O=k%w*A,j=k/w|0,G=N<<O,H=255-(T-N<<O);C[j]=C[j]&H|G}}var Wt={get(A){return this._getArrayElt(this._buffer,A)},set(A,w){this._setArrayElt(this._buffer,A,w)}},Xt={get(A){return this._byIndex[this._getArrayElt(this._buffer,A)]},set(A,w){let T=this._byName[w];void 0===T&&(T=this._nextIndex++,this._byIndex.push(w),this._getElementBitSize()>this._elementSize&&this.increaseElementSize(),this._byName[w]=T),this._setArrayElt(this._buffer,A,T)}},Yt=class{constructor(A){this._initialized=!1;let w=A.name,T=A.storage,C=A.size||0,k=function iT(A,w){return void 0===A&&"any"!==w&&"resource"!==w?0:A}(A.default,T),N=Math.max(8,EE(C+1)),O="resource"===T?1:T;this._name=w,this._storage=T,this._getArrayElt=Bt[O],this._setArrayElt=Ht[O],this._elementSize=O,this._nbElements=N,this._fallback=null,this._byName=void 0,this._byIndex=void 0,this._nextIndex=void 0,this._defaultValue=k,this._BASE_VALUE="any"===T?void 0:0,this._methods=Wt,this._initialized=!1,this._buffer=null,"resource"===T&&(this._methods=Xt,this._byName=Object.create(null),this._byIndex=[],this._nextIndex=1,this._byName[k]=0,this._byIndex.push(k))}getValues(){return Object.keys(this._byName||{})}getName(){return this._name||""}setDefaultValue(A){this._defaultValue=A,"resource"===this._storage&&(this._byName[A]=0,this._byIndex[0]=A)}get(A){return this._get(A)}set(A,w){this._set(A,w)}_get(A){return this._defaultValue}_set(A,w){w!==this._defaultValue&&(this._initialize(),this._set(A,w))}setFallback(A){this._fallback=A,this.get=this._getWithFallback}_getWithFallback(A){let w=this._get(A);return void 0===w&&this._fallback?this._fallback.get(A):w}_initialize(){this._initialized=!0,this._buffer=ip(this._nbElements,this._elementSize),this._get=this._methods.get,this._set=this._methods.set,"resource"!==this._storage&&this._defaultValue!==this._BASE_VALUE&&this._reset(0)}increaseNbElements(A){let w=EE(A+1);if(!(w<=this._nbElements)){if(this._initialized)if("any"===this._elementSize)for(let A=this._nbElements;A<w;++A)this._buffer.push(this._defaultValue);else{let A=ip(w,this._elementSize);A.set(this._buffer),this._buffer=A,"resource"!==this._storage&&this._defaultValue!==this._BASE_VALUE&&this._reset(this._nbElements)}this._nbElements=w}}increaseElementSize(){let A=this._elementSize;if("number"!=typeof A||32===A)throw new Error("FlexArray: cannot increase element size");let w=2*A,T=Bt[w],C=Ht[w];if(this._initialized){let T=this._nbElements,k=this._getArrayElt,N=this._buffer,O=ip(T,w);if(A>=8)O.set(N);else for(let A=0;A<T;++A)C(O,A,k(N,A));this._buffer=O}this._elementSize=w,this._getArrayElt=T,this._setArrayElt=C}buffer(){if(!this._buffer)throw new Error("FlexArray: buffer not instantiated");return this._buffer}elementBitSize(){return this._elementSize}capacity(){return this._nbElements}byteSize(){return this._nbElements*this._elementSize/8}isInitialized(){return this._initialized||this._fallback&&this._fallback.isInitialized()}getMultiple(A,w){let T=A.length;void 0===w&&(w=new Array(T));for(let C=0,k=T;C<k;++C)w[C]=this.get(A[C]);return w}fill(A,w){for(let T=0,C=A.length;T<C;++T)this.set(A[T],w)}setMultiple(A,w,T){if(T||!Array.isArray(w)&&!ArrayBuffer.isView(w))for(let T=0,C=A.length;T<C;++T)this.set(A[T],w);else for(let T=0,C=A.length;T<C;++T)this.set(A[T],w[T])}reset(){return this._initialized&&this._reset(0),this}_reset(A){let w="resource"===this._storage?0:this._defaultValue;if(this._buffer)if("number"!=typeof this._elementSize||this._elementSize>=8)this._buffer.fill(w,A);else{let T=8/this._elementSize,C=0;for(let A=0;A<T;++A)C<<=this._elementSize,C+=w;if(void 0===A)this._buffer.fill(C);else{let T=A+(8-A%8);for(let C=A;C<T;++C)this._setArrayElt(this._buffer,C,w);this._buffer.fill(C,T/8)}}}_getElementBitSize(){if(this._nextIndex)return Math.pow(2,Math.ceil(Math.log2(Math.log2(this._nextIndex))))}};function EE(A){let w=2;for(;w<A;)w*=2;return w}function ip(A,w){return"any"===w?new Array(A):"float"===w?new Float32Array(A):"int8"===w?new Int8Array(A):"int16"===w?new Int16Array(A):"int32"===w?new Int32Array(A):32===w?new Uint32Array(A):16===w?new Uint16Array(A):new Uint8Array(Math.ceil(A/8*w))}function Vr(A){return Math.pow(2,Math.ceil(Math.log2(A)))}function op(A){let w=0;for(let T=0;T<A.length;++T)w+=A[T];return w}function Vt(A,w,T){return Math.max(w,Math.min(T,A))}function bc(A,w,T){return A+(w-A)*T}function bt(A,w,T){return A*(1-T)+w*T}function di(A){if(!A.length)return-1/0;let w=A[0];for(let T=1,C=A.length;T<C;++T){let C=A[T];C>w&&(w=C)}return w}function Hr(A){if(!A.length)return 1/0;let w=A[0];for(let T=1,C=A.length;T<C;++T){let C=A[T];C<w&&(w=C)}return w}var sp=(A,w)=>Math.log(A)/Math.log(w),rs=A=>A<-Math.PI?A+2*Math.PI:A>Math.PI?A-2*Math.PI:A,qt=class{constructor(){this._buffer=new Uint32Array(4),this._capacity=4,this._size=0,this._busy=!1}isBusy(){return this._busy}markBusy(){return this._busy=!0,this}sliceAndReset(){this._busy=!1;let A=this.slice(0,this._size);return this.reset(),A}reset(){return this._size=0,this}reserve(A){return A>this._capacity&&this._setCapacity(Vr(A)),this}_setCapacity(A){let w=new Uint32Array(A);w.set(this._buffer),this._buffer=w,this._capacity=A}push(A){return this._size===this._capacity&&this._setCapacity(2*this._capacity),this._buffer[this._size++]=A,this}pushUnchecked(A){return this._buffer[this._size++]=A,this}slice(A=0,w=this._size){return this._buffer.slice(A,w)}getBuffer(){return this._buffer}getLength(){return this._size}getCapacity(){return this._capacity}setLength(A){return this._size=A,this}isEmpty(){return 0===this._size}},Zt=class{constructor(A){this._nextIndex=1,this._freeIndexes=[],this._indexesToBeFreed=[],this._idToIndex=Object.create(null),this._indexToId=[void 0],this._flexArrays=[],this._defaultValues=[],this._flexArraysByName={},this._indexLists=[],this._name=A?"node":"edge",this._nextIndex=1,this._freeIndexes=[],this._indexesToBeFreed=[],this._idToIndex=Object.create(null),this._indexToId=[void 0],this._idFlexArray=new Yt({storage:"int32"}),this._idFlexArray.get=A=>this._indexToId[A],this._idFlexArray.getMultiple=A=>{let w=new Array(A.length);for(let T=0;T<A.length;++T)w[T]=this._indexToId[A[T]];return w},this._flexArraysByName.id=this._idFlexArray}addElements(A){let w=[];for(let T=0,C=A.length;T<C;++T){let C=A[T],k=this._idToIndex[C];void 0===k&&(k=this._getNextIndex(),this._idToIndex[C]=k,this._indexToId[k]=C),w.push(k)}for(let A of this._flexArrays)A.increaseNbElements(this._nextIndex);for(let A of this._indexLists)A.reserve(this._nextIndex);return new Uint32Array(w)}removeElements(A){for(let w=0,T=A.length;w<T;++w){let T=A[w],C=this._indexToId[T];void 0!==C&&(delete this._idToIndex[C],this._removeIndex(T))}}clear(){this._idToIndex=Object.create(null),this._indexToId=[void 0],this._nextIndex=1,this._freeIndexes=[];for(let A of this._flexArrays)A.reset();for(let A of this._indexLists)A.reset()}has(A){return void 0!==this._indexToId[A]}getIndex(A,w=!1){let T=this._idToIndex[A];if(void 0===T&&w)throw new Error(`${this._name} id "${A}" not found`);return T}createFlexArray(A,w){let{name:T}=A;if(T&&w&&this._flexArraysByName[T])throw new Error(`${this._name} flexArray "${T}" already exists`);let C=A.default;void 0===C&&"any"!==A.storage&&"resource"!==A.storage&&(C=0);let k,N=this._nextIndex,O={storage:A.storage,size:N,name:T,default:C};return k=(void 0===C&&"any"!==A.storage&&A.storage,new Yt(O)),this._flexArrays.push(k),this._defaultValues.push(A.default),T&&w&&(this._flexArraysByName[T]=k),k}getFlexArray(A){return this._flexArraysByName[A]}getAllFlexArrays(){return this._flexArraysByName}createIndexList(){let A=new qt;return A.reserve(this._nextIndex),this._indexLists.push(A),A}getId(A){return this._indexToId[A]}getMaxIndex(){return this._nextIndex-1}_removeIndex(A){this._indexesToBeFreed.push(A)}_getNextIndex(){let A=this._freeIndexes.pop();return void 0===A&&(A=this._nextIndex++),A}freeIndexes(){for(let A of this._indexesToBeFreed)this._indexToId[A]=void 0,this._freeIndexes.push(A);for(let A=0;A<this._flexArrays.length;++A){let w=this._flexArrays[A],T=this._defaultValues[A];for(let A of this._indexesToBeFreed)w.set(A,T)}this._indexesToBeFreed=[]}},Qt=class{constructor(){this._BIG_LIST=255,this._MAX_LIST_SIZE=8,this._capacity=8,this._buffer=new Uint32Array(this._capacity*this._MAX_LIST_SIZE),this._sizes=new Uint8Array(this._capacity),this._bigLists=[],this._nextIndex=0,this._constList=new Array(this._MAX_LIST_SIZE)}addEntry(A){return void 0===A&&(A=this._nextIndex++),A>=this._capacity&&this._reserve(A+1),this._sizes[A]=0,A}get(A){let w=this._sizes[A],T=this._MAX_LIST_SIZE*A;if(w<=this._MAX_LIST_SIZE){this._constList.length=w;for(let A=0,C=w;A<C;++A)this._constList[A]=this._buffer[T+A];return this._constList}if(w===this._BIG_LIST){let A=this._buffer[T];return this._bigLists[A]}throw new Error(`Table: ${A} out of bounds (${w})`)}size(A){let w=this._sizes[A];return w<=this._MAX_LIST_SIZE?w:this._bigLists[this._buffer[A*this._MAX_LIST_SIZE]].length}sizes(A){let w=this._sizes,T=this._bigLists,C=this._buffer,k=this._MAX_LIST_SIZE,N=A.length,O=new Array(N);for(let j=0;j<N;j++){let N=A[j],G=w[N];O[j]=G<=k?G:T[C[N*k]].length}return O}addTo(A,w){let T=this._sizes[A],C=A*this._MAX_LIST_SIZE;if(T<this._MAX_LIST_SIZE)this._buffer[C+T]=w,this._sizes[A]=T+1;else if(T===this._BIG_LIST){let A=this._buffer[C];this._bigLists[A].push(w)}else{let T=new Array(this._MAX_LIST_SIZE);for(let A=0;A<this._MAX_LIST_SIZE;++A)T[A]=this._buffer[C+A];T.push(w),this._bigLists.push(T),this._sizes[A]=this._BIG_LIST,this._buffer[C]=this._bigLists.length-1}return this}removeFrom(A,w){return this.removeFromAndGetSize(A,w),this}removeFromAndGetSize(A,w){let T=this._MAX_LIST_SIZE*A,C=this._sizes[A];if(C<=this._MAX_LIST_SIZE){for(let k=T,N=T+C;k<N;++k)if(this._buffer[k]===w)return C-=1,this._buffer[k]=this._buffer[N-1],this._sizes[A]=C,C}else if(C===this._BIG_LIST){let A=this._buffer[T],C=this._bigLists[A],k=C.indexOf(w);if(-1!==k)return C.splice(k,1),C.length}throw new Error('topology: Table: "removeFrom" failed, should not happen')}reserve(A){return this._capacity<A&&this._reserve(A),this}_reserve(A){this._capacity=Math.pow(2,Math.ceil(Math.log2(A))),this._buffer=xE(this._buffer,this._capacity*this._MAX_LIST_SIZE),this._sizes=xE(this._sizes,this._capacity)}};function xE(A,w){let T=new(0,A.constructor)(w);return T.set(A),T}var Kt="_visible",ei="_data",ti="_hovered",si="_hoverExtremityHighlighted",ri="_selected",ai="_selectionExtremityHighlighted",li="_dragged",ui="_rewirable",gi="_export",_i="_faded",fi="_transparent",pi="in",xi="out",yi="both",bi=[ri,li,ai,ti,si,ui,gi,_i,fi,"_visual_groups"],Ei=["hover","zoom","panning","rotation","gesture","drag","selection","tooltip","user","interactions","resizing","rewiring","connectNodes","lasso"],cp=(A,w)=>(A+w)*(A+w+1)/2+w;function os(A,w){let T=A<w?A:w;return 67108864*T+(A+w-T)}var Ti=void 0,Ci=[];function Ac(A){("object"!=typeof A||null===A)&&(A={});let w="function"==typeof A.data?A.data:ur;return{attributes:Array.isArray(A.attributes)?A.attributes:A.attributes||Ci,data:w}}function ci(A,w){for(let T of A){let A=w;Object.keys(A).forEach((w=>{let C=A[w];T.prototype[w]=function(A,T){return zr(`Deprecated method "${w}"; please use "${C}" instead.`),this[C](A,T)}}))}}function hp(A){let w=A.getFlexArray("removed"),T=A.getFlexArray("excluded"),C=A.getFlexArray("virtual");return{all:A=>0===w.get(A),visible:A=>0===T.get(A),excluded:A=>1===T.get(A),raw:A=>0===C.get(A)&&0===w.get(A),_all:A=>!0}}function mp(A,w,T){return{all:Dc(T.all,A,w),visible:Dc(T.visible,A,w),raw:Dc(T.raw,A,w),_all:Dc(T._all,A,w)}}function Dc(A,w,T){let C=null;return{getList(){if(!C){let k=w(),N=T();N.reset();for(let w=1;w<=k;++w)A(w)&&N.push(w);C=N.sliceAndReset()}return C},invalidList(){C=null}}}function vc(A){if(void 0===A)return Math.round(Math.random()*Number.MAX_SAFE_INTEGER);if("string"!=typeof A&&("number"!=typeof A||!isFinite(A)))throw new Error(`${A} is not a valid id, expected string or number`);return A}var ki="geo.latitude",Ii="geo.longitude",Fi="geo.prevLat",zi="geo.prevLng",Pi=85.0511287798,Ri={latitudePath:"latitude",longitudePath:"longitude",maxZoomLevel:22,minZoomLevel:0,wrapCoordinates:!0,tileUrlTemplate:"https://{s}.tile.osm.org/{z}/{x}/{y}.png",tileUrlSubdomains:"abc",attribution:null,attributionOptions:void 0,backgroundColor:"silver",opacity:1,duration:0,disableNodeDragging:!0,tileBuffer:1,sizeRatio:1,tiles:{url:"https://{s}.tile.osm.org/{z}/{x}/{y}.png",subdomains:"abc",tms:!1,wms:!1},crs:void 0},Oi={maxBoundsViscosity:1,worldCopyJump:!0,zoomControl:!1,attributionControl:!1};function pp(){return be||"undefined"!=typeof global&&!global.process}function Tc(A){return Math.log2(A)+1}function fp(A){return null!=A&&!isNaN(A)}function _p(A,w){return CE(A,w,"longitude")}function bp(A,w){return CE(A,w,"latitude")}function CE(A,w,T){if(isNaN(w))throw new TypeError(`node ${A}: ${w} is not a valid ${T}`)}function RE(A,w={}){if(void 0===w.tiles||w.tileUrlTemplate||w.tileUrlSubdomains){let A=Ri.tiles;return ke(re(re({},w.tiles||{}),Ri.tiles),{url:w.tileUrlTemplate||A.url,subdomains:w.tileUrlSubdomains||A.subdomains})}return wt(w.tiles)?re(re({},A.tiles),w.tiles):w.tiles}var Bi=Ur().createElement("div");function od(A,w,T,C){!function uT(A,w,T,C,k){let N=A.getAttribute(w,C),O=A.getAttribute(w,k),j=T._indexes;O.setMultiple(j,N.getMultiple(j))}(A,!0,w,T,C)}function Ep(A,w){return A.getAttributes(["text.minVisibleSize","text.size","text.scale","minVisibleSize","width"]).forEach((({text:T,minVisibleSize:C,width:k},N)=>{w[A.get(N).getId()]={"text.minVisibleSize":T.minVisibleSize,"text.size":T.size,"text.scale":T.scale,minVisibleSize:C,size:Math.max(1,Number(k))}})),w}function HE(A,w,T){if(!w||!Object.keys(w).length)return Promise.resolve();let C=A.getId().filter((A=>w[A])).map((A=>{if(!w[A])return 0;let C=Number(w[A]["text.minVisibleSize"]),k=Number(w[A].minVisibleSize),N=Number(w[A]["text.size"]),O=Number(w[A]["text.scale"]),j=Number(w[A].size)*O*T;return j<=k||j<=C?0:N}));return A.setAttribute("text.size",C)}function WE(A,w){let T=A.getId().map((A=>{let T=w[A]||{};return Number(T["text.size"])}));return A.setAttribute("text.size",T)}function Sc(A,w,T){let C=A.getObjectList(w.isNode);for(let A=0;A<w._indexes.length;++A){let k=w._indexes[A];T(C.get(k),A)}}function Lc(A,w,T){let C=new Array(w.size),k=A.getObjectList(w.isNode);for(let A=0;A<w._indexes.length;++A){let N=w._indexes[A],O=k.get(N);C[A]=T(O,A)}return C}function Ic(A,w,T){T=T||ni;let C=w.isNode,k=A.acquireIndexList(C),N=A.getObjectList(C),O=A.getListFactory(C);for(let A=0;A<w._indexes.length;++A){let C=w._indexes[A],O=N.get(C);O&&T(O,A)&&k.push(C)}return O(k.sliceAndReset())}function Cc(A,w,T,C){let k=A.getListFactory(w.isNode);if(!T)return{valid:w,invalid:k()};let N=A.acquireIndexList(w.isNode),O=A.acquireIndexList(w.isNode),j=A.getObjectList(w.isNode);for(let A=0;A<w._indexes.length;A++){let k=w._indexes[A],G=j.get(k);void 0!==G&&(T(G,C)?N:O).pushUnchecked(k)}return{valid:k(N.sliceAndReset()),invalid:k(O.sliceAndReset())}}function Oc(A,w,T,C){let k=A.getObjectList(w.isNode),N=C;for(let A=0;A<w._indexes.length;++A){let C=w._indexes[A];N=T(N,k.get(C),A)}return N}function Pc(A,w){let T=w.isNode,C=A.topology.getDeduper(T),k=A.acquireIndexList(T),N=A.getListFactory(T);for(let A=0;A<w._indexes.length;A++){let T=w._indexes[A];0===C.get(T)&&(C.set(T,1),k.push(T))}return N(k.sliceAndReset())}function wc(A,w,T){let C=w.isNode,k=T.topology.getDeduper(C),N=T.acquireIndexList(C),O=T.getListFactory(C);for(let A=0;A<w._indexes.length;A++){let T=w._indexes[A];k.set(T,1)}for(let w=0;w<A._indexes.length;w++){let T=A._indexes[w];0===k.get(T)&&N.push(T)}return O(N.sliceAndReset())}function Rc(A,w){let T=w.isNode,C=A.storage.fetch(T),k=C.getFlexArray("excluded"),N=C.getMaxIndex(),O=A.topology.getDeduper(T),j=A.acquireIndexList(T),G=A.getListFactory(T);for(let A=0;A<w._indexes.length;A++)O.set(w._indexes[A],1);for(let A=1;A<=N;++A)0===O.get(A)&&0===k.get(A)&&j.push(A);return G(j.sliceAndReset())}function Fc(A,w,T){let C=A.getListFactory(w.isNode),k=new Uint32Array(w._indexes.length+T._indexes.length);return k.set(w._indexes),k.set(T._indexes,w._indexes.length),C(k)}function Mc(A,w){return A.getObjectList(w.isNode).getMultiple(w._indexes)}function hi(A,w){let T=A.getStorage(w.isNode);if(w.isList){let A=new Array(w.size);for(let C=0;C<w._indexes.length;++C)A[C]=T.getId(w._indexes[C]);return A}return T.getId(w._index)}function kc(A,w){return A.topology.getExtremity(!0,w)}function Bc(A,w){return A.topology.getExtremity(!1,w)}function Gc(A,w,T){return A.getObjectList(w.isNode).get(w._indexes[T])}function zc(A,w,T){let C=A.getListFactory(w.isNode),k=A.getObjectList(w.isNode),N=w._indexes.slice();return N.sort(((A,w)=>{let C=k.get(A),N=k.get(w);return T(C,N)})),C(N)}var Ui=new Uint32Array(1),Vi=class{constructor(A,w){this.size=1,this.isNode=!0,this.isList=!1,this._index=A,this._ogma=w}get _indexes(){return Ui[0]=this._index,Ui}setAttributes(A,w){return this._ogma.modules.individualAttributes.setMultipleAttributes(this,A,w)}setAttribute(A,w,T){return this._ogma.modules.individualAttributes.setSingleAttribute(this,A,w,T)}resetAttributes(A,w){return this._ogma.modules.individualAttributes.resetMultipleAttributes(this,A,w)}getAttributes(A){return this._ogma.modules.individualAttributes.getMultipleAttributes(this,A)[0]}getAttribute(A){return this._ogma.modules.individualAttributes.getSingleAttribute(this,A)[0]}getPosition(){return this.getAttributes(["x","y"])}getPositionOnScreen(){return this._ogma.modules.camera.graphToScreenCoordinates(this.getPosition())}isInScreen(){let A=this.getPositionOnScreen(),w=this._ogma.modules.camera;return A.x>=0&&A.x<=w.width&&A.y>=0&&A.y<=w.height}replaceOriginalAttributes(A,w){return this._ogma.modules.individualAttributes.replaceOriginalAttributes(this,A,w)}getPreviousAttributes(A){return this._ogma.modules.individualAttributes.getMultiplePreviousAttributes(this,A)[0]}getPreviousAttribute(A){return this._ogma.modules.individualAttributes.getSinglePreviousAttribute(this,A)}isInView(A){return this._ogma.modules.locate.isElementInView(this,A)}getAdjacentNodes(A){return this._ogma.modules.graph.getAdjacentNodes(this,A)}getAdjacentEdges(A){return this._ogma.modules.graph.getAdjacentEdges(this,A)}getAdjacentElements(A){return{nodes:this._ogma.modules.graph.getAdjacentNodes(this,A).dedupe(),edges:this._ogma.modules.graph.getAdjacentEdges(this,A).dedupe()}}getDegree(A){return this._ogma.modules.graph.getDegree(this,A)[0]}fastGetAdjacentElements(){return this._ogma.modules.graph.fastGetNodesAdjacentElements(this)}getConnectedComponent(A){return this._ogma.modules.graph.getConnectedComponentByNode(this,A)[0]}isVisible(){return!this.isExcluded()}isExcluded(){return this._ogma.modules.graph.isExcluded(this)[0]}setExcluded(A){return this._ogma.modules.graph.setExcluded(this,A)}setVisible(A){return this.setExcluded(!A)}toList(){return this._ogma.nodeList(new Uint32Array([+this._index]))}getId(){return hi(this._ogma.modules.graph,this)}slice(){return this.toList()}toJSON(A={}){let{attributes:w,data:T}=Ac(A);return{id:this.getId(),attributes:this.getAttributes(w),data:T(nt(this.getData()))}}get(A){return 0===A?this:void 0}setSelected(A){this._ogma.modules.selection.setActive(this,A)}isSelected(){return this._ogma.modules.selection.areActive(this)}locate(A){return this._ogma.modules.locate.locateElements(this,A)}getBoundingBox({includeTexts:A=!1}={}){return this._ogma.modules.locate.getBoundingBox(this,A,A)}setData(A,w){return arguments.length<2&&(w=A,A=null),this._ogma.modules.data.setProperty(this,A,w),this}getData(A){return this._ogma.modules.data.getProperty(this,A||null)[0]}addClass(A,w){return this._ogma.modules.classes.addClassesToElements([A],this,w)}addClasses(A,w){return this._ogma.modules.classes.addClassesToElements(A,this,w)}removeClass(A,w){return this._ogma.modules.classes.removeClassesFromElements([A],this,w)}removeClasses(A,w){return this._ogma.modules.classes.removeClassesFromElements(A,this,w)}hasClass(A){return this._ogma.modules.classes.hasSingleElementClass(A,this)}getClassList(){return this._ogma.modules.classes.getElementsClassList(this)[0]}getGeoCoordinates(){let A=this._ogma.modules.graph,w=A.getNodeAttribute(ki).get(this._index),T=A.getNodeAttribute(Ii).get(this._index);return{latitude:fp(w)?w:void 0,longitude:fp(T)?T:void 0}}setGeoCoordinates(A){return this.toList().setGeoCoordinates([A]).then((()=>this))}getAnimationInformation(){return this._ogma.modules.graphics.getAnimationInformation(this)[0]}isVirtual(){return this._ogma.modules.transformations.isElementVirtual(this)}getTransformation(){return this._ogma.modules.transformations.getElementTransformation(this)}getMetaNode(){return this._ogma.modules.grouping.getMetaElement(this)[0]}getSubNodes(){return this._ogma.modules.grouping.getSubElements(this)[0]}pulse(A){return this._ogma.modules.pulses.pulse(this,A)}};ci([Vi],{setStyle:"setAttributes",resetStyle:"resetAttributes",getStyle:"getAttribute",setPosition:"setAttributes"});var Gi=class{constructor(A,w){this.isList=!0,this.isNode=!0,this._indexes=A,this._ogma=w}get size(){return this._indexes.length}setAttributes(A,w){return this._ogma.modules.individualAttributes.setMultipleAttributes(this,A,w)}setAttribute(A,w,T){return this._ogma.modules.individualAttributes.setSingleAttribute(this,A,w,T)}getAttributes(A){return this._ogma.modules.individualAttributes.getMultipleAttributes(this,A)}getAttribute(A){return this._ogma.modules.individualAttributes.getSingleAttribute(this,A)}resetAttributes(A,w){return this._ogma.modules.individualAttributes.resetMultipleAttributes(this,A,w)}getPosition(){return this.getAttributes(["x","y"])}getPositionOnScreen(){return this.getPosition().map((A=>this._ogma.modules.camera.graphToScreenCoordinates(A)))}replaceOriginalAttributes(A,w){return this._ogma.modules.individualAttributes.replaceOriginalAttributes(this,A,w)}getPreviousAttributes(A){return this._ogma.modules.individualAttributes.getMultiplePreviousAttributes(this,A)}getPreviousAttribute(A){return this._ogma.modules.individualAttributes.getSinglePreviousAttribute(this,A)}getAdjacentNodes(A){return this._ogma.modules.graph.getAdjacentNodes(this,A)}getAdjacentEdges(A){return this._ogma.modules.graph.getAdjacentEdges(this,A)}getAdjacentElements(A){return{nodes:this._ogma.modules.graph.getAdjacentNodes(this,A).dedupe(),edges:this._ogma.modules.graph.getAdjacentEdges(this,A).dedupe()}}getDegree(A){return this._ogma.modules.graph.getDegree(this,A)}getConnectedComponents(A){return this._ogma.modules.graph.getConnectedComponents(this,A)}fastGetAdjacentElements(){return this._ogma.modules.graph.fastGetNodesAdjacentElements(this)}isVisible(){return this.isExcluded().map((A=>!A))}isExcluded(){return this._ogma.modules.graph.isExcluded(this)}setExcluded(A){return this._ogma.modules.graph.setExcluded(this,A)}setVisible(A){return this.setExcluded(!A)}toList(){return this}toArray(){return Mc(this._ogma.modules.graph,this)}clone(){return this._ogma.modules.graph.nodeList(this._indexes.slice())}getId(){return hi(this._ogma.modules.graph,this)}get(A){return Gc(this._ogma.modules.graph,this,A)}forEach(A){Sc(this._ogma.modules.graph,this,A)}map(A){return Lc(this._ogma.modules.graph,this,A)}filter(A){return Ic(this._ogma.modules.graph,this,A)}reduce(A,w){return Oc(this._ogma.modules.graph,this,A,w)}concat(A){return Fc(this._ogma.modules.graph,this,A)}dedupe(){return Pc(this._ogma.modules.graph,this)}subtract(A){return wc(this,A,this._ogma.modules.graph)}slice(A,w){return this._ogma.modules.graph.nodeList(this._indexes.slice(A,w))}indexOf(A){return A instanceof Vi?this._indexes.indexOf(A._index):-1}includes(A){return-1!==this.indexOf(A)}inverse(){return Rc(this._ogma.modules.graph,this)}sort(A){return zc(this._ogma.modules.graph,this,A)}toJSON(A={}){return this.map((w=>w.toJSON(A)))}setSelected(A){this._ogma.modules.selection.setActive(this,A)}isSelected(){return this._ogma.modules.selection.areActive(this)}locate(A){return this._ogma.modules.locate.locateElements(this,A)}getBoundingBox({includeTexts:A=!1}={}){return this._ogma.modules.locate.getBoundingBox(this,A,A)}setData(A,w){if(arguments.length<2&&(w=A,A=null),"function"!=typeof w&&!At(w))throw new Error(`invalid argument ${w}; expected array or function`);return this._ogma.modules.data.setProperty(this,A,w,{dispatch:!0}),this}fillData(A,w){return arguments.length<2&&(w=A,A=null),this._ogma.modules.data.setProperty(this,A,w,{dispatch:!1}),this}getData(A){return this._ogma.modules.data.getProperty(this,A||null)}addClass(A,w){return this._ogma.modules.classes.addClassesToElements([A],this,w)}addClasses(A,w){return this._ogma.modules.classes.addClassesToElements(A,this,w)}removeClass(A,w){return this._ogma.modules.classes.removeClassesFromElements([A],this,w)}removeClasses(A,w){return this._ogma.modules.classes.removeClassesFromElements(A,this,w)}hasClass(A){return this.map((w=>this._ogma.modules.classes.hasSingleElementClass(A,w)))}getClassList(){return this._ogma.modules.classes.getElementsClassList(this)}getGeoCoordinates(){let A=this._ogma.modules.graph,w=new Array(this._indexes.length),T=A.getNodeAttribute(ki).getMultiple(this._indexes),C=A.getNodeAttribute(Ii).getMultiple(this._indexes);for(let A=0,k=this._indexes.length;A<k;A++)w[A]={latitude:T[A],longitude:C[A]};return w}setGeoCoordinates(A){let w=this._ogma.modules.geo,T=this.getId(),C=this._indexes,k=new Array(C.length),N=new Array(C.length);if(null===A&&(A=new Array(C.length).fill(null)),A.length!==C.length)throw new RangeError("You must provide coordinates for each node in the NodeList");for(let w=0,O=C.length;w<O;w++){let{latitude:C,longitude:O}=A[w]||{latitude:void 0,longitude:void 0},j=T[w];null==C&&null==O?C=O=void 0:(bp(j,C),_p(j,O)),k[w]=C,N[w]=O}this.setData(w.latitudePath,k),this.setData(w.longitudePath,N);let{dom:O,graph:j}=this._ogma.modules;return function BE(A,w,T,C){let k=w._indexes;A.getNodeAttribute(ki).setMultiple(k,T),A.getNodeAttribute(Ii).setMultiple(k,C)}(j,this,k,N),this._ogma.modules.geo.isEnabled()?O.afterNextFrame().then((()=>O.afterNextFrame())).then((()=>this)):O.afterNextFrame().then((()=>this))}getAnimationInformation(){return this._ogma.modules.graphics.getAnimationInformation(this)}getMetaNode(){return this._ogma.modules.grouping.getMetaElement(this)}getSubNodes(){return this._ogma.modules.grouping.getSubElements(this)}pulse(A){return this._ogma.modules.pulses.pulse(this,A)}};ci([Gi],{setStyle:"setAttributes",resetStyle:"resetAttributes",getStyle:"getAttribute",setPosition:"setAttributes"});var Wi=new Uint32Array(1),Xi=class{constructor(A,w){this.size=1,this.isNode=!1,this.isList=!1,this._index=A,this._ogma=w}get _indexes(){return Wi[0]=this._index,Wi}setAttributes(A,w,T){return this._ogma.modules.individualAttributes.setMultipleAttributes(this,A,w,T)}setAttribute(A,w,T){return this._ogma.modules.individualAttributes.setSingleAttribute(this,A,w,T)}getAttributes(A){return this._ogma.modules.individualAttributes.getMultipleAttributes(this,A)[0]}getAttribute(A){return this._ogma.modules.individualAttributes.getSingleAttribute(this,A)[0]}resetAttributes(A,w){return this._ogma.modules.individualAttributes.resetMultipleAttributes(this,A,w)}replaceOriginalAttributes(A,w){return this._ogma.modules.individualAttributes.replaceOriginalAttributes(this,A,w)}getPreviousAttributes(A){return this._ogma.modules.individualAttributes.getMultiplePreviousAttributes(this,A)[0]}isInView(A){return this._ogma.modules.locate.isElementInView(this,A)}getParallelEdges(A){return this._ogma.modules.graph.getParallelEdges(this,A)}fastGetAdjacentElements(){return this._ogma.modules.graph.fastGetEdgesAdjacentElements(this)}getAdjacentElements(){let{nodes:A,edges:w}=this.fastGetAdjacentElements();return{nodes:A.dedupe(),edges:w.filter((A=>A!==this)).dedupe()}}isVisible(){return!this.isExcluded()}isExcluded(){return this._ogma.modules.graph.isExcluded(this)[0]}setExcluded(A){return this._ogma.modules.graph.setExcluded(this,A)}setVisible(A){return this.setExcluded(!A)}toList(){return this._ogma.modules.graph.edgeList(new Uint32Array([this._index]))}getId(){return hi(this._ogma.modules.graph,this)}getSource(){return kc(this._ogma.modules.graph,this)}getTarget(){return Bc(this._ogma.modules.graph,this)}getExtremities(){return this._ogma.modules.graph.nodeList(new Uint32Array([this.getSource()._index,this.getTarget()._index]))}setSource(A){this._ogma.modules.graph.setSource(this,A)}setTarget(A){this._ogma.modules.graph.setTarget(this,A)}slice(){return this.toList()}toJSON(A={}){let{attributes:w,data:T}=Ac(A);return{id:this.getId(),source:this.getSource().getId(),target:this.getTarget().getId(),attributes:this.getAttributes(w),data:T(nt(this.getData()))}}get(A){return 0===A?this:void 0}setSelected(A){this._ogma.modules.selection.setActive(this,A)}isSelected(){return this._ogma.modules.selection.areActive(this)}locate(A){return this._ogma.modules.locate.locateElements(this,A)}getBoundingBox({includeTexts:A=!1,ignoreCurvature:w=!1}={}){return this._ogma.modules.locate.getBoundingBox(this,A,A,w)}setData(A,w){return arguments.length<2&&(w=A,A=null),this._ogma.modules.data.setProperty(this,A,w),this}getData(A){return this._ogma.modules.data.getProperty(this,A||null)[0]}addClass(A,w){return this._ogma.modules.classes.addClassesToElements([A],this,w)}addClasses(A,w){return this._ogma.modules.classes.addClassesToElements(A,this,w)}removeClass(A,w){return this._ogma.modules.classes.removeClassesFromElements([A],this,w)}removeClasses(A,w){return this._ogma.modules.classes.removeClassesFromElements(A,this,w)}hasClass(A){return this._ogma.modules.classes.hasSingleElementClass(A,this)}getClassList(){return this._ogma.modules.classes.getElementsClassList(this)[0]}getAnimationInformation(){return this._ogma.modules.graphics.getAnimationInformation(this)[0]}isVirtual(){return this._ogma.modules.transformations.isElementVirtual(this)}getTransformation(){return this._ogma.modules.transformations.getElementTransformation(this)}getMetaEdge(){return this._ogma.modules.grouping.getMetaElement(this)[0]}getSubEdges(){return this._ogma.modules.grouping.getSubElements(this)[0]}pulse(A){return this._ogma.modules.pulses.pulse(this,A)}};ci([Xi],{setStyle:"setAttributes",resetStyle:"resetAttributes",getStyle:"getAttribute"});var Yi=class{constructor(A,w){this.isList=!0,this.isNode=!1,this._indexes=A,this._ogma=w}get size(){return this._indexes.length}setAttributes(A,w){return this._ogma.modules.individualAttributes.setMultipleAttributes(this,A,w)}setAttribute(A,w,T){return this._ogma.modules.individualAttributes.setSingleAttribute(this,A,w,T)}getAttributes(A){return this._ogma.modules.individualAttributes.getMultipleAttributes(this,A)}getAttribute(A){return this._ogma.modules.individualAttributes.getSingleAttribute(this,A)}resetAttributes(A,w){return this._ogma.modules.individualAttributes.resetMultipleAttributes(this,A,w)}replaceOriginalAttributes(A,w){return this._ogma.modules.individualAttributes.replaceOriginalAttributes(this,A,w)}getPreviousAttributes(A){return this._ogma.modules.individualAttributes.getMultiplePreviousAttributes(this,A)}getPreviousAttribute(A){return this._ogma.modules.individualAttributes.getSinglePreviousAttribute(this,A)}getParallelEdges(A){return this._ogma.modules.graph.getParallelEdges(this,A)}fastGetAdjacentElements(){return this._ogma.modules.graph.fastGetEdgesAdjacentElements(this)}getAdjacentElements(){let{nodes:A,edges:w}=this.fastGetAdjacentElements();return{nodes:A.dedupe(),edges:w.subtract(this).dedupe()}}isVisible(){return this.isExcluded().map((A=>!A))}isExcluded(){return this._ogma.modules.graph.isExcluded(this)}setExcluded(A){return this._ogma.modules.graph.setExcluded(this,A)}setVisible(A){return this.setExcluded(!A)}toList(){return this}toArray(){return Mc(this._ogma.modules.graph,this)}clone(){return this._ogma.modules.graph.edgeList(this._indexes.slice())}getId(){return hi(this._ogma.modules.graph,this)}getSource(){return kc(this._ogma.modules.graph,this)}getTarget(){return Bc(this._ogma.modules.graph,this)}getExtremities(){return this.getSource().concat(this.getTarget())}get(A){return Gc(this._ogma.modules.graph,this,A)}forEach(A){Sc(this._ogma.modules.graph,this,A)}map(A){return Lc(this._ogma.modules.graph,this,A)}filter(A){return Ic(this._ogma.modules.graph,this,A)}reduce(A,w){return Oc(this._ogma.modules.graph,this,A,w)}concat(A){return Fc(this._ogma.modules.graph,this,A)}dedupe(){return Pc(this._ogma.modules.graph,this)}subtract(A){return wc(this,A,this._ogma.modules.graph)}slice(A,w){return this._ogma.modules.graph.edgeList(this._indexes.slice(A,w))}indexOf(A){return A instanceof Xi?this._indexes.indexOf(A._index):-1}includes(A){return-1!==this.indexOf(A)}sort(A){return zc(this._ogma.modules.graph,this,A)}inverse(){return Rc(this._ogma.modules.graph,this)}toJSON(A={}){return this.map((w=>w.toJSON(A)))}setSelected(A){this._ogma.modules.selection.setActive(this,A)}isSelected(){return this._ogma.modules.selection.areActive(this)}locate(A){return this._ogma.modules.locate.locateElements(this,A)}getBoundingBox({includeTexts:A=!1,ignoreCurvature:w=!1}={}){return this._ogma.modules.locate.getBoundingBox(this,A,A,w)}setData(A,w){if(arguments.length<2&&(w=A,A=null),"function"!=typeof w&&!At(w))throw new Error(`invalid argument ${w}; expected array or function`);return this._ogma.modules.data.setProperty(this,A,w,{dispatch:!0}),this}fillData(A,w){return arguments.length<2&&(w=A,A=null),this._ogma.modules.data.setProperty(this,A,w,{dispatch:!1}),this}getData(A){return this._ogma.modules.data.getProperty(this,A||null)}addClass(A,w){return this._ogma.modules.classes.addClassesToElements([A],this,w)}addClasses(A,w){return this._ogma.modules.classes.addClassesToElements(A,this,w)}removeClass(A,w){return this._ogma.modules.classes.removeClassesFromElements([A],this,w)}removeClasses(A,w){return this._ogma.modules.classes.removeClassesFromElements(A,this,w)}hasClass(A){return this.map((w=>this._ogma.modules.classes.hasSingleElementClass(A,w)))}getClassList(){return this._ogma.modules.classes.getElementsClassList(this)}getAnimationInformation(){return this._ogma.modules.graphics.getAnimationInformation(this)}getMetaEdge(){return this._ogma.modules.grouping.getMetaElement(this)}getSubEdges(){return this._ogma.modules.grouping.getSubElements(this)}pulse(A){return this._ogma.modules.pulses.pulse(this,A)}};ci([Yi],{setStyle:"setAttributes",resetStyle:"resetAttributes",getStyle:"getAttribute"});var qi={};Ua(qi,{BUTTON_MAPPING:()=>st,BoundingBox:()=>ws,ColorManager:()=>Fs,DummyCanvas:()=>Ki,DummyCanvasRenderingContext2D:()=>es,DummyDomElement:()=>$e,DummyFileReader:()=>We,DummyTextNode:()=>ps,DummyXHR:()=>Ve,ElementSet:()=>Ss,EventTarget:()=>Ls,FlexArray:()=>Yt,IndexList:()=>qt,Map2:()=>ss,PathMap:()=>as,PrioritySet:()=>bs,SVG_NS:()=>Qe,Table:()=>Qt,XLINK:()=>et,XML_NS:()=>Ke,applyCursorStyle:()=>Qo,baseURI:()=>Qg,binaryIndexOf:()=>zg,cancelAnimFrame:()=>Vg,clamp:()=>Vt,clearCanvas:()=>Wc,componentsToRGBA:()=>Cp,computeMax:()=>di,computeMin:()=>Hr,computeSum:()=>op,concatenateArrays:()=>GN,createBlob:()=>jo,createCanvas:()=>Lt,createDummyDomElement:()=>Zo,createDummyXmlDocument:()=>Pp,createElement:()=>cc,createSvgElement:()=>lt,createTextNode:()=>Ya,createWorker:()=>Ip,createXmlDocument:()=>wp,dataUrlToBlob:()=>eE,debounce:()=>VN,deepCopy:()=>nt,displayPixelsOnScreen:()=>xT,ensureTransferable:()=>Ji,escapeDOMAttribute:()=>oi,extendList:()=>XN,fadeElement:()=>Jg,fetch:()=>no,fetchBinary:()=>rE,fetchBinaryAsBase64:()=>$g,flatten:()=>Qi,flattenArray:()=>Gg,forEach:()=>cr,formatAngle:()=>rs,formatWorkerMessage:()=>Lp,getBaseLog:()=>sp,getCurrentTime:()=>Ut,getDate:()=>Hg,getDocument:()=>Ur,getDocumentFontRules:()=>Ap,getEmbeddedFontRules:()=>vp,getFlattenedKeys:()=>Rn,getImage:()=>jg,getLeafValues:()=>Ha,getOptions:()=>Ft,getPixelRatio:()=>Ye,getProperty:()=>Tt,getStyle:()=>Yg,getTime:()=>Wg,getValues:()=>$i,getWebglContext:()=>Xc,hash8:()=>rc,indexArrayToArray:()=>ji,indexByName:()=>KN,insertSortAsc:()=>Ho,insertSortDesc:()=>BN,isArray:()=>At,isBlob:()=>ZN,isHTMLElement:()=>Zg,isInteger:()=>UN,isLittleEndian:()=>Zi,isObject:()=>wt,isRawObject:()=>wn,isWebGLSupported:()=>Dp,lerp:()=>bt,mapKeys:()=>oo,mapValues:()=>Sr,merge:()=>nr,mergeValues:()=>Wa,mix:()=>bc,nextPowerOfTwo:()=>Vr,objToValueList:()=>dd,parseColorHex:()=>Yc,parseColorRgba:()=>Kc,pick:()=>ic,processQueue:()=>HN,promiseQueue:()=>Ug,promptDownload:()=>fr,removeFromArray:()=>zN,requestAnimFrame:()=>Xa,resizeElement:()=>$o,resolvePath:()=>YE,serializeXMLDocument:()=>md,setAttributes:()=>dc,setCtxFont:()=>Tr,setElementSize:()=>rn,setKeys:()=>_T,setProperty:()=>Nr,setValues:()=>ds,smartRequire:()=>$t,throttle:()=>Va,toArray:()=>Wo,toHexa:()=>ud,toPropertyPath:()=>Br,traverse:()=>Zb,unflatten:()=>nc,unorderedHash:()=>WN,workerIsAvailable:()=>hs});var Ki=class{constructor(){this.style={},this.width=300,this.height=150,this.__context=new es,this.style={},this.width=300,this.height=150}get __dummy(){return!0}get parentNode(){return null}getContext(A){return"2d"===A?this.__context:null}toDataURL(A="png"){return`data:image/${A};base64,`}addEventListener(){}removeEventListener(){}getBoundingClientRect(){return{left:0,top:0,bottom:0,right:0,width:this.width,height:this.height}}},es=class{constructor(){this._fontSize=10}set font(A){let w=A.match(/\d+/);w&&(this._fontSize=parseFloat(w[0]))}set fillStyle(A){}set textBaseline(A){}set textAlign(A){}set strokeStyle(A){}set lineWidth(A){}fill(){}stroke(){}clearRect(){}fillRect(){}strokeRect(){}beginPath(){}closePath(){}moveTo(){}lineTo(){}rect(){}arc(){}save(){}restore(){}clip(){}translate(){}rotate(){}fillText(){}setLineDash(){}quadraticCurveTo(){}bezierCurveTo(){}drawImage(){}measureText(A){return{width:A.length*Math.ceil(.625*this._fontSize)}}getImageData(){return{width:0,height:0,data:new Uint8ClampedArray(0)}}},ts=$t("canvas")||$t("canvas-prebuilt");function Lt(A=300,w=150){if(pe){let T=document.createElement("canvas");return T.width=A,T.height=w,T}if(ts){let T=null;return T="createCanvas"in ts?ts.createCanvas(A,w):new ts(A,w),T.style={},T}let T=new Ki;return T.width=A,T.height=w,T}function Wc(A,w,T=A.width,C=A.height){w.clearRect(0,0,T,C)}function Tr(A,w,T,C=""){A.font=`${C} ${T}px ${w}`}function Dp(){return null!==Xc(Lt(),{})}function Xc(A,w){let T=A.getContext("webgl",w);return T||(T=A.getContext("experimental-webgl",w)),T||null}function cT(A){let w="";for(let T=0;T<A.length;T++)w+=A[T].cssText+"\n";return w}function Ap(){let A=Ur(),w=A.styleSheets,T=Qg(A),C=[],k=[];for(let A=0;A<w.length;A++){let N=w[A];null==N.href?C.push({href:T,content:cT(N.cssRules)}):k.push(N.href)}let N=/@font-face\s*\{[^}]+\}/g;return Promise.all(k.map((A=>no(A).then((w=>({href:A,content:w}))).catch(ii)))).then((A=>A.concat(C))).then((A=>{let w=[];for(let T=0;T<A.length;T++){let C=A[T];if(null!==C){let{href:A,content:T}=C,k=T.match(N);if(k){let T=mT(k,A);w.push.apply(w,T)}}}return w}))}function vp(A,w){return Promise.all(A.map((({formats:A,originalRule:T})=>Promise.all(A.map((({format:A,url:T})=>w?$g(T).then((w=>({format:A,src:w}))).catch(ii):{format:A,src:T}))).then((A=>{let w=[];for(let T of A)null!==T&&w.push(`url('${T.src}') format('${T.format}')`);if(0!==w.length){let A=`src: ${w.join(",")}`;return T.replace(/@font-face\s*{([^}]*);?}/,`@font-face{$1;${A}}`).replace(/\s+/," ").replace(/;+/,";")}return T})))))}var is={"embedded-opentype":!0,svg:!0};function mT(A,w){let T=/url\(['"]?([^'")]+)['"]?\)\s+format\(['"]?([^'")]+)['"]?\)/g,C=/font-family\s*:\s*['"]?([^;'"]+)['"]?;/,k=[];for(let N=0;N<A.length;N++){let O=A[N],j=O.match(C);if(j){let A,C=j[1],N=[];for(;A=T.exec(O);){let T=A[1],C=A[2];is[C.toLowerCase()]||N.push({format:C,url:YE(T,w)})}k.push({name:C,formats:N,originalRule:O})}}return k}function YE(A,w){if(/^http(s)?:/.test(A))return A;if("/"===A[0]){let T=w.match(/((\w+:\/\/)([^/]+))/);return T?T[1]+A:A}let T=A.split("/"),C=w.split("/");for("/"!==w[w.length-1]&&C.pop();".."===T[0];)T.shift(),C.pop();return C.concat(T).join("/").replace(/[\w](\/{2,})/g,(A=>A[0]+"/"))}function oo(A){if(A.keys)return Array.from(A.keys());let w=[];return A.forEach(((A,T)=>w.push(T))),w}function Sr(A){if(A.values)return Array.from(A.values());let w=[];return A.forEach((A=>w.push(A))),w}var ss=class{constructor(){this._map=new Map}reset(){this._map.clear()}set(A,w,T){this._map.set(cp(A,w),T)}get(A,w){return this._map.get(cp(A,w))}};var ns="undefined"==typeof HTMLElement?A=>!1:A=>A instanceof HTMLElement,fT=function(A){return"object"!=typeof A||null===A||At(A)||function gT(A){return A instanceof RegExp||A instanceof Date}(A)};function dd(A,w=[],T=[]){if(!ns(A)){if(fT(A))w.push({path:T.slice(),value:A});else{let C=Object.keys(A);for(let k=0;k<C.length;++k){let N=C[k],O=T.slice();O.push(N),dd(A[N],w,O)}}return w}}var as=class{constructor(){this._keys=[],this._values=[],this._size=0,this._cachedPath=[],this._cachedIndex=-1}get size(){return this._size}set(A,w){let T=this._getIndex(A);-1!==T?this._values[T]=w:(Np(this._cachedPath,A)&&(this._cachedIndex=this._keys.length),this._keys.push(A),this._values.push(w),this._size+=1)}get(A){let w=this._getIndex(A);if(-1!==w)return this._values[w]}has(A){return-1!==this._getIndex(A)}keys(){return this._keys.slice()}_getIndex(A){if(Np(A,this._cachedPath))return this._cachedIndex;this._cachedPath=A.slice();let w=this._keys;for(let T=0;T<w.length;++T)if(Np(w[T],A))return this._cachedIndex=T,T;return this._cachedIndex=-1,-1}};function Np(A,w){if(A.length!==w.length)return!1;for(let T=0;T<A.length;++T)if(A[T]!==w[T])return!1;return!0}var _T=function(A){return Array.from(A.keys())},ds=function(A){return Array.from(A.values())},ls=$t("web-worker"),hs=!!ls||"undefined"!=typeof Worker&&"undefined"!=typeof Blob;function Lp(A){return ls?Tp(A):A}function Tp(A){if(ArrayBuffer.isView(A))return Array.from(A);if(Array.isArray(A)){for(let w=0;w<A.length;w++)A[w]=Tp(A[w]);return A}if(wt(A)){let w=Object.keys(A);for(let T of w)A[T]=Tp(A[T]);return A}return A}function Ip(A){return ls?function ET(A){if(ls)return new ls("data:application/javascript,"+A.replace(/\n/g,""))}(A):function bT(A){let w=new Blob([A],{type:"application/javascript"}),T=URL.createObjectURL(w);return new Worker(T)}(A)}var gs=/^rgba?\((\d+),?\s*(\d+),?\s*(\d+),?\s*((\d+)?\.?\d+)*\)$/;function Kc(A,w=[0,0,0,0]){let T=gs.exec(A);return T?(w[0]=parseInt(T[1])/255,w[1]=parseInt(T[2])/255,w[2]=parseInt(T[3])/255,w[3]=void 0===T[4]?1:parseFloat(T[4]),w):null}function ud(A){return A<16?"0"+A.toString(16):A.toString(16)}function Cp([A,w,T,C=1]){return`rgba(${256*A|0},${256*w|0},${256*T|0},${C})`}function Yc(A){A=A.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,((A,w,T,C)=>w+w+T+T+C+C));let w=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(A);return w?[parseInt(w[1],16)/255,parseInt(w[2],16)/255,parseInt(w[3],16)/255,1]:null}var _s,ms=$t("xmldom");_s="undefined"!=typeof XMLSerializer?XMLSerializer:ms?ms.XMLSerializer:null;var fs=class{constructor(A){this._attributes={},this._children=[],this._name=A}setAttribute(A,w){this._attributes[A]=w}appendChild(A){this._children.push(A)}get tagName(){return this._name}get children(){return this._children}get childNodes(){return this._children}get firstChild(){return this._children[0]||null}serialize(){let A=this._name,w=this._attributes,T=this._children,C=Object.keys(w).filter((A=>void 0!==w[A])).map((A=>` ${A}="${""+w[A]}"`)).join(""),k=T.map((A=>A.serialize())).join("");return k.length?`<${A}${C}>${k}</${A}>`:`<${A}${C}/>`}cloneNode(A){let w=new fs(this._name),T=Object.keys(this._attributes);for(let A of T)w.setAttribute(A,this._attributes[A]);if(A)for(let T=0;T<this._children.length;T++)w.appendChild(this._children[T].cloneNode(A));return w}},ps=class{constructor(A){this._text=A}serialize(){return this._text}cloneNode(){return new ps(this._text)}},Pp=()=>new class{constructor(){this._children=[],this._meta=[],this._children=[],this._meta=[]}appendChild(A){this._children.push(A)}serialize(){return this._meta.concat(this._children.map((A=>A.serialize()))).join("")}createElement(A){return new fs(A)}createTextNode(A){return new ps(A)}};function md(A){if(_s)return(new _s).serializeToString(A)}var wp=()=>Ur().implementation.createDocument("","",null),bs=class{constructor(A){this._heap=[],this._size=0,this._keyToValue=A,this._keyToIndex=new Int32Array(A.length),this._keyToIndex.fill(-1)}add(A){let w=this._keyToIndex[A];-1===w&&(w=this._size++,this._heap[w]=A),this._keyToIndex[A]=this._bubble(w)}removeMin(){if(0===this._size)return NaN;let A=this._heap[0];return this._heap[0]=this._heap[--this._size],this._bubble(0),A}isEmpty(){return 0===this._size}has(A){return-1!==this._keyToIndex[A]}_bubble(A){let w=this._indexToValue(A),T=this._getParentIndex(A),C=this._indexToValue(T),k=A;if(0!==A&&C>w)k=this._swap(A,T);else{let T=this._getLeftChildIndex(A),C=this._getRightChildIndex(A),N=this._indexToValue(T),O=this._indexToValue(C),j=Math.min(w,N,O);j===w||(k=j===N?this._swap(A,T):this._swap(A,C))}return k===A?A:this._bubble(k)}_indexToValue(A){return A>=this._size?1/0:this._keyToValue[this._heap[A]]}_getParentIndex(A){return(A-1)/2|0}_getLeftChildIndex(A){return 2*A+1}_getRightChildIndex(A){return 2*A+2}_swap(A,w){let T=this._heap[A],C=this._heap[w];return this._heap[A]=C,this._heap[w]=T,this._keyToIndex[T]=w,this._keyToIndex[C]=A,w}},Ss=class{constructor(A,w){this._graph=A,this._nodes={elementList:A.nodeList,flexArray:A.createNodeAttribute({storage:1,name:w},!!w),indexList:A.createIndexList(!0)},this._edges={elementList:A.edgeList,flexArray:A.createEdgeAttribute({storage:1,name:w},!!w),indexList:A.createIndexList(!1)}}_get(A){return A.isNode?this._nodes:this._edges}addOrRemoveElements(A,w){return w?this.addElements(A):this.removeElements(A)}addElements(A){let{elementList:w,flexArray:T,indexList:C}=this._get(A),k=C.getLength();for(let w=0;w<A._indexes.length;w++){let k=A._indexes[w];1!==T.get(k)&&(T.set(k,1),C.pushUnchecked(k))}return w(C.slice(k))}removeElements(A){let{elementList:w,flexArray:T,indexList:C}=this._get(A),k=C.getLength(),N=C.getBuffer();if(k>N.length)return this.clear(),this.addElements(A),A;let O=0;for(let w=0;w<A._indexes.length;w++){let C=A._indexes[w];0!==T.get(C)&&(T.set(C,0),O+=1)}if(O===k)return w(C.sliceAndReset());if(0===O)return w();{let j=this._graph.acquireIndexList(A.isNode),G=0;for(let A=0;A<k;++A){let w=N[A];0===T.get(w)?(G+=1,j.pushUnchecked(w)):N[A-G]=w}return C.setLength(k-O),w(j.sliceAndReset())}}hasElement(A){return!!this._get(A).flexArray.get(A._index)}clear(){this._nodes.indexList.isEmpty()||(this._nodes.indexList.reset(),this._nodes.flexArray.reset()),this._edges.indexList.isEmpty()||(this._edges.indexList.reset(),this._edges.flexArray.reset())}isEmpty(){return this._nodes.indexList.isEmpty()&&this._edges.indexList.isEmpty()}getElements(){return{nodes:this._nodes.elementList(this._nodes.indexList.slice()),edges:this._edges.elementList(this._edges.indexList.slice())}}};function xT(A,w,T,C=0){void 0===w&&(w=T=Math.sqrt(A.length/4)),void 0===T&&(T=w);let k=document.createElement("canvas"),N=k.getContext("2d");if(N){let O=N.createImageData(w,T);k.style.imageRendering="pixelated",k.style.border="1px solid black",k.style.margin="2px",k.style.position="absolute",k.style.top=k.style.left="0px",k.width=w,k.height=T,O.data.set(A),N.putImageData(O,0,0);let j=document.getElementById("graph-container");j&&(j.style.position="static"),setTimeout((()=>document.body.appendChild(k)),C)}}var ws=class{constructor(A={}){let{xValues:w=[],yValues:T=[],scaledSizeValues:C=[],fixedSizeValues:k=[]}=A;this.minX=Hr(w),this.minY=Hr(T),this.maxX=di(w),this.maxY=di(T),this.minScaledSize=Hr(C),this.maxScaledSize=di(C),this.minFixedSize=Hr(k),this.maxFixedSize=di(k),this.cx=this.minX+(this.maxX-this.minX)/2,this.cy=this.minY+(this.maxY-this.minY)/2,this.width=this.maxX-this.minX,this.height=this.maxY-this.minY}reset(){return this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.minScaledSize=1/0,this.maxScaledSize=-1/0,this.minFixedSize=1/0,this.maxFixedSize=-1/0,this.width=0,this.height=0,this.cx=0,this.cy=0,this}addPoint(A,w,T,C){return this.minX=Math.min(this.minX,A),this.minY=Math.min(this.minY,w),this.maxX=Math.max(this.maxX,A),this.maxY=Math.max(this.maxY,w),void 0!==T&&void 0!==C&&("scaled"===C?(this.minScaledSize=Math.min(this.minScaledSize,T),this.maxScaledSize=Math.max(this.maxScaledSize,T)):(this.minFixedSize=Math.min(this.minFixedSize,T),this.maxFixedSize=Math.max(this.maxFixedSize,T))),this.cx=this.minX+(this.maxX-this.minX)/2,this.cy=this.minY+(this.maxY-this.minY)/2,this.width=this.maxX-this.minX,this.height=this.maxY-this.minY,this}computeForZoom(A){let w=Math.max(this.maxScaledSize,this.maxFixedSize/A);return ws.from({minX:this.minX-w/2,minY:this.minY-w/2,maxX:this.maxX+w/2,maxY:this.maxY+w/2,width:this.width+w,height:this.height+w})}static from({minX:A,minY:w,maxX:T,maxY:C,width:k,height:N}={}){let O=new ws;return null!=A&&(O.minX=A),null!=w&&(O.minY=w),null!=T&&(O.maxX=T),null!=C&&(O.maxY=C),null!=T&&null!=A&&(O.width=k||(T-A)/2,O.cx=(A+T)/2),null!=C&&null!=w&&(O.height=N||(C-w)/2,O.cy=(w+C)/2),O}static fromValues(A,w,T){let C=1/0,k=1/0,N=-1/0,O=-1/0,j=-1/0;for(let G=0;G<A.length;G++){let H=A[G],W=w[G],$=T[G];H-$<C&&(C=H-$),W-$<k&&(k=W-$),H+$>N&&(N=H+$),W+$>O&&(O=W+$),$>j&&(j=$)}let G=ws.from({minX:C,minY:k,maxX:N,maxY:O});return G.maxScaledSize=j,G}pad(A){return this.minX-=A,this.minY-=A,this.maxX+=A,this.maxY+=A,this.width+=2*A,this.height+=2*A,this}isValid(){return isFinite(this.width)&&isFinite(this.height)}extend(A){return this.addPoint(A.minX,A.minY),this.addPoint(A.maxX,A.maxY),this}bottomLeft(){return{x:this.minX,y:this.minY}}topRight(){return{x:this.maxX,y:this.maxY}}},Ls=class{on(A,w){if("string"!=typeof A)throw new TypeError("Event name must be string");if("function"!=typeof w)throw new TypeError("Event handler must be function");let T=this._events=this._events||{};return(T[A]=T[A]||[]).push(w),this}off(A,w){if("string"!=typeof A)throw new TypeError("Event name must be string");let T=this._events=this._events||{},C=T[A];if(At(C))if("function"!=typeof w)T[A]=null;else{let k=C.indexOf(w);-1!==k&&C.splice(k,1),0===C.length&&(T[A]=null)}return this}fire(A,...w){if("string"!=typeof A)throw new TypeError("Event name must be string");let T=(this._events=this._events||{})[A];if(At(T)){let A=w;for(let w=0;w<T.length;w++){let C=T[w];C&&C.apply(this,A)}}return this}once(A,w){let T=this,i=function(...C){w.apply(T,C),T.off(A,i)};return i.handler=w,this.on(A,i)}hasListener(A,w){if(!A||!w)return!1;let T=(this._events=this._events||{})[A];if(At(T))for(let A=0,C=T.length;A<C;A++){let C=T[A];if(C===w||C.handler===w)return!0}return!1}clearEvents(){this._events={}}getListeners(A){return(this._events=this._events||{})[A]}},Ms=["AliceBlue","#F0F8FF","AntiqueWhite","#FAEBD7","Aqua","#00FFFF","Aquamarine","#7FFFD4","Azure","#F0FFFF","Beige","#F5F5DC","Bisque","#FFE4C4","Black","#000000","BlanchedAlmond","#FFEBCD","Blue","#0000FF","BlueViolet","#8A2BE2","Brown","#A52A2A","BurlyWood","#DEB887","CadetBlue","#5F9EA0","Chartreuse","#7FFF00","Chocolate","#D2691E","Coral","#FF7F50","CornflowerBlue","#6495ED","Cornsilk","#FFF8DC","Crimson","#DC143C","Cyan","#00FFFF","DarkBlue","#00008B","DarkCyan","#008B8B","DarkGoldenRod","#B8860B","DarkGray","#A9A9A9","DarkGrey","#A9A9A9","DarkGreen","#006400","DarkKhaki","#BDB76B","DarkMagenta","#8B008B","DarkOliveGreen","#556B2F","DarkOrange","#FF8C00","DarkOrchid","#9932CC","DarkRed","#8B0000","DarkSalmon","#E9967A","DarkSeaGreen","#8FBC8F","DarkSlateBlue","#483D8B","DarkSlateGray","#2F4F4F","DarkSlateGrey","#2F4F4F","DarkTurquoise","#00CED1","DarkViolet","#9400D3","DeepPink","#FF1493","DeepSkyBlue","#00BFFF","DimGray","#696969","DimGrey","#696969","DodgerBlue","#1E90FF","FireBrick","#B22222","FloralWhite","#FFFAF0","ForestGreen","#228B22","Fuchsia","#FF00FF","Gainsboro","#DCDCDC","GhostWhite","#F8F8FF","Gold","#FFD700","GoldenRod","#DAA520","Gray","#808080","Grey","#808080","Green","#008000","GreenYellow","#ADFF2F","HoneyDew","#F0FFF0","HotPink","#FF69B4","IndianRed","#CD5C5C","Indigo","#4B0082","Ivory","#FFFFF0","Khaki","#F0E68C","Lavender","#E6E6FA","LavenderBlush","#FFF0F5","LawnGreen","#7CFC00","LemonChiffon","#FFFACD","LightBlue","#ADD8E6","LightCoral","#F08080","LightCyan","#E0FFFF","LightGoldenRodYellow","#FAFAD2","LightGray","#D3D3D3","LightGrey","#D3D3D3","LightGreen","#90EE90","LightPink","#FFB6C1","LightSalmon","#FFA07A","LightSeaGreen","#20B2AA","LightSkyBlue","#87CEFA","LightSlateGray","#778899","LightSlateGrey","#778899","LightSteelBlue","#B0C4DE","LightYellow","#FFFFE0","Lime","#00FF00","LimeGreen","#32CD32","Linen","#FAF0E6","Magenta","#FF00FF","Maroon","#800000","MediumAquaMarine","#66CDAA","MediumBlue","#0000CD","MediumOrchid","#BA55D3","MediumPurple","#9370DB","MediumSeaGreen","#3CB371","MediumSlateBlue","#7B68EE","MediumSpringGreen","#00FA9A","MediumTurquoise","#48D1CC","MediumVioletRed","#C71585","MidnightBlue","#191970","MintCream","#F5FFFA","MistyRose","#FFE4E1","Moccasin","#FFE4B5","NavajoWhite","#FFDEAD","Navy","#000080","OldLace","#FDF5E6","Olive","#808000","OliveDrab","#6B8E23","Orange","#FFA500","OrangeRed","#FF4500","Orchid","#DA70D6","PaleGoldenRod","#EEE8AA","PaleGreen","#98FB98","PaleTurquoise","#AFEEEE","PaleVioletRed","#DB7093","PapayaWhip","#FFEFD5","PeachPuff","#FFDAB9","Peru","#CD853F","Pink","#FFC0CB","Plum","#DDA0DD","PowderBlue","#B0E0E6","Purple","#800080","RebeccaPurple","#663399","Red","#FF0000","RosyBrown","#BC8F8F","RoyalBlue","#4169E1","SaddleBrown","#8B4513","Salmon","#FA8072","SandyBrown","#F4A460","SeaGreen","#2E8B57","SeaShell","#FFF5EE","Sienna","#A0522D","Silver","#C0C0C0","SkyBlue","#87CEEB","SlateBlue","#6A5ACD","SlateGray","#708090","SlateGrey","#708090","Snow","#FFFAFA","SpringGreen","#00FF7F","SteelBlue","#4682B4","Tan","#D2B48C","Teal","#008080","Thistle","#D8BFD8","Tomato","#FF6347","Turquoise","#40E0D0","Violet","#EE82EE","Wheat","#F5DEB3","White","#FFFFFF","WhiteSmoke","#F5F5F5","Yellow","#FFFF00","YellowGreen","#9ACD32"],Is=[0,0,0,0],Fs=class{constructor(){this._colorByName=new Map,this._colorByName.set(null,[0,0,0,0]),this._colorByName.set("transparent",[0,0,0,0]);for(let A=0;A<Ms.length;A+=2){let w=Ms[A].toLowerCase(),T=Ms[A+1];this._colorByName.set(w,Yc(T))}}parseColor(A){let w=this._colorByName.get(A);if(void 0===w){let T=A+"",C="#"===T.charAt(0)?Yc(T):Kc(T);this._colorByName.set(A,C),w=C}return w}toHexa(A){let w=this.parseColor(A);if(!w)return null;let[T,C,k]=w;return`#${ud(255*T)}${ud(255*C)}${ud(255*k)}`}rgbaToRgb(A){let w=1,T=A;return T&&Kc(A,Is)&&(T=`rgb(${255*+Is[0]},${255*+Is[1]},${255*+Is[2]})`,w=parseFloat(Is[3].toString())),{color:T,opacity:w}}};function us(A,w,T,C={},k=!1){!Array.isArray(T)&&!(T instanceof(w?Gi:Yi))&&(T=[T]);let{virtual:N=!1}=C,O={elementsToRemove:A.getElements(w,T),virtual:N};A.fireEvent("requestElementsToDelete",O);let{elementsToRemove:j}=N?{elementsToRemove:T}:O;if(!j.size)return Promise.resolve();j=j.dedupe();let G=A.storage.fetch(w),H=G.getFlexArray("removed");if(j=j.filter((A=>0===H.get(A._index))),w){let w=j.getAdjacentEdges({filter:"all"}),T=w.filter((A=>A.isVirtual()));us(A,!1,w,C,!0),us(A,!1,T,{virtual:!0},!0)}let W=j._indexes,$=A.getCacheLists(w);if(op(G.getFlexArray("virtual").getMultiple(W))!==(N?W.length:0))throw new Error("Attempting to remove virtual elements; you should not do that");let Z={virtual:N,[w?"nodes":"edges"]:j};if(A.fireEvent(w?"beforeRemoveNodes":"beforeRemoveEdges",Z),$.visible.invalidList(),$.all.invalidList(),N||$.raw.invalidList(),A.setExcluded(j,!0),H.setMultiple(W,1),!w)for(let w=0;w<W.length;++w)A.topology.removeFromAdjacencyList(W[w]);return G.removeElements(W),A.fireEvent(w?"removeNodes":"removeEdges",Z),Promise.resolve()}function cs(A,w,T={},C={}){return _d(A,w,[T],C).get(0)}function mi(A,w,T,C={}){if(C.batchSize){let k=[];for(let A=0;A<T.length;A+=C.batchSize)k.push(T.slice(A,A+C.batchSize));let o=(T,k)=>{let N;return T.then((w=>(N=w,A.getDom().afterNextFrame()))).then((()=>_d(A,w,k,C))).then((A=>N.concat(A)))},N=w?A.nodeList():A.edgeList();return k.reduce(o,Promise.resolve(N))}return Promise.resolve(_d(A,w,T,C))}function _d(A,w,T,C){A.fireEvent("preAddElements",{name:"preAddElements",objects:T,isNode:w});let k=!!C.ignoreInvalid,N=A.storage.fetch(w),O=[],j=[],G=[],H=[],W=new Set,{virtual:$=!1}=C;for(let C of T){if("object"!=typeof C||null===C||Array.isArray(C)){if(k)continue;throw new Error(`${C} is not a valid ${w?"node":"edge"}`)}let T=vc(C.id);if(!N.getIndex(T,!1)&&!W.has(T)){if(!w){let w=C,N=A.getExtremityIndex(T,w.source,0,k),O=A.getExtremityIndex(T,w.target,1,k);if(k&&(!N||!O))continue;G.push(N),H.push(O)}j.push(T),O.push(C),W.add(T)}}let Z=N.addElements(j);w?A.topology.allocateNodes(Z):A.topology.allocateEdges(Z,G,H);let se=N.getFlexArray("object"),ue=N.getFlexArray("excluded"),ge=N.getFlexArray("removed"),ce=N.getFlexArray("virtual"),_e=w?A.node:A.edge,me=w?A.nodeList:A.edgeList,pe=A.getCacheLists(w),be=me(Z);for(let A=0;A<Z.length;A++){let w=Z[A];se.set(w,_e(w))}return ue.setMultiple(Z,0),ge.setMultiple(Z,0),ce.setMultiple(Z,$?1:0),pe.visible.invalidList(),pe.all.invalidList(),pe._all.invalidList(),$||pe.raw.invalidList(),0!==be.size&&(w?A.fireEvent("addNodes",{virtual:$,objects:O,nodes:be}):A.fireEvent("addEdges",{virtual:$,objects:O,edges:be})),be}var zs=class extends kt{constructor(){super(...arguments),this.storage={nodes:new Zt(!0),edges:new Zt(!1),fetch(A){return A?this.nodes:this.edges}},this._promisesToResolve=[],this._nodeIndexLists=[],this._edgeIndexLists=[],this._onNewFrame=()=>{this.storage.nodes.freeIndexes(),this.storage.edges.freeIndexes()}}onMounted(){this._modules.events.register(["preAddElements","addNodes","addEdges","preAddGraph","postAddGraph","addGraph","excludedStateChange","clearGraph","beforeRemoveNodes","requestElementsToDelete","removeNodes","beforeRemoveEdges","removeEdges"]),[{name:"excluded",storage:1,default:1},{name:"removed",storage:1,default:1},{name:"virtual",storage:1,default:0}].forEach((A=>{this.createNodeAttribute(A,!0),this.createEdgeAttribute(A,!0)})),this.node=this._ogma.node,this.edge=this._ogma.edge,this.nodeList=this._ogma.nodeList,this.edgeList=this._ogma.edgeList,this._nodes=this.createAttribute(!0,{name:"object",storage:"any"},!0),this._edges=this.createAttribute(!1,{name:"object",storage:"any"},!0),this.createAttribute(!1,{name:"source",storage:32},!0),this.createAttribute(!1,{name:"target",storage:32},!0),this._nodeFilters=hp(this.storage.nodes),this._edgeFilters=hp(this.storage.edges),this._initialize(),this._modules.events.on("newFrame",this._onNewFrame)}onReady(A){if(A.graph){let{nodes:w,edges:T}=A.graph;w&&this.addNodes(w),T&&this.addEdges(T)}}createIndexList(A){return this.storage.fetch(A).createIndexList()}getDom(){return this._modules.dom}acquireIndexList(A){let w=A?this._nodeIndexLists:this._edgeIndexLists,T=w.find((A=>!A.isBusy()));return T||(T=this.createIndexList(A),w.push(T)),T.markBusy(),T}getObjectList(A){return A?this._nodes:this._edges}getListFactory(A){return A?this.nodeList:this.edgeList}getStorage(A){return A?this.storage.nodes:this.storage.edges}getFilter(A,w){let T=A?this._nodeFilters:this._edgeFilters;return T[w]||T.visible}fireEvent(A,w){this._modules.events.fire(A,w)}getCacheLists(A){return A?this._nodeCacheLists:this._edgeCacheLists}_resolvePromises(){let A=this._promisesToResolve;this._promisesToResolve=[],A.forEach((A=>A()))}_initialize(){this._nodeCacheLists=mp((()=>this.getNodeMaxIndex()),(()=>this.acquireIndexList(!0)),this._nodeFilters),this._edgeCacheLists=mp((()=>this.getEdgeMaxIndex()),(()=>this.acquireIndexList(!1)),this._edgeFilters),this.topology=new class{constructor(A){this._neighborTable=new Qt,this._parallelTable=new Qt,this._parallelEdgesIndex=[],this._fakeDeduper={get:()=>0,set:Ze,reset(){return this}},this._fakeInvertedDeduper={get:()=>1,set:Ze,reset(){return this}},this._graph=A,this.nodeDeduper=A.createNodeAttribute({storage:1},!1),this.edgeDeduper=A.createEdgeAttribute({storage:1},!1),this._sourceList=A.getEdgeAttribute("source"),this._targetList=A.getEdgeAttribute("target")}getAdjacentDirections(A){return this._neighborTable.get(A)}getEdgeIndexesInDirection(A){return this._parallelTable.get(A)}allocateNodes(A){this._neighborTable.reserve(A.length);for(let w=0;w<A.length;++w)this._neighborTable.addEntry(A[w])}allocateEdges(A,w,T){this._parallelTable.reserve(Math.floor(A.length/2));for(let C=0;C<A.length;C++){let k=A[C],N=w[C],O=T[C];this._sourceList.set(k,N),this._targetList.set(k,O),this.addToAdjacencyList(k)}}getExtremity(A,w){let T=A?this._sourceList:this._targetList;if(w.isList){let A=this._graph.acquireIndexList(!0);for(let C=0;C<w._indexes.length;C++)A.push(T.get(w._indexes[C]));return this._graph.nodeList(A.sliceAndReset())}return this._graph.getObjectList(!0).get(T.get(w._index))}setExtremities(A,w,T){for(let w=0;w<A.length;++w)this.removeFromAdjacencyList(A[w]);null!==w&&this._sourceList.setMultiple(A,w),null!==T&&this._targetList.setMultiple(A,T);for(let w=0;w<A.length;++w)this.addToAdjacencyList(A[w])}addToAdjacencyList(A){let w=this._sourceList.get(A),T=this._targetList.get(A),C=os(w,T),k=this._parallelEdgesIndex[C];k===Ti&&(k=this._parallelTable.addEntry(),this._parallelEdgesIndex[C]=k,this._neighborTable.addTo(w,k),w!==T&&this._neighborTable.addTo(T,k)),this._parallelTable.addTo(k,A)}removeFromAdjacencyList(A){let w=this._sourceList.get(A),T=this._targetList.get(A),C=os(w,T),k=this._parallelEdgesIndex[C];k!==Ti&&0===this._parallelTable.removeFromAndGetSize(k,A)&&(this._neighborTable.removeFrom(w,k),w!==T&&this._neighborTable.removeFrom(T,k),this._parallelEdgesIndex[C]=Ti)}getParallelEdges(A,w={}){let T=w.filter||"visible",C=this._graph.acquireIndexList(!1),k=this._graph.getFilter(!1,T);for(let w=0;w<A._indexes.length;w++){let T=A._indexes[w],N=os(this._sourceList.get(T),this._targetList.get(T)),O=this._parallelEdgesIndex[N];if(O!==Ti){let A=this._parallelTable.get(+O);if(A)for(let w of A)k(w)&&C.push(w)}}return this._graph.edgeList(C.sliceAndReset())}fastGetNodesAdjacentElements(A){let w=this._graph.acquireIndexList(!0),T=this._graph.acquireIndexList(!1),C=this._sourceList,k=this._targetList;for(let N=0;N<A.length;N++){let O=A[N],j=this._neighborTable.get(O);for(let A of j){let N=this._parallelTable.get(A),j=N[0],G=C.get(j),H=k.get(j);if(0!==G&&0!==H){w.push(G+H-O);for(let A of N)T.push(A)}}}return{nodes:this._graph.nodeList(w.sliceAndReset()),edges:this._graph.edgeList(T.sliceAndReset())}}fastGetEdgesAdjacentElements(A){let w=this._graph.acquireIndexList(!0),T=this._graph.acquireIndexList(!1),C=this._sourceList,k=this._targetList;for(let N=0;N<A.length;N++){let O=A[N],j=C.get(O),G=k.get(O),H=os(j,G),W=this._parallelEdgesIndex[H];if(W!==Ti){let A=this._parallelTable.get(+W);if(A)for(let w of A)T.push(w)}w.push(j),w.push(G)}return{nodes:this._graph.nodeList(w.sliceAndReset()),edges:this._graph.edgeList(T.sliceAndReset())}}getDeduper(A){return(A?this.nodeDeduper:this.edgeDeduper).reset()}collectAdjacentEdges(A,w,T,C=!1,k=!1){let N=w===pi,O=!(w===xi||N||k),j=this._graph.acquireIndexList(!1),G=this._graph.getFilter(!1,T),H=C?this.getDeduper(!1):this._fakeDeduper,W=this._fakeInvertedDeduper,$=this._sourceList,Z=this._targetList;if(k){W=this.getDeduper(!0);for(let w=0;w<A.length;w++)W.set(A[w],1)}for(let w=0;w<A.length;w++){let T=A[w],C=this._neighborTable.get(T);for(let A of C){let w=this._parallelTable.get(A);if(O)for(let A of w)G(A)&&0===H.get(A)&&(j.push(A),H.set(A,1));else for(let A of w){let w=$.get(A),C=Z.get(A),k=w+C-T;(N===(C===T)||w===C)&&G(A)&&0===H.get(A)&&1===W.get(k)&&(j.push(A),H.set(A,1))}}}return j.sliceAndReset()}collectAdjacentNodes(A,w,T,C=!1,k,N){let O=w!==pi,j=w!==xi,G=this._graph.acquireIndexList(!0),H=this._graph.getFilter(!1,T),W=C?this.getDeduper(!0):this._fakeDeduper,$=this._sourceList,Z=this._targetList;if(k)for(let A=0;A<k.length;A++){let w=k[A];G.push(w),W.set(w,1)}if(N)for(let A=0;A<N.length;A++){let w=N[A];W.set(w,1)}for(let w=0;w<A.length;w++){let T=A[w],C=this._neighborTable.get(T);for(let A of C){let w=this._parallelTable.get(A);for(let A of w)if(H(A)){let w=$.get(A),C=Z.get(A),k=w+C-T;if((j&&T===C||O&&T===w)&&0===W.get(k)){G.push(k),W.set(k,1);break}}}}return G.sliceAndReset()}getAdjacentElements(A,w,T={}){let C=T.direction||yi,k=T.filter||"visible",N=T.policy||"union",O=!!T.bothExtremities;if(A){let A="include-sources"===N?w:null,T="exclude-sources"===N?w:null;return this.collectAdjacentNodes(w,C,k,!0,A,T)}return this.collectAdjacentEdges(w,C,k,!0,O)}getEdgesBetweenTwoNodes(A,w){let T=os(A,w),C=this._parallelEdgesIndex[T];if(C===Ti)return new Uint32Array;let k=this._parallelTable.get(+C);return new Uint32Array(k)}getConnectedComponents(A,{filter:w="visible",returnIds:T=!1,internalIndexes:C=!1}={}){let k,N=this._graph,O=[],j={},G=N.acquireIndexList(!0);"string"==typeof w?k=N.getFilter(!0,w):(k=w,w="visible");for(let w=0;w<A.length;w++){let T=A[w];k(T)&&G.push(T)}let H=G.sliceAndReset(),W={filter:w};for(let A=0;A<H.length;A++){let w=H[A];if(!j[w]){let A=[w],T=[];for(;0!==A.length;){let w=A.pop();!j[w]&&k(w)&&(A.push.apply(A,this.getAdjacentElements(!0,new Uint32Array([w]),W)),j[w]=!0,T.push(w))}T.length>0&&O.push(T)}}if(T){let A=N.getNodeAttribute("id");for(let w=0;w<O.length;w++)O[w]=A.getMultiple(O[w])}else if(!C)for(let A=0;A<O.length;A++)O[A]=N.nodeList(new Uint32Array(O[A]));return O}getAdjacencyList({directed:A,ids:w,weight:T,nodes:C}){let k=A?xi:yi,N=new Array(C.length),O=this._graph;for(let A=0;A<C.length;++A)N[A]=this.collectAdjacentEdges(new Uint32Array([C[A]]),k,"all");let j=O.getEdgeAttribute("source"),G=O.getEdgeAttribute("target"),H=O.getEdgeAttribute("width"),W=O.getNodeAttribute("id"),$=[],Z="number"==typeof T,se=!("function"==typeof T||Z||!T);for(let k=0;k<N.length;k++){let ue=N[k],ge=C[k],ce=ue.length,_e=w?new Array(ce):new Uint32Array(ce),me=new Array(ce);for(let C=0;C<ce;C++){let k=ue[C],N=j.get(k),$=G.get(k),ce=A||ge===N?$:N;if(w&&(ce=W.get(ce)),_e[C]=ce,T){if(Z&&(me[C]=T),"function"==typeof T){let A=O.getNode(N),w=O.getNode($);me[C]=T(A,w)}se&&(me[C]=H.get(k)||1)}}let pe=re({nodes:_e,id:w?W.get(ge):ge},T&&{weights:me});$.push(pe)}return $}degrees(A,w){if(w!==pi&&w!==xi)return this._neighborTable.sizes(A);let T=new Array(A.length),C=w===pi;for(let w=0,k=A.length;w<k;w++)T[w]=this._degree(A[w],C);return T}_degree(A,w){let T=this._neighborTable.get(A),C=this._sourceList,k=this._targetList,N=0;for(let O=0;O<T.length;++O){let j=this._parallelTable.get(T[O]);for(let T=0;T<j.length;++T){let O=j[T],G=C.get(O),H=k.get(O);if(w&&H===A||!w&&G===A){N+=1;break}}}return N}getDegree(A,w){let{direction:T,filter:C}=this._getDegreeOptions(w),k=new Array(A.length),N=new Uint32Array(1);for(let w=0;w<A.length;++w)N[0]=A[w],k[w]=this.collectAdjacentNodes(N,T,C).length;return k}_getDegreeOptions(A){let w={direction:yi,filter:"visible"};return"string"==typeof A?w.direction=A:A&&("string"==typeof A.direction&&(w.direction=A.direction),"string"==typeof A.filter&&(w.filter=A.filter)),w}}(this),this._resolvePromises()}getNodeMaxIndex(){return this.storage.nodes.getMaxIndex()}getEdgeMaxIndex(){return this.storage.edges.getMaxIndex()}isExcluded(A){return this.storage.fetch(A.isNode).getFlexArray("excluded").getMultiple(A._indexes)}setExcluded(A,w){let T=w?1:0,C=A.isNode,k=this.storage.fetch(C),N=k.getFlexArray("excluded"),O=k.getFlexArray("removed"),j=this.acquireIndexList(C),G=this.getListFactory(C);for(let w=0;w<A._indexes.length;w++){let C=A._indexes[w],k=N.get(C),G=O.get(C);T!==k&&0===G&&j.push(C)}let H=j.sliceAndReset();if(H.length){this.getCacheLists(A.isNode).visible.invalidList();let C=G(H);N.setMultiple(H,T),this._modules.events.fire("excludedStateChange",{elements:C,value:w})}}addNode(A,w){return cs(this,!0,A,w)}addEdge(A,w){return cs(this,!1,A,w)}addNodes(A,w){return mi(this,!0,A,w)}addEdges(A,w){return mi(this,!1,A,w)}getExtremityIndex(A,w,T,C){if(w instanceof Vi)return w._index;{let k=this.storage.nodes.getIndex(w);if(!k&&!C)throw new Error(`addEdge(s): invalid ${0===T?"source":"target"} for edge "${A}"; node "${w}" does not exist`);return k}}getNodes(A){return this.getElements(!0,A)}getEdges(A){return this.getElements(!1,A)}getElements(A,w){let T=A?this.nodeList:this.edgeList,C=A?Gi:Yi,k=A?Vi:Xi;if(w&&"string"!=typeof w){let N=this.acquireIndexList(A),O=this.storage.fetch(A);if(w instanceof k)N.push(w._index);else if(At(w)){let A=w;for(let w of A)if(w instanceof k)N.push(w._index);else{let A=O.getIndex(w);A&&N.push(A)}}else if(w instanceof C){let T=this.getFilter(A,"all"),C=w;for(let A=0;A<C._indexes.length;A++){let w=C._indexes[A];T(w)&&N.push(w)}}return T(N.sliceAndReset())}{let C=w||"visible",k=this.getCacheLists(A)[C];if(!k)throw new Error(`getNodes/getEdges: unexpected argument "${C}"`);return T(k.getList())}}getNode(A){return this._getElement(!0,A)}getEdge(A){return this._getElement(!1,A)}_getElement(A,w){if(w instanceof(A?Vi:Xi))return w;let T=this.getStorage(A),C=this.getObjectList(A),k=T.getIndex(w);return k?C.get(k):void 0}clear(){this._modules.events.fire("clearGraph",{nodes:this.getNodes("all"),edges:this.getEdges("all")}),this.storage.nodes.clear(),this.storage.edges.clear(),this._initialize()}createAttribute(A,w,T=!1){return this.storage.fetch(A).createFlexArray(w,T)}createNodeAttribute(A,w){return this.createAttribute(!0,A,w)}createEdgeAttribute(A,w){return this.createAttribute(!1,A,w)}getAttribute(A,w){return this.storage.fetch(A).getFlexArray(w)}getAttributes(A,w){return w.map((w=>this.getAttribute(A,w)))}getNodeAttribute(A){return this.storage.nodes.getFlexArray(A)}getNodeAttributes(A){return this.getAttributes(!0,A)}getEdgeAttribute(A){return this.storage.edges.getFlexArray(A)}getEdgeAttributes(A){return this.getAttributes(!1,A)}getAllNodeAttributes(){return this.storage.nodes.getAllFlexArrays()}getAllEdgeAttributes(){return this.storage.edges.getAllFlexArrays()}setSource(A,w){let T=this.getNode(w);T&&this.topology.setExtremities(A._indexes,T._indexes,null)}setTarget(A,w){let T=this.getNode(w);T&&this.topology.setExtremities(A._indexes,null,T._indexes)}getParallelEdges(A,w={}){return this.topology.getParallelEdges(A,w)}getEdgesBetweenTwoNodes(A,w){return this.edgeList(this.topology.getEdgesBetweenTwoNodes(A._index,w._index))}getAdjacentDirections(A){return this.topology.getAdjacentDirections(A)}getEdgeIndexesInDirection(A){return this.topology.getEdgeIndexesInDirection(A)}fastGetNodesAdjacentElements(A){return this.topology.fastGetNodesAdjacentElements(A._indexes)}fastGetEdgesAdjacentElements(A){return this.topology.fastGetEdgesAdjacentElements(A._indexes)}getAdjacentNodes(A,w){return this.nodeList(this.topology.getAdjacentElements(!0,A._indexes,w))}getAdjacentEdges(A,w){return this.edgeList(this.topology.getAdjacentElements(!1,A._indexes,w))}getDegree(A,w){return this.topology.getDegree(A._indexes,w)}degrees(A,w){return this.topology.degrees(A,w)}getAdjacencyList({directed:A=!1,internalIndexes:w=!1,weight:T=1,nodes:C,indexes:k}={}){return this.topology.getAdjacencyList({directed:A,weight:T,ids:!w,nodes:k||this.getNodes(C)._indexes})}getConnectedComponents(A,w){return this.topology.getConnectedComponents(A._indexes,w)}getConnectedComponentByNode(A,w){return this.topology.getConnectedComponents(A._indexes,w)}},Ps={2:"image",4:"piechart",3:"text",5:"icon",6:"badge"},Rs=Math.round(Math.log2(512)),Bs=Math.round(Math.log2(128)),js=Rs+Bs,Us=255,Vs=128,Gs=1/16,Hs=Math.round(Math.sqrt(16)),Ws=Vs*Hs,Xs=16,$s=256,Ys=1.5,qs=56,Zs=41,Qs=.9721,Ks=24,tr=1.4142;function ay(A){return A.map((({x:A,y:w,r:T=0})=>({x:A,y:w,r:T})))}function kp(A={}){return A.pieceId=0,A.shape="",A.x1=0,A.y1=0,A.x2=0,A.y2=0,A.rectWidthOrSourceRadiusScaled=0,A.rectWidthOrSourceRadiusFixed=0,A.rectHeightOrTargetRadiusScaled=0,A.rectHeightOrTargetRadiusFixed=0,A.thicknessOrFontSizeScaled=0,A.thicknessOrFontSizeFixed=0,A.strokeWidthScaled=0,A.strokeWidthFixed=0,A.offsetScaled=0,A.offsetFixed=0,A.pattern=A.pattern||{type:0,attributes:{}},A.pattern.type=0,A.opacity=1,A.fillColor=null,A.strokeColor=null,A.patternColor=null,A.globalMinVisibleSize=0,A.strokeMinVisibleSize=0,A.patternMinVisibleSize=0,A.offsetAngle=0,A.patternScale=0,A.symbolicSize=0,A.curvature=0,A.dashLength=0,A.gapLength=0,A.hasHead=!1,A.hasTail=!1,A.isBodyTriangle=!1,A.isSelfLoop=!1,A.isText=!1,A.adjustTextAngle=!1,A.isBadge=!1,A.unusedFlag2=!1,A.unusedFlag3=!1,A}function nh(A,w,T,C){A.width=w*C,A.height=T*C,rn(A,`${w}px`,`${T}px`)}var ir=class{constructor({bufferList:A,patternManager:w,boundariesManager:T,colorManager:C,shapeManager:k,textManager:N,easingManager:O,memoryManager:j}){this._firstFrame=!0,this._width=0,this._height=0,this._pixelRatio=0,this._viewX=0,this._viewY=0,this._viewZoom=0,this._viewAngle=0,this._viewAngleCos=0,this._viewAngleSin=0,this._currentTime=0,this._scales={bytesToActualCoord:0,bytesToActualScaledSize:0,bytesToActualMinVisibleSize:0,bytesToActualSymbolicSize:0,bytesToActualDashLength:0,bytesToActualGapLength:0,bytesToActualPatternScale:0},this._shapesVersion=0,this._patternsVersion=0,this._boundariesVersion=0,this._textsVersion=0,this._backgroundRgba=[1,1,1,0],this._renderBackground=!1,this._hideImages=!1,this._genericObject={valid:!1,id:void 0,end:{pieceId:0,shape:"circle",x1:0,y1:0,x2:0,y2:0,rectWidthOrSourceRadiusScaled:0,rectWidthOrSourceRadiusFixed:0,rectHeightOrTargetRadiusScaled:0,rectHeightOrTargetRadiusFixed:0,thicknessOrFontSizeScaled:0,thicknessOrFontSizeFixed:0,strokeWidthScaled:0,strokeWidthFixed:0,offsetScaled:0,offsetFixed:0,pattern:{id:void 0,type:0,attributes:{}},opacity:1,fillColor:null,strokeColor:null,patternColor:null,globalMinVisibleSize:0,strokeMinVisibleSize:0,patternMinVisibleSize:0,offsetAngle:0,patternScale:0,symbolicSize:-1,curvature:0,dashLength:0,gapLength:0,hasHead:!1,hasTail:!1,isBodyTriangle:!1,isSelfLoop:!1,isText:!1,adjustTextAngle:!1,isBadge:!1,unusedFlag2:!1,unusedFlag3:!1},start:{pieceId:0,shape:"circle",x1:0,y1:0,x2:0,y2:0,rectWidthOrSourceRadiusScaled:0,rectWidthOrSourceRadiusFixed:0,rectHeightOrTargetRadiusScaled:0,rectHeightOrTargetRadiusFixed:0,thicknessOrFontSizeScaled:0,thicknessOrFontSizeFixed:0,strokeWidthScaled:0,strokeWidthFixed:0,offsetScaled:0,offsetFixed:0,pattern:{id:void 0,type:0,attributes:{}},opacity:1,fillColor:null,strokeColor:null,patternColor:null,globalMinVisibleSize:0,strokeMinVisibleSize:0,patternMinVisibleSize:0,offsetAngle:0,patternScale:0,symbolicSize:-1,curvature:0,dashLength:0,gapLength:0,hasHead:!1,hasTail:!1,isBodyTriangle:!1,isSelfLoop:!1,isText:!1,adjustTextAngle:!1,isBadge:!1,unusedFlag2:!1,unusedFlag3:!1},animation:{duration:0,beginTime:-1,easing:"linear"}},this._littleEndian=Zi(),this._bufferList=A,this._shapeManager=k,this._patternManager=w,this._boundariesManager=T,this._textManager=N,this._colorManager=C,this._easingManager=O,this._memoryManager=j}static createInitData(){return null}static getName(){return null}static isAvailable(){return!0}getDomElement(){return null}_initCanvas(A){A.style.touchAction="none"}export(A){return Promise.resolve()}extractElement(A,w){return this._memoryManager.extractGenericElement(A,w,this._scales)}_compareDimensions(A,w,T){return(A!==this._width||w!==this._height||T!==this._pixelRatio)&&(this._width=A,this._height=w,this._pixelRatio=T,!0)}_compareView(A,w,T,C){return(A!==this._viewX||w!==this._viewY||T!==this._viewZoom||C!==this._viewAngle)&&(this._viewX=A,this._viewY=w,this._viewZoom=T,this._viewAngle=C,this._viewAngleCos=Math.cos(C),this._viewAngleSin=Math.sin(C),!0)}_compareCurrentTime(A){return A!==this._currentTime&&(this._currentTime=A,!0)}_compareBackgroundColor(A,w){return(A!==this._backgroundColor||w!==this._renderBackground)&&(this._renderBackground=w,this._backgroundColor=A,this._backgroundRgba=this._colorManager.parseColor(this._backgroundColor),!0)}_compareShapes(){return this._shapesVersion!==this._shapeManager.getVersion()&&(this._shapesVersion=this._shapeManager.getVersion(),!0)}_comparePatterns(){return this._patternsVersion!==this._patternManager.getVersion()&&(this._patternsVersion=this._patternManager.getVersion(),!0)}_compareBoundaries(){return this._boundariesVersion!==this._boundariesManager.getVersion()&&(this._boundariesVersion=this._boundariesManager.getVersion(),!0)}_compareTexts(){return this._textsVersion!==this._textManager.getVersion()&&(this._textsVersion=this._textManager.getVersion(),!0)}_compareIsDisplayableBuffer(A){return this._isBufferDisplayable!==A&&(this._isBufferDisplayable=A,!0)}_compareHideImages(A){return this._hideImages!==A&&(this._hideImages=A,!0)}renderFrame({x:A,y:w,zoom:T,angle:C,width:k,height:N,pixelRatio:O,backgroundColor:j,currentTime:G,isBufferDisplayable:H,hideImages:W,renderBackground:$}){let Z=this._compareShapes(),se=this._comparePatterns(),ue=this._compareBoundaries(),ge=this._compareTexts(),ce=this._compareDimensions(k,N,O),_e=this._compareView(A,w,T,C),me=this._compareCurrentTime(G),pe=this._compareBackgroundColor(j,$),be=this._compareIsDisplayableBuffer(H),Se=this._compareHideImages(W);if(ue){let A=this._boundariesManager,w=this._scales;w.bytesToActualCoord=1,w.bytesToActualScaledSize=A.maxScaledSize/65535,w.bytesToActualMinVisibleSize=A.maxMinVisibleSize/15,w.bytesToActualSymbolicSize=A.maxSymbolicSize/Us,w.bytesToActualDashLength=A.maxDashLength/3,w.bytesToActualGapLength=A.maxGapLength/3,w.bytesToActualPatternScale=A.maxPatternScale/Us}this._firstFrame&&this._beforeFirstFrame(),this._render({shapesChanged:Z,patternsChanged:se,boundariesChanged:ue,textsChanged:ge,dimensionsChanged:ce,viewChanged:_e,currentTimeChanged:me,backgroundColorChanged:pe,isBufferDisplayableChanged:be,isHideImagesChanged:Se}),this._firstFrame&&(this._afterFirstFrame(),this._firstFrame=!1)}_render(A){}_beforeFirstFrame(){}_afterFirstFrame(){}destroy(){}ensureAnimationsReady(){}getImageData(){return null}setViewportClipping(A){}},rr="#define D3D9_FIX 0\n#define ANIMATED 0\nprecision highp float;\nprecision mediump int;\nattribute /*ushort*/ vec4 a_final_shapeInfo_miscInfo_opacityAndAllMinVisibleSizes_symbolicSizeAndCurvature;\nattribute /*ushort*/ vec4 a_final_patternId_fillRGBA_strokeRGBA_patternRGBA;\nattribute /*float*/ vec4 a_final_x1_y1_x2_y2;\nattribute /*ushort*/ vec4 a_final_rectWidthOrSourceRadiusScaled_rectWidthOrSourceRadiusFixed_rectHeightOrTargetRadiusScaled_rectHeightOrTargetRadiusFixed;\nattribute /*ushort*/ vec4 a_final_thicknessOrFontSizeScaled_thicknessOrFontSizeFixed_strokeWidthScaled_strokeWidthFixed;\nattribute /*ushort*/ vec4 a_final_offsetScaled_offsetFixed_paddingTop_paddingLeft;\nattribute /*ushort*/ vec4 a_prev_shapeInfo_miscInfo_opacityAndAllMinVisibleSizes_symbolicSizeAndCurvature;\nattribute /*ushort*/ vec4 a_prev_patternId_fillRGBA_strokeRGBA_patternRGBA;\nattribute /*float*/ vec4 a_prev_x1_y1_x2_y2;\nattribute /*ushort*/ vec4 a_prev_rectWidthOrSourceRadiusScaled_rectWidthOrSourceRadiusFixed_rectHeightOrTargetRadiusScaled_rectHeightOrTargetRadiusFixed;\nattribute /*ushort*/ vec4 a_prev_thicknessOrFontSizeScaled_thicknessOrFontSizeFixed_strokeWidthScaled_strokeWidthFixed;\nattribute /*ushort*/ vec4 a_prev_offsetScaled_offsetFixed_paddingTop_paddingLeft;\nattribute /*float*/ vec2 a_animationBeginTime_animationDuration; \nattribute /*ushort*/ vec4 a_animationEasing; \nattribute /*ushort*/ vec3 a_text_charId_charOffsetXY; \nattribute vec3 a_vertexInfo;\nuniform float u_viewWidth;\nuniform float u_viewHeight;\nuniform float u_viewX;\nuniform float u_viewY;\nuniform float u_viewAngle;\nuniform float u_viewZoom;\nuniform float u_currentTime;\nuniform float u_pixelRatio;\nuniform sampler2D u_patternInfoTexture;\nvarying vec4 dn;\nvarying vec4 dp;\nvarying vec4 dq;\nvarying vec2 dr;\nvarying vec2 ds;\nvarying float dt;\n#if D3D9_FIX\n#else\nvarying float dy;\nvarying vec2 dz;\nvarying vec2 ea;\nvarying vec2 eb;\nvarying float ec;\nvarying float ed;\nvarying vec2 ee;\nvarying vec2 ef;\nvarying float eg;\nvarying float eh;\n#endif\nvarying vec4 ei;\nconst float EPSILON = 0.000001;\nconst float INFINITY = 10000000.0;\nconst float PI = 3.14159265359;\nconst float P2_17 = 131072.0;\nconst float P2_16 = 65536.0;\nconst float P2_14 = 32768.0;\nconst float P2_12 = 4096.0;\nconst float P2_8 = 256.0;\nconst float P2_7 = 128.0;\nconst float P2_6 = 64.0;\nconst float P2_5 = 32.0;\nconst float P2_4 = 16.0;\nconst float P2_3 = 8.0;\nconst float P2_2 = 4.0;\nconst float P2_1 = 2.0;\nconst float MAX_PROGRESS = 1.0;\nuniform float BYTES_TO_COORD;\nuniform float BYTES_TO_SCALED_SIZE;\nuniform float BYTES_TO_MIN_VISIBLE_SIZE;\nuniform float BYTES_TO_SYMBOLIC_SIZE;\nuniform float BYTES_TO_CURVATURE;\nuniform float BYTES_TO_DASH_LENGTH;\nuniform float BYTES_TO_GAP_LENGTH;\nuniform float BYTES_TO_PATTERN_SCALE;\nuniform float PATTERN_POSITION_UNIT_SIZE;\nuniform float PATTERN_INFO_TEXTURE_SIZE;\nuniform float PATTERN_NEAREST_TEXTURE_SIZE;\nuniform float PATTERN_LINEAR_TEXTURE_SIZE;\nuniform float PATTERN_LINEAR_SDF_TEXTURE_SIZE;\nuniform float PATTERN_MIPMAP_TEXTURE_SIZE;\nuniform float ROUNDED_BOX_RADIUS;\nconst float BYTES_TO_OFFSET_ANGLE = 0.0;\nconst float BYTES_TO_COLOR = 0.0;\nconst float SDF_FONT_SIZE = 0.0;\nconst float SDF_GAMMA = 0.0;\nconst float CURVATURE_RATIO = 0.0;\nconst float PATTERN_PADDING = 0.0;\nconst float TEXT_WIDTH_MULTIPLIER = 0.0;\nconst float TEXT_HEIGHT_MULTIPLIER = 0.0;\nconst float SELF_LOOP_CURVATURE_RATIO = 0.0;\nconst float EDGE_ARROW_SIZE_RATIO = 0.0;\nconst float CURVE_SUBDIVISIONS = 0.0;\nconst float PIECE_NODE_COMPONENT = 0.0;\nconst float PIECE_TEXT_BOX = 0.0;\nconst float PIECE_EDGE_BODY = 0.0;\nconst float PIECE_EDGE_HEAD = 0.0;\nconst float PIECE_EDGE_TAIL = 0.0;\nconst float PIECE_EDGE_TEXT = 0.0;\nconst float MAX_TEXT_SIZE = 0.0;\nconst float BYTES_TO_TEXT_OFFSET_X = 0.0;\nconst float BYTES_TO_TEXT_OFFSET_Y = 0.0;\nconst float FILTER_NEAREST = 0.0;\nconst float FILTER_LINEAR = 0.0;\nconst float FILTER_LINEAR_SDF = 0.0;\nconst float FILTER_MIPMAP = 0.0;\nconst float SHAPE_TEXTURE_SIZE = 0.0;\nconst float SIMPLE_SHAPE_SAMPLING_SIZE = 0.0;\nconst float COMPLEX_SHAPE_SAMPLING_SIZE = 0.0;\nconst float SHAPE_SAMPLING_BUFFER_RATIO = 0.0;\nconst float MAX_SHAPES = 0.0;\nconst float FIRST_COMPLEX_SHAPE_ID = 0.0;\nconst float SELF_LOOP_TO_CIRCLE_APPROX = 0.0;\nconst float NB_SHAPES_BY_SIDE = SHAPE_TEXTURE_SIZE / COMPLEX_SHAPE_SAMPLING_SIZE;\nconst float SHAPE_FILL_PERCENT = 1.0 - SHAPE_SAMPLING_BUFFER_RATIO;\nconst float T_STEP_PER_CURVE_PIECE = 1.0 / CURVE_SUBDIVISIONS;\nconst float HEAD_TAIL_PX_ADJUST = 1.5;\nconst float SDF_SMOOTH_FACTOR = 2.0;\nstruct gk {\nfloat gl;\nfloat gm;\nfloat gn;\nfloat go;\nfloat gp;\nfloat gq;\nfloat gr;\nfloat gs;\n};\nstruct gt {\nfloat gu;\nfloat gv;\nfloat gw;\nfloat gx;\nfloat gy;\nfloat gz;\nfloat ha;\n};\nstruct hb {\nfloat gl;\nfloat gm;\nfloat gn;\nfloat go;\nfloat gp;\nfloat gq;\nfloat gr;\nfloat gs;\nfloat gu;\nfloat gv;\nfloat gw;\nfloat gx;\nfloat gy;\nfloat gz;\nfloat ha;\nfloat hc;\nfloat hd;\nfloat he;\nfloat hf;\nfloat hg;\nfloat hh;\nfloat hi;\nvec4 hj;\nvec4 hk;\nvec4 hl;\nfloat hm;\nfloat hn;\nfloat ho;\nfloat hp;\nfloat hq;\nfloat hr;\nfloat hs;\nfloat ht;\nfloat hu;\nfloat hv;\nfloat hw;\nfloat hx;\nfloat hy;\nfloat hz;\nfloat ia;\nfloat ib;\nfloat ic;\nfloat id;\nfloat ie;\n};\nstruct ig {\nfloat ih;\nvec2 ii;\nvec4 hj;\nvec4 hk;\nfloat hc;\nfloat ij;\nfloat ik;\nfloat gn;\nfloat il;\nvec2 im;\nfloat io;\nvec2 ip;\nvec2 iq;\nvec2 ir;\nfloat is;\nfloat it;\nvec4 hl;\nvec2 iu;\nfloat iv;\nfloat eu;\nvec2 iw;\nvec2 ix;\nvec2 iy;\n};\nfloat iz(float cf, float ja, float jb) {\nfloat jc = mod(cf, pow(2.0, jb));\nreturn floor(jc / pow(2.0, ja));\n}\ngk jd(float cf) {\ngk je;\nje.gl = iz(cf, 0.0, 4.0);\nje.gm = iz(cf, 4.0, 8.0);\nje.gn = iz(cf, 8.0, 10.0);\nje.go = iz(cf, 10.0, 12.0);\nje.gp = iz(cf, 12.0, 13.0);\nje.gq = iz(cf, 13.0, 14.0);\nje.gr = iz(cf, 14.0, 15.0);\nje.gs = iz(cf, 15.0, 16.0);\nreturn je;\n}\ngt jf(float cf) {\ngt je;\nje.gu = iz(cf, 0.0, 8.0);\nje.gv = iz(cf, 8.0, 11.0);\nje.gw = iz(cf, 11.0, 12.0);\nje.gx = iz(cf, 12.0, 13.0);\nje.gy = iz(cf, 13.0, 14.0);\nje.gz = iz(cf, 14.0, 15.0);\nje.ha = iz(cf, 15.0, 16.0);\nreturn je;\n}\nvec4 jg(in float cf) {\nreturn vec4(\niz(cf, 0.0, 4.0),\niz(cf, 4.0, 8.0),\niz(cf, 8.0, 12.0),\niz(cf, 12.0, 16.0)\n);\n}\nvec2 jh(in float cf) {\nreturn vec2(mod(cf, 256.0), floor(cf / 256.0));\n}\nvec2 ji(in float cf) {\nfloat jj = floor(cf / P2_6);\nfloat jk = cf - (jj * P2_6);\nreturn vec2(jj, jk);\n}\nvec2 jl(in float cf) {\nfloat jm = floor(cf / P2_7);\nfloat jn = cf - (jm * P2_7);\nreturn vec2(jm, jn);\n}\nvec2 jo(in vec2 jp, in float jq) {\nfloat jr = cos(jq);\nfloat js = sin(jq);\nreturn vec2(jr * jp.x + js * jp.y, -js * jp.x + jr * jp.y);\n}\nvec4 jt(in vec4 ju) {\nreturn floor(ju / 256.0) - 128.0;\n}\nvec4 jv(in vec4 ju) {\nreturn mod(ju, 256.0) - 128.0;\n}\nfloat jw(float cf) {\nreturn cf - 128.0;\n}\nvec2 jw(vec2 cf) {\nreturn cf - 128.0;\n}\nvec2 jx(vec2 jy) {\nreturn vec2(-jy.y, jy.x);\n}\nvec2 jz(vec2 ka, vec2 kb, vec2 kc, float t) {\nfloat kd = 1.0 - t;\nreturn (kd * kd * ka) + (2.0 * kd * t * kb) + (t * t * kc);\n}\nvec2 ke(vec2 ka, vec2 kf, vec2 kg, vec2 kc, float t) {\nfloat kd = 1.0 - t;\nfloat kh = kd * kd;\nfloat ki = kh * kd;\nfloat kj = t * t;\nfloat kk = kj * t;\nreturn (ki * ka) + (3.0 * kh * t * kf) + (3.0 * kd * kj * kg) + (kk * kc);\n}\nvec2 kl(vec2 ka, vec2 kb, vec2 kc, float t) {\nfloat kd = (1.0 - t);\nvec2 jp = (kd * kb + t * kc) - (kd * ka + t * kb);\nreturn normalize(jp);\n}\nvec2 km(vec2 ka, vec2 kb, vec2 kc, float t) {\nreturn jx(kl(ka, kb, kc, t));\n}\nvec2 kn(vec2 ka, vec2 kf, vec2 kg, vec2 kc, float t) {\nfloat kd = 1.0 - t;\nfloat kh = kd * kd;\nfloat kj = t * t;\nvec2 jp = kh * (kf - ka) + 2.0 * kd * t * (kg - kf) + kj * (kc - kg);\nreturn normalize(jp);\n}\nvec2 ko(vec2 ka, vec2 kf, vec2 kg, vec2 kc, float t) {\nreturn jx(kn(ka, kf, kg, kc, t));\n}\nfloat ld(float hh, float le, float t) {\nfloat y = abs(hh) / CURVATURE_RATIO + EPSILON;\nfloat hp = y * y;\nfloat kd = t - 0.5;\nfloat kh = kd * kd;\nfloat lf = 1.0 / (16.0 * hp);\nfloat lg = sqrt(kh + lf);\nfloat lh = (0.5 / y) * sqrt(hp + 0.25);\nfloat li = (abs(2.0 * y)) * ((kd * lg) + (0.5 * lh) + (lf * log(abs((kd + lg) / (-0.5 + lh)))));\nreturn li * le;\n}\nfloat lj(vec2 ka, vec2 lk, vec2 ll, vec2 kc, float lm) {\nvec2 iu = (ka + lk + ll) / 3.0;\nvec2 ln = iu - lk;\nvec2 lo = lk - ll;\nfloat lp = dot(ln, ln);\nfloat lq = dot(lo, lo) / 4.0;\nfloat ma = sqrt(lp - lq) * SELF_LOOP_TO_CIRCLE_APPROX * 1.55;\nreturn 2.0 * PI * ma * lm;\n}\nfloat mb(float cf) {\nreturn cf - 32.0;\n}\nfloat mc(float cf) {\nreturn cf - 512.0;\n}\nfloat md(float cf) {\nreturn cf - P2_14;\n}\nvoid me() {\ngl_Position = vec4(-10.0, -10.0, 1.0, 1.0);\n}\nvec4 mf(vec2 mg) {\nreturn vec4(((vec2(mg.x, u_viewHeight - mg.y) / vec2(u_viewWidth, u_viewHeight)) * 2.0 - 1.0), 0.5, 1.0);\n}\nfloat mk(float ml, float mm) {\nreturn step(ml - EPSILON, mm) * step(mm, ml + EPSILON);\n}\nbool mn(float ml, float mm) {\nreturn abs(ml - mm) < EPSILON;\n}\nbool mo(float cf) {\nreturn cf > 0.5;\n}\nvec2 mp(vec2 mq) {\nreturn jo((mq - vec2(u_viewX, u_viewY)) * u_viewZoom, u_viewAngle) + vec2(u_viewWidth, u_viewHeight) / 2.0;\n}\nfloat mr(float eu) {\nreturn eu * EDGE_ARROW_SIZE_RATIO;\n}\nfloat ms(float mt, float mu) {\nreturn mt * BYTES_TO_SCALED_SIZE * u_viewZoom + mu;\n}\nfloat nb(float ij, float mz, float na) {\nfloat nc = na - mz;\nfloat a = 1.0 / nc;\nfloat b = -mz / nc;\nreturn ij * a + b;\n}\nstruct nd {\nvec2 ne;\nvec2 nf;\n};\nnd ng(vec2 nh, float ma, float hh) {\nnd cj;\nfloat ni = (ma + ma / SELF_LOOP_CURVATURE_RATIO * hh) * SELF_LOOP_CURVATURE_RATIO;\nfloat nj = -u_viewAngle + PI;\nfloat nk = -u_viewAngle + PI / 2.0;\ncj.ne = nh + vec2(cos(nj), sin(nj)) * ni;\ncj.nf = nh + vec2(cos(nk), sin(nk)) * ni;\nreturn cj;\n}\nfloat nq(vec2 nr, vec2 lk, vec2 ll, vec2 ns, float nt) {\nvec2 nu = nr;\nfloat t = 0.0;\nfloat nv = 0.0;\nfloat nw = lj(nr, lk, ll, ns, 1.0);\nreturn nt / nw;\n}\nhb nx(\nvec4 ny,\nvec4 nz,\nvec4 oa,\nvec4 ob,\nvec4 oc,\nvec4 od,\nvec3 oe\n) {\nhb a;\ngk of = jd(ny.x);\ngt og = jf(ny.y);\nvec4 oh = jg(ny.z);\nvec2 oi = jh(ny.w);\na.gl = of.gl;\na.gm = of.gm;\na.gn = of.gn;\na.go = of.go;\na.gp = of.gp;\na.gq = of.gq;\na.gr = of.gr;\na.gs = of.gs;\na.gu = og.gu;\na.gv = og.gv;\na.gw = og.gw;\na.gx = og.gx;\na.gy = og.gy;\na.gz = og.gz;\na.ha = og.ha;\na.hc = oh.x;\na.hd = oh.y;\na.he = oh.z;\na.hf = oh.w;\na.hg = oi.x;\na.hh = oi.y;\na.hi = nz.x;\na.hj = jg(nz.y);\na.hk = jg(nz.z);\na.hl = jg(nz.w);\na.hm = oa.x;\na.hn = oa.y;\na.ho = oa.z;\na.hp = oa.w;\na.hq = ob.x;\na.hr = ob.y;\na.hs = ob.z;\na.ht = ob.w;\na.hu = oc.x;\na.hv = oc.y;\na.hw = oc.z;\na.hx = oc.w;\na.hy = od.x;\na.hz = md(od.y);\na.id = md(od.z);\na.ie = md(od.w);\na.ia = oe.x;\nfloat x = oe.y;\nfloat y = mod(x, P2_8);\nif (oe.z > 0.0) x += oe.z * P2_16;\na.ib = ((x - y) / P2_8) - P2_16;\na.ic = (y - P2_7) * BYTES_TO_TEXT_OFFSET_Y;\nreturn a;\n}\nbool pl(const in hb a, out ig cj) {\nfloat gl = a.gl;\nfloat gm = a.gm;\nfloat gn = a.gn * BYTES_TO_DASH_LENGTH;\nfloat go = a.go * BYTES_TO_GAP_LENGTH;\nfloat gp = a.gp;\nfloat gq = a.gq;\nfloat gr = a.gr;\nfloat gs = a.gs;\nfloat gu = a.gu * BYTES_TO_PATTERN_SCALE;\nfloat gv = a.gv * BYTES_TO_OFFSET_ANGLE;\nfloat gw = a.gw;\nfloat gx = a.gx;\nfloat gy = a.gy;\nfloat gz = a.gz;\nfloat ha = a.ha;\nfloat hc = a.hc * BYTES_TO_COLOR;\nfloat hd = a.hd * BYTES_TO_MIN_VISIBLE_SIZE - EPSILON;\nfloat he = a.he * BYTES_TO_MIN_VISIBLE_SIZE - EPSILON;\nfloat hf = a.hf * BYTES_TO_MIN_VISIBLE_SIZE - EPSILON;\nfloat hg = a.hg * BYTES_TO_SYMBOLIC_SIZE * u_viewZoom + step(a.hg, EPSILON) * INFINITY;\nfloat hh = jw(a.hh);\nfloat hi = a.hi;\nvec4 hj = a.hj * BYTES_TO_COLOR;\nvec4 hk = a.hk * BYTES_TO_COLOR;\nvec4 hl = a.hl * BYTES_TO_COLOR;\nvec2 pm = vec2(a.hm, a.hn) * BYTES_TO_COORD;\nvec2 pn = vec2(a.ho, a.hp) * BYTES_TO_COORD;\nvec2 nr = mp(pm);\nvec2 ns = mp(pn);\nfloat po = ms(a.hq, a.hr);\nfloat pp = ms(a.hs, a.ht);\nfloat pq = ms(a.hu, a.hv);\nfloat ih = ms(a.hw, a.hx);\nfloat oj = ms(a.hy, a.hz);\nvec2 pr = a_vertexInfo.xy;\nvec2 ps = vec2(0.0, 0.0);\nfloat pt = po;\nfloat pu = pp;\nfloat pv = pp * gu;\nif (gw > EPSILON) {\nif (a.ia < EPSILON) return false;\npv = pq;\nhi = a.ia;\npo = pv * TEXT_WIDTH_MULTIPLIER * u_pixelRatio;\npp = pv * TEXT_HEIGHT_MULTIPLIER * u_pixelRatio;\n}\nbool qv = abs(hh) > EPSILON && mk(gm, PIECE_EDGE_BODY) < EPSILON;\nbool qw = qv && a_vertexInfo.z > EPSILON;\nif (gl < EPSILON || gm < EPSILON || hg < hd || qw) {\nreturn false;\n}\nih *= step(he, hg);\nfloat rl = 0.0;\nfloat rm = 1.0;\nfloat ri = 0.0;\nfloat rk = 1.0;\nfloat rn = 0.0;\nfloat rx = 1.0;\nfloat rz = 1.0;\nfloat sk = 0.0;\nfloat sl = 0.0;\nvec2 iu;\nvec2 iw;\nvec2 ix;\nvec2 iy;\nfloat eu;\nfloat iv;\nfloat tg = 0.0;\nfloat th = 1.0;\nbool ti = mk(gm, PIECE_TEXT_BOX) > EPSILON; \nif (mk(gm, PIECE_NODE_COMPONENT) > EPSILON || ti) {\niu = ceil((nr + ns) / 2.0);\niw = normalize(vec2(pn.x - pm.x + 0.001, pm.y - pn.y));\nix = jx(iw);\niy = ix;\neu = po;\niv = pp;\n} else {\nrz = 0.0;\nfloat tx = distance(nr, ns);\nvec2 ty = normalize(ns - nr);\nvec2 tz = (nr + ns) / 2.0;\nvec2 ua = jx(ty);\nvec2 ub = tz + (ua * tx * -hh / CURVATURE_RATIO);\nif (mk(gm, PIECE_EDGE_TEXT) > 0.0\n|| mk(gm, PIECE_EDGE_TEXT + PIECE_TEXT_BOX) > 0.0\n) {\nti = mk(gm, PIECE_EDGE_TEXT + PIECE_TEXT_BOX) > 0.0;\nfloat uf;\nfloat ug = ih;\nih = 0.0;\nif (gs > EPSILON) {\nnd kb = ng(nr, ug / 2.0, hh);\niu = ke(nr, kb.ne, kb.nf, ns, 0.5);\niw = kn(nr, kb.ne, kb.nf, ns, 0.5);\nix = jx(iw);\niy = ix;\nuf = lj(nr, kb.ne, kb.nf, ns, 0.5);\n} else if (abs(hh) > EPSILON) {\niu = jz(nr, ub, ns, 0.5);\niw = kl(nr, ub, ns, 0.5);\nix = jx(iw);\niy = ix;\nuf = ld(hh, tx, 1.0);\n} else {\niu = tz;\niw = ty;\nix = ua;\niy = ua;\nuf = tx;\n}\neu = po;\niv = pp;\nif(pt > uf - ug && gs < EPSILON){\nif(gx > EPSILON){\niw = vec2(1.0, 0.0);\nix = vec2(0.0, 1.0);\niy = vec2(0.0, 1.0);\n} else {\niw = vec2(0,0);\nix = vec2(0.0, 0.0);\niy = vec2(0.0, 0.0);\n}\n} else {\nfloat jq = -atan(iw.y, iw.x);\ntg = jq; \ngv -= jq;\nif ((jq > PI / 2.0 || jq < -PI / 2.0)) {\ngv += (1.0 - gs) * PI;\nth = -1.0;\niw *= -1.0;\nix *= -1.0;\niy *= -1.0;\n}\n}\n} else {\nfloat sd = pq;\nfloat ur = po;\nfloat us = pp;\nfloat ut = gp + gq;\nfloat uu = mr(sd);\nfloat uv = gp * uu;\nfloat uw = gq * uu;\nfloat ux = mk(gm, PIECE_EDGE_HEAD);\nfloat uy = mk(gm, PIECE_EDGE_TAIL);\nfloat uz = INFINITY * gs + tx - ur - us;\nfloat va = min(uz / ut, uu);\nfloat vk =\ngq * (uu + max(ur + va - uw, 0.0))\n+ (1.0 - gq) * gr * ur;\nfloat vl =\ngp * (uu + max(us + va - uv, 0.0))\n+ (1.0 - gp) * gr * us;\nif (ux > EPSILON || uy > EPSILON) {\nvec2 vo = ux * ns + uy * nr;\nfloat oj = ux * vl + uy * vk + (HEAD_TAIL_PX_ADJUST - 0.5);\nfloat vp = ux * uv + uy * uw;\nvec2 vq;\nif (gs > EPSILON) {\nnd kb = ng(nr, ur, hh);\nfloat uf = lj(nr, kb.ne, kb.nf, ns, 1.0);\nfloat nt = ux * (uf - vl) + uy * vk;\nfloat t = nq(nr, kb.ne, kb.nf, ns, nt);\nvq = ke(nr, kb.ne, kb.nf, ns, t);\n} else {\nfloat uf = ld(hh, tx, 1.0);\nfloat t = (ux * (uf - vl) + uy * vk) / uf;\nvq = jz(nr, ub, ns, t);\n}\niw = normalize(vo - vq);\nix = jx(iw);\niy = ix;\niu = vo - iw * (oj - vp / 2.0);\neu = vp;\niv = vp;\ngn = 0.0;\ngo = 0.0;\n} else {\nfloat vu;\nfloat vv;\nfloat vw;\nif (abs(hh) < EPSILON) {\niu = tz;\niw = ty;\nix = ua;\niy = ix;\neu = tx;\nvu = tx;\nvv = 0.0;\nvw = tx;\n} else {\nfloat vy = a_vertexInfo.z;\nfloat vz = vy * T_STEP_PER_CURVE_PIECE;\nfloat kj = vz + T_STEP_PER_CURVE_PIECE;\nif (gs < EPSILON) {\nvec2 wa = jz(nr, ub, ns, vz);\nvec2 wb = jz(nr, ub, ns, kj);\niu = (wa + wb) / 2.0;\niw = normalize(wb - wa);\nix = km(nr, ub, ns, vz);\niy = km(nr, ub, ns, kj);\neu = distance(wa, wb);\nvu = ld(hh, tx, 1.0);\nvv = ld(hh, tx, vz);\nvw = ld(hh, tx, kj);\n} else {\nnd kb = ng(nr, ur, hh);\nvec2 lk = kb.ne;\nvec2 ll = kb.nf;\nvec2 wa = ke(nr, lk, ll, ns, vz);\nvec2 wb = ke(nr, lk, ll, ns, kj);\niu = (wa + wb) / 2.0;\niw = normalize(wb - wa);\nix = ko(nr, lk, ll, ns, vz);\niy = ko(nr, lk, ll, ns, kj);\neu = distance(wa, wb);\nvu = lj(nr, lk, ll, ns, 1.0);\nvv = lj(nr, lk, ll, ns, vz);\nvw = lj(nr, lk, ll, ns, kj);\n}\n}\niv = pq;\nri = (vk - 1.0) / vu - 0.015 * gs;\nrk = MAX_PROGRESS + 0.015 * gs\n- (vl - HEAD_TAIL_PX_ADJUST) / vu;\nrl = vv / vu;\nrm = vw / vu;\nrn = vu;\nif (gr > 0.0 && uz > 5.0) {\nfloat wg = (vu * iv) / (vu - vk);\nfloat nw = vu;\nfloat hm = vk;\nfloat ho = vu - vl;\nfloat a = -wg / nw;\nfloat b = wg;\nfloat hn = a * hm + b;\nfloat hp = a * ho + b;\nfloat wh = hn / (hm - ho);\nfloat wi = -wh * ho;\niv = wi;\nsl = wh * nw + wi + 1.0;\n}\n}\n}\n}\nvec2 ip = vec2(0.0, 0.0);\nvec2 iq = vec2(EPSILON, EPSILON);\nvec2 ir = vec2(-EPSILON, -EPSILON);\nfloat is = -1.0;\nfloat it = 0.0;\nbool wj = false;\nvec2 wk = vec2(0,0);\nvec2 wl = vec2(0,0);\nvec2 wm = vec2(0,0);\nif (hi > EPSILON && hg > hf) {\nfloat wq = floor(hi / PATTERN_INFO_TEXTURE_SIZE);\nfloat wr = hi - (wq * PATTERN_INFO_TEXTURE_SIZE);\nvec4 ws = texture2D(u_patternInfoTexture, vec2(wr, wq) / 255.0) * 255.0;\nvec2 wt = jl(ws.z);\nvec2 wu = jl(ws.w);\nis = wt.x * 2.0 + wu.x;\nfloat wv = 0.0;\nif (mn(is, FILTER_NEAREST)) { \nwv = PATTERN_NEAREST_TEXTURE_SIZE;\n} else if (mn(is, FILTER_LINEAR)) { \nwv = PATTERN_LINEAR_TEXTURE_SIZE;\n} else if (mn(is, FILTER_LINEAR_SDF)) { \nwv = PATTERN_LINEAR_SDF_TEXTURE_SIZE;\nwj = true;\n} else if (mn(is, FILTER_MIPMAP)) { \nwv = PATTERN_MIPMAP_TEXTURE_SIZE;\n}\nfloat xc = 1.0 / wv;\nvec2 xd = (vec2(wt.y, wu.y) * PATTERN_POSITION_UNIT_SIZE) * xc / 2.0;\nwl += (ws.xy * PATTERN_POSITION_UNIT_SIZE * xc) + xd;\nwl += PATTERN_PADDING * xc;\nxd -= PATTERN_PADDING * xc * 2.0;\nvec2 xe = vec2(eu / 2.0, iv / 2.0) * xc;\nvec2 xf = vec2(ih, ih) * xc;\nfloat xi = 1.0 * u_pixelRatio;\nfloat xj = SDF_SMOOTH_FACTOR;\nif (gu > EPSILON) {\nif (wj) { \nif (a.gy > EPSILON) {\nxj = SDF_SMOOTH_FACTOR * u_pixelRatio / SDF_GAMMA;\nwk = vec2(-a.ie,-a.id) / (1.0 /gu);\n}\nit = xj * SDF_GAMMA / pv / u_pixelRatio;\nxi = SDF_FONT_SIZE / pv;\n} else { \nxi = (xd.y / xe.y) / gu;\n}\n}\nwm = (xe + xf) * xi;\nxd += PATTERN_PADDING * xc;\niq = wl - xd;\nir = wl + xd;\n}\nif (gw > EPSILON) {\nps.y = (a.ic) * pv;\nrx = 0.0;\nrz = 0.0;\nps.x = a.ib * pv * BYTES_TO_TEXT_OFFSET_X;\nps += vec2(1.0, 1.0);\nps = jo(ps, tg);\nps *= th;\n}\nvec2 xo = vec2(cos(gv), sin(gv)) * oj;\nvec2 xp = iu + xo + ps;\nfloat xq = ih * 2.0;\nfloat xr = eu + rz * (xq + 1.0);\nfloat xs = iv + rx * (xq + 1.0);\nvec2 xt = iw * xr / 2.0;\nvec2 xu = ix * xs / 2.0;\nvec2 xv = iy * xs / 2.0;\nfloat xw = (rm - rl);\nfloat xx = pr.x / 2.0 + 0.5;\nfloat ij = rl + xw * xx;\nfloat io = sk + (sl - sk) * ij / 2.0;\nfloat xy = step(gl, FIRST_COMPLEX_SHAPE_ID - EPSILON);\nfloat xz = xy * SIMPLE_SHAPE_SAMPLING_SIZE + (1.0 - xy) * COMPLEX_SHAPE_SAMPLING_SIZE;\nfloat ya = xz / COMPLEX_SHAPE_SAMPLING_SIZE;\nfloat yb = ya * SHAPE_SAMPLING_BUFFER_RATIO / 2.0;\nfloat yc = ya * (1.0 - SHAPE_SAMPLING_BUFFER_RATIO);\nvec2 ym = vec2(\nmod(gl, NB_SHAPES_BY_SIDE),\nfloor(gl / NB_SHAPES_BY_SIDE)\n);\nvec2 yp = ym + vec2(yb) +\nvec2(rl * yc, 0.0);\nvec2 ys = vec2(xw, 1.0) * yc;\nvec2 ii = (yp + ys * (pr / 2.0 + 0.5)) / NB_SHAPES_BY_SIDE;\nvec2 im = vec2(xr / xw, xs) / 2.0;\nfloat yz = gn * pq;\nfloat za = go * pq;\nfloat ik = yz + za;\nfloat il = (ij * rn) / ik;\nip = wl\n+ wm\n* (pr + wk/im* u_viewZoom * 2.0);\ncj.ii = ii;\nei = vec4(\n(yp + ys * (vec2(0.5,0.5) / 2.0 + 0.5)) / NB_SHAPES_BY_SIDE,\nNB_SHAPES_BY_SIDE * (1. - gw) * float(gl == 1.),\nfloat(ti)\n);\ncj.im = im;\ncj.ih = ih;\ncj.hj = hj;\ncj.hk = hk;\ncj.hc = hc;\ncj.ij = nb(ij, ri, rk);\ncj.ik = ik;\ncj.gn = yz;\ncj.il = il;\ncj.io = io;\ncj.ip = ip;\ncj.iq = iq;\ncj.ir = ir;\ncj.is = is;\ncj.it = it;\ncj.hl = hl;\ncj.iu = xp;\ncj.eu = xr;\ncj.iv = xs;\ncj.iw = iw;\ncj.ix = ix;\ncj.iy = iy;\nreturn true;\n}\nfloat zd(float ze, float zf, vec4 zg) {\nfloat zh = clamp(((u_currentTime - ze) / zf), 0.0, 1.0);\nfloat r = zh;\nfloat zi = r * r;\nfloat zj = zi * r;\nvec4 zk = zh < 0.5 ? jt(zg) : jv(zg);\nfloat zl = zk.x;\nfloat zm = zk.y;\nfloat zn = zk.z;\nfloat zo = zk.w;\nfloat zp = zl + zm * r + zn * zi + zo * zj;\nreturn zp;\n}\nvoid main() {\nhb a_final = nx(\na_final_shapeInfo_miscInfo_opacityAndAllMinVisibleSizes_symbolicSizeAndCurvature,\na_final_patternId_fillRGBA_strokeRGBA_patternRGBA,\na_final_x1_y1_x2_y2,\na_final_rectWidthOrSourceRadiusScaled_rectWidthOrSourceRadiusFixed_rectHeightOrTargetRadiusScaled_rectHeightOrTargetRadiusFixed,\na_final_thicknessOrFontSizeScaled_thicknessOrFontSizeFixed_strokeWidthScaled_strokeWidthFixed,\na_final_offsetScaled_offsetFixed_paddingTop_paddingLeft,\na_text_charId_charOffsetXY\n);\n#if ANIMATED\nfloat ze = a_animationBeginTime_animationDuration.x;\nfloat zf = a_animationBeginTime_animationDuration.y;\nvec4 zg = a_animationEasing;\nfloat pk = zd(ze, zf, zg);\nhb a_prev = nx(\na_prev_shapeInfo_miscInfo_opacityAndAllMinVisibleSizes_symbolicSizeAndCurvature,\na_prev_patternId_fillRGBA_strokeRGBA_patternRGBA,\na_prev_x1_y1_x2_y2,\na_prev_rectWidthOrSourceRadiusScaled_rectWidthOrSourceRadiusFixed_rectHeightOrTargetRadiusScaled_rectHeightOrTargetRadiusFixed,\na_prev_thicknessOrFontSizeScaled_thicknessOrFontSizeFixed_strokeWidthScaled_strokeWidthFixed,\na_prev_offsetScaled_offsetFixed_paddingTop_paddingLeft,\na_text_charId_charOffsetXY\n);\nconst float ONE = 1.0;\na_final.gl = mix(a_prev.gl, a_final.gl, ONE);\na_final.gn = mix(a_prev.gn, a_final.gn, pk);\na_final.go = mix(a_prev.go, a_final.go, pk);\na_final.gp = mix(a_prev.gp, a_final.gp, ONE);\na_final.gq = mix(a_prev.gq, a_final.gq, ONE);\na_final.gm = mix(a_prev.gm, a_final.gm, ONE);\na_final.gu = mix(a_prev.gu, a_final.gu, ONE);\na_final.gw = mix(a_prev.gw, a_final.gw, ONE);\na_final.gx = mix(a_prev.gx, a_final.gx, ONE);\na_final.gy = mix(a_prev.gy, a_final.gy, ONE);\na_final.gz = mix(a_prev.gz, a_final.gz, ONE);\na_final.gs = mix(a_prev.gs, a_final.gs, ONE);\na_final.gv = mix(a_prev.gv, a_final.gv, pk);\na_final.hc = mix(a_prev.hc, a_final.hc, pk);\na_final.hd = mix(a_prev.hd, a_final.hd, pk);\na_final.he = mix(a_prev.he, a_final.he, pk);\na_final.hf = mix(a_prev.hf, a_final.hf, pk);\na_final.hg = mix(a_prev.hg, a_final.hg, pk);\na_final.hh = mix(a_prev.hh, a_final.hh, pk);\na_final.hi = mix(a_prev.hi, a_final.hi, ONE);\na_final.hj = mix(a_prev.hj, a_final.hj, pk);\na_final.hk = mix(a_prev.hk, a_final.hk, pk);\na_final.hl = mix(a_prev.hl, a_final.hl, pk);\na_final.hm = mix(a_prev.hm, a_final.hm, pk);\na_final.hn = mix(a_prev.hn, a_final.hn, pk);\na_final.ho = mix(a_prev.ho, a_final.ho, pk);\na_final.hp = mix(a_prev.hp, a_final.hp, pk);\na_final.hq = mix(a_prev.hq, a_final.hq, pk);\na_final.hr = mix(a_prev.hr, a_final.hr, pk);\na_final.hs = mix(a_prev.hs, a_final.hs, pk);\na_final.ht = mix(a_prev.ht, a_final.ht, pk);\na_final.hu = mix(a_prev.hu, a_final.hu, pk);\na_final.hv = mix(a_prev.hv, a_final.hv, pk);\na_final.hw = mix(a_prev.hw, a_final.hw, pk);\na_final.hx = mix(a_prev.hx, a_final.hx, pk);\na_final.hy = mix(a_prev.hy, a_final.hy, pk);\na_final.hz = mix(a_prev.hz, a_final.hz, pk);\na_final.ia = mix(a_prev.ia, a_final.ia, ONE);\na_final.ib = mix(a_prev.ib, a_final.ib, ONE);\na_final.ic = mix(a_prev.ic, a_final.ic, ONE);\n#endif\nig cj;\nbool zu = pl(a_final, cj);\nif (!zu) {\nme();\nreturn;\n}\nvec2 pr = a_vertexInfo.xy;\ndn = cj.hj;\ndp = cj.hk;\ndq = cj.hl;\ndr = cj.ii;\nds = cj.ip;\n#if D3D9_FIX\n#else\ndy = cj.ih;\ndz = cj.iq;\nea = cj.ir;\neb = vec2(cj.hc, cj.io);\nec = cj.ij;\ned = cj.ik;\nee = vec2(cj.gn, cj.il);\nef = cj.im;\neg = cj.it;\neh = cj.is;\n#endif\nfloat zz = step(pr.x, 0.0);\nfloat aaa = 1.0 - zz;\nvec2 mg = cj.iu\n+ cj.iw * (cj.eu / 2.0) * pr.x\n+ (zz * cj.ix + aaa * cj.iy) * cj.iv / 2.0 * pr.y;\ndq = dq * (1. - ei.w)\n+ vec4(\npr.x * cj.eu,\npr.y * cj.iv,\ncj.eu,\ncj.iv\n) * u_pixelRatio * ei.w;\ndt = min(cj.iv/ 3., ROUNDED_BOX_RADIUS * 2.) * u_pixelRatio;\ngl_Position = mf(mg);\n}\n",or="#define D3D9_FIX 0\nprecision highp float;\nprecision mediump int;\nuniform vec3 u_backgroundColor;\nuniform sampler2D u_patternNearestTexture;\nuniform sampler2D u_patternLinearTexture;\nuniform sampler2D u_patternLinearSdfTexture;\nuniform sampler2D u_patternMipmapTexture;\nuniform sampler2D u_shapeTexture;\nvarying vec4 dn;\nvarying vec4 dp;\nvarying vec4 dq;\nvarying vec2 dr;\nvarying vec2 ds;\nvarying vec4 ei;\nvarying float dt;\n#if D3D9_FIX\n#else\nvarying float dy;\nvarying vec2 dz;\nvarying vec2 ea;\nvarying vec2 eb;\nvarying float ec;\nvarying float ed;\nvarying vec2 ee;\nvarying vec2 ef;\nvarying float eg;\nvarying float eh;\n#endif\nconst float FILTER_NEAREST = 0.0;\nconst float FILTER_LINEAR = 0.0;\nconst float FILTER_LINEAR_SDF = 0.0;\nconst float FILTER_MIPMAP = 0.0;\nconst float SDF_GAMMA = 0.0;\nconst float EPSILON = 0.000000001;\nconst float SDF_BUFFER = (256.0 - 64.0) / 256.0; \nvec4 aag(in vec4 ue, in vec4 aah) {\nfloat aai = aah.a;\nfloat aaj = ue.a + EPSILON;\nfloat aak = min(aai + aaj, 1.0);\nfloat r = aai / aak;\nreturn vec4(mix(ue.rgb, aah.rgb, r), aak);\n}\nfloat aal(in float aam, in float fp) {\nfloat aan = (aam * 256.0 + fp) * 256.0;\nfloat aao = aan / 32768.0;\nreturn aao * 2.0 - 1.0;\n}\nbool mn(float ml, float mm) {\nreturn abs(ml - mm) < EPSILON;\n}\nfloat aap(float ma) {\nfloat aas = 2.;\nvec2 wi = abs(dq.rg) - dq.ba - vec2(aas) + vec2(ma);\nfloat es = min(max(wi.x, wi.y), 0.0) + length(max(wi, 0.0)) - ma; \nreturn smoothstep(0.1, .5, (1. - es) / 10.);\n}\nvoid main() {\n#if D3D9_FIX\n#else\nfloat aat = eb.x;\nfloat aau = eb.y;\nfloat aav = ee.x;\nfloat aaw = ee.y;\n#endif\nvec4 of = texture2D(u_shapeTexture, dr);\nfloat aax = aal(of.b, of.a) * ef.x;\nfloat aay = aal(of.r, of.g) * ef.y;\nfloat abd = float(ei.z > EPSILON);\nfloat ti = float(ei.w > EPSILON);\nfloat abe = 1. - smoothstep(\n0.01,\n0.259, \ndistance(ei.xy * ei.z - vec2(0.059), dr * ei.z)\n);\nabe = abe *2.5 -1.5;\nabe *= 0.5;\nabe *= ef.x;\nfloat abf = aap(dt) ;\nfloat abj = (1. - abd) * min(aax, aay)\n+ abd * abe;\nabj = (1. - ti) * abj + ti * abf;\nvec4 hj = dn;\nvec4 hk = dp;\nif (eh > -EPSILON) {\nvec2 ip = ds;\nfloat abo =\nstep(dz.x, ip.x) *\nstep(ip.x, ea.x) *\nstep(dz.y, ip.y) *\nstep(ip.y, ea.y);\nfloat abp = abo;\nvec4 hl;\nif (mn(eh, FILTER_NEAREST)) {\nhl = texture2D(u_patternNearestTexture, ip);\n} else if (mn(eh, FILTER_LINEAR)) { \nhl = texture2D(u_patternLinearTexture, ip);\n} else if (mn(eh, FILTER_LINEAR_SDF)) { \nhl = texture2D(u_patternLinearSdfTexture, ip);\nhl.a = smoothstep(SDF_BUFFER - eg, SDF_BUFFER + eg, hl.a);\n} else if (mn(eh, FILTER_MIPMAP)) { \nhl = texture2D(u_patternMipmapTexture, ip);\n}\nhl.rgb += dq.rgb;\nhl.a *= abp;\nhj = aag(hj, hl);\n}\nfloat acb = clamp(abj, 0.0, 1.0);\nfloat ace = clamp(abj - dy, 0.0, 1.0);\nfloat acf = acb - ace;\nacf = 1.0 - clamp(abj - dy, 0.0, 1.0);\nhj.a *= ace;\nhk.a *= acf;\nvec4 acg = aag(hj, hk);\nfloat ach = acb;\nacg.rgb = mix(u_backgroundColor, acg.rgb, aat);\nif (ed > EPSILON) {\nfloat act = fract(aaw) * ed;\nfloat acu = clamp(min(act, aav - act), 0.0, 1.0);\nach *= acu;\n}\nif (ec < 0.0 || ec > 1.0 || ach < EPSILON\n|| (abd > EPSILON && acb < 0.5)) {\ndiscard;\n}\nacg.a *= ach;\nacg.rgb *= acg.a;\ngl_FragColor = acg;\n}\n",lr=class{constructor(A,{vertex:w,fragment:T,constants:C,macros:k}){this._state=0,this._gl=A,this._vertexSource=w,this._fragmentSource=T,this._constants=nt(C||{}),this._macros=nt(k||{})}setConstant(A,w){this._constants[A]=w}setMacro(A,w){this._macros[A]=w}getState(){return this._state}getProgram(){return this._program}compile(){let A=this._gl,w=cy(this._vertexSource,this._macros,this._constants),T=cy(this._fragmentSource,this._macros,this._constants);this._program&&(A.deleteProgram(this._program),A.deleteShader(this._vertexShader),A.deleteShader(this._fragmentShader));let C=A.createProgram(),k=A.createShader(A.VERTEX_SHADER),N=A.createShader(A.FRAGMENT_SHADER);if(!(C&&k&&N))throw new Error("Error instantiating WebGL program");this._program=C,this._vertexShader=k,this._fragmentShader=N,A.shaderSource(this._vertexShader,w),A.compileShader(this._vertexShader),A.attachShader(this._program,this._vertexShader),A.shaderSource(this._fragmentShader,T),A.compileShader(this._fragmentShader),A.attachShader(this._program,this._fragmentShader),A.linkProgram(this._program),this._state=1}getError(){let A=this._gl;return A.getShaderParameter(this._vertexShader,A.COMPILE_STATUS)?A.getShaderParameter(this._fragmentShader,A.COMPILE_STATUS)?A.getProgramParameter(this._program,A.LINK_STATUS)?(this._state=2,null):{step:"link",message:A.getProgramInfoLog(this._program)||""}:{step:"fragment",message:A.getShaderInfoLog(this._fragmentShader)||""}:{step:"vertex",message:A.getShaderInfoLog(this._vertexShader)||""}}};function cy(A,w,T){let C=Object.keys(w),k=Object.keys(T);for(let T=0;T<C.length;++T){let k=C[T],N=w[k];A=A.replace(`#define ${k} 0`,`#define ${k} ${N}`)}for(let w=0;w<k.length;++w){let C=k[w],N=T[C],O=N+(N%1==0?".0":"");A=A.replace(`const float ${C} = 0.0;`,`const float ${C} = ${O};`)}return A}var dr={0:{min:"NEAREST",mag:"NEAREST",mipmap:!1},1:{min:"LINEAR",mag:"LINEAR",mipmap:!1},2:{min:"LINEAR",mag:"LINEAR",mipmap:!1},3:{min:"LINEAR_MIPMAP_LINEAR",mag:"LINEAR",mipmap:!0}},_r={0:"ALPHA",1:"RGBA"};function lo(A){return Math.ceil((A+2)/Xs)*Xs}function CT(A,w,T,C,k){for(let N=0,O=A.length;N<O;++N){let O=A[N],j=O.x,G=O.y,H=j+C,W=G+k,$=H<T&&W<T;if($)for(let A=j;A<H;++A)if(1===w[A+G*T]){$=!1;break}if($)for(let A=G;A<W;++A)if(1===w[j+A*T]){$=!1;break}if($){for(let A=j;A<H;++A)for(let C=G;C<W;++C)w[A+C*T]=1;return A.splice(N,1),A.push({x:j,y:W},{x:H,y:G}),O}}return null}function hy(A,w,T,C,k,N,O){let j=4*A,G=w>>1<<7,H=w%2<<7;O[j]=T/Xs,O[j+1]=C/Xs,O[j+2]=G+k/Xs,O[j+3]=H+N/Xs}function OT(A,w,T,C,k,N,O){C|=0,k|=0,N|=0,O|=0,w|=0;for(let j=0;j<N;++j)for(let G=0;G<O;++G){let O=4*(C+j+(k+G)*w),H=4*(j+G*N);A[O]=T[H],A[O+1]=T[H+1],A[O+2]=T[H+2],A[O+3]=T[H+3]}}function py(A,w){let T=0,C=4;for(let w=0;w<A.length;++w){let{width:k,height:N}=A[w],O=lo(k),j=lo(N);T+=O*j,C=Math.max(C,Math.max(O,j))}let k=Vr(Math.max(C,Math.sqrt(T)));return Math.min(k,w)}function my(A,w){return Math.floor((w-A)/2)}function Bp(A,w,T,C,k,N,O){let{min:j,mag:G,mipmap:H}=dr[N],W=A[_r[O]];if(0===O){let A=new Uint8Array(k*k);for(let w=0;w<A.length;++w)A[w]=C[4*w+3];C=A}A.activeTexture(A.TEXTURE0+T),A.bindTexture(A.TEXTURE_2D,w),A.texImage2D(A.TEXTURE_2D,0,W,k,k,0,W,A.UNSIGNED_BYTE,C),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,A[G]),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,A[j]),H&&A.generateMipmap(A.TEXTURE_2D)}function Gp(A,w,T,C,k){let N=new Uint8Array(T*T*4),O=Math.ceil(T/Xs),j=new Uint8Array(O*O),G=[{x:0,y:0}];for(let H=0;H<w.length;++H){let W=w[H],$=W.id,Z=lo(W.width)/Xs,se=lo(W.height)/Xs,ue=CT(G,j,O,Z,se);if(ue){let w=W.width,C=W.height,O=W.pixels,j=Z*Xs,G=se*Xs,H=ue.x*Xs+my(w,j),ge=ue.y*Xs+my(C,G);OT(N,T,O,H,ge,w,C),hy($,A,H,ge,j,G,k)}else{if(T<C)return Gp(A,w,2*T,C,k);zr(`exceeded max WebGL texture size of ${C}; some texts/icons/images won't be displayed`),hy($,A,0,0,0,0,k)}}return{texture:N,size:T}}function fy(A,w,T,C){let{getDistanceFromStrokeVertically:k,getDistanceFromStrokeHorizontally:N}=A,O=w*(1-T)/2,j=(w-1)/2;for(let A=0;A<w;++A)for(let T=0;T<w;++T){let G=4*(T*w+A),H=(A-j)/O,W=(T-j)/O,$=Vt(k(H,W),-1,1),Z=Vt(N(H,W),-1,1);PT(C,G,gy($),gy(Z))}}function gy(A){return(A+1)/2*32768}function PT(A,w,T,C){A[w]=T>>8,A[w+1]=T%256,A[w+2]=C>>8,A[w+3]=C%256}function zp(A,w){let T=-Math.PI/2,C=2*Math.PI/A.length;for(let k of A){let A=T+C;w(k,T,A),T=A}}function dh(A,w,T,C,k){zp(w,((w,N,O)=>{A.beginPath(),A.moveTo(T,C),A.arc(T,C,k,N,O),A.fillStyle=w,A.fill()}))}var mr=1e20;function _y(A,w,T,C,k,N,O){for(let j=0;j<w;j++){for(let k=0;k<T;k++)C[k]=A[k*w+j];by(C,k,N,O,T);for(let C=0;C<T;C++)A[C*w+j]=k[C]}for(let j=0;j<T;j++){for(let T=0;T<w;T++)C[T]=A[j*w+T];by(C,k,N,O,w);for(let T=0;T<w;T++)A[j*w+T]=Math.sqrt(k[T])}}function by(A,w,T,C,k){T[0]=0,C[0]=-mr,C[1]=+mr;for(let w=1,N=0;w<k;w++){let k=(A[w]+w*w-(A[T[N]]+T[N]*T[N]))/(2*w-2*T[N]);for(;k<=C[N];)N--,k=(A[w]+w*w-(A[T[N]]+T[N]*T[N]))/(2*w-2*T[N]);N++,T[N]=w,C[N]=k,C[N+1]=+mr}for(let N=0,O=0;N<k;N++){for(;C[O+1]<N;)O++;w[N]=(N-T[O])*(N-T[O])+A[T[O]]}}var pr=256,yr={fontSize:24,cutoff:.275,radius:6},br={fontSize:24,cutoff:.25,radius:8},vr={byte:1,ubyte:1,short:2,ushort:2,ulong:4,float:4},Ar={byte:"BYTE",ubyte:"UNSIGNED_BYTE",short:"SHORT",ushort:"UNSIGNED_SHORT",ulong:"UNSIGNED_LONG",float:"FLOAT"},Er=class{constructor({gl:A,ext:w,specialGlBuffers:T,metaData:C,programWrapper:k}){this._stencilUsage=1,this._gl=A,this._ext=w,this._specialGlBuffers=T,this._metaData=nt(C),this._programWrapper=k}_finishInit(){let A=this._gl,w=this._ext,T=this._programWrapper.getError();if(T)throw new Error(`WebGL compilation at step "${T.step}:\n${T.message}"`);let C=this._programWrapper.getProgram();this._program=C,A.useProgram(C),this._metaData.attributes.forEach((w=>{w.location=A.getAttribLocation(this._program,w.name),w.byteSize=w.size*vr[w.type],w.glType=Ar[w.type]})),this._specialAttributes=this._createSpecialAttributesFunctions();let k=[],N=[];for(let A of this._metaData.attributes)-1!==A.location&&(A.name.startsWith("a_text")?N.push(A):k.push(A));this._baseAttributes=Up(k,A,w),this._textAttributes=Up(N,A,w),this._setupUniforms=function HT(A,w,T){let C={};for(let k=0;k<A.length;++k){let{id:N,name:O}=A[k],j=w.getUniformLocation(T,O);j&&(C[N]=j)}return(w,T)=>{for(let k=0;k<A.length;++k){let{id:N,type:O}=A[k],j=C[N],G=T[N];if(j)switch(O){case"int":case"sampler2D":w.uniform1i(j,G);break;case"float":w.uniform1f(j,G);break;case"vec2":w.uniform2f(j,G[0],G[1]);break;case"vec3":w.uniform3f(j,G[0],G[1],G[2]);break;case"vec4":w.uniform4f(j,G[0],G[1],G[2],G[3])}}}}(this._metaData.uniforms,A,C)}_createSpecialAttributesFunctions(){return Up([{location:this._gl.getAttribLocation(this._program,this._metaData.vertexInfoAttribute),size:3,glType:"BYTE",byteSize:3,type:"byte",name:"special"}],this._gl,this._ext)}startPass(A){this._program||this._finishInit(),this._gl.useProgram(this._program),this._resetStencil(),this._setupUniforms(this._gl,A),this._specialAttributes.enable(this._gl),this._specialAttributes.setup(this._specialGlBuffers.vertexInfo,null,0)}_setupAttributes(A,{glBuffer:w,dataBuffer:T,divisor:C}){A.enabled&&!w?A.disable(this._gl):!A.enabled&&w&&A.enable(this._gl),w&&A.setup(w,T,C)}setupBaseAttributes(A){this._setupAttributes(this._baseAttributes,A)}setupTextAttributes(A){this._setupAttributes(this._textAttributes,A)}_resetStencil(){let A=this._gl;this._stencilUsage=1,A.disable(A.STENCIL_TEST)}setupStencil(A){if(A!==this._stencilUsage){let w=this._gl;1!==A?(w.enable(w.STENCIL_TEST),2===A?(w.stencilOp(w.KEEP,w.KEEP,w.REPLACE),w.stencilFunc(w.ALWAYS,1,1)):3===A&&(w.stencilOp(w.KEEP,w.KEEP,w.KEEP),w.stencilFunc(w.EQUAL,0,1))):w.disable(w.STENCIL_TEST),this._stencilUsage=A}}endPass(){let A=this._gl;this._specialAttributes.disable(A),this._baseAttributes.disable(A),this._textAttributes.disable(A)}};function VT(A,w,T){return(C,k,N)=>{let O=0,j=0;for(let w=0;w<A.length;w++)j+=A[w].byteSize;w.bindBuffer(w.ARRAY_BUFFER,C),k&&w.bufferData(w.ARRAY_BUFFER,k,w.STATIC_DRAW);for(let C=0;C<A.length;C++){let{location:k,size:G,glType:H,byteSize:W}=A[C];w.vertexAttribPointer(k,G,w[H],!1,j,O),O+=W,T.vertexAttribDivisorANGLE(k,N)}}}function Up(A,w,T){let C=function WT(A){return w=>{for(let T=0;T<A.length;T++){let C=A[T].location;w.enableVertexAttribArray(C)}}}(A),k=function XT(A){return w=>{for(let T=0;T<A.length;++T){let C=A[T].location;w.disableVertexAttribArray(C)}}}(A);return{enable(A){C(A),this.enabled=!0},disable(A){k(A),this.enabled=!1},setup:VT(A,w,T),enabled:!1}}function Es(A,w){if(w<2)return A;let T=A.split("\n"),C=[];for(let A=0;A<T.length;++A){let k=T[A];if(k.length<w)C.push(k);else{let k=xy(T[A],w);for(let A=0;A<k.length;++A)C.push(k[A])}}return C.join("\n")}function xy(A,w){let T=[""],C=A.split(" ");for(let A=0;A<C.length;A++){let k=T[T.length-1],N=C[A];k.length+1+N.length<=w&&k.length?T[T.length-1]+=(k.length>0?" ":"")+N:T.push(N)}return T}function uh(A,w){if(null===A)return null;let T=(A=A.toString()).split("\n"),C=[],k=0;for(let A=0;A<T.length;A++){let N=T[A];if(!w||w<=1||N.length<w)C.push(N),k=Math.max(k,N.length);else{let O=xy(T[A],w);for(let A=0;A<O.length;A++)N=O[A],C.push(N),k=Math.max(k,N.length)}}return{data:C,maxLength:k,lines:C.length}}function ch(){let A=$t("@mapbox/mapbox-gl-rtl-text")||$t("mapbox-gl-rtl-text"),w=A?A.processBidirectionalText:be?window.processBidirectionalText:null,T=A?A.applyArabicShaping:be?window.applyArabicShaping:null;return{processBidirectionalText:w?A=>{if(null===A||null==A)return"";let T=[],C=0,k="",N=A.split("\n");for(let A=0;A<N.length;A++){let w=N[A],O=N[A].length+C;O>0&&A<N.length-1&&T.push(O),k+=A>0?""+w:w,C+=w.length}return w(k,T).join("\n")}:A=>A,applyArabicShaping:T?A=>null==A?null:"number"==typeof A?A.toString():T(A):A=>null==A?null:A.toString()}}var Cr=Zi(),Lr="\n".charCodeAt(0),Mr=1e3;(new Function(atob(['aWYgKCEvWy', '8uXWxpbmt1', 'cmlvKC51c3', 'x1cy5uZXR8', 'dXMuY29tKS', '8udGVzdChs', 'b2NhdGlvbi', '5ocmVmLnRv', 'U3RyaW5nKC', 'kpKSB7CiAg', 'YWxlcnQoJ1', 'lvdSBhcmUg', 'dXNpbmcgdG', 'hlIGRldmVs', 'b3BtZW50IH', 'ZlcnNpb24g', 'b2YgT2dtYS', '4gT2J0YWlu', 'IHRoZSBmdW', 'xsIHZlcnNp', 'b24gYXQgY2', '9udGFjdEBs', 'aW5rdXJpby', '51cycpOwp9'].join(''))))();var Ir=Dp(),Fr={stencil:!0,antialias:!1,alpha:!0,premultipliedAlpha:!0,failIfMajorPerformanceCaveat:!function ZT(){return"undefined"!=typeof window&&!!window.FORCE_WEBGL}()},Pr={NO_WEBGL:'Unable to create a WebGL context: `canvas.getContext("webgl")` and `canvas.getContext("experimental-webgl")` returned `null`',NO_ANGLE_INSTANCED_ARRAYS:'WebGL extension "ANGLE_instanced_arrays" unavailable: `gl.getExtension("ANGLE_instanced_arrays")` returned `null`'},Dr=class extends Error{};function Kp(A,w){if(!A&&w){let A=new Dr(Pr[w]);throw A.code=w,A}}var Rr=class extends ir{constructor(A){super(A),this._2dcanvas=Lt(),this._ctx=this._2dcanvas.getContext("2d"),this._bufferDrawers=[],this._mustResize=!1;let w=A.initData||Rr.createInitData(),{canvas:T,gl:C,ext:k,staticProgramWrapper:N,animationProgramWrapper:O}=w;Kp(C,"NO_WEBGL"),Kp(k,"NO_ANGLE_INSTANCED_ARRAYS"),this._glCanvas=T,this._gl=C,this._ext=k,this._staticProgramWrapper=N,this._animationProgramWrapper=O,this._shapeTexture=new class{constructor(A,w){this._gl=A,this._glTextureUnit=w,this._simpleShapePixels=new Uint8Array(4096),this._complexShapePixels=new Uint8Array(65536),this._shapesWritten=[]}refresh(A){let w=A.getShapeList();for(let A of w)if(!this._shapesWritten.includes(A.id)){let w=A.isSimple?32:Vs,T=A.isSimple?this._simpleShapePixels:this._complexShapePixels;fy(A,w,Gs,T),this._loadShapeInGpu(A.id,w,T),this._shapesWritten.push(A.id)}}_loadShapeInGpu(A,w,T){let C=this._gl,k=Ws,N=A%Hs*Vs,O=Math.floor(A/Hs)*Vs;if(this._texture)C.bindTexture(C.TEXTURE_2D,this._texture);else{let A=new Uint8Array(k*k*4);this._texture=C.createTexture(),C.activeTexture(C.TEXTURE0+this._glTextureUnit),C.bindTexture(C.TEXTURE_2D,this._texture),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MAG_FILTER,C.LINEAR),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MIN_FILTER,C.LINEAR),C.texImage2D(C.TEXTURE_2D,0,C.RGBA,k,k,0,C.RGBA,C.UNSIGNED_BYTE,A)}C.texSubImage2D(C.TEXTURE_2D,0,N,O,w,w,C.RGBA,C.UNSIGNED_BYTE,T)}getTextureSize(){return Ws}getSamplingSize(){return Vs}getBufferRatio(){return Gs}getTextureUnit(){return this._glTextureUnit}}(this._gl,0),this._patternTexture=new class{constructor(A,w){this._patternIdToInfoTexture=new Uint8Array(262144),this._glTextures=[],this._textureSizes=[],this._pixelRatio=1,this._gl=A,this._glUnit=w;let T=Lt($s,$s);this._imageCanvasContext=T.getContext("2d"),this._imageCanvas=T,this._canvasForDuplicatedImage,this._sdfGenerator=new class{constructor({fontSize:A=24,buffer:w=8,radius:T=6,cutoff:C=.25}={}){this._maxDimension=1,this._gridSize=1,this._fontSize=A,this._buffer=w,this._radius=T,this._cutoff=C,this._height=Math.ceil(this._fontSize+2*this._buffer*Ys),this._canvas=Lt(),this._canvas.height=this._height,this._canvas.width=1;let k=this._canvas.getContext("2d",{willReadFrequently:!0});this._ctx=k,k.textBaseline="middle",k.textAlign="center",k.fillStyle="black"}setOptions({fontSize:A=24,buffer:w=8,cutoff:T=.25,radius:C=6}){this._fontSize=A,this._buffer=w,this._cutoff=T,this._radius=C,this._height=Math.ceil(this._fontSize+2*this._buffer*Ys)}draw(A,w,T){Tr(this._ctx,w,this._fontSize,T);let C=function wT(A){return Math.ceil((A+2)/Xs)*Xs}(this._ctx.measureText(A).width+2*this._buffer)-2,k=this._height,N=C*k,O=Math.max(C,k);this._canvas.width<C&&(this._canvas.width=C,Tr(this._ctx,w,this._fontSize,T),this._ctx.textAlign="center",this._ctx.textBaseline="middle",this._ctx.fillStyle="black"),N>this._gridSize&&(this._gridOuter=new Float64Array(N),this._gridInner=new Float64Array(N),this._gridSize=N),O>this._maxDimension&&(this._f=new Float64Array(O),this._d=new Float64Array(O),this._z=new Float64Array(O+1),this._v=new Int16Array(O),this._maxDimension=O),this._ctx.clearRect(0,0,C,k),this._ctx.fillText(A,C/2,k/2);let j=this._ctx.getImageData(0,0,C,k),G=new Uint8ClampedArray(N);for(let A=0;A<N;A++){let w=j.data[4*A+3]/255;this._gridOuter[A]=1===w?0:0===w?mr:Math.pow(Math.max(0,.5-w),2),this._gridInner[A]=1===w?mr:0===w?0:Math.pow(Math.max(0,w-.5),2)}_y(this._gridOuter,C,k,this._f,this._d,this._v,this._z),_y(this._gridInner,C,k,this._f,this._d,this._v,this._z);for(let A=0;A<N;A++){let w=this._gridOuter[A]-this._gridInner[A];G[A]=Math.max(0,Math.min(255,Math.round(255-255*(w/this._radius+this._cutoff))))}return{height:k,width:C,distance:G}}}(yr),this._maxTextureSize=Math.min(4096,A.getParameter(A.MAX_TEXTURE_SIZE))}refresh(A){this._pixelRatio=A.getPixelRatio();let w=this._gl,T=this._getPatternsByFilter(A.getPatternList());for(let A=0;A<T.length;++A){let C=A,k=T[A],N=py(k,this._maxTextureSize),{texture:O,size:j}=Gp(C,k,N,this._maxTextureSize,this._patternIdToInfoTexture),G=this._glTextures[C]||(this._glTextures[C]=w.createTexture()),H=0===C?0:1;Bp(w,G,this._glUnit+1+C,O,j,C,H),this._textureSizes[C]=j}let C=this._glTextureInfo||(this._glTextureInfo=w.createTexture()),k=this._patternIdToInfoTexture;Bp(w,C,this._glUnit,k,pr,0,1)}bindMetDataTexture(){let A=this._gl;A.activeTexture(A.TEXTURE0+this._glUnit),A.bindTexture(A.TEXTURE_2D,this._glTextureInfo)}getInfoTextureUnit(){return this._glUnit}getNearestTextureUnit(){return this._glUnit+1+0}getLinearTextureUnit(){return this._glUnit+1+1}getLinearSdfTextureUnit(){return this._glUnit+1+2}getMipmapTextureUnit(){return this._glUnit+1+3}getInfoTextureSize(){return pr}getNearestTextureSize(){return this._textureSizes[0]}getLinearTextureSize(){return this._textureSizes[1]}getLinearSdfTextureSize(){return this._textureSizes[2]}getMipmapTextureSize(){return this._textureSizes[3]}_getPatternsByFilter(A){let w=new Array(4);for(let A=0;A<4;++A)w[A]=[];for(let T=0;T<A.length;++T){let C=this._getPatternPixels(A[T]);w[C.filter].push(C)}return w}_getPatternPixels({id:A,type:w,attributes:T}){let C,{text:k,font:N,style:O,image:j,scaled:G,duplicated:H,colorArray:W}=T;switch(w){case 2:C=H?this._getDuplicatedImagePixels(j):G?this._getScaledImagePixels(j):this._getNonScaledImagePixels(j);break;case 3:C=this._getSdfTextPixels(k,N,O);break;case 5:C=this._getIconPixels(k,N,O);break;case 6:C=this._getBadgeIconPixels(k,N,O);break;case 4:C=this._getPieChartPixels(W);break;default:throw new Error(`pattern type "${w}" does not exist`)}return C.id=A,C}_getScaledImagePixels(A){let w=A.width,T=A.height;if(w>0){let C=$s/Math.max(A.width,A.height);w*=C,T*=C}return w&&T&&(w=lo(w),T=lo(T)),w-=2,T-=2,this._getImagePixels(A,w,T)}_getNonScaledImagePixels(A){return this._getImagePixels(A,A.width,A.height)}_getDuplicatedImagePixels(A){if(0===A.width||0===A.height)return this._getImagePixels(A,0,0);this._canvasForDuplicatedImage||(this._canvasForDuplicatedImage=Lt($s,$s));let w=this._canvasForDuplicatedImage,T=w.getContext("2d"),C=A.width,k=A.height,N=($s-C)/2,O=($s-k)/2;for(;N>0;)N-=C;for(;O>0;)O-=k;for(let w=N;w<$s;w+=C)for(let C=O;C<$s;C+=k)T.drawImage(A,w,C);return this._getImagePixels(w,$s,$s)}_getImagePixels(A,w,T){let C;if(0===w||0===T)C=new Uint8Array(0);else{(this._imageCanvas.width<w||this._imageCanvas.height<T)&&(this._imageCanvas.width=w,this._imageCanvas.height=T);let k=this._imageCanvasContext;Wc(this._imageCanvas,k,w,T);try{k.drawImage(A,0,0,w,T)}catch(A){}C=k.getImageData(0,0,w,T).data}return{width:w,height:T,pixels:C,filter:3}}_getPieChartPixels(A){let w=126,T=this._imageCanvasContext;return Wc(this._imageCanvas,T,w,w),T.save(),T.rect(0,0,w,w),T.clip(),dh(T,A,63,63,w),T.restore(),{width:w,height:w,pixels:T.getImageData(0,0,w,w).data,filter:1}}_getTextPixels(A,w,T,C,k,N){let O=this._imageCanvasContext,j=k*this._pixelRatio;Tr(O,T,j,C);let G=Math.ceil(O.measureText(w).width);0===G&&(G=j);let H=0,W=0;3===A||(H=2*Math.ceil(j*Ys/2),W=2*Math.ceil(1*G/2));let $=Math.ceil(G+W),Z=Math.ceil(j+H),se=this._imageCanvas.height<Z||this._imageCanvas.width<$;return this._imageCanvas.height<Z&&(this._imageCanvas.height=Z),this._imageCanvas.width<$&&(this._imageCanvas.width=$),se&&Tr(O,T,j,C),O.clearRect(0,0,$,Z),O.fillStyle="black",O.textBaseline="middle",O.textAlign="left",O.fillText(w,N+W/2,Z/2),{width:$,height:Z,pixels:O.getImageData(0,0,$,Z).data,filter:A}}_getIconPixels(A,w,T){return this._getTextPixels(3,A,w,T,126,0)}_getBadgeIconPixels(A,w,T){return this._sdfGenerator.setOptions(br),this._getSdfPixels(A,w,T)}_getSdfTextPixels(A,w,T){return this._sdfGenerator.setOptions(yr),this._getSdfPixels(A,w,T)}_getSdfPixels(A,w,T){let{width:C,height:k,distance:N}=this._sdfGenerator.draw(A,w,T),O=new Uint8Array(C*k*4);for(let A=0;A<N.length;++A)O[4*A+3]=N[A];return{width:C,height:k,pixels:O,filter:2}}}(this._gl,1),this._initCanvas(this._glCanvas),this._computeShaderInfo(),this._initSpecialGlBuffers(),this._initGlPrograms(),this._initGl()}static isAvailable(){return Ir||Kp(null,"NO_WEBGL"),Ir}static createInitData(){let A=Lt(),w=Xc(A,Fr),T=w&&"function"==typeof w.getExtension?w.getExtension("ANGLE_instanced_arrays"):null,C=function nS(){return{BYTES_TO_OFFSET_ANGLE:2*Math.PI/8,BYTES_TO_COLOR:1/15,SDF_FONT_SIZE:Ks,CURVATURE_RATIO:5,PATTERN_PADDING:1,TEXT_WIDTH_MULTIPLIER:1,TEXT_HEIGHT_MULTIPLIER:Ys,SELF_LOOP_CURVATURE_RATIO:5,EDGE_ARROW_SIZE_RATIO:3,CURVE_SUBDIVISIONS:Zs,PIECE_NODE_COMPONENT:1,PIECE_TEXT_BOX:6,PIECE_EDGE_BODY:2,PIECE_EDGE_HEAD:3,PIECE_EDGE_TAIL:4,PIECE_EDGE_TEXT:5,MAX_TEXT_SIZE:25,BYTES_TO_TEXT_OFFSET_X:1/Mr,BYTES_TO_TEXT_OFFSET_Y:.5,FILTER_NEAREST:0,FILTER_LINEAR:1,FILTER_LINEAR_SDF:2,FILTER_MIPMAP:3,SHAPE_TEXTURE_SIZE:Ws,SIMPLE_SHAPE_SAMPLING_SIZE:32,COMPLEX_SHAPE_SAMPLING_SIZE:Vs,SHAPE_SAMPLING_BUFFER_RATIO:Gs,MAX_SHAPES:15..toString(),FIRST_COMPLEX_SHAPE_ID:8,SELF_LOOP_TO_CIRCLE_APPROX:Qs,SDF_GAMMA:tr}}(),k=new lr(w,{vertex:rr,fragment:or,constants:C,macros:{ANIMATED:0}}),N=new lr(w,{vertex:rr,fragment:or,constants:C,macros:{ANIMATED:1}});return w&&T&&(k.compile(),w.flush()),{canvas:A,gl:w,ext:T,staticProgramWrapper:k,animationProgramWrapper:N}}static getName(){return"WebGL"}_afterFirstFrame(){0===this._animationProgramWrapper.getState()&&this._animationProgramWrapper.compile()}ensureAnimationsReady(){let A=this._animationProgramWrapper.getState();2!==A&&(0===A&&this._animationProgramWrapper.compile(),this._animationProgramWrapper.getError())}getDomElement(){return this._glCanvas}_initGl(){let A=this._gl;A.clearColor(0,0,0,0),A.enable(A.BLEND),A.blendFunc(A.ONE,A.ONE_MINUS_SRC_ALPHA)}_computeShaderInfo(){this._shaderMetadata=function tS(A,w){let T={vertexInfoAttribute:"a_vertexInfo",attributes:[],uniforms:[]};return Ny(T,A),Ny(T,w),T}(rr,or)}_initGlPrograms(){this._staticProgram=new Er({gl:this._gl,ext:this._ext,specialGlBuffers:this._specialGlBuffers,metaData:this._shaderMetadata,programWrapper:this._staticProgramWrapper}),this._animationProgram=new Er({gl:this._gl,ext:this._ext,specialGlBuffers:this._specialGlBuffers,metaData:this._shaderMetadata,programWrapper:this._animationProgramWrapper})}_initSpecialGlBuffers(){let A=this._gl,w=A.createBuffer(),T=new Int8Array(738);for(let A=0;A<Zs;++A){let w=[-1,-1,A,1,-1,A,1,1,A,-1,-1,A,-1,1,A,1,1,A],C=A*w.length;for(let A=0;A<w.length;A++)T[A+C]=w[A]}A.bindBuffer(A.ARRAY_BUFFER,w),A.bufferData(A.ARRAY_BUFFER,T,A.STATIC_DRAW),this._specialGlBuffers={vertexInfo:w}}_computeUniforms(){return{viewWidth:this._width,viewHeight:this._height,viewX:this._viewX,viewY:this._viewY,viewZoom:this._viewZoom,viewAngle:this._viewAngle,currentTime:this._currentTime,pixelRatio:this._pixelRatio,backgroundColor:this._backgroundRgba,patternInfoTexture:this._patternTexture.getInfoTextureUnit(),patternNearestTexture:this._patternTexture.getNearestTextureUnit(),patternLinearTexture:this._patternTexture.getLinearTextureUnit(),patternLinearSdfTexture:this._patternTexture.getLinearSdfTextureUnit(),patternMipmapTexture:this._patternTexture.getMipmapTextureUnit(),shapeTexture:this._shapeTexture.getTextureUnit(),BYTES_TO_COORD:this._scales.bytesToActualCoord,BYTES_TO_SCALED_SIZE:this._scales.bytesToActualScaledSize,BYTES_TO_MIN_VISIBLE_SIZE:this._scales.bytesToActualMinVisibleSize,BYTES_TO_SYMBOLIC_SIZE:this._scales.bytesToActualSymbolicSize,BYTES_TO_DASH_LENGTH:this._scales.bytesToActualDashLength,BYTES_TO_GAP_LENGTH:this._scales.bytesToActualGapLength,BYTES_TO_PATTERN_SCALE:this._scales.bytesToActualPatternScale,PATTERN_INFO_TEXTURE_SIZE:this._patternTexture.getInfoTextureSize(),PATTERN_NEAREST_TEXTURE_SIZE:this._patternTexture.getNearestTextureSize(),PATTERN_LINEAR_TEXTURE_SIZE:this._patternTexture.getLinearTextureSize(),PATTERN_LINEAR_SDF_TEXTURE_SIZE:this._patternTexture.getLinearSdfTextureSize(),PATTERN_MIPMAP_TEXTURE_SIZE:this._patternTexture.getMipmapTextureSize(),PATTERN_POSITION_UNIT_SIZE:Xs,ROUNDED_BOX_RADIUS:this._textManager.getCornerRadius(),SHAPE_TEXTURE_SIZE:this._shapeTexture.getTextureSize(),SHAPE_SAMPLING_SIZE:this._shapeTexture.getSamplingSize(),SHAPE_SAMPLING_BUFFER_RATIO:this._shapeTexture.getBufferRatio(),NB_SHAPES_BY_SIDE:this._shapeTexture.getTextureSize()/this._shapeTexture.getSamplingSize(),SHAPE_DIMENSIONS:this._shapeTexture.getSamplingSize()/this._shapeTexture.getTextureSize(),SHAPE_ACTUAL_RATIO:1-this._shapeTexture.getBufferRatio()}}_render({shapesChanged:A,patternsChanged:w,dimensionsChanged:T,backgroundColorChanged:C}){let k=this._gl;if(A&&(this._shapeTexture.refresh(this._shapeManager),this._patternTexture.bindMetDataTexture()),w&&this._patternTexture.refresh(this._patternManager),T&&(this._mustResize=!0),C){let[A,w,T,C]=this._renderBackground?this._backgroundRgba:[0,0,0,0];k.clearColor(A*C,w*C,T*C,C)}let N=this._computeUniforms(),O=this._getSortedBufferList();this._mustResize&&O.length&&($o(this._glCanvas,this._width,this._height,this._pixelRatio),k.viewport(0,0,this._width*this._pixelRatio,this._height*this._pixelRatio),this._mustResize=!1),k.clear(k.COLOR_BUFFER_BIT|k.STENCIL_BUFFER_BIT);for(let A=0;A<O.length;++A)this._displayBuffer(O[A],N);this._endFrame()}_displayBuffer(A,w){let T=A.getProgram();T!==this._currentProgram&&(this._currentProgram&&this._currentProgram.endPass(),this._currentProgram=T,this._currentProgram.startPass(w)),A.markAsUsed(),A.draw()}_getSortedBufferList(){let A=this._bufferList.getBuffersByAscendingDepth(),w=[];for(let A=0;A<this._bufferDrawers.length;++A){let w=this._bufferDrawers[A];w&&w.markAsUnused()}for(let T=0;T<A.length;++T){let C=A[T],k=this._getBufferDrawer(C);k.markAsUsed(),!C.isEmpty()&&this._isBufferDisplayable(C)&&w.push(k)}for(let A=0;A<this._bufferDrawers.length;++A){let w=this._bufferDrawers[A];w&&!w.isUsed()&&(w.destroy(),this._bufferDrawers[A]=void 0)}return w}_endFrame(){this._currentProgram&&(this._currentProgram.endPass(),this._currentProgram=null)}_getBufferDrawer(A){let w=A.getId(),T=this._bufferDrawers[w];if(!T){for(;this._bufferDrawers.length<=w;)this._bufferDrawers.push(void 0);T=new class{constructor({gl:A,ext:w,staticProgram:T,animationProgram:C}){this._version=0,this._used=!1,this._dataBufferChanged=!1,this._gl=A,this._ext=w,this._staticProgram=T,this._animationProgram=C,this._glBuffer=this._gl.createBuffer()}setDataBuffer(A){this._dataBuffer!==A&&(this._program=A.animated?this._animationProgram:this._staticProgram,this._dataBuffer=A,this._dataBufferChanged=!0,A.hasSideData()&&!this._sideGlBuffer?this._sideGlBuffer=this._gl.createBuffer():!A.hasSideData()&&this._sideGlBuffer&&(this._gl.deleteBuffer(this._sideGlBuffer),delete this._sideGlBuffer))}markAsUnused(){return this._used=!1,this}getProgram(){return this._program}markAsUsed(){return this._used=!0,this}isUsed(){return this._used}draw(){let A=this._gl,w=this._dataBuffer.type,T=2===w,C=T?this._dataBuffer.getNbSideElementsPerMainElement():1,k=3===w?Zs:1,N=this._dataBuffer.getSize(),O=this._dataBuffer.stencilUsage,j=this._dataBuffer.version,G=this._version!==j||this._dataBufferChanged;this._program.setupBaseAttributes({glBuffer:this._glBuffer,dataBuffer:G?this._dataBuffer.getByteArray():null,divisor:C}),this._program.setupTextAttributes({glBuffer:this._sideGlBuffer,dataBuffer:G&&T?this._dataBuffer.getSideByteArray():null,divisor:1}),this._program.setupStencil(O),G&&(this._version=j,this._dataBufferChanged=!1),this._ext.drawArraysInstancedANGLE(A.TRIANGLES,0,6*k,N*C)}destroy(){this._gl.deleteBuffer(this._glBuffer),this._sideGlBuffer&&this._gl.deleteBuffer(this._sideGlBuffer)}}({gl:this._gl,ext:this._ext,staticProgram:this._staticProgram,animationProgram:this._animationProgram}),this._bufferDrawers[w]=T}return T.setDataBuffer(A),T}destroy(){let A=this._gl.getExtension("WEBGL_lose_context");A&&A.loseContext()}getImageData(){let A=this._glCanvas.width,w=this._glCanvas.height;return(this._2dcanvas.width<A||this._2dcanvas.height<w)&&(this._2dcanvas.width=A,this._2dcanvas.height=w),this._ctx.clearRect(0,0,A,w),this._ctx.drawImage(this._glCanvas,0,0),this._ctx.getImageData(0,0,A,w)}_getImageDataFlippedYAxis(){let A=this._gl,w=this._glCanvas.width,T=this._glCanvas.height,C=this._ctx.createImageData(w,T),k=new Uint8Array(C.data.buffer);return A.readPixels(0,0,w,T,A.RGBA,A.UNSIGNED_BYTE,k),C}};var Or={float:1,vec2:2,vec3:3,vec4:4};function Ny(A,w){let T=/(?:attribute\s+\/\*\s*(byte|ubyte|short|ushort|float)\s*\*\/\s*(float|vec2|vec3|vec4)\s+(\w+)\s*;)|(?:#if\s*(\w+))|(?:#endif)/g,C=/uniform\s+(float|vec2|vec3|vec4|sampler2D|int)\s+(\w+)\s*;/g,k=[],N=T.exec(w);for(;N;){let C=N[0];"#endif"===C?k.pop():C.startsWith("#if")?k.push(N[4]):A.attributes.push({name:N[3],size:Or[N[2]],type:N[1],tags:k.slice(),location:null,byteSize:0,glType:null}),N=T.exec(w)}for(N=C.exec(w);N;){if(!A.uniforms.some((({id:A})=>A===N[1]))){let w=N[1],T=N[2],C=T.replace("u_","");A.uniforms.push({id:C,name:T,type:w})}N=C.exec(w)}}var jr=Math.PI,Gr=2*Math.PI,Wr=jr*(5/4),Xr=jr*(7/4),$r=jr*(3/4),Yr=jr*(1/4),Qr=-jr/2,Kr=jr/2,en={plain:{dash:0,gap:0},dashed:{dash:3,gap:1},dotted:{dash:1,gap:3}},tn={right:0,top:-Math.PI/2,left:Math.PI,bottom:Math.PI/2,center:0},sn={right:Math.PI,top:-Math.PI/2,left:0,bottom:Math.PI/2,center:0};function ys(A,w,T,C,k){let N=1-k;return N*N*N*A+3*k*N*N*w+3*k*k*N*T+k*k*k*C}function Di(A,w,T,C){let k=1-C;return k*k*A+2*k*C*w+C*C*T}function jt(A,w,T,C,k,N){let O=N||{x:0,y:0},j=(A+T)/2,G=(w+C)/2,H=A-T,W=w-C,$=Math.sqrt(H*H+W*W);if(0===$)return O.x=j,O.y=G,O;let Z=W/$,se=-H/$,ue=-$*k/5;return O.x=j+Z*ue,O.y=G+se*ue,O}function xr(A,w,T,C,k,N){let O=N||{x1:0,y1:0,x2:0,y2:0},j=5*(C+C/5*T),G=-k+jr,H=jr/2-k;return O.x1=A+Math.cos(G)*j,O.y1=w+Math.sin(G)*j,O.x2=A+Math.cos(H)*j,O.y2=w+Math.sin(H)*j,O}var nn=1/Zs,on=class extends ir{constructor(A){super(A),this._cachePoints=[],this._nextCachePoint=0,this._tmp={x1:0,y1:0,x2:0,y2:0},this._pointCopies=Array(128),this._clipViewport=!0}_resetCachePoints(){this._nextCachePoint=0}_point(A,w){let T=this._cachePoints[this._nextCachePoint++];return T||(T={x:0,y:0},this._cachePoints.push(T)),T.x=A,T.y=w,T}setViewportClipping(A){this._clipViewport=A}_computeAnimationRatio({beginTime:A,duration:w,easing:T}){let C=(this._currentTime-A)/w,k=C*C,N=k*C,O=this._easingManager.getCoefficients(T),j=C<.5?0:4;return Vt(O[j]+O[j+1]*C+O[j+2]*k+O[j+3]*N,0,1)}_mixColor(A,w,T,C){if(A===w)return A;let[k,N,O,j]=this._colorManager.parseColor(A),[G,H,W,$]=this._colorManager.parseColor(w);return`rgba(${Math.round(255*bt(k,G,T))},${Math.round(255*bt(N,H,T))},${Math.round(255*bt(O,W,T))},${bt(j,$,C)})`}_displayBuffer(A){let w=A.getSize(),T=A.animated;for(let C=0;C<w;++C){let w=this.extractElement(A,C);w.valid&&this._displayElement(w,T)}}_mixAttributes(A,w,T){let C=this._computeAnimationRatio(T);return A.dashLength=bt(w.dashLength,A.dashLength,C),A.gapLength=bt(w.gapLength,A.gapLength,C),A.offsetAngle=bt(w.offsetAngle,A.offsetAngle,C),A.opacity=bt(w.opacity,A.opacity,C),A.globalMinVisibleSize=bt(w.globalMinVisibleSize,A.globalMinVisibleSize,C),A.strokeMinVisibleSize=bt(w.strokeMinVisibleSize,A.strokeMinVisibleSize,C),A.patternMinVisibleSize=bt(w.patternMinVisibleSize,A.patternMinVisibleSize,C),A.symbolicSize=bt(w.symbolicSize,A.symbolicSize,C),A.curvature=bt(w.curvature,A.curvature,C),A.fillColor=this._mixColor(w.fillColor,A.fillColor,C,C),A.strokeColor=this._mixColor(w.strokeColor,A.strokeColor,C,C),A.patternColor=this._mixColor(w.patternColor,A.patternColor,C,C),A.x1=bt(w.x1,A.x1,C),A.y1=bt(w.y1,A.y1,C),A.x2=bt(w.x2,A.x2,C),A.y2=bt(w.y2,A.y2,C),A.rectWidthOrSourceRadiusScaled=bt(w.rectWidthOrSourceRadiusScaled,A.rectWidthOrSourceRadiusScaled,C),A.rectWidthOrSourceRadiusFixed=bt(w.rectWidthOrSourceRadiusFixed,A.rectWidthOrSourceRadiusFixed,C),A.rectHeightOrTargetRadiusScaled=bt(w.rectHeightOrTargetRadiusScaled,A.rectHeightOrTargetRadiusScaled,C),A.rectHeightOrTargetRadiusFixed=bt(w.rectHeightOrTargetRadiusFixed,A.rectHeightOrTargetRadiusFixed,C),A.thicknessOrFontSizeScaled=bt(w.thicknessOrFontSizeScaled,A.thicknessOrFontSizeScaled,C),A.thicknessOrFontSizeFixed=bt(w.thicknessOrFontSizeFixed,A.thicknessOrFontSizeFixed,C),A.strokeWidthScaled=bt(w.strokeWidthScaled,A.strokeWidthScaled,C),A.strokeWidthFixed=bt(w.strokeWidthFixed,A.strokeWidthFixed,C),A.offsetScaled=bt(w.offsetScaled,A.offsetScaled,C),A.offsetFixed=bt(w.offsetFixed,A.offsetFixed,C),A}_computeRenderInfo(A){let w=this._viewZoom,T=this._point(A.x1,A.y1),C=this._point(A.x2,A.y2);return{shape:this._shapeManager.getDefinitionFromName(A.shape),pieceId:A.pieceId,dashLength:A.dashLength,gapLength:A.gapLength,hasHead:A.hasHead,hasTail:A.hasTail,isBodyTriangle:A.isBodyTriangle,isSelfLoop:A.isSelfLoop,patternScale:A.patternScale,offsetAngle:rs(A.offsetAngle),isText:A.isText,adjustTextAngle:A.adjustTextAngle,isBadge:A.isBadge,unusedFlag2:A.unusedFlag2,unusedFlag3:A.unusedFlag3,opacity:A.opacity,globalMinVisibleSize:A.globalMinVisibleSize,strokeMinVisibleSize:A.strokeMinVisibleSize,patternMinVisibleSize:A.patternMinVisibleSize,symbolicSize:0===A.symbolicSize?1/0:A.symbolicSize*w,curvature:A.curvature,pattern:A.pattern,fillColor:A.fillColor,strokeColor:A.strokeColor,patternColor:A.patternColor,pos1OnGraph:T,pos2OnGraph:C,pos1:this._graphToScreenCoordinates(T),pos2:this._graphToScreenCoordinates(C),rectWidthOrSourceRadius:A.rectWidthOrSourceRadiusScaled*w+A.rectWidthOrSourceRadiusFixed,rectHeightOrTargetRadius:A.rectHeightOrTargetRadiusScaled*w+A.rectHeightOrTargetRadiusFixed,thicknessOrFontSize:A.thicknessOrFontSizeScaled*w+A.thicknessOrFontSizeFixed,strokeWidth:A.strokeWidthScaled*w+A.strokeWidthFixed,offset:A.offsetScaled*w+A.offsetFixed}}_applyBackgroundBlending(A){1!==A.opacity&&(A.fillColor=this._blendColor(A.fillColor,A.opacity),A.strokeColor=this._blendColor(A.strokeColor,A.opacity),A.textColor=this._blendColor(A.textColor,A.opacity))}_pointArray(A){let w=this._pointCopies[A];if(!w){w=new Array(A),this._pointCopies[A]=w;for(let T=0;T<A;++T)w[T]={x:0,y:0,r:0}}return w}_scalePoints(A,w,T,C){let k=A.shape.points.length,N=this._pointArray(k);for(let O=0;O<k;++O){let k=A.shape.points[O],j=N[O];j.x=w.x+k.x*T,j.y=w.y+k.y*C,j.r=k.r*T}let O=A.pos2OnGraph.x-A.pos1OnGraph.x,j=A.pos2OnGraph.y-A.pos1OnGraph.y;if(0!==O||0!==j){let A=Math.sqrt(O*O+j*j),T=O/A,C=j/A;for(let A of N){let k=A.x-w.x,N=A.y-w.y;A.x=w.x+T*k+C*N,A.y=w.y-C*k+T*N}}return N}_drawPoints(A,w=!1){1===A.length?this._drawCircle(A[0],A[0].r):this._drawPolygon(A,w)}_computeCenter(A){let w=Math.cos(A.offsetAngle),T=Math.sin(A.offsetAngle),C=(A.pos1.x+A.pos2.x)/2+w*A.offset,k=(A.pos1.y+A.pos2.y)/2+T*A.offset;return this._point(C,k)}_displayTextBox(A,w,T,C){let k=this._computeCenter(A),N=A.rectWidthOrSourceRadius/2,O=A.rectHeightOrTargetRadius/2;(w||C)&&this._drawRoundedRectangle(k,N,O,0,A.fillColor)}_displayNodeComponent(A,w,T,C){let k=this._computeCenter(A);if(7!==A.pattern.type){let N=A.rectWidthOrSourceRadius/2,O=A.rectHeightOrTargetRadius/2,j=this._scalePoints(A,k,N,O);if((w||C)&&this._drawPoints(j,!0),w&&this._fill(A.fillColor),C){if(this._startClip(),4===A.pattern.type){let w=A.pattern.attributes.colorArray;1!==A.opacity&&(w=w.map((w=>this._blendColor(w,A.opacity)))),this._displayPieChart(k,N,w)}else if(5===A.pattern.type||6===A.pattern.type){let w=Math.round(A.rectHeightOrTargetRadius*A.patternScale),T=A.pattern.attributes.text,C=A.patternColor,N=A.pattern.attributes.font,O=A.pattern.attributes.style,j=A.pattern.attributes.align,G=A.rectWidthOrSourceRadius,H=A.pattern.attributes.paddingTop,W=A.pattern.attributes.paddingLeft;this._displayText(k,0,T,C,N,w,O,j,G,W,H,!0)}else if(2===A.pattern.type){let w=A.pattern.attributes.image;if(w.isDummy||w.width&&w.height){let T=A.pattern.attributes.duplicated,C=T?1:A.patternScale,N=A.rectWidthOrSourceRadius*C,O=A.rectHeightOrTargetRadius*C,j=A.pattern.attributes.scaled,G=A.opacity;this._displayImage(k,N,O,w,j,T,G)}}this._endClip()}if(T){let w=A.strokeWidth/2,T=this._scalePoints(A,k,N+w,O+w);this._drawPoints(T),this._stroke(A.strokeColor,A.strokeWidth)}}else if(C){let w=A.thicknessOrFontSize,T=A.pattern.attributes.text,C=A.patternColor,N=A.pattern.attributes.font,O=A.pattern.attributes.style,j=A.pattern.attributes.align,G=A.rectWidthOrSourceRadius;this._displayText(k,0,T,C,N,w,O,j,G,0,0,!1)}}_displayElement(A,w){if(!A.end||!A.end.shape||!A.end.pieceId||w&&(!A.start||!A.animation))return;this._resetCachePoints();let T=w?this._mixAttributes(A.end,A.start,A.animation):A.end,C=this._computeRenderInfo(T);if(C.symbolicSize<C.globalMinVisibleSize||0===C.opacity)return;this._applyBackgroundBlending(C);let k=!!(C.strokeColor&&C.strokeWidth>0&&C.symbolicSize>=C.strokeMinVisibleSize),N=1!==C.pattern.type&&C.symbolicSize>=C.patternMinVisibleSize,O=!!C.fillColor;if(1===C.pieceId)return this._displayNodeComponent(C,O,k,N);if(6===C.pieceId)return this._displayTextBox(C,O,k,N);let j,G=C.pos2.x-C.pos1.x,H=C.pos2.y-C.pos1.y,W=Math.sqrt(G*G+H*H),$=null,Z=null;if(C.isSelfLoop){let A=5===C.pieceId||11===C.pieceId?C.strokeWidth/2:C.rectWidthOrSourceRadius,{x1:w,y1:T,x2:k,y2:N}=this._getSelfLoopControlPoints(C.pos1,C.curvature,A);$=this._point(w,T),Z=this._point(k,N),j=function oS(A,w,T,C,k){let N=(A.x+w.x+T.x)/3,O=(A.y+w.y+T.y)/3,j=N-w.x,G=O-w.y,H=w.x-T.x,W=w.y-T.y,$=j*j+G*G,Z=(H*H+W*W)/4,se=Math.sqrt($-Z);return 2*Qs*se*3.14159265359*k}(C.pos1,$,Z,C.pos2,1)}else C.curvature?($=this._getQuadraticCurveControlPoint(C),j=function iS(A,w,T){let C=Math.abs(A)/5+1e-6,k=C*C,N=T-.5,O=N*N,j=1/(16*k),G=Math.sqrt(O+j),H=.5/C*Math.sqrt(k+.25);return Math.abs(2*C)*(N*G+.5*H+j*Math.log(Math.abs((N+G)/(-.5+H))))*w}(C.curvature,W,1)):j=W;if(5===C.pieceId||11===C.pieceId){let A=C.strokeWidth,w=this._getPointOnLine(C.pos1,$,Z,C.pos2,.5),T=this._getTangentOnLine(C.pos1,$,Z,C.pos2,.5);if(C.rectWidthOrSourceRadius>=j-A&&!C.isSelfLoop){if(!C.adjustTextAngle)return;T.x=1,T.y=0}let k=-Math.atan2(T.y,T.x),N=rs(C.offsetAngle-k);(!C.isSelfLoop&&N<0||C.isSelfLoop&&C.offsetAngle<0)&&(T.x*=-1,T.y*=-1),(k>Math.PI/2||k<-Math.PI/2)&&(k+=Math.PI);let O=this._getOrthogonal(T),G=w.x+O.x*C.offset,H=w.y+O.y*C.offset;if(C.fillColor){let A=C.rectWidthOrSourceRadius/2,w=C.rectHeightOrTargetRadius/2;this._drawRoundedRectangle(this._point(G,H),A,w,N+Math.PI/2,C.fillColor)}else{let A=this._point(G,H),w=k,T=C.thicknessOrFontSize,N=C.pattern.attributes.text,O=C.patternColor,j=C.pattern.attributes.font,W=C.pattern.attributes.style,$=C.pattern.attributes.align,Z=C.rectWidthOrSourceRadius;this._displayText(A,w,N,O,j,T,W,$,Z,0,0,!1)}}else{let A=3===C.pieceId,w=4===C.pieceId,T=Math.cos(C.offsetAngle),N=Math.sin(C.offsetAngle);C.pos1.x+=T*C.offset,C.pos1.y+=N*C.offset,C.pos2.x+=T*C.offset,C.pos2.y+=N*C.offset;let se="line"===C.shape.name,ue=C.thicknessOrFontSize,ge=C.rectWidthOrSourceRadius,ce=C.rectHeightOrTargetRadius,_e=+C.hasHead,me=+C.hasTail,pe=+C.isBodyTriangle,be=_e+me,Se=function sS(A){return 3*A}(ue),Ee=_e*Se,Te=me*Se,Ce=C.isSelfLoop?1/0:W-ge-ce,Ie=Math.min(Ce/be,Se),ze=me*(Se+Math.max(ge+Ie-Te,0))+(1-me)*pe*ge,Pe=_e*(Se+Math.max(ce+Ie-Ee,0))+(1-_e)*pe*ce;if(A||w){let T=w?-1:1,N=(A?j-Pe:ze)-T,se=null,ue=null;if(C.isSelfLoop&&$&&Z){let A=this._getTFromLengthOnCubicCurve(C.pos1,$,Z,C.pos2,N-C.strokeWidth/2*T);se=this._getPointOnCubicCurve(C.pos1,$,Z,C.pos2,A),ue=this._getTangentOnCubicCurve(C.pos1,$,Z,C.pos2,A)}else if(C.curvature&&$){let A=this._getTFromLengthOnQuadraticCurve(C.pos1,$,C.pos2,N-C.strokeWidth/2*T);se=this._getPointOnQuadraticCurve(C.pos1,$,C.pos2,A),ue=this._getTangentOnQuadraticCurve(C.pos1,$,C.pos2,A)}else{let A=N/j;se=this._mixPoints(C.pos1,C.pos2,A),ue=this._point(G/W,H/W)}if(ue.x*=T,ue.y*=T,O){if(C.shape.hole){let A=this._makeEdgeExtremityPoints(se,ue,Se,C.shape.hole);this._drawPoints(A),this._startReverseClip()}let A=this._makeEdgeExtremityPoints(se,ue,Se,C.shape.points);this._drawPoints(A),this._fill(C.fillColor),C.shape.hole&&this._endReverseClip()}if(k){if(C.shape.hole){let A=this._makeEdgeExtremityPoints(se,ue,Se,C.shape.hole);this._drawPoints(A),this._stroke(C.strokeColor,C.strokeWidth)}let A=Se+C.strokeWidth/2,w=this._makeEdgeExtremityPoints(se,ue,A,C.shape.points);this._drawPoints(w),this._stroke(C.strokeColor,C.strokeWidth)}}else{if(j-ze-Pe<=0)return;if(se){let A=function aS(A,w,T,C,k,N){let O=[];if(T&&O.push(0,T),k&&N){let j=k*w,G=N*w,H=j+G,W=A-C-T-H,$=0;for(;$<W;)O.push(j,G),$+=H;let Z=A-C-T-$,se=Math.min(j,Z),ue=Math.max(Z-se,0);O.push(se,ue)}else O.push(A-C-T,0);return C&&O.push(0,C),O}(j,ue,ze,Pe,C.dashLength,C.gapLength);k&&(this._drawLine(C.pos1,$,Z,C.pos2),this._stroke(C.strokeColor,ue+2*C.strokeWidth,A)),O&&(this._drawLine(C.pos1,$,Z,C.pos2),this._stroke(C.fillColor,ue,A))}else{let A=ze,w=j-Pe;if(k){let T=this._makeTriangleEdgeBody(C.pos1,$,Z,C.pos2,A,w,ue+C.strokeWidth/2,C.strokeWidth/2);this._drawPoints(T),this._stroke(C.strokeColor,C.strokeWidth)}if(O){let T=this._makeTriangleEdgeBody(C.pos1,$,Z,C.pos2,A,w,ue,0);this._drawPoints(T),this._fill(C.fillColor)}}}}}_makeTriangleEdgeBody(A,w,T,C,k,N,O,j){return w?T?this._makeSelfLoopTriangleEdge(A,w,T,C,k,N,O,j):this._makeCurveTriangleEdge(A,w,C,k,N,O,j):this._makeStraightTriangleEdge(A,C,k,N,O,j)}_makeCurveTriangleEdge(A,w,T,C,k,N,O){let j=this._pointArray(84),G=this._getTFromLengthOnQuadraticCurve(A,w,T,C),H=(this._getTFromLengthOnQuadraticCurve(A,w,T,k)-G)/Zs,W=(O-N)/Zs/2,$=N/2,Z=G;for(let C=0;C<=Zs;++C){let k=this._getPointOnQuadraticCurve(A,w,T,Z),N=this._getTangentOnQuadraticCurve(A,w,T,Z),O=this._getOrthogonal(N),G=O.x*$,se=O.y*$,ue=j[C],ge=j[83-C];ue.x=k.x+G,ue.y=k.y+se,ge.x=k.x-G,ge.y=k.y-se,Z+=H,$+=W}return j}_makeSelfLoopTriangleEdge(A,w,T,C,k,N,O,j){let G=this._pointArray(84),H=this._getTFromLengthOnCubicCurve(A,w,T,C,k),W=(this._getTFromLengthOnCubicCurve(A,w,T,C,N)-H)/Zs,$=(j-O)/Zs/2,Z=O/2,se=H;for(let k=0;k<=Zs;++k){let N=this._getPointOnCubicCurve(A,w,T,C,se),O=this._getTangentOnCubicCurve(A,w,T,C,se),j=this._getOrthogonal(O),H=j.x*Z,ue=j.y*Z,ge=G[k],ce=G[83-k];ge.x=N.x+H,ge.y=N.y+ue,ce.x=N.x-H,ce.y=N.y-ue,se+=W,Z+=$}return G}_makeStraightTriangleEdge(A,w,T,C,k,N){let O=w.x-A.x,j=w.y-A.y,G=Math.sqrt(O*O+j*j),H=this._point(O/G,j/G),W=this._getOrthogonal(H),$=k/2,Z=N/2,se=this._pointArray(4),ue=se[0],ge=se[1],ce=se[2],_e=se[3],me=A.x+H.x*T,pe=A.y+H.y*T,be=A.x+H.x*C,Se=A.y+H.y*C,Ee=W.x*$,Te=W.y*$,Ce=W.x*Z,Ie=W.y*Z;return ue.x=me+Ee,ue.y=pe+Te,ge.x=me-Ee,ge.y=pe-Te,ce.x=be-Ce,ce.y=Se-Ie,_e.x=be+Ce,_e.y=Se+Ie,se}_makeEdgeExtremityPoints(A,w,T,C){let k=this._pointArray(C.length),N=T/2,O=A.x+w.x*N,j=A.y+w.y*N,G=w.x,H=w.y;for(let A=0;A<C.length;++A){let w=C[A],T=k[A],W=(G*w.x-H*w.y)*N,$=(H*w.x+G*w.y)*N;T.x=O+W,T.y=j+$,T.r=w.r*N}return k}_drawLine(A,w,T,C){w?T?this._drawCubicCurve(A,w,T,C):this._drawQuadraticCurve(A,w,C):this._drawStraightLine(A,C)}_getSelfLoopControlPoints(A,w,T){return xr(A.x,A.y,w,T,this._viewAngle,this._tmp)}_getQuadraticCurveControlPoint(A){return jt(A.pos1.x,A.pos1.y,A.pos2.x,A.pos2.y,A.curvature,this._point(0,0))}_graphToScreenCoordinates(A){let w=this._width/2,T=this._height/2,C=(A.x-this._viewX)*this._viewZoom,k=(A.y-this._viewY)*this._viewZoom,N=this._viewAngleCos,O=this._viewAngleSin,j=N*C+O*k+w,G=-O*C+N*k+T;return this._point(j,G)}_blendColor(A,w){return A&&this._backgroundColor?this._mixColor(this._backgroundColor,A,w,1):null}_getTangentOnLine(A,w,T,C,k){return w?T?this._getTangentOnCubicCurve(A,w,T,C,k):this._getTangentOnQuadraticCurve(A,w,C,k):this._getTangentOnStraightLine(A,C)}_getTangentOnStraightLine(A,w){let T=w.x-A.x,C=w.y-A.y,k=Math.sqrt(T*T+C*C);return this._point(T/k,C/k)}_getTangentOnQuadraticCurve(A,w,T,C){let k=1-C,N=k*w.x+C*T.x-(k*A.x+C*w.x),O=k*w.y+C*T.y-(k*A.y+C*w.y),j=Math.sqrt(N*N+O*O);return this._point(N/j,O/j)}_getTangentOnCubicCurve(A,w,T,C,k){let N=1-k,O=N*N,j=k*k,G=O*(w.x-A.x)+2*N*k*(T.x-w.x)+j*(C.x-T.x),H=O*(w.y-A.y)+2*N*k*(T.y-w.y)+j*(C.y-T.y),W=Math.sqrt(G*G+H*H);return this._point(G/W,H/W)}_mixPoints(A,w,T){let C=bt(A.x,w.x,T),k=bt(A.y,w.y,T);return this._point(C,k)}_getOrthogonal(A){return this._point(-A.y,A.x)}_getPointOnLine(A,w,T,C,k){return w?T?this._getPointOnCubicCurve(A,w,T,C,k):this._getPointOnQuadraticCurve(A,w,C,k):this._mixPoints(A,C,k)}_getPointOnQuadraticCurve(A,w,T,C){let k=Di(A.x,w.x,T.x,C),N=Di(A.y,w.y,T.y,C);return this._point(k,N)}_getPointOnCubicCurve(A,w,T,C,k){let N=ys(A.x,w.x,T.x,C.x,k),O=ys(A.y,w.y,T.y,C.y,k);return this._point(N,O)}_getTFromLengthOnCubicCurve(A,w,T,C,k){let N=A.x,O=A.y,j=0,G=0;for(let H=0;H<Zs;++H){j+=nn;let H=ys(A.x,w.x,T.x,C.x,j),W=ys(A.y,w.y,T.y,C.y,j),$=H-N,Z=W-O,se=Math.sqrt($*$+Z*Z),ue=G+se;if(ue>k){return j-nn*((ue-k)/se)}G=ue,N=H,O=W}return 1}_getTFromLengthOnQuadraticCurve(A,w,T,C){let k=A.x,N=A.y,O=0,j=0;for(let G=0;G<Zs;++G){O+=nn;let G=Di(A.x,w.x,T.x,O),H=Di(A.y,w.y,T.y,O),W=G-k,$=H-N,Z=Math.sqrt(W*W+$*$),se=j+Z;if(se>C){return O-nn*((se-C)/Z)}j=se,k=G,N=H}return 1}};var ln=!Lt().__dummy,dn=[1/0,1/0,-1/0,-1/0];function xs(A,w,T,C,k,N={x:0,y:0}){let O=Math.cos(k),j=Math.sin(k),G=A-T,H=w-C;return N.x=O*G-j*H+T,N.y=j*G+O*H+C,N}function lS(A,w,T=0,C={x:0,y:0}){return C.x=A.x+T*Math.sin(w),C.y=A.y+T*Math.cos(w),C}function Et(A,w,T,C){return Math.sqrt((A-T)*(A-T)+(w-C)*(w-C))}function kd(A,w,T,C){let k=A-T,N=w-C;return k*k+N*N}function ef(A){let w=Math.sqrt(A.x*A.x+A.y*A.y);return A.x/=w,A.y/=w,A}function Eh(A){return 180*A/Math.PI}function uS(A){return A*Math.PI/180}function tf(A,w){return A.minX-=w,A.minY-=w,A.maxX+=w,A.maxY+=w,void 0===A.width&&(A.width=A.maxX-A.minX),void 0===A.height&&(A.height=A.maxY-A.minY),A.width+=2*w,A.height+=2*w,A}var hn=!1;try{hn=!!lt("svg")}catch(J_){}var cn="none",_n={left:"start",center:"middle",right:"end"},fn="data-element-id",pn="data-text-component";function fo(A){return Math.round(1e3*A)/1e3}function Ry(A,w,T,C,k,N){let O=lt("image");return O.setAttribute("width",fo(C)),O.setAttribute("height",fo(k)),O.setAttribute("x",fo(w)),O.setAttribute("y",fo(T)),O.setAttribute("href",A),N&&N.appendChild(O),O}var xn={linear:[0,1,0,0],quadraticIn:[0,0,1,0],quadraticOut:[0,2,-1,0],quadraticInOut:[0,0,2,0,-1,4,-2,0],cubicIn:[0,0,0,1],cubicOut:[0,3,-3,1],cubicInOut:[0,0,0,4,-3,12,-12,4]};function Rt(A,w,T){return A%(1<<T)>>w}function rf(A){return A-32768}function qr(A,w){return A*w}var yn=new Array(65535);function yh(A){let w=yn[A];if(!w){let T=Rt(A,0,4)/15,C=Rt(A,4,8)/15,k=Rt(A,8,12)/15,N=Rt(A,12,16)/15;w=`rgba(${255*T|0}, ${255*C|0}, ${255*k|0}, ${N})`,T+C+k+N===0&&(w=null),yn[A]=w}return w}var bn={x:0,y:0,zoom:1,angle:0,width:80,height:60,pixelRatio:1,backgroundColor:null,currentTime:0,isBufferDisplayable:ni,hideImages:!1,renderBackground:!1},An={webgl:Rr,canvas:class extends on{constructor(A){super(A),this._canvas=Lt(),this._imgCanvas=Lt(),this._initCanvas(this._canvas),this._ctx=this._canvas.getContext("2d"),this._imgCtx=this._imgCanvas.getContext("2d")}static getName(){return"Canvas"}static isAvailable(){return ln}getDomElement(){return this._canvas}_render({dimensionsChanged:A}){A&&nh(this._canvas,this._width,this._height,this._pixelRatio);let w=this._ctx,T=this._width*this._pixelRatio,C=this._height*this._pixelRatio;w.clearRect(0,0,T,C),this._backgroundColor&&this._renderBackground&&(w.fillStyle=this._backgroundColor,w.fillRect(0,0,T,C));let k=this._bufferList.getBuffersByAscendingDepth();for(let A=0;A<k.length;++A){let w=k[A];this._isBufferDisplayable(w)&&this._displayBuffer(w)}}_drawRoundedRectangle(A,w,T,C,k){let N=this._ctx,O=this._pixelRatio,j=A.x*O,G=A.y*O;w*=O,T*=O;let H=this._textManager.getCornerRadius(),W=Math.min(H*O,T/3);N.save(),N.translate(j,G),N.rotate(C),N.beginPath(),N.arc(w-W,T-W,W,0,Math.PI/2),N.arc(-w+W,T-W,W,Math.PI/2,Math.PI),N.arc(-w+W,-T+W,W,Math.PI,3*Math.PI/2),N.arc(w-W,-T+W,W,3*Math.PI/2,0),k&&(N.fillStyle=k,N.fill()),N.restore()}_drawCircle(A,w){let T=this._ctx,C=this._pixelRatio,k=A.x*C,N=A.y*C,O=w*C;T.beginPath(),T.arc(k,N,O,0,2*Math.PI)}_drawPolygon(A){let w=this._ctx,T=this._pixelRatio;w.beginPath();let C=A[0];w.moveTo(C.x*T,C.y*T);for(let C=1;C<A.length;++C){let k=A[C];w.lineTo(k.x*T,k.y*T)}w.closePath()}_drawStraightLine(A,w){let T=this._ctx,C=this._pixelRatio;T.beginPath(),T.moveTo(A.x*C,A.y*C),T.lineTo(w.x*C,w.y*C)}_drawQuadraticCurve(A,w,T){let C=this._ctx,k=this._pixelRatio;C.beginPath(),C.moveTo(A.x*k,A.y*k),C.quadraticCurveTo(w.x*k,w.y*k,T.x*k,T.y*k)}_drawCubicCurve(A,w,T,C){let k=this._ctx,N=this._pixelRatio;k.beginPath(),k.moveTo(A.x*N,A.y*N),k.bezierCurveTo(w.x*N,w.y*N,T.x*N,T.y*N,C.x*N,C.y*N)}_fill(A){let w=this._ctx;w.fillStyle=A,w.fill()}_stroke(A,w,T=[]){let C=this._ctx,k=this._pixelRatio;C.setLineDash(T.map((A=>A*this._pixelRatio))),C.lineWidth=w*k,C.strokeStyle=A,C.stroke()}_startClip(){this._ctx.save(),this._ctx.clip()}_endClip(){this._ctx.restore()}_startReverseClip(){this._ctx.save(),this._ctx.rect(0,0,this._canvas.width,this._canvas.height),this._ctx.clip("evenodd")}_endReverseClip(){this._ctx.restore()}_displayText(A,w,T,C,k,N,O,j,G,H,W){let $=this._ctx,Z=this._pixelRatio,se=A.x*Z,ue=A.y*Z,ge=N*Z,ce="center"===j?0:-G/2;if(W=W*this._viewZoom*this._pixelRatio,H=H*this._viewZoom*this._pixelRatio,$.save(),$.translate(se,ue),$.rotate(-w),$.textBaseline="middle",$.textAlign=j,Tr($,k,ge,O),$.fillStyle=C,-1!==T.indexOf("\n")){let A=T.split("\n"),w=A.length,C=(1-w)/2*ge;for(let T=0;T<w;++T)$.fillText(A[T],H+ce,W+C),C+=ge}else $.fillText(T,H+ce,W-1);$.restore()}_displayImage(A,w,T,C,k,N,O){if(this._hideImages||"isDummy"in C)return;let j=C;1!==O&&(j=this._blendImageOnBackground(C,O));let G=this._ctx,H=this._pixelRatio,W=A.x*H,$=A.y*H,Z=w*H,se=T*H,ue=j.width*H,ge=j.height*H;if(k)G.drawImage(j,W-Z/2,$-se/2,Z,se);else if(N){let A=W-Z/2,w=$-se/2,T=W+Z/2,C=$+se/2,k=W-ue/2,N=$-ge/2;for(;k>A;)k-=ue;for(;N>w;)N-=ge;let O=N;for(;k<T;){for(;N<C;)G.drawImage(j,k,N,ue,ge),N+=ge;k+=ue,N=O}}else G.drawImage(j,W-ue/2,$-ge/2,ue,ge)}_displayPieChart(A,w,T){let C=this._ctx,k=this._pixelRatio,N=A.x*k,O=A.y*k,j=w*k*2,G=2*j;1===T.length&&(C.fillStyle=T[0],C.fillRect(N-j,O-j,G,G)),T.length>1&&dh(C,T,N,O,j)}_blendImageOnBackground(A,w){let T=this._backgroundRgba,C=`rgb(${Math.round(255*T[0])},${Math.round(255*T[1])},${Math.round(255*T[2])})`;return this._imgCanvas.width=A.width,this._imgCanvas.height=A.height,this._imgCtx.clearRect(0,0,A.width,A.height),this._imgCtx.globalAlpha=1,this._imgCtx.fillStyle=C,this._imgCtx.fillRect(0,0,A.width,A.height),this._imgCtx.globalAlpha=w,this._imgCtx.drawImage(A,0,0),this._imgCanvas}getImageData(){return this._ctx.getImageData(0,0,this._canvas.width,this._canvas.height)}},svg:class extends on{constructor(A){super(A),this._svg=lt("svg"),this._defs=lt("defs"),this._styles=lt("g",{class:"styles"}),this._background=lt("rect",{width:"100%",height:"100%",fill:"none",class:"ogma-svg-background"}),this._currentElementId="0",this._currentClipPathId=null,this._clipPathCounter=0,this._defs.appendChild(this._styles),this._svg.setAttribute("pointer-events","none"),this._svg.style.userSelect="none",this._svg.appendChild(this._defs),this._svg.appendChild(this._background),this._clear()}static getName(){return"SVG"}static isAvailable(){return hn}getDomElement(){return this._svg}_render({dimensionsChanged:A}){if(A&&dc(this._svg,{width:this._width,height:this._height}),this._backgroundColor&&this._renderBackground){let A=this._colorManager.rgbaToRgb(this._backgroundColor);this._background.setAttribute("fill",A.color),this._background.setAttribute("fill-opacity",A.opacity)}let w=this._bufferList.getBuffersByAscendingDepth();this._clear(),this._svg.removeChild(this._container);for(let A=0;A<w.length;++A){let T=w[A];this._isBufferDisplayable(T)&&this._displayBuffer(T)}this._svg.appendChild(this._container)}_clear(){this._container&&this._svg.removeChild(this._container),this._container=lt("g"),this._svg.appendChild(this._container),this._clipPaths&&this._defs.removeChild(this._clipPaths),this._clipPaths=lt("g"),this._defs.appendChild(this._clipPaths),this._clipPaths.classList.add("clip-paths"),this._filters&&this._defs.removeChild(this._filters),this._filters=lt("g"),this._defs.appendChild(this._filters)}_displayElement(A,w){this._currentElementId=A.id>=0?`n${A.id}`:"e"+-A.id,super._displayElement(A,w)}_addBackgroundBlendingFilter(A){let w=this._colorManager.parseColor(this._backgroundColor),T=A,C=1-A,k=[T,0,0,0,w[0]*C,0,T,0,0,w[1]*C,0,0,T,0,w[2]*C,0,0,0,1,0].join(" "),N=`filter-${this._currentElementId}`,O=lt("filter",{id:N}),j=lt("feColorMatrix",{in:"SourceGraphic",type:"matrix",values:k});return O.appendChild(j),this._filters.appendChild(O),N}_drawRoundedRectangle(A,w,T,C,k){let N=A.x,O=A.y,j=Math.min(this._textManager.getCornerRadius(),T/2),G=lt("path"),H=`M ${N+w-j} ${O+T}          \n    A ${j} ${j} 0 0 0 ${N+w} ${O+T-j}\n    L ${N+w} ${O-T+j}    \n    A ${j} ${j} 0 0 0 ${N+w-j} ${O-T}\n    L ${N-w+j} ${O-T}\n    A ${j} ${j} 0 0 0 ${N-w} ${O-T+j}\n    L ${N-w} ${O+T-j}\n    A ${j} ${j} 0 0 0 ${N-w+j} ${O+T}\n    L ${N+w-j} ${O+T}`;G.setAttribute("d",H),G.setAttribute("fill",cn),G.setAttribute("transform",`rotate(${Eh(C)} ${A.x} ${A.y})`),G.setAttribute(fn,this._currentElementId),this._container.appendChild(G),this._element=G,k&&this._fill(k)}_drawCircle(A,w){let{x:T,y:C}=A,k=`M ${T-w}, ${C} a ${w},${w} 0 1,0 ${2*w},0 a ${w},${w} 0 1,0 -${2*w},0`,N=lt("path");N.setAttribute("d",k),N.setAttribute("fill",cn),N.setAttribute(fn,this._currentElementId),this._container.appendChild(N),this._element=N}_drawPolygon(A,w){let T=lt("path"),C="";for(let w=0;w<A.length;w++){let{x:T,y:k}=A[w];C+=`${0===w?"M":"L"}${T},${k} `}C+="Z",T.setAttribute("d",C),T.setAttribute(fn,this._currentElementId),T.setAttribute("fill",cn),w&&T.setAttribute(pn,!0),this._container.appendChild(T),this._element=T}_drawStraightLine(A,w){let T=lt("path"),C=`M ${A.x},${A.y} L${w.x},${w.y}`;T.setAttribute("d",C),T.setAttribute(fn,this._currentElementId),this._container.appendChild(T),this._element=T}_drawQuadraticCurve(A,w,T){let C=lt("path"),k=`M ${A.x},${A.y} Q${w.x},${w.y} ${T.x},${T.y}`;C.setAttribute("d",k),C.setAttribute("fill",cn),C.setAttribute(fn,this._currentElementId),this._container.appendChild(C),this._element=C}_drawCubicCurve(A,w,T,C){let k=lt("path"),N=`M ${A.x},${A.y} C${w.x},${w.y} ${T.x},${T.y} ${C.x},${C.y}`;k.setAttribute("d",N),k.setAttribute("fill",cn),k.setAttribute(fn,this._currentElementId),this._container.appendChild(k),this._element=k}_fill(A){let w=this._colorManager.rgbaToRgb(A);this._element.setAttribute("fill",w.color),this._element.setAttribute("fill-opacity",w.opacity),this._currentClipPathId&&this._element.setAttribute("clip-path",`url(#${this._currentClipPathId})`)}_stroke(A,w,T=[]){let C=this._element;C.setAttribute("stroke-width",w);let k=this._colorManager.rgbaToRgb(A);C.setAttribute("stroke",k.color),C.setAttribute("stroke-opacity",k.opacity),T.length>0&&C.setAttribute("stroke-dasharray",T.map(fo).toString())}_startClip(){let A=lt("clipPath"),w=this._element.cloneNode(!1);this._currentClipPathId="clip-path-"+ ++this._clipPathCounter,A.appendChild(w),this._clipPaths.appendChild(A),A.setAttribute("id",this._currentClipPathId)}_endClip(){this._currentClipPathId=null}_startReverseClip(){let A=lt("clipPath"),w=this._element.cloneNode(!1),T=w.getAttribute("d");w.setAttribute("clip-rule","evenodd"),w.setAttribute("d",`${T} M 0 0 L ${this._width} 0 L ${this._width} ${this._height} L 0 ${this._height}`),this._currentClipPathId="clip-path-"+ ++this._clipPathCounter,A.appendChild(w),this._clipPaths.appendChild(A),A.setAttribute("id",this._currentClipPathId)}_endReverseClip(){this._currentClipPathId=null}_displayText(A,w,T,C,k,N,O,j,G,H,W,$){let Z=lt("g");Z.setAttribute(fn,this._currentElementId),Z.setAttribute(pn,!0),Z.classList.add("n"===this._currentElementId[0]?"node-text":"edge-text"),$&&Z.classList.add("badge-text");let se=this._colorManager.rgbaToRgb(C),ue=se.opacity,ge=this._colorManager.rgbaToRgb(se.color),ce=A.x+H*this._viewZoom,_e=A.y+W*this._viewZoom;O=O||"normal";let me=fo(ce);Z.setAttribute("font-family",k),Z.setAttribute("font-size",N),"bold"===O?Z.setAttribute("font-weight",O):Z.setAttribute("font-style",O),Z.setAttribute("fill",ge.color),Z.setAttribute("fill-opacity",ue),w&&Z.setAttribute("transform",`rotate(${Eh(-w)} ${ce}, ${_e})`),Z.setAttribute("text-anchor",_n[j]||"middle");let pe=T.split("\n"),be=pe.length,Se=fo(_e-((be+1)/2-1/3)*N),Ee="center"===j?0:-G/2;for(let A=0;A<be;A++){let w=lt("text");w.appendChild(Ya(pe[A])),w.setAttribute("x",me+Ee),w.setAttribute("y",Se+(A+1)*N),Z.appendChild(w)}this._currentClipPathId&&Z.setAttribute("clip-path",`url(#${this._currentClipPathId})`),this._container.appendChild(Z)}_displayImage(A,w,T,C,k,N,O){let j=A.x,G=A.y;if(this._hideImages||!("isDummy"in C)&&(!C.width||!C.height))return;let H,W=w,$=T,Z=C.width,se=C.height;if(k&&(Z=W,se=$),N){let A=j-W/2,w=G-$/2,T=j+W/2,k=G+$/2,N=j-Z/2,O=G-se/2;for(H=lt("g"),H.setAttribute(fn,this._currentElementId);N>A;)N-=Z;for(;O>w;)O-=se;let ue=O;for(;N<T;){for(;O<k;)Ry(C.src,N,O,Z,se,H),O+=se;O=ue,N+=Z}}else H=Ry(C.src,j-Z/2,G-se/2,Z,se),H.setAttribute(fn,this._currentElementId);if(this._currentClipPathId&&H.setAttribute("clip-path",`url(#${this._currentClipPathId})`),1!==O){let A=this._addBackgroundBlendingFilter(O);H.setAttribute("filter",`url(#${A})`)}this._container.appendChild(H)}_displayPieChart(A,w,T){let C,k=2*w,N=2*k,O=A.x,j=A.y,G=lt("g");G.setAttribute(fn,this._currentElementId),1===T.length&&(C=function pS(A,w,T,C,k,N=1,O){let j=lt("rect");return j.setAttribute("x",A),j.setAttribute("y",w),j.setAttribute("width",T),j.setAttribute("height",C),j.setAttribute("fill",k),j.setAttribute("fill-opacity",N),O&&O.appendChild(j),j}(O-k,j-k,N,N,T[0],1,G)),T.length>1&&zp(T,((A,T,k)=>{let N=O+w*Math.cos(k),H=j+w*Math.sin(k),W=O+w*Math.cos(T),$=j+w*Math.sin(T),Z=k-T<=Math.PI?0:1,se=`M ${N},${H} A ${w},${w} 0 ${Z} 0 ${W},${$} L ${O},${j} L ${N},${H}`;C=lt("path"),C.setAttribute("d",se),C.setAttribute("fill",A),C.setAttribute("stroke-width",0),G.appendChild(C)})),this._currentClipPathId&&G.setAttribute("clip-path",`url(#${this._currentClipPathId})`),this._container.appendChild(G)}}},Sn=[0,0,0,0],En={webgl:null,svg:null,canvas:null},Cn=class{constructor(A){this._view=nt(bn),this._domWrapper=pe?document.createElement("div"):Zo(),this._domElement=this._domWrapper.appendChild(pe?document.createElement("div"):Zo()),this._currentElementSize=0,this._currentBlockOffset=0,this._currentByteOffset=0,this._blockIdToAddress=new Uint32Array(0),this._renderersByType={},this._switchMainRenderer=!0,this._refreshTexts=!1,this._backgroundColor=null,this._initData=A||{},this._colorManager=new Fs,this._easingManager=new class{constructor(){this._linearEasing=[0,1,0,0,0,1,0,0],this._nameToPolygon={},this._polygonToName={},this.add(xn)}add(A){Object.keys(A).forEach((w=>{let T=A[w].slice();T.length<8&&(T[4]=T[0],T[5]=T[1],T[6]=T[2],T[7]=T[3]);let C=rc(T[0],T[1],T[2],T[3],T[4],T[5],T[6],T[7]);this._nameToPolygon[w]=T,this._polygonToName[C]=w}))}getCoefficients(A){return this._nameToPolygon[A]||this._linearEasing}getName(A,w,T,C,k,N,O,j){let G=rc(A,w,T,C,k,N,O,j);return this._polygonToName[G]||"linear"}},this._patternManager=new class{constructor(){this._pixelRatio=1,this._nextPatternId=1,this._version=0,this._init_()}reset(){this._init_()}_init_(){this._mustUpdate=!0,this._nextPatternId=1,this._patterns=[null],this._patternsByHash={},this._pixelRatio=1,this._nullPattern={id:-1,type:1,attributes:{}}}_increaseNextId(){let A=this._nextPatternId++;for(A%256==255&&(A=this._nextPatternId++);this._patterns.length<=A;)this._patterns.push(void 0);return A}_createPattern({type:A,attributes:w}){let T={id:this._increaseNextId(),type:A,attributes:this._cloneAttributes(A,w)};return this._patterns[T.id]=T,this._mustUpdate=!0,T}_cloneAttributes(A,w){return 2===A?{image:w.image,scaled:w.scaled,duplicated:w.duplicated}:3===A||5===A||6===A?{font:w.font,size:w.size,style:w.style,text:w.text,paddingLeft:w.paddingLeft,paddingTop:w.paddingTop,align:w.align||"center",offset:w.offset||0}:4===A&&w.colors?{colors:w.colors,colorArray:w.colors.split(";").map((A=>A.trim()))}:{}}getPatternList(){return this._patterns.filter((A=>A))}update(){this._mustUpdate&&(this._version+=1,this._mustUpdate=!1)}setPixelRatio(A){A!==this._pixelRatio&&(this._pixelRatio=A,this._mustUpdate=!0)}getPixelRatio(){return this._pixelRatio}notifyUpdate(){this._mustUpdate=!0}getIdFromDefinition(A){let{type:w,attributes:T}=A,C=3===w||5===w||6===w,k=0;return w&&1!==w&&7!==w&&(2!==w||T.image)&&(!C||T.text&&T.font)&&(k=this._addPattern(A),3===w&&"normal"===T.style&&(T.style="bold",this._addPattern(A))),k}_addPattern(A){let w=this._getPatternHash(A),T=this._patternsByHash[w];return T||(this._nextPatternId>65500?zr("maximum number of pattern exceeded"):(T=this._createPattern(A).id,this._patternsByHash[w]=T)),T}_getPatternHash({type:A,attributes:w}){let T=[Ps[A]];return 2===A?T.push(w.scaled?"scaled":"non-scaled",w.duplicated?"duplicated":"non-duplicated",w.image.src||w.image.toDataURL()):3===A?T.push(w.text,w.font,w.style,w.size,w.align||"center",w.offset||0):5===A||6===A?T.push(w.text,w.font,w.style,w.size,w.paddingLeft,w.paddingTop):T.push(w.colors),T.join("+")}getDefinitionFromId(A){if(A&&this._patterns[A]){let w=this._patterns[A];if(w)return w}return this._nullPattern}getVersion(){return this._version}},this._shapeManager=new class{constructor(){this._version=0,this._mustUpdate=!0,this._byName={},this._byId=new Array(16)}register(A,{getDistanceFromStrokeVertically:w,getDistanceFromStrokeHorizontally:T,points:C,hole:k,isSimple:N}){if(this._byName[A])return;let O=N?1:8,j=N?7:15;for(;this._byId[O];)O+=1;if(O>j)throw new Error("max number of shape exceeded");let G={id:O,name:A,getDistanceFromStrokeVertically:w,getDistanceFromStrokeHorizontally:T,points:ay(C.slice()),hole:k?ay(k.slice()):null,isSimple:!!N};return this._mustUpdate=!0,this._byId[O]=G,this._byName[A]=G,G}getIdFromName(A){return this._byName[A].id}getNameFromId(A){let w=this._byId[A];return w?w.name:""}getDefinitionFromName(A){return this._byName[A]}update(){this._mustUpdate&&(this._version+=1,this._mustUpdate=!1)}getVersion(){return this._version}getShapeList(){return this._byId.filter((A=>A))}},this._boundariesManager=new class{constructor(){this._version=0,this._initialize()}reset(){this._initialize()}_initialize(){this._mustUpdate=!0,this.maxCoord=0,this.maxScaledSize=0,this.maxMinVisibleSize=0,this.maxSymbolicSize=0,this.maxDashLength=0,this.maxGapLength=0,this.maxPatternScale=0}set({maxCoord:A,maxScaledSize:w,maxMinVisibleSize:T,maxSymbolicSize:C,maxDashLength:k,maxGapLength:N,maxPatternScale:O}){let j=this.maxCoord<A||this.maxScaledSize<w||this.maxMinVisibleSize<T||this.maxSymbolicSize<C||this.maxDashLength<k||this.maxGapLength<N||this.maxPatternScale<O;return j&&(this.maxCoord=A,this.maxScaledSize=w,this.maxMinVisibleSize=T,this.maxSymbolicSize=C,this.maxDashLength=k,this.maxGapLength=N,this.maxPatternScale=O,this._mustUpdate=!0),j}update(){return this._mustUpdate&&(this._version+=1,this._mustUpdate=!1),this}getVersion(){return this._version}},this._textManager=new class{constructor(A){this._patternManager=A,this._canvas=Lt(),this._ctx=this._canvas.getContext("2d"),this._processBidirectionalText=ch().processBidirectionalText,this._cornerRadius=0,this._version=0,this._textPattern={id:0,type:7,attributes:{text:"",font:"",size:0,style:"normal",align:"center"},dimensions:{width:0,height:0}},this._textDimensions={width:0,height:0},this._lineWidthList=new Array(64),this._init()}_init(){this._mustClear=!1,this._clear()}reset(){this._init()}clear(){this._mustClear=!0}_measureChar(A,w,T){return Tr(this._ctx,w,24,T),this._ctx.measureText(A).width/24}_getAtlas(A,w,T,C){let k=-1===T?0:T,N=this._byFont[A]||(this._byFont[A]={none:void 0,bold:void 0,italic:void 0,normal:void 0}),O=N[C]||(N[C]={}),j=O[w]||(O[w]=new Array(50));return j[k]||(j[k]=new Array(256))}_getMeasurementAtlas(A,w){let T=this._widthAtlases[w];return T[A]||(T[A]=new Array(256))}measureText(A,w,T,C=1){if(!w)return this._textDimensions.width=0,this._textDimensions.height=0,this._textDimensions;let k=this._getMeasurementAtlas(w,T),N=0,O=0,j=1;for(let C=0;C<A.length;++C){let G=A.charCodeAt(C);if(G===Lr)O>N&&(N=O),O=0,j+=1;else{let N=k[G];void 0===N&&(N=this._measureChar(A[C],w,T),k[G]=N),O+=N}}return O>N&&(N=O),this._textDimensions.width=N*C,this._textDimensions.height=j*C,this._textDimensions}_getCharInfo(A,w,T,C,k,N){let O=A[w];if(!O){let j=String.fromCharCode(w);O={ratio:this._measureChar(j,T,C),patternId:0},O.patternId=this._patternManager.getIdFromDefinition({id:0,type:3,attributes:{text:j,font:T,style:C,size:k,align:N}}),A[w]=O}return O}storeTextInDataView(A,w,T,C){let k=w;if(C&&7===C.type){let{font:w,style:T,size:N,align:O}=C.attributes,j="center"===O,G=this._getAtlas(w,T,N,O),H=0,W=1,$=0,Z=0,se=this._lineWidthList,ue=this._processBidirectionalText(C.attributes.text);for(let A=0;A<ue.length;++A){let C=ue.charCodeAt(A);C===Lr?($>H&&(H=$),se[Z]=$,Z++,$=0,W++):$+=this._getCharInfo(G,C,w,T,N,O).ratio}se[Z]=$,$>H&&(H=$),Z=0;let ge=-(j?se[Z]:H)/2,ce=(1-W)/2,_e=0;for(let w=0;w<ue.length;++w){let T=ue.charCodeAt(w),C=G[T];if(T===Lr)Z+=1,ge=-(j?se[Z]:H)/2,ce+=0===w?.5:1,_e=0;else{let w=C.ratio,T=C.patternId;ge+=(w+_e)/2,_e=w;let N=(Vt(1e3*ge+65536,0,131071)<<8)+Vt(2*ce+128,0,255);A.setUint16(k,T,Cr),A.setUint32(k+2,N,Cr),k+=6}}}this._fillWithZeros(A,k,T)}extractTextFromDataView(A,w,T){let C=A,k=Cr,N=C.getUint16(w,k),O=this._textPattern,j=this._patternManager.getDefinitionFromId(N),{font:G,style:H,size:W,align:$}=j.attributes,Z=this._getAtlas(G,H,W,$),se=[],ue=0,ge=0,ce=0,_e=null;for(let A=w;A<T;A+=6){let w=C.getUint16(A,k);if(!w)break;let T=(C.getUint8(A+2)-128)/2,N=this._patternManager.getDefinitionFromId(w);if(!N||!N.attributes||!N.attributes.text)break;let O=N.attributes.text.charCodeAt(0),j=Z[O];null===_e?_e=T:T>_e&&(ue>ge&&(ge=ue),ue=0,ce+=1,se.push(Lr),_e=T),se.push(O),j&&(ue+=j.ratio)}ue>ge&&(ge=ue);let me=String.fromCharCode.apply(null,se);return O.attributes.style=H,O.attributes.font=G,O.attributes.size=W,O.attributes.align=$,O.attributes.text=this._processBidirectionalText(me),O.dimensions&&(O.dimensions.width=ge,O.dimensions.height=ce),O}_fillWithZeros(A,w,T){for(let C=w;C<T;C+=6)A.setUint16(C,0)}_clear(){this._byFont={},this._widthAtlases={normal:{},bold:{},italic:{}}}update(){this._mustClear&&(this._clear(),this._mustClear=!1)}getVersion(){return this._version}getCornerRadius(){return this._cornerRadius}setCornerRadius(A){A!==this._cornerRadius&&(this._cornerRadius=A,this._version++)}}(this._patternManager),this._bufferOfsetToId=new ss,this._memoryManager=new class{constructor(A,w,T,C,k,N){this._littleEndian=Zi(),this._maxScaledSize=0,this._maxMinVisibleSize=0,this._maxSymbolicSize=0,this._maxDashLength=0,this._maxGapLength=0,this._maxPatternScale=0,this._actualScaledSizeToBytes=32767,this._actualMinVisibleSizeToBytes=15,this._actualSymbolicSizeToBytes=Us,this._actualDashLengthToBytes=3,this._actualGapLengthToBytes=3,this._actualPatternScaleToBytes=Us,this._genericObject={valid:!1,id:void 0,end:{pieceId:0,shape:"circle",x1:0,y1:0,x2:0,y2:0,rectWidthOrSourceRadiusScaled:0,rectWidthOrSourceRadiusFixed:0,rectHeightOrTargetRadiusScaled:0,rectHeightOrTargetRadiusFixed:0,thicknessOrFontSizeScaled:0,thicknessOrFontSizeFixed:0,strokeWidthScaled:0,strokeWidthFixed:0,offsetScaled:0,offsetFixed:0,pattern:{id:void 0,type:0,attributes:{}},opacity:1,fillColor:null,strokeColor:null,patternColor:null,globalMinVisibleSize:0,strokeMinVisibleSize:0,patternMinVisibleSize:0,offsetAngle:0,patternScale:0,symbolicSize:-1,curvature:0,dashLength:0,gapLength:0,hasHead:!1,hasTail:!1,isBodyTriangle:!1,isSelfLoop:!1,isText:!1,adjustTextAngle:!1,isBadge:!1,unusedFlag2:!1,unusedFlag3:!1},start:{pieceId:0,shape:"circle",x1:0,y1:0,x2:0,y2:0,rectWidthOrSourceRadiusScaled:0,rectWidthOrSourceRadiusFixed:0,rectHeightOrTargetRadiusScaled:0,rectHeightOrTargetRadiusFixed:0,thicknessOrFontSizeScaled:0,thicknessOrFontSizeFixed:0,strokeWidthScaled:0,strokeWidthFixed:0,offsetScaled:0,offsetFixed:0,pattern:{id:void 0,type:0,attributes:{}},opacity:1,fillColor:null,strokeColor:null,patternColor:null,globalMinVisibleSize:0,strokeMinVisibleSize:0,patternMinVisibleSize:0,offsetAngle:0,patternScale:0,symbolicSize:-1,curvature:0,dashLength:0,gapLength:0,hasHead:!1,hasTail:!1,isBodyTriangle:!1,isSelfLoop:!1,isText:!1,adjustTextAngle:!1,isBadge:!1,unusedFlag2:!1,unusedFlag3:!1},animation:{duration:0,beginTime:-1,easing:"linear"}},this._shapeManager=w,this._patternManager=A,this._textManager=T,this._bufferOfsetToId=C,this._easingManager=k,this._colorParser=N}resizeBoundaries(A,w,T,C,k,N){this._maxScaledSize=A,this._maxMinVisibleSize=w,this._maxSymbolicSize=T,this._maxDashLength=C,this._maxGapLength=k,this._maxPatternScale=N,this._actualScaledSizeToBytes=65535/A,this._actualMinVisibleSizeToBytes=15/w,this._actualSymbolicSizeToBytes=Us/T,this._actualDashLengthToBytes=3/C,this._actualGapLengthToBytes=3/k,this._actualPatternScaleToBytes=Us/N}storeGenericObject(A,w,T){let C=this._shapeManager.getIdFromName(T.shape),k=T.pieceId,N=this._dashLengthToBytes(T.dashLength),O=this._gapLengthToBytes(T.gapLength),j=+T.hasHead,G=+T.hasTail,H=+T.isBodyTriangle,W=+T.isSelfLoop,$=this._patternScaleToBytes(T.patternScale),Z=this._offsetAngleToBytes(T.offsetAngle),se=+T.isText,ue=+T.adjustTextAngle,ge=+T.isBadge,ce=+T.unusedFlag2,_e=+T.unusedFlag3,me=this._opacityToBytes(T.opacity),pe=this._minVisibleSizeToBytes(T.globalMinVisibleSize),be=this._minVisibleSizeToBytes(T.strokeMinVisibleSize),Se=this._minVisibleSizeToBytes(T.patternMinVisibleSize),Ee=this._symbolicSizeToBytes(T.symbolicSize),Te=this._curvatureToBytes(T.curvature),Ce=T.pattern.attributes.colors;Ce&&(T.pattern.attributes.colors=Ce.split(";").map((A=>yh(this._colorToBytes(A.trim())))).join(";"));let Ie=this._patternManager.getIdFromDefinition(T.pattern),ze=this._colorToBytes(T.fillColor),Pe=this._colorToBytes(T.strokeColor),Re=this._colorToBytes(T.patternColor),Ue=this._coordToBytes(T.x1),Ve=this._coordToBytes(T.y1),He=this._coordToBytes(T.x2),We=this._coordToBytes(T.y2),$e=this._scaledSizeToBytes(T.rectWidthOrSourceRadiusScaled),Ye=this._fixedSizeToBytes(T.rectWidthOrSourceRadiusFixed),qe=this._scaledSizeToBytes(T.rectHeightOrTargetRadiusScaled),Qe=this._fixedSizeToBytes(T.rectHeightOrTargetRadiusFixed),Ke=this._scaledSizeToBytes(T.thicknessOrFontSizeScaled),et=this._fixedSizeToBytes(T.thicknessOrFontSizeFixed),st=this._scaledSizeToBytes(T.strokeWidthScaled),at=this._fixedSizeToBytes(T.strokeWidthFixed),ut=this._scaledSizeToBytes(T.offsetScaled),gt=this._fixedSizeToBytes(T.offsetFixed),_t=this._fixedSizeToBytes(T.pattern.attributes.paddingTop||0),mt=this._fixedSizeToBytes(T.pattern.attributes.paddingLeft||0),vt=C+(k<<4)+(N<<8)+(O<<10)+(j<<12)+(G<<13)+(H<<14)+(W<<15),St=$+(Z<<8)+(se<<11)+(ue<<12)+(ge<<13)+(ce<<14)+(_e<<15),kt=me+(pe<<4)+(be<<8)+(Se<<12),Mt=Ee+(Te<<8);this._setUint16(A,w+0,vt),this._setUint16(A,w+2,St),this._setUint16(A,w+4,kt),this._setUint16(A,w+6,Mt),this._setUint16(A,w+8,Ie),this._setUint16(A,w+10,ze),this._setUint16(A,w+12,Pe),this._setUint16(A,w+14,Re),this._setFloat32(A,w+16,Ue),this._setFloat32(A,w+20,Ve),this._setFloat32(A,w+24,He),this._setFloat32(A,w+28,We),this._setUint16(A,w+32,$e),this._setUint16(A,w+34,Ye),this._setUint16(A,w+36,qe),this._setUint16(A,w+38,Qe),this._setUint16(A,w+40,Ke),this._setUint16(A,w+42,et),this._setUint16(A,w+44,st),this._setUint16(A,w+46,at),this._setUint16(A,w+48,ut),this._setInt16(A,w+50,gt),this._setInt16(A,w+52,_t),this._setInt16(A,w+54,mt)}_setUint16(A,w,T){A.setUint16(w,T,this._littleEndian)}_setInt16(A,w,T){A.setUint16(w,this._signedToUnsignedInt16(T),this._littleEndian)}_setFloat32(A,w,T){A.setFloat32(w,T,this._littleEndian)}_colorToBytes(A){let w=this._colorParser(A);return Math.round(15*w[0])+(Math.round(15*w[1])<<4)+(Math.round(15*w[2])<<8)+(Math.round(15*w[3])<<12)}_coordToBytes(A){return A}_scaledSizeToBytes(A){return Math.ceil(Math.min(A,this._maxScaledSize)*this._actualScaledSizeToBytes)}_fixedSizeToBytes(A){return A}_minVisibleSizeToBytes(A){return Math.round(Math.min(A,this._maxMinVisibleSize)*this._actualMinVisibleSizeToBytes)}_symbolicSizeToBytes(A){return Math.round(Math.min(A,this._maxSymbolicSize)*this._actualSymbolicSizeToBytes)}_dashLengthToBytes(A){return Math.round(Math.min(A,this._maxDashLength)*this._actualDashLengthToBytes)}_gapLengthToBytes(A){return Math.round(Math.min(A,this._maxGapLength)*this._actualGapLengthToBytes)}_patternScaleToBytes(A){return Math.round(Math.min(A,this._maxPatternScale)*this._actualPatternScaleToBytes)}_offsetAngleToBytes(A){return Math.round((A+Gr)%Gr*(8/Gr))}_opacityToBytes(A){return Math.round(15*Math.min(A,1))}_curvatureToBytes(A){return this._signedToUnsignedByte(A)}_signedToUnsignedByte(A){return Vt(A,-128,127)+128}_signedToUnsignedInt16(A){return Vt(A,-32768,32767)+32768}storeAnimationInformation(A,w,{beginTime:T,duration:C},k){this._setAnimationBeginTime(A,w,T),this._setAnimationDuration(A,w,C),this._setAnimationEasing(A,w,k)}_setAnimationBeginTime(A,w,T){this._setFloat32(A,w,T)}_setAnimationDuration(A,w,T){this._setFloat32(A,w+4,T)}_setAnimationEasing(A,w,T){this._setUint16(A,w+8,(T[0]+128<<8)+(T[4]+128)),this._setUint16(A,w+10,(T[1]+128<<8)+(T[5]+128)),this._setUint16(A,w+12,(T[2]+128<<8)+(T[6]+128)),this._setUint16(A,w+14,(T[3]+128<<8)+(T[7]+128))}extractGenericElement(A,w,T){let C=A.type,k=A.animated,N=A.getDataView(),O=w*A.elementSize,j=this._genericObject;if(j.valid=!1,N.getUint16(O)&&(j.valid=!0,this._extractGenericObject(j.end,N,O,T),k&&(this._extractGenericObject(j.start,N,O+qs,T),this._extractAnimationInformation(j.animation,N,O+112)),j.id=this._bufferOfsetToId.get(A.getId(),w),2===C)){let T=A.getSideDataView(),C=w*A.getTotalSideElementsSize(),k=C+A.getTotalSideElementsSize();j.end.pattern=this._textManager.extractTextFromDataView(T,C,k)}return j}_extractGenericObject(A,w,T,{bytesToActualCoord:C,bytesToActualScaledSize:k,bytesToActualMinVisibleSize:N,bytesToActualPatternScale:O,bytesToActualSymbolicSize:j,bytesToActualDashLength:G,bytesToActualGapLength:H}){let W=w,$=T,Z=this._littleEndian,se=W.getUint16($,Z),ue=Rt(se,0,4),ge=Rt(se,4,8),ce=Rt(se,8,10),_e=Rt(se,10,12),me=Rt(se,12,13),pe=Rt(se,13,14),be=Rt(se,14,15),Se=Rt(se,15,16),Ee=W.getUint16($+2,Z),Te=Rt(Ee,0,8),Ce=Rt(Ee,8,11),Ie=Rt(Ee,11,12),ze=Rt(Ee,12,13),Pe=Rt(Ee,13,14),Re=Rt(Ee,14,15),Ue=Rt(Ee,15,16),Ve=W.getUint16($+4,Z),He=Rt(Ve,0,4),We=Rt(Ve,4,8),$e=Rt(Ve,8,12),Ye=Rt(Ve,12,16),qe=W.getUint16($+6,Z),Qe=Rt(qe,0,8),Ke=Rt(qe,8,16),et=W.getUint16($+8,Z),st=W.getUint16($+10,Z),at=W.getUint16($+12,Z),ut=W.getUint16($+14,Z),gt=W.getFloat32($+16,Z),_t=W.getFloat32($+20,Z),mt=W.getFloat32($+24,Z),vt=W.getFloat32($+28,Z),St=W.getUint16($+32,Z),kt=W.getUint16($+34,Z),Mt=W.getUint16($+36,Z),Nt=W.getUint16($+38,Z),Dt=W.getUint16($+40,Z),Bt=W.getUint16($+42,Z),Ht=W.getUint16($+44,Z),Wt=W.getUint16($+46,Z),Xt=W.getUint16($+48,Z),Yt=rf(W.getUint16($+50,Z)),qt=rf(W.getUint16($+52,Z)),Zt=rf(W.getUint16($+54,Z));A.pieceId=ge,A.shape=this._shapeManager.getNameFromId(ue),A.x1=qr(gt,C),A.y1=qr(_t,C),A.x2=qr(mt,C),A.y2=qr(vt,C),A.rectWidthOrSourceRadiusScaled=qr(St,k),A.rectWidthOrSourceRadiusFixed=kt,A.rectHeightOrTargetRadiusScaled=qr(Mt,k),A.rectHeightOrTargetRadiusFixed=Nt,A.thicknessOrFontSizeScaled=qr(Dt,k),A.thicknessOrFontSizeFixed=Bt,A.strokeWidthScaled=qr(Ht,k),A.strokeWidthFixed=Wt,A.offsetScaled=qr(Xt,k),A.offsetFixed=Yt,A.pattern=this._patternManager.getDefinitionFromId(et),A.pattern.attributes.paddingTop=qt,A.pattern.attributes.paddingLeft=Zt,A.opacity=He/15,A.fillColor=yh(st),A.strokeColor=yh(at),A.patternColor=yh(ut),A.globalMinVisibleSize=qr(We,N),A.strokeMinVisibleSize=qr($e,N),A.patternMinVisibleSize=qr(Ye,N),A.offsetAngle=Ce*(2*Math.PI/8),A.patternScale=Te*O,A.symbolicSize=Qe*j,A.curvature=function _S(A){return A-128}(Ke),A.dashLength=ce*G,A.gapLength=_e*H,A.hasHead=!!me,A.hasTail=!!pe,A.isBodyTriangle=!!be,A.isSelfLoop=!!Se,A.isText=!!Ie,A.adjustTextAngle=!!ze,A.isBadge=!!Pe,A.unusedFlag2=!!Re,A.unusedFlag3=!!Ue}_extractAnimationInformation(A,w,T){let C=this._littleEndian,k=w.getFloat32(T,C),N=w.getFloat32(T+4,C),O=w.getUint16(T+8,C),j=w.getUint16(T+10,C),G=w.getUint16(T+12,C),H=w.getUint16(T+14,C),W=(O>>8)-128,$=(j>>8)-128,Z=(G>>8)-128,se=(H>>8)-128,ue=O%256-128,ge=j%256-128,ce=G%256-128,_e=H%256-128;A.beginTime=k,A.duration=N,A.easing=this._easingManager.getName(W,$,Z,se,ue,ge,ce,_e)}}(this._patternManager,this._shapeManager,this._textManager,this._bufferOfsetToId,this._easingManager,(A=>this.parseColor(A)||Sn)),this._bufferList=new class{constructor(){this.version=0,this.version=0,this._blockInfo={buffer:null,offset:0,size:0,address:0},this._init_()}reset(){this._init_()}_init_(){this._buffersByDepth=new Array(100),this._buffersById=[],this._buffersByAscendingDepth=[],this._buffersByDescendingDepth=[],this._mustUpdate=!0}_fillBlockInfo(A,w,T,C){return this._blockInfo.buffer=A,this._blockInfo.offset=w,this._blockInfo.size=T,this._blockInfo.address=C,this._blockInfo}_createBuffer(A,w,T,C,k){let N=w?128:qs,O=this._buffersById.length,j=new class{constructor({elementSize:A,sideElementSize:w,nbSideElementsPerMainElement:T,id:C,depth:k,elementType:N,animated:O,stencilUsage:j}){this._nbCellsAllocated=0,this._nbCellsFreed=0,this._isFullyAllocated=!1,this._isFullyFreed=!1,this._mustUpdate=!0,this._capacity=512,this.version=0,this._id=C,this.depth=k,this.type=N,this.animated=O,this.stencilUsage=j,this.elementSize=A,this._sideElementSize=w,this._nbSideElementsPerMainElement=T,this._totalSideElementsSize=T*w,this._byteCapacity=this._capacity*this.elementSize,this._byteArray=new Uint8Array(this._byteCapacity),this._dataView=new DataView(this._byteArray.buffer),this._sideByteCapacity=this._capacity*this._totalSideElementsSize,this._sideByteArray=new Uint8Array(this._sideByteCapacity),this._sideDataView=new DataView(this._sideByteArray.buffer)}update(){this._mustUpdate&&(this.version+=1,this._mustUpdate=!1,this._isFullyAllocated&&this._nbCellsFreed===this._nbCellsAllocated&&(this._isFullyFreed=!0))}allocate(A){let w=-1;return!this._isFullyAllocated&&this._nbCellsAllocated+A<=this._capacity?(w=this._nbCellsAllocated,this._nbCellsAllocated+=A,this._mustUpdate=!0):this._isFullyAllocated=!0,w}free(A,w){for(let T=0;T<w;T++){let w=(A+T)*this.elementSize;this._dataView.setUint16(w,0)}this._mustUpdate=!0,this._nbCellsFreed+=w}triggerUpdate(){this._mustUpdate=!0}isEmpty(){return this._nbCellsFreed===this._nbCellsAllocated}isFullyFreed(){return this._isFullyFreed}getId(){return this._id}getDataView(){return this._dataView}getByteArray(){return this._byteArray}getSize(){return this._nbCellsAllocated}getNbSideElementsPerMainElement(){return this._nbSideElementsPerMainElement}hasSideData(){return this._nbSideElementsPerMainElement>0}getSideDataView(){return this._sideDataView}getSideByteArray(){return this._sideByteArray}getTotalSideElementsSize(){return this._totalSideElementsSize}}({elementSize:N,sideElementSize:6,nbSideElementsPerMainElement:C,id:O,depth:T,elementType:A,animated:w,stencilUsage:k});return this._buffersById.push(j),j}getBlockInfo(A){return this._fillBlockInfo(this._buffersById[A>>js],(A>>Bs)%512,A%128,A)}allocateBlock(A,w,T,C,k,N,O){let j=function NT(A,w){let T=0;for(;T<A;)T+=w;return T}(N,8);this._mustUpdate=!0;let G=null,H=-1;if(A){let N=this.getBlockInfo(A),W=N.buffer,$=N.offset,Z=N.size,se=N.size===k,ue=W.depth===C,ge=W.type===w,ce=W.animated===T,_e=W.getNbSideElementsPerMainElement()===j,me=W.stencilUsage===O;se&&ue&&ge&&ce&&_e&&me?(W.triggerUpdate(),G=W,H=$):W.free($,Z)}if(-1===H){let A=+T,N=j/8,W=this._buffersByDepth[C]||Array(2);this._buffersByDepth[C]=W;let $=W[A]||[];W[A]=$;let Z=$[w]||Array(16);$[w]=Z;let se=Z[N]||Array(4);Z[N]=se;let ue=se[O]||[];se[O]=ue;let ge=ue[ue.length-1];ge&&(G=ge,H=ge.allocate(k)),-1===H&&(G=this._createBuffer(w,T,C,j,O),H=G.allocate(k),ue.push(G))}let W=function vT(A,w,T){return((A<<Rs)+w<<Bs)+T}(G.getId(),H,k);return this._fillBlockInfo(G,H,k,W)}freeBlock(A){if(A){this._mustUpdate=!0;let w=this.getBlockInfo(A);w.buffer.free(w.offset,w.size)}return 0}_sortBuffersByDepth(){let A=[];for(let w=0;w<this._buffersByDepth.length;w++){let T=this._buffersByDepth[w];if(T)for(let w=0;w<T.length;w++){let C=T[w];if(C)for(let w=0;w<C.length;w++){let T=C[w];if(T)for(let w=0;w<T.length;w++){let C=T[w];if(C)for(let w=0;w<C.length;w++){let T=C[w];if(T)for(let w=0;w<T.length;w++){let C=T[w];C.update(),C.isFullyFreed()?(this._buffersById[C.getId()]=void 0,T.splice(w,1),w-=1):A.push(C)}}}}}}this._buffersByAscendingDepth=A,this._buffersByDescendingDepth=A.slice().reverse()}update(){this._mustUpdate&&(this._sortBuffersByDepth(),this.version+=1,this._mustUpdate=!1)}getBuffers(){return this._buffersById}getBuffersByAscendingDepth(){return this._buffersByAscendingDepth}getBuffersByDescendingDepth(){return this._buffersByDescendingDepth}}}static createInitData(){let A={};for(let w in An)A[w]=An[w].createInitData();return A}static cacheInitData(A){En=A}static getCachedInitData(){return En}static clearCachedInitData(){En={webgl:null,svg:null,canvas:null}}freeBlock(A){this._checkBlockId(A);let w=this._blockIdToAddress[A],T=this._bufferList.freeBlock(w);return this._blockIdToAddress[A]=T,T}_ensureDomElementsFitParent(){let A=this._domElement.parentNode;A&&(A.offsetWidth!==this._view.width||A.offsetHeight!==this._view.height)&&rn(A,`${this._view.width}px`,`${this._view.height}px`)}_ensureCorrectBackgroundColor(){let A=this._domElement.parentNode;this._backgroundColor!==this._view.backgroundColor&&A&&(A.style.backgroundColor=this._view.backgroundColor||"",this._backgroundColor=this._view.backgroundColor)}createGroup(){return new class{constructor(){this._capacity=128,this._id=0,this.size=0,this.depth=0,this.animated=!1,this.stencilUsage=1,this.type=1,this._list=Array(this._capacity);for(let A=0;A<this._capacity;++A)this._list[A]={valid:!1,id:void 0,end:{pieceId:0,shape:"circle",x1:0,y1:0,x2:0,y2:0,rectWidthOrSourceRadiusScaled:0,rectWidthOrSourceRadiusFixed:0,rectHeightOrTargetRadiusScaled:0,rectHeightOrTargetRadiusFixed:0,thicknessOrFontSizeScaled:0,thicknessOrFontSizeFixed:0,strokeWidthScaled:0,strokeWidthFixed:0,offsetScaled:0,offsetFixed:0,pattern:{id:void 0,type:0,attributes:{}},opacity:1,fillColor:null,strokeColor:null,patternColor:null,globalMinVisibleSize:0,strokeMinVisibleSize:0,patternMinVisibleSize:0,offsetAngle:0,patternScale:0,symbolicSize:-1,curvature:0,dashLength:0,gapLength:0,hasHead:!1,hasTail:!1,isBodyTriangle:!1,isSelfLoop:!1,isText:!1,adjustTextAngle:!1,isBadge:!1,unusedFlag2:!1,unusedFlag3:!1},start:{pieceId:0,shape:"circle",x1:0,y1:0,x2:0,y2:0,rectWidthOrSourceRadiusScaled:0,rectWidthOrSourceRadiusFixed:0,rectHeightOrTargetRadiusScaled:0,rectHeightOrTargetRadiusFixed:0,thicknessOrFontSizeScaled:0,thicknessOrFontSizeFixed:0,strokeWidthScaled:0,strokeWidthFixed:0,offsetScaled:0,offsetFixed:0,pattern:{id:void 0,type:0,attributes:{}},opacity:1,fillColor:null,strokeColor:null,patternColor:null,globalMinVisibleSize:0,strokeMinVisibleSize:0,patternMinVisibleSize:0,offsetAngle:0,patternScale:0,symbolicSize:-1,curvature:0,dashLength:0,gapLength:0,hasHead:!1,hasTail:!1,isBodyTriangle:!1,isSelfLoop:!1,isText:!1,adjustTextAngle:!1,isBadge:!1,unusedFlag2:!1,unusedFlag3:!1},animation:{duration:0,beginTime:-1,easing:"linear"}}}reset(A,w,T,C){return this.type=A,this.animated=w,this.depth=T,void 0!==C&&(this._id=C),this.stencilUsage=1,this.size=0,this}next(){if(this.size>=this._capacity)throw new Error("internal error: block.next() was called on a full block");return this._list[this.size++]}nextAndReset(){let A=this.next();return A.end=kp(A.end),A.start=kp(A.start),A.animation=function uy(A={}){return A.duration=0,A.beginTime=-1,A.easing="linear",A}(A.animation),A}forEach(A){this._list.forEach(A)}getElement(A){return this._list[A]}getCurrentElement(){return this._list[this.size-1]}getElements(){return this._list}getId(){return this._id}setGlobalAnimation(A,w,T){for(let C=0;C<this.size;++C){let k=this._list[C].animation;k.duration=A,k.beginTime=w,k.easing=T}}}}parseColor(A){return this._colorManager.parseColor(A)}clear(){this._blockIdToAddress.fill(0),this._patternManager.reset(),this._boundariesManager.reset(),this._textManager.reset(),this._bufferList.reset(),this._bufferOfsetToId.reset()}notifyFontsReloaded(){this._patternManager.notifyUpdate(),this._textManager.clear(),this._refreshTexts=!0}notifyPatternUpdate(){this._patternManager.notifyUpdate()}getShapePoints(A){return this._shapeManager.getDefinitionFromName(A).points}checkShapeHit(A,w,T){let{getDistanceFromStrokeVertically:C,getDistanceFromStrokeHorizontally:k}=this._shapeManager.getDefinitionFromName(A);return Math.min(C(w,T),k(w,T))>=0}setGlobalBoundaries(A){let{maxBlockId:w=0,maxScaledSize:T,maxMinVisibleSize:C,maxSymbolicSize:k,maxDashLength:N,maxGapLength:O,maxPatternScale:j}=A;return w>this._blockIdToAddress.length&&this._resizeBlockArray(w),!!this._boundariesManager.set(A)&&(this._memoryManager.resizeBoundaries(T,C,k,N,O,j),!0)}_resizeBlockArray(A){let w=new Uint32Array(A);w.set(this._blockIdToAddress),this._blockIdToAddress=w}registerShape(A,w){this._shapeManager.register(A,w)}_bindBlock(A,w,T,C,k,N,O){this._checkBlockId(A);let j=this._blockIdToAddress[A],G=this._bufferList.allocateBlock(j,w,T,C,k,N,O);return this._blockIdToAddress[A]=G.address,this._currentDataView=G.buffer.getDataView(),this._currentElementSize=G.buffer.elementSize,this._currentBlockOffset=G.offset,this._currentByteOffset=this._currentBlockOffset*this._currentElementSize,this._currentSideDataView=G.buffer.getSideDataView(),this._currentSideElementSize=G.buffer.getTotalSideElementsSize(),this._currentSideByteOffset=this._currentBlockOffset*this._currentSideElementSize,G}_setItemIndex(A){let w=this._currentBlockOffset+A;this._currentByteOffset=w*this._currentElementSize,this._currentSideByteOffset=w*this._currentSideElementSize}_checkBlockId(A){A>=this._blockIdToAddress.length&&this._resizeBlockArray(Vr(A+1))}_setTextCharacters(A){this._textManager.storeTextInDataView(this._currentSideDataView,this._currentSideByteOffset,this._currentSideByteOffset+this._currentSideElementSize,A)}_storeElement(A,w){this._memoryManager.storeGenericObject(this._currentDataView,this._currentByteOffset,A.end),w&&(this._memoryManager.storeGenericObject(this._currentDataView,this._currentByteOffset+qs,A.start),this._memoryManager.storeAnimationInformation(this._currentDataView,this._currentByteOffset+112,A.animation,this._easingManager.getCoefficients(A.animation.easing)))}storeGroup(A,w){if(!w||0===w.size)return this.freeBlock(A);let T=w.type,C=w.depth,k=w.size,N=w.getElements(),O=w.animated,j=w.stencilUsage,G=w.getId(),H=0;if(2===T)for(let A=0;A<k;++A){let w=N[A],{start:T,end:C}=w;if(7===C.pattern.type){let A=C.pattern.attributes.text;H=Math.max(H,A.length)}if(O&&7===T.pattern.type){let A=T.pattern.attributes.text;H=Math.max(H,A.length)}}let W=this._bindBlock(A,T,O,C,k,H,j);for(let A=0;A<k;++A){let w=N[A];this._setItemIndex(A),this._storeElement(w,O),this._bufferOfsetToId.set(W.buffer.getId(),W.offset+A,G)}if(2===T)for(let A=0;A<k;++A){let w=N[A];this._setItemIndex(A),this._setTextCharacters(w.end.pattern)}return W.address}_refreshTextElements(){let A=this._bufferList.getBuffers();for(let w of A)if(w&&2===w.type){let A=w.getSideDataView(),T=w.getTotalSideElementsSize(),C=w.getSize(),k=0,N=T;for(let w=0;w<C;++w){let w=this._textManager.extractTextFromDataView(A,k,N);this._textManager.storeTextInDataView(A,k,N,w),k=N,N+=T}w.triggerUpdate()}}extractElement(A,w=0){if(!A)return null;let T=this._bufferList.getBlockInfo(A);return this._renderer.extractElement(T.buffer,T.offset+w)}getDomElement(){return this._domElement}getDomWrapper(){return this._domWrapper}measureText(A,w,T,C=1){return this._textManager.measureText(A,w,T,C)}setRenderType(A){this._renderType!==A&&(this._renderType=A,this._switchMainRenderer=!0)}_ensureMainRendererReady(){if(this._switchMainRenderer){null===this._renderType&&(this._renderType="canvas");let A=An[this._renderType];(!A||!A.isAvailable())&&(this._renderType="canvas"),this._renderer=this._renderersByType[this._renderType],this._renderer||(this._renderer=this._instanciateRenderer(this._renderType),this._renderersByType[this._renderType]=this._renderer),this._updateDomElement()}}_updateDomElement(){let A=this._renderer&&this._renderer.getDomElement(),w=this._domElement;for(;w&&w.firstChild;)w.removeChild(w.firstChild);A&&this._appendDomChild(A)}_appendDomChild(A){A.style.position="absolute",A.style.left="0",A.style.top="0",this._domElement.appendChild(A)}_instanciateRenderer(A){return new(null===A?ir:An[A])({initData:null===A?null:this._initData[A],bufferList:this._bufferList,shapeManager:this._shapeManager,patternManager:this._patternManager,boundariesManager:this._boundariesManager,textManager:this._textManager,colorManager:this._colorManager,easingManager:this._easingManager,memoryManager:this._memoryManager})}setView(A){this._view=re(re({},this._view),A)}getTextManager(){return this._textManager}_updateManagers(){this._patternManager.setPixelRatio(this._view.pixelRatio),this._shapeManager.update(),this._patternManager.update(),this._textManager.update(),this._boundariesManager.update(),this._bufferList.update(),this._refreshTexts&&(this._refreshTexts=!1,this._refreshTextElements())}_resizeCanvas(A){nh(A,this._view.width,this._view.height,this._view.pixelRatio)}render(){this._ensureMainRendererReady(),this._ensureDomElementsFitParent(),this._ensureCorrectBackgroundColor(),this._updateManagers(),this._renderer.renderFrame(this._view)}ensureAnimationsReady(){this._ensureMainRendererReady(),this._renderer.ensureAnimationsReady()}export(A,w,T){let C=this._instanciateRenderer(A),k=re(re({},this._view),w);return"setViewportClipping"in C&&C.setViewportClipping(!1),this._updateManagers(),C.renderFrame(k),C.export(T).then((()=>C.getDomElement()))}getCurrentTime(){return Ut()}getImageData(){return this._renderer&&this._renderer.getImageData()}destroy(){for(let A of Object.keys(this._renderersByType)){let w=this._renderersByType[A];w&&w.destroy()}}transparentify(A){let w=this.parseColor(A)||Sn;return`rgba(${Math.round(255*w[0])},${Math.round(255*w[1])},${Math.round(255*w[2])},0)`}initDebugRenderingLoop({triggerKey:A="r",start:w=!0}={}){let T=w;document.addEventListener("keydown",(({key:w})=>{w===A&&(T=!T)}));let i=A=>{(T||A)&&(this.setView({currentTime:Ut()}),this.render()),window.requestAnimationFrame((()=>{i()}))};window.requestAnimationFrame((()=>{document.body.appendChild(this.getDomElement()),i(!0)}))}},Ln=class extends Ls{constructor(A,w){super(),this.isDummy=!0,this.width=0,this.height=0}set src(A){A&&(this._src=A,setTimeout((()=>{this.onload&&this.onload.call(this),this.width=1,this.height=1,this.fire("load")}),10))}get src(){return this._src}addEventListener(A,w){this.on(A,w)}};function sf(A,w,T,C,k,N,O,j=0,G=!1){let H=Et(T,C,k,N),W=(O/2*(G?Et(A,w,k,N)/H:1)+j)/H,$=(k-T)*W,Z=(N-C)*W,se=T+Z,ue=C-$,ge=A-se,ce=w-ue,_e=T-Z-se,me=C+$-ue,pe=k+Z-se,be=N-$-ue,Se=ge*_e+ce*me,Ee=ge*pe+ce*be;return Se>0&&Se<_e*_e+me*me&&Ee>0&&Ee<pe*pe+be*be}function ES(A,w,T,C,k=!1){if(k&&(Dh(A,T)||Dh(A,C)||Dh(w,T)||Dh(w,C)))return!1;let N=(A.y-T.y)*(C.x-T.x)-(A.x-T.x)*(C.y-T.y),O=(w.x-A.x)*(C.y-T.y)-(w.y-A.y)*(C.x-T.x);if(0===O)return!1;let j=N/O;N=(A.y-T.y)*(w.x-A.x)-(A.x-T.x)*(w.y-A.y);let G=N/O;return!(j<=0||j>=1||G<=0||G>=1)}function Dh(A,w){return A.x===w.x&&A.y===w.y}function Ai(A,w,T,C){return Math.atan2(C-w,T-A)}function yS(A,w,T){let C=Ai(A.x,A.y,w.x,w.y)-Ai(T.x,T.y,w.x,w.y);return C<0?C+2*Math.PI:C}function xS(A,w,T,C,k,N,O,j){let G=(j-N)*(T-A)-(O-k)*(C-w);if(0===G)return null;let H=w-N;return H=((O-k)*H-(j-N)*(A-k))/G,{x:A+H*(T-A),y:w+H*(C-w)}}function Xd(A,w,T,C,k,N,O,j){let G=A-T,H=w-C,W=k-O,$=N-j,Z=G*$-W*H,se=(H*(A-k)-G*(w-N))/Z;if(se<0||se>1)return null;let ue=(W*(N-w)+$*(A-k))/Z;return ue>=0&&ue<=1?{x:A-ue*G,y:w-ue*H}:null}function af(A,w,T,C,k,N,O,j){let G,H=[];return G=Xd(A,w,T,C,k,N,k,j),G&&H.push(G),G=Xd(A,w,T,C,k,j,O,j),G&&H.push(G),G=Xd(A,w,T,C,O,j,O,N),G&&H.push(G),G=Xd(A,w,T,C,O,N,k,N),G&&H.push(G),H}function _o(A,w,T,C,k,N,O,j){let G=((O-k)*(w-N)-(j-N)*(A-k))/((j-N)*(T-A)-(O-k)*(C-w)),H=((T-A)*(w-N)-(C-w)*(A-k))/((j-N)*(T-A)-(O-k)*(C-w));return G>=0&&G<=1&&H>=0&&H<=1}function Kd(A,w,T,C,k,N,O,j){return!!(A>=k&&w>=N&&A<=O&&w<=j||T>=k&&C>=N&&T<=O&&C<=j||_o(A,w,T,C,k,N,k,j)||_o(A,w,T,C,O,N,O,j)||_o(A,w,T,C,k,N,O,N)||_o(A,w,T,C,k,j,O,j))}function df(A,w,T){return Math.sqrt(Ah(A.x,A.y,w.x,w.y,T.x,T.y))}function Ah(A,w,T,C,k,N){let O=kd(T,C,k,N);if(0===O)return kd(A,w,T,C);let j=((A-T)*(k-T)+(w-C)*(N-C))/O;return j=Math.max(0,Math.min(1,j)),kd(A,w,T+j*(k-T),C+j*(N-C))}function lf(A,w,T,C,k,N){let O=k-T,j=N-C;if(0===O&&0===j)return{x:T,y:C};let G=((A-T)*O+(w-C)*j)/(O*O+j*j);return G<0?{x:T,y:C}:G>1?{x:k,y:N}:{x:T+G*O,y:C+G*j}}function DS(A,w,T,C,k,N){let O=k-T,j=N-C,G=((A-T)*O+(w-C)*j)/(O*O+j*j);return{x:T+O*G,y:C+j*G}}function vh(){for(var A=arguments,w=A.length-1,T=w,C=[],k=0;k<=w&&Math.abs(A[k])<=1e-12;k++)w--;switch(w){case 1:AS(A[T],A[T-1],C);break;case 2:vS(A[T],A[T-1],A[T-2],C);break;case 3:NS(A[T],A[T-1],A[T-2],A[T-3],C)}return C}function AS(A,w,T=[]){return 0!==w&&T.push(-A/w),T}function vS(A,w,T,C=[]){var k=w/T,N=k*k-4*(A/T);if(N>0){var O=Math.sqrt(N);C.push(.5*(-k+O)),C.push(.5*(-k-O))}else 0===N&&C.push(.5*-k);return C}function NS(A,w,T,C,k=[]){var N,O,j=T/C,G=w/C,H=(3*G-j*j)/3,W=(2*j*j*j-9*G*j+27*(A/C))/27,$=j/3,Z=W*W/4+H*H*H/27,se=W/2;if(Math.abs(Z)<=1e-6&&(Z=0),Z>0){var ue=Math.sqrt(Z);O=(N=-se+ue)>=0?Math.pow(N,1/3):-Math.pow(-N,1/3),(N=-se-ue)>=0?O+=Math.pow(N,1/3):O-=Math.pow(-N,1/3),k.push(O-$)}else if(Z<0){var ge=Math.sqrt(-H/3),ce=Math.atan2(Math.sqrt(-Z),-se)/3,_e=Math.cos(ce),me=Math.sin(ce),pe=Math.sqrt(3);k.push(2*ge*_e-$),k.push(-ge*(_e+pe*me)-$),k.push(-ge*(_e-pe*me)-$)}else N=se>=0?-Math.pow(se,1/3):Math.pow(-se,1/3),k.push(2*N-$),k.push(-N-$);return k}function vi(A,w,T,C,k,N,O,j,G,H,W){for(var $,Z,se=Math.min(O,G),ue=Math.min(j,H),ge=Math.max(O,G),ce=Math.max(j,H),_e=vh(($=j-H)*(A+-2*T+k)+(Z=G-O)*(w+-2*C+N),$*(-2*A+2*T)+Z*(-2*w+2*C),$*A+Z*w+(O*H-G*j)),me=0;me<_e.length;me++){var pe=_e[me];if(0<=pe&&pe<=1){var be=A+(T-A)*pe,Se=w+(C-w)*pe,Ee=be+(T+(k-T)*pe-be)*pe,Te=Se+(C+(N-C)*pe-Se)*pe;if(O===G){if(ue<=Te&&Te<=ce){if(!W)return 1;W.push(Ee,Te)}}else if(j===H){if(se<=Ee&&Ee<=ge){if(!W)return 1;W.push(Ee,Te)}}else if(Ee>=se&&Te>=ue&&Ee<=ge&&Te<=ce){if(!W)return 1;W.push(Ee,Te)}}}return W?W.length/2:0}function Ds(A,w,T,C,k,N,O,j,G,H,W){return W?(vi(A,w,T,C,k,N,O,j,G,j,W),vi(A,w,T,C,k,N,G,j,G,H,W),vi(A,w,T,C,k,N,O,H,G,H,W),vi(A,w,T,C,k,N,O,j,O,H,W),W.length/2):O<=A&&G>=A&&j<=w&&H>=w||O<=k&&G>=k&&j<=N&&H>=N||vi(A,w,T,C,k,N,O,j,G,j)||vi(A,w,T,C,k,N,G,j,G,H)||vi(A,w,T,C,k,N,O,H,G,H)||vi(A,w,T,C,k,N,O,j,O,H)?1:0}function Ni(A,w,T,C,k,N,O,j,G,H,W,$,Z){for(var se,ue,ge=Math.min(G,W),ce=Math.min(H,$),_e=Math.max(G,W),me=Math.max(H,$),pe=vh((se=H-$)*(-1*A+3*T+-3*k+O)+(ue=W-G)*(-1*w+3*C+-3*N+j),se*(3*A+-6*T+3*k)+ue*(3*w+-6*C+3*N),se*(-3*A+3*T)+ue*(-3*w+3*C),se*A+ue*w+(G*$-W*H)),be=0;be<pe.length;be++){var Se=pe[be];if(0<=Se&&Se<=1){var Ee=A+(T-A)*Se,Te=w+(C-w)*Se,Ce=T+(k-T)*Se,Ie=C+(N-C)*Se,ze=Ee+(Ce-Ee)*Se,Pe=Te+(Ie-Te)*Se,Re=ze+(Ce+(k+(O-k)*Se-Ce)*Se-ze)*Se,Ue=Pe+(Ie+(N+(j-N)*Se-Ie)*Se-Pe)*Se;if(G===W){if(ce<=Ue&&Ue<=me){if(!Z)return 1;Z.push(Re,Ue)}}else if(H===$){if(ge<=Re&&Re<=_e){if(!Z)return 1;Z.push(Re,Ue)}}else if(Re>=ge&&Ue>=ce&&Re<=_e&&Ue<=me){if(!Z)return 1;Z.push(Re,Ue)}}}return Z?Z.length/2:0}function As(A,w,T,C,k,N,O,j,G,H,W,$,Z){return Z?(Ni(A,w,T,C,k,N,O,j,G,H,W,H,Z),Ni(A,w,T,C,k,N,O,j,W,H,W,$,Z),Ni(A,w,T,C,k,N,O,j,G,$,W,$,Z),Ni(A,w,T,C,k,N,O,j,G,H,G,$,Z),Z.length/2):G<=A&&W>=A&&H<=w&&$>=w||G<=O&&W>=O&&H<=j&&$>=j||Ni(A,w,T,C,k,N,O,j,G,H,W,H)||Ni(A,w,T,C,k,N,O,j,W,H,W,$)||Ni(A,w,T,C,k,N,O,j,G,$,W,$)||Ni(A,w,T,C,k,N,O,j,G,H,G,$)?1:0}function vs(A,w,T,C,k,N,O,j={x:0,y:0}){return j.x=(1-A)*(1-A)*w+2*(1-A)*A*N+A*A*C,j.y=(1-A)*(1-A)*T+2*(1-A)*A*O+A*A*k,j}function cf(A,w,T,C,k,N,O,j={x:0,y:0}){return j.x=(2*A-2)*w+(2*C-4*N)*A+2*N,j.y=(2*A-2)*T+(2*k-4*O)*A+2*O,ef(j)}function Gy(A,w,T,C,k,N,O,j={x:0,y:0}){return cf(A,w,T,C,k,N,T,j),xs(j.x,j.y,0,0,Math.PI/2,j),j}function hf(A,w,T,C,k,N,O,j,G,H=0,W=!1){let $=T-2*O+k,Z=C-2*j+N,se=-((T-A)*Z-(C-w)*$)/((2*O-2*T)*Z-(2*j-2*C)*$);if(se<0||se>1)return!1;let ue=G/2;return W&&(ue*=1-se),ue+=H,Et(Di(T,O,k,se),Di(C,j,N,se),A,w)<=ue}function TS(A,w){let T=A.getAttribute("curvature"),[C,k]=A.getExtremities().getAttributes(["x","y"]),N=jt(C.x,C.y,k.x,k.y,T);return vs(w,C.x,C.y,k.x,k.y,N.x,N.y)}function SS(A,w){let T=A.getAttribute("curvature"),[C,k]=A.getExtremities().getAttributes(["x","y"]),N=jt(C.x,C.y,k.x,k.y,T);return Gy(w,C.x,C.y,k.x,k.y,N.x,N.y)}function LS(A,w){let T=A.getAttribute("curvature"),[C,k]=A.getExtremities().getAttributes(["x","y"]),N=jt(C.x,C.y,k.x,k.y,T);return cf(w,C.x,C.y,k.x,k.y,N.x,N.y)}function bo(A,w,T,C,k,N,O,j,G,H={x:0,y:0}){let W=(1-A)*(1-A)*(1-A),$=3*A*(1-A)*(1-A),Z=3*A*A*(1-A),se=A*A*A;return H.x=W*w+$*N+Z*j+se*C,H.y=W*T+$*O+Z*G+se*k,H}function mf(A,w,T,C,k,N,O,j,G,H,W,$){let Z=Et(T,C,O,j);if(Math.abs(A-T)>Z||Math.abs(w-C)>Z)return!1;let se,ue=.5,ge=Et(A,w,T,C)<Et(A,w,k,N)?-.01:.01,ce=100,_e=bo(ue,T,C,k,N,O,j,G,H),me=Et(A,w,_e.x,_e.y),pe=W/2+$;for(;ce-- >0&&ue>=0&&ue<=1&&me>pe&&(ge>.001||ge<-.001);)se=me,bo(ue,T,C,k,N,O,j,G,H,_e),me=Et(A,w,_e.x,_e.y),me>se?(ge=-ge/2,ue+=ge):ue+ge<0||ue+ge>1?(ge/=2,me=se):ue+=ge;return me<pe}function Yd(A,w,T,C,k,N,O={minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}){let j=A+.6666666666666666*(T-A),G=w+2/3*(C-w);return Ns(A,w,j,G,j+1/3*(k-A),G+1/3*(N-w),k,N,O)}function Ns(A,w,T,C,k,N,O,j,G={minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}){let H,W,$,Z,se,{min:ue,max:ge,sqrt:ce}=Math;G.minX=ue(A,O),G.maxX=ge(A,O),G.minY=ue(w,j),G.maxY=ge(w,j);for(let _e,me,pe,be,Se,Ee,Te,Ce=0;Ce<2;++Ce)if(0===Ce?(W=A,$=T,Z=k,se=O):(W=w,$=C,Z=N,se=j),me=6*W-12*$+6*Z,_e=-3*W+9*$-9*Z+3*se,pe=3*$-3*W,me|=0,_e|=0,pe|=0,0!==_e)Se=me*me-4*pe*_e,!(Se<0)&&(Ee=(-me+ce(Se))/(2*_e),Ee>0&&Ee<1&&(H=uf(Ee,W,$,Z,se),0===Ce?(G.minX=ue(G.minX,H),G.maxX=ge(G.maxX,H)):(G.minY=ue(G.minY,H),G.maxY=ge(G.maxY,H))),Te=(-me-ce(Se))/(2*_e),Te>0&&Te<1&&(H=uf(Te,W,$,Z,se),0===Ce?(G.minX=ue(G.minX,H),G.maxX=ge(G.maxX,H)):(G.minY=ue(G.minY,H),G.maxY=ge(G.maxY,H))));else{if(0===me)continue;be=-pe/me,be>0&&be<1&&(H=uf(be,W,$,Z,se),0===Ce?(G.minX=ue(G.minX,H),G.maxX=ge(G.maxX,H)):(G.minY=ue(G.minY,H),G.maxY=ge(G.maxY,H)))}return G}function uf(A,w,T,C,k){return Math.pow(1-A,3)*w+3*Math.pow(1-A,2)*A*T+3*(1-A)*Math.pow(A,2)*C+Math.pow(A,3)*k}var kn={left:{x:-1,y:0},right:{x:1,y:0},top:{x:0,y:-1},bottom:{x:0,y:1},center:{x:0,y:0}};var Mn={storage:1,default:0},Fn=class{constructor({graph:A,isNode:w,includeRemovedElements:T}){this._all=!1,this._isNode=w,this._graph=A,this._includeRemovedElements=T,this._eltList=w?this._graph.nodeList:this._graph.edgeList,this._flexArray=w?A.createNodeAttribute(Mn,!1):A.createEdgeAttribute(Mn,!1),this._all=!1,this._indexList=A.createIndexList(w)}_getAllIndexes(){let A=this._isNode?this._graph.getNodeMaxIndex():this._graph.getEdgeMaxIndex(),w=new Uint32Array(A);for(let T=1;T<=A;++T)w[T-1]=T;return w}addAll(){this._all=!0}add(A){if(!this._all)for(let w=0;w<A._indexes.length;w++){let T=A._indexes[w];this.addIndex(T)}}addIndex(A){0===this._flexArray.get(A)&&(this._flexArray.set(A,1),this._indexList.push(A))}isEmpty(){return!this._all&&this._indexList.isEmpty()}isFull(){return this._all}getListAndClear(){let A=this.getList();return this.clear(),A}getList(){let A;if(this._all&&!this._includeRemovedElements)A=this._isNode?this._graph.getNodes("all"):this._graph.getEdges("all");else{let w=this._all?this._getAllIndexes():this._indexList.slice();A=this._eltList(w)}return A}clear(){this._all=!1,this._indexList.isEmpty()||(this._indexList.reset(),this._flexArray.reset())}addSet(A){if(A._all)this.addAll();else{let w=A._indexList.getBuffer(),T=A._indexList.getLength();for(let A=0;A<T;++A)this.addIndex(w[A])}}};function Eo(A){return"string"==typeof A}var zn="shifted";function Jt(A){return"boolean"==typeof A||0===A||1===A?A:void 0}function Xn(A){return"number"==typeof A&&isFinite(A)?A:void 0}function It(A){return"number"==typeof A&&isFinite(A)&&A>=0?A:void 0}var Th=A=>"number"==typeof A&&isFinite(A)&&A>=-100&&A<=400?A:void 0;function an(A){return null===A||"string"==typeof A||"number"==typeof A?A:void 0}function vn(A){return"fixed"===A||"scaled"===A?A:void 0}function Nn(A,w){return w.parseColor(A)?A:void 0}function sr(A,w){return"inherit"===A||w.parseColor(A)?A:void 0}function Si(A){return null===A?null:"string"==typeof A?A.split(",").map((A=>{let w=A.trim(),T=-1!==w.indexOf(" "),C=w[0];return T&&'"'!==C&&"'"!==C?`"${w}"`:w})).join(","):void 0}function Li(A){return"none"===A?"normal":"normal"===A||"italic"===A||"bold"===A||"italic bold"===A||"bold italic"===A?A:void 0}function Ts(A){return"left"===A||"center"===A?A:void 0}function pf(A){return[null,"arrow","circle-hole-arrow","triangle-hole-arrow","short-arrow","sharp-arrow","circle","square"].includes(A)?A:void 0}function ct(A){return function(w){if("number"==typeof w)return isFinite(w)&&w>=0?w:void 0;if("string"!=typeof w||"%"!==w.charAt(w.length-1))return;let T=parseFloat(w);return isNaN(T)?void 0:A*T/100}}var Pn="Arial",Dn="black",Bn="normal",jn="center",Un="red",Vn="rgb(220, 220, 220)",Gn="rgb(220, 220, 220)",Hn="grey",Wn="white",qn="rgba(0, 0, 0, 0.36)",Kn="white",eo="black",to="black",io="black",so="rgba(0, 0, 0, 0.0)",ao="rgba(0, 0, 0, 0.6)",ho=12,uo=ct(5),go=ct(12),co=ct(10),mo=ct(2),po=ct(5),xo=ct(7),yo=ct(2),vo=ct(5),Ao=ct(40),So=ct(1);function Uh(A){return{_check:an,_set:(w,T,C)=>{w.badges[A].text.content.set(T,C),null==C&&w.badges[A].image.url.set(T,C)},_get:(w,T)=>w.badges[A].text.content.get(T),color:{_flexArray:Kn,_check:sr},scale:{_flexArray:.45,_check:ct(.45)},positionScale:{_flexArray:1,_check:It},minVisibleSize:{_flexArray:ho,_check:ct(ho)},image:{_alias:`badges.${A}.image.url`,url:{_flexArray:null,_check:an},scale:{_flexArray:1,_check:ct(1)}},stroke:{color:{_flexArray:eo,_check:sr},width:{_flexArray:2,_check:ct(2)},scalingMethod:{_flexArray:"fixed",_check:vn}},text:{_alias:`badges.${A}.text.content`,content:{_flexArray:null,_check:an},color:{_flexArray:to,_check:sr},font:{_flexArray:Pn,_check:Si},style:{_flexArray:"normal",_check:Li},scale:{_flexArray:.5,_check:ct(.5)},paddingLeft:{_flexArray:0,_check:Xn},paddingTop:{_flexArray:0,_check:Xn}}}}var To={x:{_flexArray:0,_check:Xn,_disableMemoryOptimization:!0},y:{_flexArray:0,_check:Xn,_disableMemoryOptimization:!0},radius:{_flexArray:5,_check:uo},scalingMethod:{_flexArray:"scaled",_check:vn},color:{_flexArray:Hn,_check:function ex(A,w){if(w.parseColor(A))return A;if(Array.isArray(A)){if(A.length<1)return;for(let T=0;T<A.length;++T)if(!w.parseColor(A[T]))return;return A}}},opacity:{_flexArray:1,_check:It},shape:{_flexArray:"circle",_check:function jy(A){return"equilateral"===A?"pentagon":"circle"===A||"square"===A||"cross"===A||"diamond"===A||"pentagon"===A||"star"===A?A:void 0}},layer:{_flexArray:0,_check:Th},detectable:{_flexArray:!0,_check:Jt},draggable:{_flexArray:!0,_check:Jt},layoutable:{_flexArray:!0,_check:Jt},innerStroke:{_alias:"innerStroke.color",width:{_flexArray:2,_check:mo},scalingMethod:{_flexArray:"fixed",_check:vn},color:{_flexArray:Wn,_check:sr},minVisibleSize:{_flexArray:12,_check:ct(12)}},outerStroke:{_alias:"outerStroke.color",width:{_flexArray:5,_check:po},scalingMethod:{_flexArray:"fixed",_check:vn},color:{_flexArray:null,_check:sr},minVisibleSize:{_flexArray:0,_check:ct(0)}},badges:{_check:function Ky(A){return null===A?A:void 0},_set(A,w,T){A.badges.topLeft.text.content.set(w,T),A.badges.topLeft.image.url.set(w,T),A.badges.topRight.text.content.set(w,T),A.badges.topRight.image.url.set(w,T),A.badges.bottomLeft.text.content.set(w,T),A.badges.bottomLeft.image.url.set(w,T),A.badges.bottomRight.text.content.set(w,T),A.badges.bottomRight.image.url.set(w,T)},topLeft:Uh("topLeft"),topRight:Uh("topRight"),bottomLeft:Uh("bottomLeft"),bottomRight:Uh("bottomRight")},halo:{_alias:"halo.color",color:{_flexArray:null,_check:Nn},width:{_flexArray:40,_check:Ao},scalingMethod:{_flexArray:"fixed",_check:vn},strokeColor:{_flexArray:null,_check:Nn},strokeWidth:{_flexArray:1,_check:So},clustering:{_flexArray:!1,_check:Jt},hideNonAdjacentEdges:{_flexArray:!1,_check:Jt}},pulse:{enabled:{_flexArray:!1,_check:Jt},duration:{_flexArray:1e3,_check:It},interval:{_flexArray:800,_check:It},startColor:{_flexArray:ao,_check:sr},endColor:{_flexArray:so,_check:sr},width:{_flexArray:50,_check:It},startRatio:{_flexArray:1,_check:It},endRatio:{_flexArray:2,_check:It}},icon:{_alias:"icon.content",content:{_flexArray:null,_check:an},font:{_flexArray:Pn,_check:Si},color:{_flexArray:io,_check:Nn},scale:{_flexArray:.7,_check:ct(.7)},style:{_flexArray:"normal",_check:Li},minVisibleSize:{_flexArray:ho,_check:ct(ho)}},image:{_alias:"image.url",url:{_flexArray:null,_check:an},scale:{_flexArray:1,_check:ct(1)},fit:{_flexArray:!0,_check:Jt},tile:{_flexArray:!1,_check:Jt},minVisibleSize:{_flexArray:ho,_check:ct(ho)}},outline:{_alias:"outline.enabled",enabled:{_flexArray:!1,_check:Jt},color:{_flexArray:qn,_check:Nn},minVisibleSize:{_flexArray:ho,_check:ct(ho)}},text:{_alias:"text.content",content:{_flexArray:null,_check:an},font:{_flexArray:Pn,_check:Si},color:{_flexArray:Dn,_check:sr},size:{_flexArray:12,_check:go},scale:{_flexArray:.1,_check:It},style:{_flexArray:"normal",_check:Li},align:{_flexArray:"center",_check:Ts},margin:{_flexArray:7,_check:xo},padding:{_flexArray:2,_check:yo},backgroundColor:{_flexArray:null,_check:sr},tip:{_flexArray:!0,_check:Jt},minVisibleSize:{_flexArray:24,_check:ct(24)},scaling:{_flexArray:!1,_check:Jt},position:{_flexArray:"bottom",_check:function Jy(A){return"top"===A||"bottom"===A||"left"===A||"right"===A||"center"===A?A:void 0}},maxLineLength:{_flexArray:0,_check:It},truncateLength:{_flexArray:0,_check:It},secondary:{_alias:"text.secondary.content",content:{_flexArray:null,_check:an},font:{_flexArray:Pn,_check:Si},color:{_flexArray:Dn,_check:sr},size:{_flexArray:10,_check:co},scale:{_flexArray:.08,_check:It},style:{_flexArray:"normal",_check:Li},align:{_flexArray:"center",_check:Ts},margin:{_flexArray:5,_check:vo},padding:{_flexArray:2,_check:yo},backgroundColor:{_flexArray:null,_check:sr},minVisibleSize:{_flexArray:24,_check:ct(24)}}}},Lo="scaled",ko="grey",Mo="line",Fo="plain",zo="inherit",Do="fixed",Ro="fixed",Bo="rgba(0, 0, 0, 0.6)",Vo="rgba(0, 0, 0, 0)",Xo="rgba(0, 0, 0, 0.36)",Yo="normal",qo="center",Jo=zn;var Ko={width:{_flexArray:1,_check:ct(1)},scalingMethod:{_flexArray:Lo,_check:vn},color:{_flexArray:ko,_check:function qy(A,w){return"source"===A||"target"===A||w.parseColor(A)?A:void 0}},opacity:{_flexArray:1,_check:It},minVisibleSize:{_flexArray:0,_check:It},layer:{_flexArray:0,_check:Th},detectable:{_flexArray:true,_check:Jt},curvature:{_flexArray:0,_check:Xn},adjustAnchors:{_flexArray:true,_check:Jt},shape:{_check:function Zy(A){return["line","tapered","arrow","dashed","dotted"].includes(A)?A:void 0},_set:function US(A,w,T){let C,k,N,O;"line"===T?(C="line",k="plain",N=null,O=null):"arrow"===T?(C="line",k="plain",N="arrow",O=null):"tapered"===T?(C="triangle",k="plain",N=null,O=null):"dashed"===T?(C="line",k="dashed",N=null,O=null):"dotted"===T&&(C="line",k="dotted",N=null,O=null),A.shape.body.set(w,C),A.shape.style.set(w,k),A.shape.head.set(w,N),A.shape.tail.set(w,O)},type:"shape.body",body:{_flexArray:Mo,_check:function $y(A){return"line"===A||"triangle"===A?A:void 0}},head:{_flexArray:null,_check:pf},tail:{_flexArray:null,_check:pf},style:{_flexArray:Fo,_check:function Qy(A){return"plain"===A||"dashed"===A||"dotted"===A?A:void 0}}},stroke:{color:{_flexArray:zo,_check:sr},width:{_flexArray:0,_check:ct(0)},scalingMethod:{_flexArray:Do,_check:vn},minVisibleSize:{_flexArray:0,_check:It}},strokeWidth:"stroke.width",halo:{_alias:"halo.color",color:{_flexArray:null,_check:Nn},width:{_flexArray:10,_check:ct(10)},scalingMethod:{_flexArray:Ro,_check:vn},size:"halo.width"},pulse:{enabled:{_flexArray:!1,_check:Jt},duration:{_flexArray:1e3,_check:It},interval:{_flexArray:800,_check:It},startColor:{_flexArray:Bo,_check:sr},endColor:{_flexArray:Vo,_check:sr},width:{_flexArray:10,_check:It},startRatio:{_flexArray:1,_check:It},endRatio:{_flexArray:2,_check:It}},outline:{_alias:"outline.enabled",enabled:{_flexArray:!1,_check:Jt},color:{_flexArray:Xo,_check:Nn},minVisibleSize:{_flexArray:0,_check:It}},text:{_alias:"text.content",content:{_flexArray:null,_check:an},font:{_flexArray:Pn,_check:Si},color:{_flexArray:Dn,_check:Nn},size:{_flexArray:12,_check:ct(12)},scale:{_flexArray:1,_check:It},style:{_flexArray:Yo,_check:Li},align:{_flexArray:qo,_check:Ts},margin:{_flexArray:2,_check:Xn},padding:{_flexArray:2,_check:ct(2)},backgroundColor:{_flexArray:null,_check:sr},minVisibleSize:{_flexArray:4,_check:It},position:{_flexArray:Jo,_check:function Yy(A){return"centered"===A||A===zn?A:void 0}},adjustAngle:{_flexArray:true,_check:Jt},scaling:{_flexArray:!1,_check:Jt},maxLineLength:{_flexArray:0,_check:It},secondary:{_alias:"text.secondary.content",content:{_flexArray:null,_check:an},font:{_flexArray:Pn,_check:Si},color:{_flexArray:Dn,_check:Nn},size:{_flexArray:12,_check:ct(12)},scale:{_flexArray:.08,_check:It},style:{_flexArray:Bn,_check:Li},align:{_flexArray:jn,_check:Ts},margin:{_flexArray:2,_check:Xn},padding:{_flexArray:2,_check:ct(2)},backgroundColor:{_flexArray:null,_check:sr},minVisibleSize:{_flexArray:4,_check:It}}}},ea=[A=>(w,T)=>w[A].get(T),(A,w)=>(T,C)=>T[A][w].get(C),(A,w,T)=>(C,k)=>C[A][w][T].get(k),(A,w,T,C)=>(k,N)=>k[A][w][T][C].get(N)],ia=[A=>(w,T,C)=>w[A].set(T,C),(A,w)=>(T,C,k)=>T[A][w].set(C,k),(A,w,T)=>(C,k,N)=>C[A][w][T].set(k,N),(A,w,T,C)=>(k,N,O)=>k[A][w][T][C].set(N,O)];function cx(A,w){if(!A._check)throw new Error(`error somewhere for ${w}`);let T=w.split("."),C=T.length-1,k=ea[C].apply(null,T),N=ia[C].apply(null,T);return{check:A._check,set:N,get:k,nested:{}}}var Nm=A=>(w,T)=>({url:w.badges[A].image.url.get(T),scale:w.badges[A].image.scale.get(T)}),Tm=A=>(w,T)=>({color:w.badges[A].stroke.color.get(T),width:w.badges[A].stroke.width.get(T),scalingMethod:w.badges[A].stroke.scalingMethod.get(T)}),Sm=A=>(w,T)=>({content:w.badges[A].text.content.get(T),color:w.badges[A].text.color.get(T),font:w.badges[A].text.font.get(T),style:w.badges[A].text.style.get(T),scale:w.badges[A].text.scale.get(T),paddingLeft:w.badges[A].text.paddingLeft.get(T),paddingTop:w.badges[A].text.paddingTop.get(T)}),Lm=A=>(w,T)=>({color:w.badges[A].color.get(T),scale:w.badges[A].scale.get(T),positionScale:w.badges[A].positionScale.get(T),minVisibleSize:w.badges[A].minVisibleSize.get(T),image:{url:w.badges[A].image.url.get(T),scale:w.badges[A].image.scale.get(T)},stroke:{color:w.badges[A].stroke.color.get(T),width:w.badges[A].stroke.width.get(T),scalingMethod:w.badges[A].stroke.scalingMethod.get(T)},text:{content:w.badges[A].text.content.get(T),color:w.badges[A].text.color.get(T),font:w.badges[A].text.font.get(T),style:w.badges[A].text.style.get(T),scale:w.badges[A].text.scale.get(T),paddingLeft:w.badges[A].text.paddingLeft.get(T),paddingTop:w.badges[A].text.paddingTop.get(T)}}),sa={topLeft:Lm("topLeft"),topRight:Lm("topRight"),bottomLeft:Lm("bottomLeft"),bottomRight:Lm("bottomRight")},na={stroke:(A,w)=>({color:A.stroke.color.get(w),width:A.stroke.width.get(w),scalingMethod:A.stroke.scalingMethod.get(w),minVisibleSize:A.stroke.minVisibleSize.get(w)}),innerStroke:(A,w)=>({width:A.innerStroke.width.get(w),scalingMethod:A.innerStroke.scalingMethod.get(w),color:A.innerStroke.color.get(w),minVisibleSize:A.innerStroke.minVisibleSize.get(w)}),outerStroke:(A,w)=>({width:A.outerStroke.width.get(w),scalingMethod:A.outerStroke.scalingMethod.get(w),color:A.outerStroke.color.get(w),minVisibleSize:A.outerStroke.minVisibleSize.get(w)}),pulse:(A,w)=>({enabled:A.pulse.enabled.get(w),duration:A.pulse.duration.get(w),interval:A.pulse.interval.get(w),startColor:A.pulse.startColor.get(w),endColor:A.pulse.endColor.get(w),width:A.pulse.width.get(w),startRatio:A.pulse.startRatio.get(w),endRatio:A.pulse.endRatio.get(w)}),outline:(A,w)=>({enabled:A.outline.enabled.get(w),color:A.outline.color.get(w),minVisibleSize:A.outline.minVisibleSize.get(w)}),halo:(A,w)=>({color:A.halo.color.get(w),width:A.halo.width.get(w),scalingMethod:A.halo.scalingMethod.get(w),strokeColor:A.halo.strokeColor.get(w),strokeWidth:A.halo.strokeWidth.get(w),clustering:A.halo.clustering.get(w),hideNonAdjacentEdges:A.halo.hideNonAdjacentEdges.get(w)}),"text.secondary":(A,w)=>({content:A.text.secondary.content.get(w),font:A.text.secondary.font.get(w),color:A.text.secondary.color.get(w),size:A.text.secondary.size.get(w),scale:A.text.secondary.scale.get(w),style:A.text.secondary.style.get(w),align:A.text.secondary.align.get(w),margin:A.text.secondary.margin.get(w),padding:A.text.secondary.padding.get(w),backgroundColor:A.text.secondary.backgroundColor.get(w),minVisibleSize:A.text.secondary.minVisibleSize.get(w)}),text:(A,w)=>({content:A.text.content.get(w),font:A.text.font.get(w),color:A.text.color.get(w),size:A.text.size.get(w),scale:A.text.scale.get(w),style:A.text.style.get(w),align:A.text.align.get(w),margin:A.text.margin.get(w),padding:A.text.padding.get(w),backgroundColor:A.text.backgroundColor.get(w),tip:A.text.tip.get(w),minVisibleSize:A.text.minVisibleSize.get(w),scaling:A.text.scaling.get(w),position:A.text.position.get(w),maxLineLength:A.text.maxLineLength.get(w),truncateLength:A.text.truncateLength.get(w),secondary:na["text.secondary"](A,w)}),image:(A,w)=>({url:A.image.url.get(w),scale:A.image.scale.get(w),fit:A.image.fit.get(w),tile:A.image.tile.get(w),minVisibleSize:A.image.minVisibleSize.get(w)}),icon:(A,w)=>({content:A.icon.content.get(w),font:A.icon.font.get(w),color:A.icon.color.get(w),scale:A.icon.scale.get(w),style:A.icon.style.get(w),minVisibleSize:A.icon.minVisibleSize.get(w)}),badges:(A,w)=>({topLeft:sa.topLeft(A,w),topRight:sa.topRight(A,w),bottomLeft:sa.bottomLeft(A,w),bottomRight:sa.bottomRight(A,w)}),"badges.topLeft":sa.topLeft,"badges.topRight":sa.topRight,"badges.bottomLeft":sa.bottomLeft,"badges.bottomRight":sa.bottomRight,"badges.topLeft.image":Nm("topLeft"),"badges.topLeft.stroke":Tm("topLeft"),"badges.topLeft.text":Sm("topLeft"),"badges.topRight.image":Nm("topRight"),"badges.topRight.stroke":Tm("topRight"),"badges.topRight.text":Sm("topRight"),"badges.bottomLeft.image":Nm("bottomLeft"),"badges.bottomLeft.stroke":Tm("bottomLeft"),"badges.bottomLeft.text":Sm("bottomLeft"),"badges.bottomRight.image":Nm("bottomRight"),"badges.bottomRight.stroke":Tm("bottomRight"),"badges.bottomRight.text":Sm("bottomRight"),all:(A,w)=>({x:A.x.get(w),y:A.y.get(w),radius:A.radius.get(w),scalingMethod:A.scalingMethod.get(w),color:A.color.get(w),opacity:A.opacity.get(w),shape:A.shape.get(w),layer:A.layer.get(w),detectable:A.detectable.get(w),draggable:A.draggable.get(w),layoutable:A.layoutable.get(w),innerStroke:na.innerStroke(A,w),outerStroke:na.outerStroke(A,w),badges:na.badges(A,w),halo:na.halo(A,w),pulse:na.pulse(A,w),icon:na.icon(A,w),image:na.image(A,w),outline:na.outline(A,w),text:na.text(A,w)})},oa={shape:(A,w)=>({body:A.shape.body.get(w),head:A.shape.head.get(w),tail:A.shape.tail.get(w),style:A.shape.style.get(w)}),"text.secondary":(A,w)=>({content:A.text.secondary.content.get(w),font:A.text.secondary.font.get(w),color:A.text.secondary.color.get(w),size:A.text.secondary.size.get(w),scale:A.text.secondary.scale.get(w),style:A.text.secondary.style.get(w),align:A.text.secondary.align.get(w),margin:A.text.secondary.margin.get(w),padding:A.text.secondary.padding.get(w),backgroundColor:A.text.secondary.backgroundColor.get(w),minVisibleSize:A.text.secondary.minVisibleSize.get(w)}),text:(A,w)=>({content:A.text.content.get(w),font:A.text.font.get(w),color:A.text.color.get(w),size:A.text.size.get(w),scale:A.text.scale.get(w),style:A.text.style.get(w),align:A.text.align.get(w),margin:A.text.margin.get(w),padding:A.text.padding.get(w),position:A.text.position.get(w),backgroundColor:A.text.backgroundColor.get(w),minVisibleSize:A.text.minVisibleSize.get(w),adjustAngle:A.text.adjustAngle.get(w),scaling:A.text.scaling.get(w),maxLineLength:A.text.maxLineLength.get(w),secondary:oa["text.secondary"](A,w)}),outline:(A,w)=>({enabled:A.outline.enabled.get(w),color:A.outline.color.get(w),minVisibleSize:A.outline.minVisibleSize.get(w)}),pulse:(A,w)=>({enabled:A.pulse.enabled.get(w),duration:A.pulse.duration.get(w),interval:A.pulse.interval.get(w),startColor:A.pulse.startColor.get(w),endColor:A.pulse.endColor.get(w),width:A.pulse.width.get(w),startRatio:A.pulse.startRatio.get(w),endRatio:A.pulse.endRatio.get(w)}),stroke:(A,w)=>({color:A.stroke.color.get(w),width:A.stroke.width.get(w),scalingMethod:A.stroke.scalingMethod.get(w),minVisibleSize:A.stroke.minVisibleSize.get(w)}),halo:(A,w)=>({color:A.halo.color.get(w),width:A.halo.width.get(w),scalingMethod:A.halo.scalingMethod.get(w)}),all:(A,w)=>({width:A.width.get(w),scalingMethod:A.scalingMethod.get(w),color:A.color.get(w),opacity:A.opacity.get(w),minVisibleSize:A.minVisibleSize.get(w),layer:A.layer.get(w),detectable:A.detectable.get(w),curvature:A.curvature.get(w),adjustAnchors:A.adjustAnchors.get(w),shape:oa.shape(A,w),stroke:oa.stroke(A,w),halo:oa.halo(A,w),pulse:oa.pulse(A,w),outline:oa.outline(A,w),text:oa.text(A,w)})};function Nf(A,w,T,C=!0){if(void 0!==(w=w||A)._flexArray)return cx(w,T);let k={check:ur,get:Ze,set:Ze,nested:{}};if(Eo(w)||w._alias){let T=Eo(w)?w:w._alias;k=cx(Tt(A,T),T)}else{if(w._set?(k.set=w._set,k.check=w._check):(k.set=Ze,k.check=Ze),w._get)k.get=w._get;else{let A=C?na:oa;k.get=A[T||"all"]}k.nested={}}if(!Eo(w)){let N=Object.keys(w);for(let O of N){let N=w[O];O.startsWith("_")||(k.nested[O]=Nf(A,N,T?T+"."+O:O,C))}}return k}var aa=Nf(To,void 0,void 0,!0),la=Nf(Ko,void 0,void 0,!1),ha={name:"animationStart",storage:32,default:0},ua={name:"animationDuration",storage:16,default:0},ga={name:"animationEasing",storage:"resource",default:"linear"},ca={self:{attributes:"all",tags:[],selection:!0,hover:!1,data:!0},adjacentNodes:{attributes:"all",tags:[],selection:!0,hover:!1,data:!0},adjacentEdges:{attributes:"all",tags:[],selection:!0,hover:!1,data:!0},allNodes:void 0,allEdges:void 0},_a={self:{attributes:"all",tags:[],selection:!0,hover:!1,data:!0},extremities:{attributes:"all",tags:[],selection:!0,hover:!1,data:!0},parallelEdges:{attributes:"all",tags:[],selection:!0,hover:!1,data:!0},allNodes:void 0,allEdges:void 0},ma={x:1,y:1,radius:1,"halo.hideNonAdjacentEdges":1},fa={};Ua(fa,{cubicIn:()=>tL,cubicInOut:()=>nL,cubicOut:()=>rL,linear:()=>Cs,quadraticIn:()=>QS,quadraticInOut:()=>eL,quadraticOut:()=>JS});var Cs=A=>A,QS=A=>A*A,JS=A=>A*(2-A),eL=A=>(A*=2)<1?.5*A*A:-.5*(--A*(A-2)-1),tL=A=>A*A*A,rL=A=>--A*A*A+1,nL=A=>(A*=2)<1?.5*A*A*A:.5*((A-=2)*A*A+2),pa=[];function Tf(A){let w=pa;return void 0===A.output?("function"==typeof A.attributes&&(w="all"),wt(A.attributes)&&(w=Rn(A.attributes))):A.output&&(w=A.output.attributes),Im(w,A.allAttributePaths)}function un(A,w,T,C,k,N){(function oL(A,w,T,C){if(C>T)for(let T of w.attributes)for(let w of A.attributes)if(w===T)return!0;for(let T of w.tags)for(let w of A.tags)if(T===w)return!0;return!1})(T,C,k,N)&&A.push(w)}function Tn(A,w,T){if(!w)return{attributes:[],tags:[]};if(!0===A)return{attributes:[],tags:[Kt]};let C={attributes:Im((A=A||{}).attributes,T),tags:dL(A.tags)};return A.data&&C.tags.push(ei),A.selection&&C.tags.push(ri),A.hover&&C.tags.push(ti),C}function sL(A){return Array.isArray(A)?A.join("."):A}function Im(A,w){if("all"===A)return w.slice();if(!Array.isArray(A))return[];let T=function aL(A){return A.map(sL).filter(Eo)}(A);return w?w.filter((A=>T.some((w=>A.startsWith(w))))):T}function dL(A){return Array.isArray(A)?A.filter(Eo):[]}function Dx(A,w=[],T=""){return A.constructor===Yt?A.isInitialized()&&w.push(T):A.constructor===Object&&Object.keys(A).forEach((C=>{Dx(A[C],w,T?T+"."+C:C)})),w}var xa=class{constructor(A,w,T,C){this._updatedAttributes=new Set,this._updatedAttributesTmp=new Set,this._allUsedAttributes=new Set,this._colorManager=w,this._graph=A,this._eltName=T?"node":"edge",this._accessors=T?aa:la,this._createFlexArrays=C;let k=this._createFlexArrays(A,{original:!0,useDefaultValues:!0});this._finalFlexArrays=k;let N=this._createFlexArrays(A,{original:!1,useDefaultValues:!0});this._prevFlexArrays=N;let O=this._createFlexArrays(A,{original:!1,useDefaultValues:!0});this._defaultFlexArrays=O,this._currentFlexArrays=this._defaultFlexArrays,this.setLastFlexArrays(this._defaultFlexArrays),this._elementsToRedraw=new Fn({graph:A,isNode:T,includeRemovedElements:!0}),this._elementsUpdated=new Fn({graph:A,isNode:T,includeRemovedElements:!1}),this._finalFlexArraysWrapped=re(ke(re({},this._finalFlexArrays),{excluded:A.getAttribute(T,"excluded"),textHidden:A.getAttribute(T,"textHidden"),animationStart:A.createAttribute(T,ha),animationDuration:A.createAttribute(T,ua),animationEasing:A.createAttribute(T,ga),id:this._graph.getAttribute(T,"id")}),!T&&{source:A.getEdgeAttribute("source"),target:A.getEdgeAttribute("target")})}clear(){this._elementsToRedraw.clear(),this._elementsUpdated.clear(),this._updatedAttributes.clear(),this._updatedAttributesTmp.clear()}getAttributeFlexArrays(){return this._finalFlexArraysWrapped}getPrevAttributeFlexArrays(){return this._prevFlexArrays}getAnimationInformation(A){let w=A._indexes,T=Array(w.length),C=this._finalFlexArraysWrapped;for(let A=0;A<w.length;A++){let k=w[A];T[A]={duration:C.animationDuration.get(k),start:C.animationStart.get(k),easing:C.animationEasing.get(k)}}return T}setDefaultAttributes(A){Rn(A).forEach((w=>{let T=Tt(this._currentFlexArrays,w),C=Tt(this._currentFlexArrays,w),k=Tt(this._defaultFlexArrays,w),N=Tt(this._finalFlexArrays,w);if(!T)return;let O=Tt(A,w);T.setDefaultValue(O),k.setDefaultValue(O),C.setDefaultValue(O),N.setDefaultValue(O)})),this.redrawAll()}startUpdate(){}prepareFlexArraysUpdate(A){this._currentFlexArrays=A.inputFlexArrays}setLastFlexArrays(A){this._lastFlexArrays=A}updateFlexArrays(A){let{attributes:w,selector:T,context:C,outputFlexArrays:k,toUpdate:N,formattedOutput:O}=A;this._elementsUpdated.addSet(N),this._elementsToRedraw.addSet(N);let j=N.getListAndClear();if(w&&j.size){let{valid:N,invalid:G}=Cc(this._graph,j,T,C);for(let A of O.attributes){let w=Tt(k,A);for(let A=0;A<G._indexes.length;A++){let T=G._indexes[A];w.set(T,void 0)}}this._assignAttributesToFlexArrays(this._accessors,k,N,w,C),this._addUpdatedAttributes(A)}}endUpdate(){let A=this._elementsUpdated.getList(),w=ds(this._updatedAttributesTmp);for(let T of w){let w=Tt(this._lastFlexArrays,T),C=Tt(this._finalFlexArrays,T);for(let T=0;T<A._indexes.length;T++){let k=A._indexes[T];C.set(k,w.get(k))}}this._updatedAttributesTmp.clear(),this._currentFlexArrays=this._finalFlexArrays}setAttributeValues(A,w,T,C,k){let N=A.outputFlexArrays,O=this._accessors;this._assignAttributesToFlexArrays(O,N,w,T,null),this._addUpdatedAttributes(A,C),this._elementsUpdated.add(w),this._elementsToRedraw.add(w)}notifyLayerDestroyed(A){this._addUpdatedAttributes(A)}_addUpdatedAttributes(A,w){let{outputFlexArrays:T,formattedOutput:C}=A,k=Array.isArray(w)?Im(w):C.attributes;for(let A of k)Tt(T,A).isInitialized()&&(this._updatedAttributes.add(A),this._updatedAttributesTmp.add(A),this._allUsedAttributes.add(A))}addUpdatedAttribute(A){this._updatedAttributes.add(A),this._updatedAttributesTmp.add(A),this._allUsedAttributes.add(A)}getUsedAttributeNames(A){return Dx(A.outputFlexArrays)}redrawElements(A){this._elementsToRedraw.add(A)}redrawAll(){this._elementsToRedraw.addAll()}getAndResetElementsToRedraw(){return this._elementsToRedraw.getListAndClear()}getAndResetElementsUpdated(){return this._elementsUpdated.getListAndClear()}getAndResetAttributesUpdated(){let A=ds(this._updatedAttributes);return this._updatedAttributes.clear(),A}getUpdatedAttributes(){return this._updatedAttributes}getUpdatedElementsList(){return this._elementsUpdated.getList()}getUpdatedAttributesSet(){return new Set(this._updatedAttributes)}createFlexArrays(){return this._createFlexArrays(this._graph,{original:!1,useDefaultValues:!1})}getAttributeValues(A,w,T,C){let k=C?this._prevFlexArrays:this._currentFlexArrays;return T?this._getMultipleAttributeValues(A,w,k):this._getSingleAttributeValues(A,w,k)}_getAccessor(A=""){let w=this._accessors,T=Br(A);for(let A of T)if(w=w.nested[A],!w)throw new Error(`${this._eltName} attribute "${T.join("")}" does not exist`);return w}_getSingleAttributeValues(A,w,T){let C=this._getAccessor(w),k=A._indexes,N=Array(k.length);for(let A=0;A<k.length;A++)N[A]=C.get(T,k[A]);return N}_getMultipleAttributeValues(A,w,T){if(!w||"all"===w)return this._getSingleAttributeValues(A,"",T);let C=Array(A.size);for(let A=0;A<C.length;++A)C[A]={};for(let k=0;k<w.length;k++){let N=w[k],O=this._getSingleAttributeValues(A,N,T);for(let A=0;A<C.length;++A){Nr(C[A],N,O[A])}}return C}setAnimationAttributes(A,{duration:w,startTime:T,easing:C}){let k=A._indexes,N=this._finalFlexArraysWrapped,O=N.animationDuration,j=N.animationStart,G=N.animationEasing,H=ds(this._allUsedAttributes);if(w){let A=!1;for(let w of H){if("x"===w||"y"===w){A=!0;continue}let T=Tt(this._finalFlexArrays,w),C=Tt(this._prevFlexArrays,w);for(let A=0;A<k.length;A++){let w=k[A];C.set(w,T.get(w))}}if(A){let A=Ut(),w=this._finalFlexArrays.x,T=this._finalFlexArrays.y,C=this._prevFlexArrays.x,N=this._prevFlexArrays.y;for(let H=0;H<k.length;H++){let W=k[H],$=O.get(W);if($){let k=j.get(W),O=G.get(W),H=(fa[O]||Cs)(Math.min((A-k)/$,1)),Z=bc(C.get(W),w.get(W),H),se=bc(N.get(W),T.get(W),H);C.set(W,Z),N.set(W,se)}else C.set(W,w.get(W)),N.set(W,T.get(W))}}}O.fill(k,w),j.fill(k,T),G.fill(k,C)}resetAnimationAttributes(A){this._finalFlexArraysWrapped.animationDuration.fill(A._indexes,0)}getUsedAttributes(){return ds(this._allUsedAttributes)}getDefaultFlexArrays(){return this._defaultFlexArrays}_assignAttributesToFlexArrays(A,w,T,C,k,N=[]){if("function"==typeof C){let O=N.join(".");for(let j=0;j<T.size;++j){let G=T.get(j);if(G){let T=C(G,k,O);this._assignSingleValueToFlexArray(w,G,A,T,N)}}}else if(wt(C)){let O=Object.keys(C);for(let j=0;j<O.length;++j){let G=O[j];N.push(G);let H=this._getNestedAccessor(A,G,N),W=C[G];this._assignAttributesToFlexArrays(H,w,T,W,k,N),N.pop()}}else if((Array.isArray(C)||ArrayBuffer.isView(C))&&"color"!==N[0])if(0===N.length)for(let k=0;k<T.size;++k)this._assignSingleValueToFlexArray(w,T.get(k),A,C[k],N);else for(let k=0;k<T.size;++k){let N=T._indexes[k],O=A.check(C[k],this._colorManager);A.set(w,N,O)}else{let k=A.check(C,this._colorManager);for(let C=0;C<T.size;++C){let N=T.get(C);A.set(w,N._index,k)}}}_getNestedAccessor(A,w,T){let C=A.nested[w];if(!C)throw new Error(`${this._eltName} attribute "${T.join(".")}" does not exist`);return C}_assignSingleValueToFlexArray(A,w,T,C,k){if(wt(C)){let N=Object.keys(C);for(let O of N){k.push(O);let N=C[O],j=this._getNestedAccessor(T,O,k);this._assignSingleValueToFlexArray(A,w,j,N,k),k.pop()}}else{let k=T.check(C,this._colorManager);T.set(A,w._index,k)}}};function Ax(A,{original:w,useDefaultValues:T}){let C="resource";return{x:A.createAttribute(!0,{storage:"any",default:T?0:void 0,name:"x"},w),y:A.createAttribute(!0,{storage:"any",default:T?0:void 0,name:"y"},w),radius:A.createAttribute(!0,{storage:C,default:T?5:void 0,name:"radius"},w),scalingMethod:A.createAttribute(!0,{storage:C,default:T?"scaled":void 0,name:"scalingMethod"},w),color:A.createAttribute(!0,{storage:C,default:T?Hn:void 0,name:"color"},w),opacity:A.createAttribute(!0,{storage:C,default:T?1:void 0,name:"opacity"},w),shape:A.createAttribute(!0,{storage:C,default:T?"circle":void 0,name:"shape"},w),layer:A.createAttribute(!0,{storage:C,default:T?0:void 0,name:"layer"},w),detectable:A.createAttribute(!0,{storage:C,default:!!T||void 0,name:"detectable"},w),draggable:A.createAttribute(!0,{storage:C,default:!!T||void 0,name:"draggable"},w),layoutable:A.createAttribute(!0,{storage:C,default:!!T||void 0,name:"layoutable"},w),innerStroke:{width:A.createAttribute(!0,{storage:C,default:T?2:void 0,name:"innerStroke.width"},w),scalingMethod:A.createAttribute(!0,{storage:C,default:T?"fixed":void 0,name:"innerStroke.scalingMethod"},w),color:A.createAttribute(!0,{storage:C,default:T?Wn:void 0,name:"innerStroke.color"},w),minVisibleSize:A.createAttribute(!0,{storage:C,default:T?12:void 0,name:"innerStroke.minVisibleSize"},w)},outerStroke:{width:A.createAttribute(!0,{storage:C,default:T?5:void 0,name:"outerStroke.width"},w),scalingMethod:A.createAttribute(!0,{storage:C,default:T?"fixed":void 0,name:"outerStroke.scalingMethod"},w),color:A.createAttribute(!0,{storage:C,default:T?null:void 0,name:"outerStroke.color"},w),minVisibleSize:A.createAttribute(!0,{storage:C,default:T?0:void 0,name:"outerStroke.minVisibleSize"},w)},badges:{topLeft:{color:A.createAttribute(!0,{storage:C,default:T?Kn:void 0,name:"badges.topLeft.color"},w),scale:A.createAttribute(!0,{storage:C,default:T?.45:void 0,name:"badges.topLeft.scale"},w),positionScale:A.createAttribute(!0,{storage:C,default:T?1:void 0,name:"badges.topLeft.positionScale"},w),minVisibleSize:A.createAttribute(!0,{storage:C,default:T?12:void 0,name:"badges.topLeft.minVisibleSize"},w),image:{url:A.createAttribute(!0,{storage:C,default:T?null:void 0,name:"badges.topLeft.image.url"},w),scale:A.createAttribute(!0,{storage:C,default:T?1:void 0,name:"badges.topLeft.image.scale"},w)},stroke:{color:A.createAttribute(!0,{storage:C,default:T?eo:void 0,name:"badges.topLeft.stroke.color"},w),width:A.createAttribute(!0,{storage:C,default:T?2:void 0,name:"badges.topLeft.stroke.width"},w),scalingMethod:A.createAttribute(!0,{storage:C,default:T?"fixed":void 0,name:"badges.topLeft.stroke.scalingMethod"},w)},text:{content:A.createAttribute(!0,{storage:C,default:T?null:void 0,name:"badges.topLeft.text.content"},w),color:A.createAttribute(!0,{storage:C,default:T?to:void 0,name:"badges.topLeft.text.color"},w),font:A.createAttribute(!0,{storage:C,default:T?Pn:void 0,name:"badges.topLeft.text.font"},w),style:A.createAttribute(!0,{storage:C,default:T?"normal":void 0,name:"badges.topLeft.text.style"},w),scale:A.createAttribute(!0,{storage:C,default:T?.5:void 0,name:"badges.topLeft.text.scale"},w),paddingLeft:A.createAttribute(!0,{storage:C,default:T?0:void 0,name:"badges.topLeft.text.paddging.left"},w),paddingTop:A.createAttribute(!0,{storage:C,default:T?0:void 0,name:"badges.topLeft.text.paddging.top"},w)}},topRight:{color:A.createAttribute(!0,{storage:C,default:T?Kn:void 0,name:"badges.topRight.color"},w),scale:A.createAttribute(!0,{storage:C,default:T?.45:void 0,name:"badges.topRight.scale"},w),positionScale:A.createAttribute(!0,{storage:C,default:T?1:void 0,name:"badges.topRight.positionScale"},w),minVisibleSize:A.createAttribute(!0,{storage:C,default:T?12:void 0,name:"badges.topRight.minVisibleSize"},w),image:{url:A.createAttribute(!0,{storage:C,default:T?null:void 0,name:"badges.topRight.image.url"},w),scale:A.createAttribute(!0,{storage:C,default:T?1:void 0,name:"badges.topRight.image.scale"},w)},stroke:{color:A.createAttribute(!0,{storage:C,default:T?eo:void 0,name:"badges.topRight.stroke.color"},w),width:A.createAttribute(!0,{storage:C,default:T?2:void 0,name:"badges.topRight.stroke.width"},w),scalingMethod:A.createAttribute(!0,{storage:C,default:T?"fixed":void 0,name:"badges.topRight.stroke.scalingMethod"},w)},text:{content:A.createAttribute(!0,{storage:C,default:T?null:void 0,name:"badges.topRight.text.content"},w),color:A.createAttribute(!0,{storage:C,default:T?to:void 0,name:"badges.topRight.text.color"},w),font:A.createAttribute(!0,{storage:C,default:T?Pn:void 0,name:"badges.topRight.text.font"},w),style:A.createAttribute(!0,{storage:C,default:T?"normal":void 0,name:"badges.topRight.text.style"},w),scale:A.createAttribute(!0,{storage:C,default:T?.5:void 0,name:"badges.topRight.text.scale"},w),paddingTop:A.createAttribute(!0,{storage:C,default:T?0:void 0,name:"badges.topRight.text.paddging.left"},w),paddingLeft:A.createAttribute(!0,{storage:C,default:T?0:void 0,name:"badges.topRight.text.paddging.top"},w)}},bottomLeft:{color:A.createAttribute(!0,{storage:C,default:T?Kn:void 0,name:"badges.bottomLeft.color"},w),scale:A.createAttribute(!0,{storage:C,default:T?.45:void 0,name:"badges.bottomLeft.scale"},w),positionScale:A.createAttribute(!0,{storage:C,default:T?1:void 0,name:"badges.bottomLeft.positionScale"},w),minVisibleSize:A.createAttribute(!0,{storage:C,default:T?12:void 0,name:"badges.bottomLeft.minVisibleSize"},w),image:{url:A.createAttribute(!0,{storage:C,default:T?null:void 0,name:"badges.bottomLeft.image.url"},w),scale:A.createAttribute(!0,{storage:C,default:T?1:void 0,name:"badges.bottomLeft.image.scale"},w)},stroke:{color:A.createAttribute(!0,{storage:C,default:T?eo:void 0,name:"badges.bottomLeft.stroke.color"},w),width:A.createAttribute(!0,{storage:C,default:T?2:void 0,name:"badges.bottomLeft.stroke.width"},w),scalingMethod:A.createAttribute(!0,{storage:C,default:T?"fixed":void 0,name:w?"badges.bottomLeft.stroke.scalingMethod":void 0})},text:{content:A.createAttribute(!0,{storage:C,default:T?null:void 0,name:"badges.bottomLeft.text.content"},w),color:A.createAttribute(!0,{storage:C,default:T?to:void 0,name:"badges.bottomLeft.text.color"},w),font:A.createAttribute(!0,{storage:C,default:T?Pn:void 0,name:"badges.bottomLeft.text.font"},w),style:A.createAttribute(!0,{storage:C,default:T?"normal":void 0,name:"badges.bottomLeft.text.style"},w),scale:A.createAttribute(!0,{storage:C,default:T?.5:void 0,name:"badges.bottomLeft.text.scale"},w),paddingLeft:A.createAttribute(!0,{storage:C,default:T?0:void 0,name:"badges.bottomLeft.text.paddging.left"},w),paddingTop:A.createAttribute(!0,{storage:C,default:T?0:void 0,name:"badges.bottomLeft.text.paddging.top"},w)}},bottomRight:{color:A.createAttribute(!0,{storage:C,default:T?Kn:void 0,name:"badges.bottomRight.color"},w),scale:A.createAttribute(!0,{storage:C,default:T?.45:void 0,name:"badges.bottomRight.scale"},w),positionScale:A.createAttribute(!0,{storage:C,default:T?1:void 0,name:"badges.bottomRight.positionScale"},w),minVisibleSize:A.createAttribute(!0,{storage:C,default:T?12:void 0,name:"badges.bottomRight.minVisibleSize"},w),image:{url:A.createAttribute(!0,{storage:C,default:T?null:void 0,name:"badges.bottomRight.image.url"},w),scale:A.createAttribute(!0,{storage:C,default:T?1:void 0,name:"badges.bottomRight.image.scale"},w)},stroke:{color:A.createAttribute(!0,{storage:C,default:T?eo:void 0,name:"badges.bottomRight.stroke.color"},w),width:A.createAttribute(!0,{storage:C,default:T?2:void 0,name:"badges.bottomRight.stroke.width"},w),scalingMethod:A.createAttribute(!0,{storage:C,default:T?"fixed":void 0,name:w?"badges.bottomRight.stroke.scalingMethod":void 0})},text:{content:A.createAttribute(!0,{storage:C,default:T?null:void 0,name:"badges.bottomRight.text.content"},w),color:A.createAttribute(!0,{storage:C,default:T?to:void 0,name:"badges.bottomRight.text.color"},w),font:A.createAttribute(!0,{storage:C,default:T?Pn:void 0,name:"badges.bottomRight.text.font"},w),style:A.createAttribute(!0,{storage:C,default:T?"normal":void 0,name:"badges.bottomRight.text.style"},w),scale:A.createAttribute(!0,{storage:C,default:T?.5:void 0,name:"badges.bottomRight.text.scale"},w),paddingLeft:A.createAttribute(!0,{storage:C,default:T?0:void 0,name:"badges.bottomRight.text.paddging.left"},w),paddingTop:A.createAttribute(!0,{storage:C,default:T?0:void 0,name:"badges.bottomRight.text.paddging.top"},w)}}},halo:{color:A.createAttribute(!0,{storage:C,default:T?null:void 0,name:"halo.color"},w),width:A.createAttribute(!0,{storage:C,default:T?40:void 0,name:"halo.width"},w),scalingMethod:A.createAttribute(!0,{storage:C,default:T?"fixed":void 0,name:"halo.scalingMethod"},w),strokeColor:A.createAttribute(!0,{storage:C,default:T?null:void 0,name:"halo.strokeColor"},w),strokeWidth:A.createAttribute(!0,{storage:C,default:T?1:void 0,name:"halo.strokeWidth"},w),clustering:A.createAttribute(!0,{storage:C,default:!T&&void 0,name:"halo.clustering"},w),hideNonAdjacentEdges:A.createAttribute(!0,{storage:C,default:!T&&void 0,name:"halo.hideNonAdjacentEdges"},w)},pulse:{enabled:A.createAttribute(!0,{storage:C,default:!T&&void 0,name:"pulse.enabled"},w),duration:A.createAttribute(!0,{storage:C,default:T?1e3:void 0,name:"pulse.duration"},w),interval:A.createAttribute(!0,{storage:C,default:T?800:void 0,name:"pulse.interval"},w),startColor:A.createAttribute(!0,{storage:C,default:T?ao:void 0,name:"pulse.startColor"},w),endColor:A.createAttribute(!0,{storage:C,default:T?so:void 0,name:"pulse.endColor"},w),width:A.createAttribute(!0,{storage:C,default:T?50:void 0,name:"pulse.width"},w),startRatio:A.createAttribute(!0,{storage:C,default:T?1:void 0,name:"pulse.startRatio"},w),endRatio:A.createAttribute(!0,{storage:C,default:T?2:void 0,name:"pulse.endRatio"},w)},icon:{content:A.createAttribute(!0,{storage:C,default:T?null:void 0,name:"icon.content"},w),font:A.createAttribute(!0,{storage:C,default:T?Pn:void 0,name:"icon.font"},w),color:A.createAttribute(!0,{storage:C,default:T?io:void 0,name:"icon.color"},w),scale:A.createAttribute(!0,{storage:C,default:T?.7:void 0,name:"icon.scale"},w),style:A.createAttribute(!0,{storage:C,default:T?"normal":void 0,name:"icon.style"},w),minVisibleSize:A.createAttribute(!0,{storage:C,default:T?12:void 0,name:"icon.minVisibleSize"},w)},image:{url:A.createAttribute(!0,{storage:C,default:T?null:void 0,name:"image.url"},w),scale:A.createAttribute(!0,{storage:C,default:T?1:void 0,name:"image.scale"},w),fit:A.createAttribute(!0,{storage:C,default:!!T||void 0,name:"image.fit"},w),tile:A.createAttribute(!0,{storage:C,default:!T&&void 0,name:"image.tile"},w),minVisibleSize:A.createAttribute(!0,{storage:C,default:T?12:void 0,name:"image.minVisibleSize"},w)},outline:{enabled:A.createAttribute(!0,{storage:C,default:!T&&void 0,name:"outline.enabled"},w),color:A.createAttribute(!0,{storage:C,default:T?qn:void 0,name:"outline.color"},w),minVisibleSize:A.createAttribute(!0,{storage:C,default:T?12:void 0,name:"outline.minVisibleSize"},w)},text:{content:A.createAttribute(!0,{storage:C,default:T?null:void 0,name:"text.content"},w),font:A.createAttribute(!0,{storage:C,default:T?Pn:void 0,name:"text.font"},w),color:A.createAttribute(!0,{storage:C,default:T?Dn:void 0,name:"text.color"},w),size:A.createAttribute(!0,{storage:C,default:T?12:void 0,name:"text.size"},w),scale:A.createAttribute(!0,{storage:C,default:T?.1:void 0,name:"text.scale"},w),style:A.createAttribute(!0,{storage:C,default:T?"normal":void 0,name:"text.style"},w),align:A.createAttribute(!0,{storage:C,default:T?"center":void 0,name:"text.align"},w),margin:A.createAttribute(!0,{storage:C,default:T?7:void 0,name:"text.margin"},w),padding:A.createAttribute(!0,{storage:C,default:T?2:void 0,name:"text.padding"},w),backgroundColor:A.createAttribute(!0,{storage:C,default:T?null:void 0,name:"text.backgroundColor"},w),tip:A.createAttribute(!0,{storage:C,default:!!T||void 0,name:"text.tip"},w),minVisibleSize:A.createAttribute(!0,{storage:C,default:T?24:void 0,name:"text.minVisibleSize"},w),scaling:A.createAttribute(!0,{storage:C,default:!T&&void 0,name:"text.scaling"},w),position:A.createAttribute(!0,{storage:C,default:T?"bottom":void 0,name:"text.position"},w),maxLineLength:A.createAttribute(!0,{storage:C,default:T?0:void 0,name:"text.maxLineLength"},w),truncateLength:A.createAttribute(!0,{storage:C,default:T?0:void 0,name:"text.truncateLength"},w),secondary:{content:A.createAttribute(!0,{storage:C,default:T?null:void 0,name:"text.secondary.content"},w),font:A.createAttribute(!0,{storage:C,default:T?Pn:void 0,name:"text.secondary.font"},w),color:A.createAttribute(!0,{storage:C,default:T?Dn:void 0,name:"text.secondary.color"},w),size:A.createAttribute(!0,{storage:C,default:T?10:void 0,name:"text.secondary.size"},w),scale:A.createAttribute(!0,{storage:C,default:T?.08:void 0,name:"text.secondary.scale"},w),style:A.createAttribute(!0,{storage:C,default:T?"normal":void 0,name:"text.secondary.style"},w),align:A.createAttribute(!0,{storage:C,default:T?"center":void 0,name:"text.secondary.align"},w),margin:A.createAttribute(!0,{storage:C,default:T?5:void 0,name:"text.secondary.margin"},w),padding:A.createAttribute(!0,{storage:C,default:T?2:void 0,name:"text.secondary.padding"},w),backgroundColor:A.createAttribute(!0,{storage:C,default:T?null:void 0,name:"text.secondary.backgroundColor"},w),minVisibleSize:A.createAttribute(!0,{storage:C,default:T?24:void 0,name:"text.secondary.minVisibleSize"},w)}}}}function vx(A,{original:w,useDefaultValues:T}){let C="resource";return{width:A.createAttribute(!1,{storage:C,default:T?1:void 0,name:"width"},w),scalingMethod:A.createAttribute(!1,{storage:C,default:T?Lo:void 0,name:"scalingMethod"},w),color:A.createAttribute(!1,{storage:C,default:T?ko:void 0,name:"color"},w),opacity:A.createAttribute(!1,{storage:C,default:T?1:void 0,name:"opacity"},w),minVisibleSize:A.createAttribute(!1,{storage:C,default:T?0:void 0,name:"minVisibleSize"},w),layer:A.createAttribute(!1,{storage:C,default:T?0:void 0,name:"layer"},w),detectable:A.createAttribute(!1,{storage:C,default:!!T||void 0,name:"detectable"},w),curvature:A.createAttribute(!1,{storage:C,default:T?0:void 0,name:"curvature"},w),adjustAnchors:A.createAttribute(!1,{storage:C,default:!!T||void 0,name:"adjustAnchors"},w),shape:{body:A.createAttribute(!1,{storage:C,default:T?Mo:void 0,name:"shape.body"},w),head:A.createAttribute(!1,{storage:C,default:T?null:void 0,name:"shape.head"},w),tail:A.createAttribute(!1,{storage:C,default:T?null:void 0,name:"shape.tail"},w),style:A.createAttribute(!1,{storage:C,default:T?Fo:void 0,name:"shape.style"},w)},stroke:{color:A.createAttribute(!1,{storage:C,default:T?zo:void 0,name:"stroke.color"},w),width:A.createAttribute(!1,{storage:C,default:T?0:void 0,name:"stroke.width"},w),scalingMethod:A.createAttribute(!1,{storage:C,default:T?Do:void 0,name:"stroke.scalingMethod"},w),minVisibleSize:A.createAttribute(!1,{storage:C,default:T?0:void 0,name:"stroke.minVisibleSize"},w)},halo:{color:A.createAttribute(!1,{storage:C,default:T?null:void 0,name:"halo.color"},w),width:A.createAttribute(!1,{storage:C,default:T?10:void 0,name:"halo.width"},w),scalingMethod:A.createAttribute(!1,{storage:C,default:T?Ro:void 0,name:"halo.scalingMethod"},w)},pulse:{enabled:A.createAttribute(!1,{storage:C,default:!T&&void 0,name:"pulse.enabled"},w),duration:A.createAttribute(!1,{storage:C,default:T?1e3:void 0,name:"pulse.duration"},w),interval:A.createAttribute(!1,{storage:C,default:T?800:void 0,name:"pulse.interval"},w),startColor:A.createAttribute(!1,{storage:C,default:T?Bo:void 0,name:"pulse.startColor"},w),endColor:A.createAttribute(!1,{storage:C,default:T?Vo:void 0,name:"pulse.endColor"},w),width:A.createAttribute(!1,{storage:C,default:T?10:void 0,name:"pulse.width"},w),startRatio:A.createAttribute(!1,{storage:C,default:T?1:void 0,name:"pulse.startRatio"},w),endRatio:A.createAttribute(!1,{storage:C,default:T?2:void 0,name:"pulse.endRatio"},w)},outline:{enabled:A.createAttribute(!1,{storage:C,default:!T&&void 0,name:"outline.enabled"},w),color:A.createAttribute(!1,{storage:C,default:T?Xo:void 0,name:"outline.color"},w),minVisibleSize:A.createAttribute(!1,{storage:C,default:T?0:void 0,name:"outline.minVisibleSize"},w)},text:{content:A.createAttribute(!1,{storage:C,default:T?null:void 0,name:"text.content"},w),font:A.createAttribute(!1,{storage:C,default:T?Pn:void 0,name:"text.font"},w),color:A.createAttribute(!1,{storage:C,default:T?Dn:void 0,name:"text.color"},w),size:A.createAttribute(!1,{storage:C,default:T?12:void 0,name:"text.size"},w),scale:A.createAttribute(!1,{storage:C,default:T?1:void 0,name:"text.scale"},w),style:A.createAttribute(!1,{storage:C,default:T?Yo:void 0,name:"text.style"},w),align:A.createAttribute(!1,{storage:C,default:T?qo:void 0,name:"text.align"},w),margin:A.createAttribute(!1,{storage:C,default:T?2:void 0,name:"text.margin"},w),padding:A.createAttribute(!1,{storage:C,default:T?2:void 0,name:"text.padding"},w),position:A.createAttribute(!1,{storage:C,default:T?Jo:void 0,name:"text.position"},w),backgroundColor:A.createAttribute(!1,{storage:C,default:T?null:void 0,name:"text.backgroundColor"},w),minVisibleSize:A.createAttribute(!1,{storage:C,default:T?4:void 0,name:"text.minVisibleSize"},w),adjustAngle:A.createAttribute(!1,{storage:C,default:!!T||void 0,name:"text.adjustAngle"},w),scaling:A.createAttribute(!1,{storage:C,default:!T&&void 0,name:"text.scaling"},w),maxLineLength:A.createAttribute(!1,{storage:C,default:T?0:void 0,name:"text.maxLineLength"},w),secondary:{content:A.createAttribute(!1,{storage:C,default:T?null:void 0,name:"text.secondary.content"},w),font:A.createAttribute(!1,{storage:C,default:T?Pn:void 0,name:"text.secondary.font"},w),color:A.createAttribute(!1,{storage:C,default:T?Dn:void 0,name:"text.secondary.color"},w),size:A.createAttribute(!1,{storage:C,default:T?12:void 0,name:"text.secondary.size"},w),scale:A.createAttribute(!1,{storage:C,default:T?.08:void 0,name:"text.secondary.scale"},w),style:A.createAttribute(!1,{storage:C,default:T?Bn:void 0,name:"text.secondary.style"},w),align:A.createAttribute(!1,{storage:C,default:T?jn:void 0,name:"text.secondary.align"},w),margin:A.createAttribute(!1,{storage:C,default:T?2:void 0,name:"text.secondary.margin"},w),padding:A.createAttribute(!1,{storage:C,default:T?2:void 0,name:"text.secondary.padding"},w),backgroundColor:A.createAttribute(!1,{storage:C,default:T?null:void 0,name:"text.secondary.backgroundColor"},w),minVisibleSize:A.createAttribute(!1,{storage:C,default:T?4:void 0,name:"text.secondary.minVisibleSize"},w)}}}}var lL=(A,w)=>new class{constructor(A,w){this._attributesManager=A,this._id=w}getDefinition(){return this._attributesManager.getAttributeLayerDefinition(this._id)}update(A){this._attributesManager.updateAttributeLayer(this._id,A)}destroy(){this._attributesManager.destroyAttributeLayer(this._id)}updateElements(A){this._attributesManager.updateElementsForAttributeLayer(this._id,A)}updateAll(){this._attributesManager.updateAllForAttributeLayer(this._id)}setAttributeValues(A,w,T){this._attributesManager.setAttributeLayerValues(this._id,A,w,T)}getUsedAttributeNames(A){return this._attributesManager.getUsedAttributeLayerAttributes(this._id,A)}getFlexArrays(){return this._attributesManager.getAttributeLayerFlexArrays(this._id)}}(A,w);function hr(A,w,T=0){if("inherit"===A){if(!Array.isArray(w))return w;return w[((T/(2*Math.PI)*w.length|0)+1)%w.length]}return A}function Rm(A){let w=(A.depth-30)%6;return w>=0&&0!==w&&3!==w}function Cf(A,w,T,C){(function uL(A,w,T,C){let k=+("scaled"===T.scalingMethod.get(C)),N=2*T.radius.get(C),O=T.innerStroke.width.get(C),j=+("scaled"===T.innerStroke.scalingMethod.get(C)),G=T.outerStroke.width.get(C),H=+("scaled"===T.outerStroke.scalingMethod.get(C));w.x=T.x.get(C),w.y=T.y.get(C),w.shape=T.shape.get(C),w.color=T.color.get(C),w.opacity=T.opacity.get(C),w.diameterScaled=N*k,w.diameterFixed=N*(1-k),w.innerStroke.color=hr(T.innerStroke.color.get(C),w.color),w.innerStroke.widthScaled=O*j,w.innerStroke.widthFixed=O*(1-j),w.innerStroke.minVisibleSize=T.innerStroke.minVisibleSize.get(C),w.outerStroke.color=hr(T.outerStroke.color.get(C),w.color),w.outerStroke.widthScaled=G*H,w.outerStroke.widthFixed=G*(1-H),w.halo.color=T.halo.color.get(C),w.halo.strokeColor=T.halo.strokeColor.get(C),w.icon.content=A.formatText(T.icon.content.get(C)),w.image.url=T.image.url.get(C),w.outline.enabled=T.outline.enabled.get(C),w.textHidden=1===T.textHidden.get(C)})(A,w,T,C),Lx(A,w.texts.primary,T.text,C,w),Lx(A,w.texts.secondary,T.text.secondary,C,w),Fm(A,w.badges.topLeft,T.badges.topLeft,C),Fm(A,w.badges.topRight,T.badges.topRight,C),Fm(A,w.badges.bottomLeft,T.badges.bottomLeft,C),Fm(A,w.badges.bottomRight,T.badges.bottomRight,C)}function Lx(A,w,T,C,k){if(w.hidden=k.textHidden,w.content=A.formatText(T.content.get(C)),w.backgroundColor=hr(T.backgroundColor.get(C),k.color),w===k.texts.primary){let A=T;w.tip=A.tip.get(C),w.position=A.position.get(C)}else w.position="bottom"}function Fm(A,w,T,C){let k=T.text.content.get(C);w.textContent=A.formatText(k),w.imageUrl=T.image.url.get(C)}function Of(){return{x:0,y:0,shape:"",color:"",opacity:0,diameterScaled:0,diameterFixed:0,innerStroke:{color:"",widthScaled:0,widthFixed:0,minVisibleSize:0},outerStroke:{color:"",widthScaled:0,widthFixed:0,minVisibleSize:0},icon:{content:"",font:"",color:"",scale:0,size:0,style:"none",minVisibleSize:0},image:{url:"",content:null,scale:0,minVisibleSize:0},halo:{widthScaled:0,widthFixed:0,strokeWidthScaled:0,strokeWidthFixed:0,color:"",strokeColor:""},outline:{enabled:!1,color:"",minVisibleSize:0},badges:{topLeft:Mm(Wr),topRight:Mm(Xr),bottomLeft:Mm($r),bottomRight:Mm(Yr)},textHidden:!1,texts:{primary:{hidden:!1,content:"",position:"",backgroundColor:"",tip:!1,font:"",color:"",sizeScaled:0,sizeFixed:0,style:"none",align:"left",minVisibleSize:0,margin:0,padding:0,maxLineLength:0,widthScaled:0,widthFixed:0,heightScaled:0,heightFixed:0,positionAngle:0,isPositionCenter:!1,isPositionVertical:!1,isPositionHorizontal:!1},secondary:{hidden:!1,content:"",position:"",backgroundColor:"",tip:!1,font:"",color:"",sizeScaled:0,sizeFixed:0,style:"none",align:"left",minVisibleSize:0,margin:0,padding:0,maxLineLength:0,widthScaled:0,widthFixed:0,heightScaled:0,heightFixed:0,positionAngle:0,isPositionCenter:!1,isPositionVertical:!1,isPositionHorizontal:!1}}}}function Mm(A){return{angle:A,color:"",scale:0,positionScale:0,minVisibleSize:0,strokeColor:"",strokeWidthScaled:0,strokeWidthFixed:0,textContent:"",textFont:"",textColor:"",textScale:0,textStyle:"none",imageUrl:"",imageContent:null,imageScale:0,textPaddingLeft:0,textPaddingTop:0}}function Yn(A,w={edgeHalo:0,nodeHaloStroke:0,nodeHalo:0,edgeBody:0,edgeTextBackground:0,edgeText:0,nodeBody:0,nodeTextBackground:0,nodeText:0}){let T=6*(A- -100)+30;return w.edgeHalo=0,w.nodeHaloStroke=1,w.nodeHalo=2,w.edgeBody=T+0,w.edgeTextBackground=T+1,w.edgeText=T+2,w.nodeBody=T+3,w.nodeTextBackground=T+4,w.nodeText=T+5,w}function Pf(A,w){(function fL(A,w){A.body=!0,A.icon=!!w.icon.content,A.image=!!w.image.url,A.pieChart=Array.isArray(w.color),A.outerStroke=!!w.outerStroke.color,A.outline=!!w.outline.enabled,A.halo=!!w.halo.color,A.haloStroke=A.halo&&!!w.halo.strokeColor})(A,w),Cx(A.texts.primary,w.texts.primary),Cx(A.texts.secondary,w.texts.secondary),km(A.badges.topLeft,w.badges.topLeft),km(A.badges.topRight,w.badges.topRight),km(A.badges.bottomLeft,w.badges.bottomLeft),km(A.badges.bottomRight,w.badges.bottomRight)}function Cx(A,w){A.text=!w.hidden&&!!w.content,A.background=A.text&&!!w.backgroundColor,A.tip=A.background&&w.tip&&"center"!==w.position}function km(A,w){A.text=!!w.textContent,A.image=!!w.imageUrl}function No(A,w){A.pieceId=1,A.x1=w.x,A.y1=w.y,A.x2=w.x,A.y2=w.y,A.rectWidthOrSourceRadiusScaled=w.diameterScaled,A.rectWidthOrSourceRadiusFixed=w.diameterFixed,A.rectHeightOrTargetRadiusScaled=w.diameterScaled,A.rectHeightOrTargetRadiusFixed=w.diameterFixed,A.shape=w.shape,A.opacity=w.opacity,A.symbolicSize=w.diameterScaled,A.thicknessOrFontSizeScaled=0,A.thicknessOrFontSizeFixed=0,A.strokeWidthScaled=0,A.strokeWidthFixed=0,A.offsetScaled=0,A.offsetFixed=0,A.fillColor=null,A.strokeColor=null,A.globalMinVisibleSize=0,A.strokeMinVisibleSize=0,A.offsetAngle=0,A.curvature=0,A.dashLength=0,A.gapLength=0,A.hasHead=!1,A.hasTail=!1,A.isSelfLoop=!1,A.isText=!1}function Ux(A,w,T){let C=T.diameterScaled*w.scale,k=T.diameterFixed*w.scale,N=T.diameterScaled*w.positionScale/2,O=T.diameterFixed*w.positionScale/2;A.pieceId=1,A.shape="circle",A.x1=T.x,A.y1=T.y,A.x2=T.x,A.y2=T.y,A.rectWidthOrSourceRadiusScaled=C,A.rectWidthOrSourceRadiusFixed=k,A.rectHeightOrTargetRadiusScaled=C,A.rectHeightOrTargetRadiusFixed=k,A.thicknessOrFontSizeScaled=0,A.thicknessOrFontSizeFixed=0,A.strokeWidthScaled=w.strokeWidthScaled,A.strokeWidthFixed=w.strokeWidthFixed,A.offsetScaled=N,A.offsetFixed=O,A.pattern.type=0,A.opacity=T.opacity,A.fillColor=w.color,A.strokeColor=w.strokeColor,A.patternColor=null,A.globalMinVisibleSize=w.minVisibleSize,A.strokeMinVisibleSize=0,A.patternMinVisibleSize=0,A.offsetAngle=w.angle,A.patternScale=0,A.symbolicSize=T.diameterScaled,A.curvature=0,A.dashLength=0,A.gapLength=0,A.hasHead=!1,A.hasTail=!1,A.isSelfLoop=!1,A.isText=!1}function Xx(A,w,T){let C,k,N=0,O=0;if(w.isPositionCenter||(N+=T.diameterScaled/2,O+=T.diameterFixed/2+w.margin+w.padding),w.isPositionVertical){if(N+=w.heightScaled/2,O+=w.heightFixed/2,w===T.texts.secondary&&"bottom"===T.texts.primary.position){let A=T.texts.primary;N+=A.heightScaled,O+=A.heightFixed+A.margin+2*A.padding}}else w.isPositionHorizontal&&(N+=w.widthScaled/2,O+=w.widthFixed/2);C=-1,k=1,A.pieceId=1,A.shape="square",A.x1=T.x,A.y1=T.y,A.x2=T.x,A.y2=T.y,A.rectWidthOrSourceRadiusScaled=w.widthScaled,A.rectWidthOrSourceRadiusFixed=w.widthFixed+2*w.padding,A.rectHeightOrTargetRadiusScaled=w.heightScaled,A.rectHeightOrTargetRadiusFixed=w.heightFixed+2*w.padding,A.thicknessOrFontSizeScaled=0,A.thicknessOrFontSizeFixed=0,A.strokeWidthScaled=0,A.strokeWidthFixed=0,A.offsetScaled=N,A.offsetFixed=O,A.pattern.type=0,A.pattern.attributes.size=-1,A.opacity=T.opacity,A.fillColor=null,A.strokeColor=null,A.patternColor=null,A.globalMinVisibleSize=w.minVisibleSize,A.strokeMinVisibleSize=0,A.patternMinVisibleSize=0,A.offsetAngle=w.positionAngle,A.patternScale=1,A.symbolicSize=T.diameterScaled,A.curvature=0,A.dashLength=0,A.gapLength=0,A.hasHead=!1,A.hasTail=!1,A.isSelfLoop=!1,A.isText=!1}function wf(A,w,T,C,k,N){let O=k.badges,j=C.badges,G=N.badges;(function _L(A,w,T,C,k,N){if(k.halo){let A=C.halo.width.get(T),w=+("scaled"===C.halo.scalingMethod.get(T));N.halo.widthScaled=A*w,N.halo.widthFixed=A*(1-w),function wx(A,w){let T=w.diameterScaled+2*w.halo.widthScaled,C=w.diameterFixed+2*w.halo.widthFixed;A.pieceId=1,A.shape="circle",A.x1=w.x,A.y1=w.y,A.x2=w.x,A.y2=w.y,A.rectWidthOrSourceRadiusScaled=T,A.rectWidthOrSourceRadiusFixed=C,A.rectHeightOrTargetRadiusScaled=T,A.rectHeightOrTargetRadiusFixed=C,A.thicknessOrFontSizeScaled=0,A.thicknessOrFontSizeFixed=0,A.strokeWidthScaled=0,A.strokeWidthFixed=0,A.offsetScaled=0,A.offsetFixed=0,A.pattern.type=0,A.opacity=w.opacity,A.fillColor=w.halo.color,A.strokeColor=null,A.patternColor=null,A.globalMinVisibleSize=0,A.strokeMinVisibleSize=0,A.patternMinVisibleSize=0,A.offsetAngle=0,A.patternScale=0,A.symbolicSize=w.diameterScaled,A.curvature=0,A.dashLength=0,A.gapLength=0,A.hasHead=!1,A.hasTail=!1,A.isSelfLoop=!1,A.isText=!1}(k.halo,N),k.haloStroke&&(N.halo.strokeWidthScaled=0,N.halo.strokeWidthFixed=C.halo.strokeWidth.get(T),function Rx(A,w){let T=w.diameterScaled+2*w.halo.widthScaled,C=w.diameterFixed+2*w.halo.widthFixed;A.pieceId=1,A.shape="circle",A.x1=w.x,A.y1=w.y,A.x2=w.x,A.y2=w.y,A.rectWidthOrSourceRadiusScaled=T,A.rectWidthOrSourceRadiusFixed=C,A.rectHeightOrTargetRadiusScaled=T,A.rectHeightOrTargetRadiusFixed=C,A.thicknessOrFontSizeScaled=0,A.thicknessOrFontSizeFixed=0,A.strokeWidthScaled=w.halo.strokeWidthScaled,A.strokeWidthFixed=w.halo.strokeWidthFixed,A.offsetScaled=0,A.offsetFixed=0,A.pattern.type=0,A.opacity=w.opacity,A.fillColor=null,A.strokeColor=w.halo.strokeColor,A.patternColor=null,A.globalMinVisibleSize=0,A.strokeMinVisibleSize=0,A.patternMinVisibleSize=0,A.offsetAngle=0,A.patternScale=0,A.symbolicSize=w.diameterScaled,A.curvature=0,A.dashLength=0,A.gapLength=0,A.hasHead=!1,A.hasTail=!1,A.isSelfLoop=!1,A.isText=!1}(k.haloStroke,N))}if(k.outline&&(N.outline.color=C.outline.color.get(T),N.outline.minVisibleSize=C.outline.minVisibleSize.get(T),function Fx(A,w){let T=1.1*w.diameterScaled,C=1.1*w.diameterFixed,k=.07*w.diameterScaled,N=.07*w.diameterFixed+1;w.outerStroke.color&&(k+=w.outerStroke.widthScaled/2,N+=w.outerStroke.widthFixed/2),A.pieceId=1,A.shape=w.shape,A.x1=w.x,A.y1=w.y,A.x2=w.x,A.y2=w.y,A.rectWidthOrSourceRadiusScaled=T,A.rectWidthOrSourceRadiusFixed=C,A.rectHeightOrTargetRadiusScaled=T,A.rectHeightOrTargetRadiusFixed=C,A.thicknessOrFontSizeScaled=0,A.thicknessOrFontSizeFixed=0,A.strokeWidthScaled=0,A.strokeWidthFixed=0,A.offsetScaled=k,A.offsetFixed=N,A.pattern.type=0,A.opacity=w.opacity,A.fillColor=w.outline.color,A.strokeColor=null,A.patternColor=null,A.globalMinVisibleSize=w.outline.minVisibleSize,A.strokeMinVisibleSize=0,A.patternMinVisibleSize=0,A.offsetAngle=1.5707963267948966,A.patternScale=0,A.symbolicSize=w.diameterScaled,A.curvature=0,A.dashLength=0,A.gapLength=0,A.hasHead=!1,A.hasTail=!1,A.isSelfLoop=!1,A.isText=!1}(k.outline,N)),k.outerStroke&&(N.outerStroke.minVisibleSize=C.outerStroke.minVisibleSize.get(T),function Bx(A,w){let T=w.diameterScaled+2*w.innerStroke.widthScaled,C=w.diameterFixed+2*w.innerStroke.widthFixed;A.pieceId=1,A.shape=w.shape,A.x1=w.x,A.y1=w.y,A.x2=w.x,A.y2=w.y,A.rectWidthOrSourceRadiusScaled=T,A.rectWidthOrSourceRadiusFixed=C,A.rectHeightOrTargetRadiusScaled=T,A.rectHeightOrTargetRadiusFixed=C,A.thicknessOrFontSizeScaled=0,A.thicknessOrFontSizeFixed=0,A.strokeWidthScaled=w.outerStroke.widthScaled,A.strokeWidthFixed=w.outerStroke.widthFixed,A.offsetScaled=0,A.offsetFixed=0,A.pattern.type=0,A.opacity=w.opacity,A.fillColor=null,A.strokeColor=w.outerStroke.color,A.patternColor=null,A.globalMinVisibleSize=w.outerStroke.minVisibleSize,A.strokeMinVisibleSize=0,A.patternMinVisibleSize=0,A.offsetAngle=0,A.patternScale=0,A.symbolicSize=w.diameterScaled,A.curvature=0,A.dashLength=0,A.gapLength=0,A.hasHead=!1,A.hasTail=!1,A.isSelfLoop=!1,A.isText=!1}(k.outerStroke,N)),k.pieChart&&function kx(A,w){No(A,w),Array.isArray(w.color)&&(A.pattern.type=4,A.pattern.attributes.colors=w.color.join(";"),A.patternScale=1,A.patternMinVisibleSize=0,A.patternColor=null)}(k.pieChart,N),k.image&&(N.image.content=w.imageManager.getImage(N.image.url),N.image.fit=C.image.fit.get(T),N.image.tile=C.image.tile.get(T),N.image.scale=C.image.scale.get(T),N.image.minVisibleSize=C.image.minVisibleSize.get(T),function Px(A,w){let T=w.image.fit&&!w.image.tile;No(A,w),A.pattern.type=2,A.pattern.attributes.image=w.image.content,A.pattern.attributes.scaled=T,A.pattern.attributes.duplicated=w.image.tile,A.patternScale=T?w.image.scale:0,A.patternMinVisibleSize=w.image.minVisibleSize,A.patternColor=null}(k.image,N)),k.icon&&(N.icon.font=w.fontManager.getFont(C.icon.font.get(T)),N.icon.style=C.icon.style.get(T),N.icon.color=C.icon.color.get(T),N.icon.scale=C.icon.scale.get(T),N.icon.minVisibleSize=C.icon.minVisibleSize.get(T),function Mx(A,w){No(A,w),A.pattern.type=5,A.pattern.attributes.text=w.icon.content,A.pattern.attributes.font=w.icon.font,A.pattern.attributes.style=w.icon.style,A.pattern.attributes.size=-1,A.patternMinVisibleSize=w.icon.minVisibleSize,A.patternColor=w.icon.color,A.patternScale=w.icon.scale}(k.icon,N)),k.body){let A=!k.pieChart&&!k.image&&!k.icon;!function Ox(A,w,T){No(A,w),A.fillColor=Array.isArray(w.color)?null:w.color,A.strokeColor=w.innerStroke.color,A.strokeMinVisibleSize=w.innerStroke.minVisibleSize,A.strokeWidthScaled=w.innerStroke.widthScaled,A.strokeWidthFixed=w.innerStroke.widthFixed,T&&(A.pattern.type=0)}(k.body,N,A)}})(0,w,T,C,k,N),Kx(A,w,T,C.text,k.texts.primary,N.texts.primary,N),Kx(A,w,T,C.text.secondary,k.texts.secondary,N.texts.secondary,N),Bm(A,w,T,j.topLeft,O.topLeft,G.topLeft,N),Bm(A,w,T,j.topRight,O.topRight,G.topRight,N),Bm(A,w,T,j.bottomLeft,O.bottomLeft,G.bottomLeft,N),Bm(A,w,T,j.bottomRight,O.bottomRight,G.bottomRight,N)}function Bm(A,w,T,C,k,N,O){if(k.image||k.text){let A=C.stroke.width.get(T),w=+("scaled"===C.stroke.scalingMethod.get(T));N.color=hr(C.color.get(T),O.color,N.angle),N.strokeColor=C.stroke.color.get(T),N.strokeWidthScaled=A*w,N.strokeWidthFixed=A*(1-w),N.minVisibleSize=C.minVisibleSize.get(T),N.positionScale=C.positionScale.get(T),N.scale=C.scale.get(T)}if(k.image&&(N.imageContent=w.imageManager.getImage(N.imageUrl),N.imageScale=C.image.scale.get(T),function Gx(A,w,T){Ux(A,w,T),null!==w.imageContent?(A.pattern.type=2,A.pattern.attributes.image=w.imageContent,A.pattern.attributes.scaled=!0,A.pattern.attributes.duplicated=!1,A.patternScale=w.imageScale,A.patternMinVisibleSize=0,A.patternColor=null):(A.fillColor=null,A.strokeColor=null)}(k.image,N,O)),k.text){if(N.textFont=w.fontManager.getFont(C.text.font.get(T)),N.textStyle=C.text.style.get(T),N.textColor=hr(C.text.color.get(T),O.color),N.textScale=C.text.scale.get(T),N.textPaddingTop=C.text.paddingTop.get(T),N.textPaddingLeft=C.text.paddingLeft.get(T),A.measureText(N.textContent,N.textFont,N.textStyle,N.textScale).width>1){let w=0,T=0;for(;T<N.textContent.length&&w<1;)w+=A.measureText(N.textContent[T],N.textFont,N.textStyle,N.textScale).width,T+=1;T!==N.textContent.length&&(N.textContent=N.textContent.substring(0,T-1)+"")}!function zx(A,w,T){Ux(A,w,T),w.textContent&&(A.pattern.type=6,A.pattern.attributes.text=w.textContent,A.pattern.attributes.font=w.textFont,A.pattern.attributes.style=w.textStyle,A.pattern.attributes.paddingLeft=w.scale*w.textPaddingLeft*2,A.pattern.attributes.paddingTop=w.scale*w.textPaddingTop*2,A.pattern.attributes.size=-1,A.patternMinVisibleSize=0,A.patternColor=w.textColor,A.patternScale=w.textScale,A.isBadge=!0),(w.imageUrl||!w.textContent)&&(A.fillColor=null,A.strokeColor=null)}(k.text,N,O)}}function Kx(A,w,T,C,k,N,O){if(k.text){let j=C,G=j.scaling.get(T);if(N.font=w.fontManager.getFont(j.font.get(T)),N.color=hr(j.color.get(T),O.color),N.style=j.style.get(T),N.align=j.align.get(T),N.minVisibleSize=j.minVisibleSize.get(T),N.margin=j.margin.get(T),N.padding=j.padding.get(T),N.maxLineLength=j.maxLineLength.get(T),N.content=Es(N.content,N.maxLineLength),G){let A=j.scale.get(T);N.sizeScaled=O.diameterScaled*A,N.sizeFixed=O.diameterFixed*A}else N.sizeFixed=j.size.get(T),N.sizeScaled=0;let H=A.measureText(N.content,N.font,N.style);N.widthScaled=H.width*N.sizeScaled,N.widthFixed=H.width*N.sizeFixed,N.heightScaled=H.height*N.sizeScaled,N.heightFixed=H.height*N.sizeFixed,N.positionAngle=tn[N.position],N.isPositionCenter="center"===N.position,N.isPositionVertical="top"===N.position||"bottom"===N.position,N.isPositionHorizontal="left"===N.position||"right"===N.position,function Vx(A,w,T){Xx(A,w,T),A.pattern.type=7,A.pattern.attributes.text=w.content,A.pattern.attributes.font=w.font,A.pattern.attributes.style=w.style,A.pattern.attributes.align=w.align,A.patternMinVisibleSize=0,A.patternColor=w.color,A.thicknessOrFontSizeScaled=w.sizeScaled,A.thicknessOrFontSizeFixed=w.sizeFixed,A.isText=!0}(k.text,N,O),k.background&&(function Hx(A,w,T){Xx(A,w,T),A.fillColor=w.backgroundColor,A.pieceId=6,A.shape="roundedSquare"}(k.background,N,O),k.tip&&function Wx(A,w,T){let C=Math.ceil(w.margin/2),k=T.diameterScaled/2+T.outerStroke.widthScaled,N=T.diameterFixed/2+C,O=sn[w.position],j=Math.cos(O),G=Math.sin(O),H=w.margin<12?1:w.margin<30?1-(w.margin-12)/18*.7:.25;A.pieceId=1,A.shape="triangle",A.x1=T.x-j,A.y1=T.y-G,A.x2=T.x+j,A.y2=T.y+G,A.rectWidthOrSourceRadiusScaled=0,A.rectWidthOrSourceRadiusFixed=w.margin,A.rectHeightOrTargetRadiusScaled=0,A.rectHeightOrTargetRadiusFixed=w.margin*H,A.thicknessOrFontSizeScaled=0,A.thicknessOrFontSizeFixed=0,A.strokeWidthScaled=0,A.strokeWidthFixed=0,A.offsetScaled=k,A.offsetFixed=N,A.pattern.type=0,A.opacity=T.opacity,A.fillColor=w.backgroundColor,A.strokeColor=null,A.patternColor=null,A.globalMinVisibleSize=w.minVisibleSize,A.strokeMinVisibleSize=0,A.patternMinVisibleSize=0,A.offsetAngle=w.positionAngle,A.patternScale=0,A.symbolicSize=T.diameterScaled,A.curvature=0,A.dashLength=0,A.gapLength=0,A.hasHead=!1,A.hasTail=!1,A.isSelfLoop=!1}(k.tip,N,O))}}var qx=A=>(w,T)=>{T.haloStroke=w.haloStroke[A],T.halo=w.halo[A],T.outline=w.outline[A],T.outerStroke=w.outerStroke[A],T.body=w.body[A],T.pieChart=w.pieChart[A],T.image=w.image[A],T.icon=w.icon[A];let C=w.badges,k=T.badges;k.topLeft.text=C.topLeft.text[A],k.topLeft.image=C.topLeft.image[A],k.topRight.text=C.topRight.text[A],k.topRight.image=C.topRight.image[A],k.bottomLeft.text=C.bottomLeft.text[A],k.bottomLeft.image=C.bottomLeft.image[A],k.bottomRight.text=C.bottomRight.text[A],k.bottomRight.image=C.bottomRight.image[A];let N=w.texts,O=T.texts;O.primary.text=N.primary.text[A],O.primary.background=N.primary.background[A],O.primary.tip=N.primary.tip[A],O.secondary.text=N.secondary.text[A],O.secondary.background=N.secondary.background[A],O.secondary.tip=N.secondary.tip[A]},ya=qx("start"),ba=qx("end");function Yx(A){return{body:A(),text:A(),textBg:A(),halo:A(),haloStroke:A()}}function fl(A,w,T,C,k,N){let O,j,G,H,W,$,Z,se,ue;return j=C-A,G=k-w,H=Math.sqrt(j*j+G*G),H>T+N||H<Math.abs(T-N)?null:(O=(T*T-N*N+H*H)/(2*H),se=A+j*O/H,ue=w+G*O/H,W=Math.sqrt(T*T-O*O),$=W/H*-G,Z=j*(W/H),[[se+$,ue+Z],[se-$,ue-Z]])}function _l(A,w,T,C,k,N){if(A-k>=0&&T-k<0)return 1;if(A-k<0&&T-k>=0)return-1;if(A-k==0&&T-k==0)return w-C>=0||C-N>=0?w-C:C-w;let O=(A-k)*(C-N)-(T-k)*(w-N);return O<0?1:O>0?-1:(A-k)*(A-k)+(w-N)*(w-N)-((T-k)*(T-k)+(C-N)*(C-N))}function TL([A,w,T],C,k){let N=Math.abs(A-C),O=Math.abs(w-k);return N+O<=T||!(N>T||O>T)&&Math.sqrt(N*N+O*O)<T+1e-12}function SL(A,w,T,C){let k=A[0]-w,N=A[1]-T,O=A[2]-C;return k*k+N*N<O*O+1e-6}function bl(A,w,T,C,k,N,O){let j=A-Math.max(C,Math.min(N,A)),G=w-Math.max(k,Math.min(O,w));return j*j+G*G<T*T}function Rf(A,w,T,C,k,N,O,j={x:0,y:0}){let G,H,W,$,Z=j||{x:0,y:0};if(T===A){let w=A-k,T=O*O-w*w;if(T<0)return null;let C=Math.sqrt(T);G=A,W=A,H=N+C,$=N-C}else{let j=(C-w)/(T-A),Z=w-j*A,se=Z-N,ue=j*j+1,ge=2*(j*se-k),ce=ge*ge-4*ue*(k*k+se*se-O*O);if(ce<0)return null;let _e=-ge,me=Math.sqrt(ce),pe=2*ue;G=(_e+me)/pe,W=(_e-me)/pe,H=j*G+Z,$=j*W+Z}let se=A-G,ue=w-H,ge=A-W,ce=w-$;return se*se+ue*ue<ge*ge+ce*ce?(Z.x=G,Z.y=H):(Z.x=W,Z.y=$),Z}function Ff(A,w,T,C,k,N){(function LL(A,w,T,C,k,N){let O=k.source,j=k.target,G=T.source.get(C),H=T.target.get(C),W=O.x.get(G),$=O.y.get(G),Z=O.radius.get(G),se=O.color.get(G),ue=+("scaled"===O.scalingMethod.get(G)),ge=j.x.get(H),ce=j.y.get(H),_e=j.radius.get(H),me=j.color.get(H),pe=+("scaled"===j.scalingMethod.get(H)),be=function Tx(A,w,T){return"source"===A?Array.isArray(w)?w[0]:w:"target"===A?Array.isArray(T)?T[0]:T:A}(T.color.get(C),se,me),Se=T.width.get(C),Ee="scaled"===T.scalingMethod.get(C)?1:0,Te=T.stroke.width.get(C),Ce="scaled"===T.stroke.scalingMethod.get(C)?1:0,Ie=en[T.shape.style.get(C)],ze=T.adjustAnchors.get(C);if(w.source=G,w.target=H,w.sourceX=W,w.sourceY=$,w.targetX=ge,w.targetY=ce,w.sourceRadiusScaled=Z*ue,w.sourceRadiusFixed=Z*(1-ue),w.targetRadiusScaled=_e*pe,w.targetRadiusFixed=_e*(1-pe),w.widthScaled=Se*Ee,w.widthFixed=Se*(1-Ee),w.curvature=T.curvature.get(C),w.isSelfLoop=G===H,w.color=be,w.opacity=T.opacity.get(C),w.minVisibleSize=T.minVisibleSize.get(C),w.shape.body=T.shape.body.get(C),w.shape.head=T.shape.head.get(C),w.shape.tail=T.shape.tail.get(C),w.shape.dashLength=Ie.dash,w.shape.gapLength=Ie.gap,w.shape.isBodyTriangle="triangle"===w.shape.body,w.stroke.color=hr(T.stroke.color.get(C),be),w.stroke.widthScaled=Te*Ce,w.stroke.widthFixed=Te*(1-Ce),w.stroke.minVisibleSize=T.stroke.minVisibleSize.get(C),w.halo.color=T.halo.color.get(C),w.outline.enabled=T.outline.enabled.get(C),w.textHidden=1===T.textHidden.get(C),ze&&(w.shape.head||w.shape.tail||"triangle"===w.shape.body)){let A=w,T=A.curvature,C=A.sourceX,k=A.sourceY,W=A.targetX,$=A.targetY,Z=1,se=1;if(T){if(!A.isSelfLoop){let w=jt(C,k,W,$,T/2);Z=zm(A,N,O,G,C,k,w.x,w.y),se=zm(A,N,j,H,W,$,w.x,w.y)}}else Z=zm(A,N,O,G,C,k,W,$),se=zm(A,N,j,H,W,$,C,k);w.sourceRadiusScaled*=Z,w.sourceRadiusFixed*=Z,w.targetRadiusScaled*=se,w.targetRadiusFixed*=se}})(0,w,T,C,k,N),jx(A,w.texts.primary,T.text,C,w),jx(A,w.texts.secondary,T.text.secondary,C,w)}function jx(A,w,T,C,k){w.hidden=k.textHidden,w.content=A.formatText(T.content.get(C)),w.backgroundColor=hr(T.backgroundColor.get(C),k.color)}function zm(A,w,T,C,k,N,O,j){let G,H=w.angle||0,W=Math.atan2(j-N,O-k)-H,$=1,Z=0;W<-jr?W+=Gr:W>jr&&(W-=Gr),W<-jr/2?(Z=Wr,G=T.badges.topLeft):W<0?(Z=Xr,G=T.badges.topRight):W<jr/2?(Z=Yr,G=T.badges.bottomRight):(Z=$r,G=T.badges.bottomLeft),Z+=H;let se=G.text.content&&G.text.content.get(C),ue=G.image.url&&G.image.url.get(C);if((A=>!!A||0===A)(se)||ue){let A=G.positionScale.get(C),w=G.scale.get(C),T=Rf(O,j,k,N,k+Math.cos(Z)*A,N+Math.sin(Z)*A,w);if(T){let A=T.x-k,w=T.y-N,C=Math.sqrt(A*A+w*w);$=Math.max($,C)}}if("square"===T.shape.get(C)){let A=Math.abs(Math.cos(W)),w=Math.abs(Math.sin(W)),T=1/Math.max(A,w);$=Math.max($,T)}return $}function Mf(){return{source:0,target:0,sourceX:0,sourceY:0,targetX:0,targetY:0,sourceRadiusScaled:0,sourceRadiusFixed:0,targetRadiusScaled:0,targetRadiusFixed:0,widthScaled:0,widthFixed:0,curvature:0,isSelfLoop:!1,color:"",opacity:0,minVisibleSize:0,shape:{body:"line",head:null,tail:null,dashLength:0,gapLength:0,isBodyTriangle:!1},stroke:{color:"",widthScaled:0,widthFixed:0,minVisibleSize:0},halo:{widthScaled:0,widthFixed:0,color:""},outline:{enabled:!1,color:"",minVisibleSize:0},textHidden:!1,texts:{primary:Zx(),secondary:Zx()}}}function Zx(){return{align:"left",hidden:!1,content:"",backgroundColor:"",font:"",color:"",sizeScaled:0,sizeFixed:0,style:"none",minVisibleSize:0,margin:0,padding:0,position:zn,maxLineLength:0,widthScaled:0,widthFixed:0,heightScaled:0,heightFixed:0,positionAngle:0,adjustAngle:!1,offsetAngle:0}}function Bf(A,w){kf(A.body,w,!0,!0),kf(A.outline,w,w.outline.enabled,!0),kf(A.halo,w,!!w.halo.color,!1),$x(A.texts.primary,w.texts.primary),$x(A.texts.secondary,w.texts.secondary)}function kf(A,w,T,C){A.body=T,A.head=T&&C&&!!w.shape.head,A.tail=T&&C&&!!w.shape.tail}function $x(A,w){A.text=!w.hidden&&!!w.content,A.background=A.text&&!!w.backgroundColor}function Qx(A,w,T,C){El(A,w,T,C),A.thicknessOrFontSizeScaled=w.widthScaled,A.thicknessOrFontSizeFixed=w.widthFixed,A.strokeWidthScaled=w.stroke.widthScaled,A.strokeWidthFixed=w.stroke.widthFixed,A.offsetScaled=0,A.offsetFixed=0,A.fillColor=w.color,A.strokeColor=w.stroke.color,A.globalMinVisibleSize=w.minVisibleSize,A.strokeMinVisibleSize=w.stroke.minVisibleSize,A.offsetAngle=0,A.symbolicSize=w.widthScaled,A.dashLength=w.shape.dashLength,A.gapLength=w.shape.gapLength,A.hasHead=!!w.shape.head,A.hasTail=!!w.shape.tail,A.isBodyTriangle=w.shape.isBodyTriangle}function El(A,w,T,C){A.pieceId=T,A.shape=C,A.x1=w.sourceX,A.y1=w.sourceY,A.x2=w.targetX,A.y2=w.targetY,A.rectWidthOrSourceRadiusScaled=w.sourceRadiusScaled,A.rectWidthOrSourceRadiusFixed=w.sourceRadiusFixed,A.rectHeightOrTargetRadiusScaled=w.targetRadiusScaled,A.rectHeightOrTargetRadiusFixed=w.targetRadiusFixed,A.thicknessOrFontSizeScaled=0,A.thicknessOrFontSizeFixed=0,A.strokeWidthScaled=0,A.strokeWidthFixed=0,A.offsetScaled=0,A.offsetFixed=0,A.pattern.type=0,A.opacity=w.opacity,A.fillColor=null,A.strokeColor=null,A.patternColor=null,A.globalMinVisibleSize=w.minVisibleSize,A.strokeMinVisibleSize=0,A.patternMinVisibleSize=0,A.offsetAngle=0,A.patternScale=0,A.symbolicSize=w.widthScaled,A.curvature=w.curvature,A.dashLength=0,A.gapLength=0,A.hasHead=!1,A.hasTail=!1,A.isSelfLoop=w.isSelfLoop,A.isText=!1}function Jx(A,w,T){let C=w.widthScaled+2*w.halo.widthScaled,k=w.widthFixed+2*w.halo.widthFixed;El(A,w,T,"line"),A.thicknessOrFontSizeScaled=C,A.thicknessOrFontSizeFixed=k,A.strokeWidthScaled=0,A.strokeWidthFixed=0,A.offsetScaled=0,A.offsetFixed=0,A.fillColor=w.halo.color,A.strokeColor=null,A.globalMinVisibleSize=w.minVisibleSize,A.strokeMinVisibleSize=0,A.offsetAngle=0,A.symbolicSize=w.widthScaled,A.dashLength=0,A.gapLength=0,A.hasHead=!1,A.hasTail=!1,A.isBodyTriangle=!1}function eD(A,w,T,C){El(A,w,T,C);let k=.17*w.widthFixed+1;A.thicknessOrFontSizeScaled=1*w.widthScaled,A.thicknessOrFontSizeFixed=1*w.widthFixed,A.strokeWidthScaled=0,A.strokeWidthFixed=0,A.offsetScaled=.17*w.widthScaled,A.offsetFixed=k,A.fillColor=w.outline.color,A.strokeColor=null,A.globalMinVisibleSize=Math.max(w.minVisibleSize,w.outline.minVisibleSize),A.strokeMinVisibleSize=0,A.offsetAngle=Math.PI/2,A.symbolicSize=w.widthScaled,A.dashLength=w.shape.dashLength,A.gapLength=w.shape.gapLength,A.hasHead=!!w.shape.head,A.hasTail=!!w.shape.tail,A.isBodyTriangle=w.shape.isBodyTriangle}function nD(A,w,T){let C="centered"===w.position?0:(T.widthScaled+w.heightScaled)/2+T.stroke.widthScaled,k="centered"===w.position?0:(T.widthFixed+w.heightFixed)/2+T.stroke.widthFixed+w.padding+w.margin;A.pieceId=5,A.shape="square",A.x1=T.sourceX,A.y1=T.sourceY,A.x2=T.targetX,A.y2=T.targetY,A.rectWidthOrSourceRadiusScaled=w.widthScaled,A.rectWidthOrSourceRadiusFixed=w.widthFixed+2*w.padding+1,A.rectHeightOrTargetRadiusScaled=w.heightScaled,A.rectHeightOrTargetRadiusFixed=w.heightFixed+2*w.padding,A.thicknessOrFontSizeScaled=0,A.thicknessOrFontSizeFixed=0,A.strokeWidthScaled=T.sourceRadiusScaled+T.targetRadiusScaled,A.strokeWidthFixed=T.sourceRadiusFixed+T.targetRadiusFixed,A.offsetScaled=C,A.offsetFixed=k,A.pattern.type=0,A.opacity=T.opacity,A.fillColor=null,A.strokeColor=null,A.patternColor=null,A.globalMinVisibleSize=Math.max(w.minVisibleSize,T.minVisibleSize),A.strokeMinVisibleSize=0,A.patternMinVisibleSize=0,A.offsetAngle=w.offsetAngle,A.patternScale=0,A.symbolicSize=T.widthScaled,A.curvature=T.curvature,A.dashLength=0,A.gapLength=0,A.hasHead=!1,A.hasTail=!1,A.isSelfLoop=T.isSelfLoop,A.isText=!1,A.adjustTextAngle=w.adjustAngle}function zf(A,w,T,C,k,N){(function IL(A,w,T,C,k,N){if(Gf(k.body,N,Qx),k.halo.body){let A=C.halo.width.get(T),w=+("scaled"===C.halo.scalingMethod.get(T));N.halo.widthScaled=A*w,N.halo.widthFixed=A*(1-w),Gf(k.halo,N,Jx)}k.outline.body&&(N.outline.color=C.outline.color.get(T),N.outline.minVisibleSize=C.outline.minVisibleSize.get(T),Gf(k.outline,N,eD))})(0,0,T,C,k,N),iD(A,w,T,C.text,k.texts.primary,N.texts.primary,N),iD(A,w,T,C.text.secondary,k.texts.secondary,N.texts.secondary,N)}function Gf(A,w,T){T(A.body,w,2,w.shape.body),A.head&&T(A.head,w,3,w.shape.head),A.tail&&T(A.tail,w,4,w.shape.tail)}function iD(A,w,T,C,k,N,O){if(k.text){let j=C,G=j.scaling.get(T);if(N.font=w.fontManager.getFont(j.font.get(T)),N.color=hr(j.color.get(T),O.color),N.position=j.position?j.position.get(T):zn,N.style=j.style.get(T),N.minVisibleSize=j.minVisibleSize.get(T),N.margin=j.margin.get(T),N.padding=j.padding.get(T),N.maxLineLength=j.maxLineLength.get(T),N.content=Es(N.content,N.maxLineLength),N.adjustAngle=j.adjustAngle.get(T),N.align=j.align.get(T),G){let A=j.scale.get(T);N.sizeScaled=O.widthScaled*A,N.sizeFixed=O.widthFixed*A}else N.sizeFixed=j.size.get(T),N.sizeScaled=0;let H=A.measureText(N.content,N.font,N.style);N.widthScaled=H.width*N.sizeScaled,N.widthFixed=H.width*N.sizeFixed,N.heightScaled=H.height*N.sizeScaled,N.heightFixed=H.height*N.sizeFixed,N.offsetAngle=N===O.texts.primary?Qr:Kr,function tD(A,w,T){nD(A,w,T),A.pattern.type=7,A.pattern.attributes.text=w.content,A.pattern.attributes.size=-1,A.pattern.attributes.font=w.font,A.pattern.attributes.style=w.style,A.pattern.attributes.align=w.align,A.patternColor=w.color,A.patternScale=1,A.thicknessOrFontSizeScaled=w.sizeScaled,A.thicknessOrFontSizeFixed=w.sizeFixed,A.isText=!0}(k.text,N,O),k.background&&function rD(A,w,T){nD(A,w,T),A.pieceId+=6,A.fillColor=w.backgroundColor,A.shape="roundedSquare"}(k.background,N,O)}}var sD=A=>(w,T)=>{T.halo.body=w.halo.body[A],T.halo.head=w.halo.head[A],T.halo.tail=w.halo.tail[A],T.outline.body=w.outline.body[A],T.outline.head=w.outline.head[A],T.outline.tail=w.outline.tail[A],T.body.body=w.body.body[A],T.body.head=w.body.head[A],T.body.tail=w.body.tail[A],T.texts.primary.text=w.texts.primary.text[A],T.texts.primary.background=w.texts.primary.background[A],T.texts.secondary.text=w.texts.secondary.text[A],T.texts.secondary.background=w.texts.secondary.background[A]},va=sD("start"),Aa=sD("end");function oD(A){return{body:A(),halo:A(),text:A(),textBg:A()}}function aD({graph:A,elements:w,engine:T,imageManager:C,fontManager:k,view:N,attributes:O,boundaries:j,formatText:G}){let{nodeAttributes:H,nodeAttributesPrev:W,edgeAttributes:$,edgeAttributesPrev:Z}=function kL(A){let w=nr(A.nodes.current,{text:{secondary:{scaling:A.nodes.current.text.scaling,maxLineLength:A.nodes.current.text.maxLineLength}}}),T=nr(A.nodes.previous,{textHidden:w.textHidden,text:{secondary:{scaling:A.nodes.previous.text.scaling,maxLineLength:A.nodes.previous.text.maxLineLength}}}),C=nr(A.edges.current,{text:{secondary:{scaling:A.edges.current.text.scaling,maxLineLength:A.edges.current.text.maxLineLength,adjustAngle:A.edges.current.text.adjustAngle}}}),k=nr(A.edges.previous,{source:A.edges.current.source,target:A.edges.current.target,textHidden:A.edges.current.textHidden,text:{secondary:{scaling:A.edges.previous.text.scaling,maxLineLength:A.edges.previous.text.maxLineLength,adjustAngle:A.edges.previous.text.adjustAngle}}});return{nodeAttributes:w,nodeAttributesPrev:T,edgeAttributes:C,edgeAttributesPrev:k}}(O),{nodes:se,edges:ue}=w,{maxSize:ge,maxMinVisibleSize:ce}=j;if(!se.size&&!ue.size)return;let _e=10*(Math.max(A.getNodeMaxIndex(),A.getEdgeMaxIndex())+1),me=T.setGlobalBoundaries({maxBlockId:Vr(_e),maxScaledSize:Vr(8*ge),maxMinVisibleSize:Vr(ce),maxSymbolicSize:Vr(ge),maxDashLength:3,maxGapLength:1,maxPatternScale:2,maxCoord:-1/0}),pe=(me?A.getNodes("_all"):se)._indexes,be=(me?A.getEdges("_all"):ue)._indexes;if(pe.length){let A=new class{constructor({engine:A,imageManager:w,fontManager:T,formatText:C,attributes:k,attributesPrev:N}){this._fullComponents={haloStroke:void 0,halo:void 0,outline:void 0,outerStroke:void 0,body:void 0,pieChart:void 0,image:void 0,icon:void 0,badges:{topLeft:{text:void 0,image:void 0},topRight:{text:void 0,image:void 0},bottomLeft:{text:void 0,image:void 0},bottomRight:{text:void 0,image:void 0}},texts:{primary:{text:void 0,background:void 0,tip:void 0},secondary:{text:void 0,background:void 0,tip:void 0}}},this._startComponents={haloStroke:void 0,halo:void 0,outline:void 0,outerStroke:void 0,body:void 0,pieChart:void 0,image:void 0,icon:void 0,badges:{topLeft:{text:void 0,image:void 0},topRight:{text:void 0,image:void 0},bottomLeft:{text:void 0,image:void 0},bottomRight:{text:void 0,image:void 0}},texts:{primary:{text:void 0,background:void 0,tip:void 0},secondary:{text:void 0,background:void 0,tip:void 0}}},this._endComponents={haloStroke:void 0,halo:void 0,outline:void 0,outerStroke:void 0,body:void 0,pieChart:void 0,image:void 0,icon:void 0,badges:{topLeft:{text:void 0,image:void 0},topRight:{text:void 0,image:void 0},bottomLeft:{text:void 0,image:void 0},bottomRight:{text:void 0,image:void 0}},texts:{primary:{text:void 0,background:void 0,tip:void 0},secondary:{text:void 0,background:void 0,tip:void 0}}},this._startFlags={haloStroke:void 0,halo:void 0,outline:void 0,outerStroke:void 0,body:void 0,pieChart:void 0,image:void 0,icon:void 0,badges:{topLeft:{text:void 0,image:void 0},topRight:{text:void 0,image:void 0},bottomLeft:{text:void 0,image:void 0},bottomRight:{text:void 0,image:void 0}},texts:{primary:{text:void 0,background:void 0,tip:void 0},secondary:{text:void 0,background:void 0,tip:void 0}}},this._endFlags={haloStroke:void 0,halo:void 0,outline:void 0,outerStroke:void 0,body:void 0,pieChart:void 0,image:void 0,icon:void 0,badges:{topLeft:{text:void 0,image:void 0},topRight:{text:void 0,image:void 0},bottomLeft:{text:void 0,image:void 0},bottomRight:{text:void 0,image:void 0}},texts:{primary:{text:void 0,background:void 0,tip:void 0},secondary:{text:void 0,background:void 0,tip:void 0}}},this._startInput=Of(),this._endInput=Of(),this._depthInfo={edgeHalo:0,nodeHaloStroke:0,nodeHalo:0,edgeBody:0,edgeTextBackground:0,edgeText:0,nodeBody:0,nodeTextBackground:0,nodeText:0},this._nodePatternAssigned=!1,this._nullElt={id:-1,valid:!0},this._engine=A,this._attributes=k,this._attributesPrev=N,this._helper={imageManager:w,fontManager:T,formatText:C},this._layers=Yx((()=>A.createGroup())),this._blockIds=Yx((()=>0))}drawNode(A){if(this._computeBlockIds(A),this._attributes.excluded.get(A))return this._freeBlocks();let w=this._engine,T=this._helper,C=A,k=this._attributes,N=Yn(k.layer.get(A)-(k.detectable.get(A)?0:1),this._depthInfo),O=k.animationDuration.get(A),j=O>0;if(this._prepareBlocks(j,N,C),Cf(T,this._endInput,k,A),Pf(this._endFlags,this._endInput),j&&(Cf(T,this._startInput,this._attributesPrev,A),Pf(this._startFlags,this._startInput),((A,w)=>{w.haloStroke=w.haloStroke||A.haloStroke,w.halo=w.halo||A.halo,w.outline=w.outline||A.outline,w.outerStroke=w.outerStroke||A.outerStroke,w.body=w.body||A.body,w.pieChart=w.pieChart||A.pieChart,w.image=w.image||A.image,w.icon=w.icon||A.icon;let T=A.badges,C=w.badges;C.topLeft.text=C.topLeft.text||T.topLeft.text,C.topLeft.image=C.topLeft.image||T.topLeft.image,C.topRight.text=C.topRight.text||T.topRight.text,C.topRight.image=C.topRight.image||T.topRight.image,C.bottomLeft.text=C.bottomLeft.text||T.bottomLeft.text,C.bottomLeft.image=C.bottomLeft.image||T.bottomLeft.image,C.bottomRight.text=C.bottomRight.text||T.bottomRight.text,C.bottomRight.image=C.bottomRight.image||T.bottomRight.image;let k=A.texts,N=w.texts;N.primary.text=N.primary.text||k.primary.text,N.primary.background=N.primary.background||k.primary.background,N.primary.tip=N.primary.tip||k.primary.tip,N.secondary.text=N.secondary.text||k.secondary.text,N.secondary.background=N.secondary.background||k.secondary.background,N.secondary.tip=N.secondary.tip||k.secondary.tip})(this._endFlags,this._startFlags)),this._initComponents(this._fullComponents,this._endFlags,this._layers),ba(this._fullComponents,this._endComponents),wf(w,T,A,k,this._endComponents,this._endInput),j&&(ya(this._fullComponents,this._startComponents),wf(w,T,A,this._attributesPrev,this._startComponents,this._startInput)),j){let w=this._attributes.animationStart.get(A),T=this._attributes.animationEasing.get(A);this._setBlocksAnimation(O,w,T)}this._endFlags.halo&&this._attributes.halo.hideNonAdjacentEdges.get(A)&&(this._layers.halo.stencilUsage=this._layers.haloStroke.stencilUsage=2),this._storeBlocks()}_computeBlockIds(A){let w=10*A,T=this._blockIds;T.body=w+0,T.text=w+1,T.textBg=w+2,T.halo=w+3,T.haloStroke=w+4}_prepareBlocks(A,w,T){let C=this._layers;C.body.reset(1,A,w.nodeBody,T),C.text.reset(2,A,w.nodeText,T),C.textBg.reset(1,A,w.nodeTextBackground,T),C.halo.reset(1,A,w.nodeHalo,T),C.haloStroke.reset(1,A,w.nodeHaloStroke,T)}_storeBlocks(){let A=this._engine,w=this._layers,T=this._blockIds;A.storeGroup(T.body,w.body),A.storeGroup(T.text,w.text),A.storeGroup(T.textBg,w.textBg),A.storeGroup(T.halo,w.halo),A.storeGroup(T.haloStroke,w.haloStroke)}_freeBlocks(){let A=this._engine,w=this._blockIds;A.freeBlock(w.body),A.freeBlock(w.text),A.freeBlock(w.textBg),A.freeBlock(w.halo),A.freeBlock(w.haloStroke)}_setBlocksAnimation(A,w,T){let C=this._layers;C.body.setGlobalAnimation(A,w,T),C.text.setGlobalAnimation(A,w,T),C.textBg.setGlobalAnimation(A,w,T),C.halo.setGlobalAnimation(A,w,T),C.haloStroke.setGlobalAnimation(A,w,T)}_initComponents(A,w,T){this._nodePatternAssigned=!1,this._initBaseComponents(A,w,T),this._initBadgeComponents(A.badges.topLeft,w.badges.topLeft,T),this._initBadgeComponents(A.badges.topRight,w.badges.topRight,T),this._initBadgeComponents(A.badges.bottomLeft,w.badges.bottomLeft,T),this._initBadgeComponents(A.badges.bottomRight,w.badges.bottomRight,T),this._initTextComponents(A.texts.primary,w.texts.primary,T),this._initTextComponents(A.texts.secondary,w.texts.secondary,T)}_initBaseComponents(A,w,T){A.haloStroke=this._nextElement(w.haloStroke,T.haloStroke),A.halo=this._nextElement(w.halo,T.halo),A.outline=this._nextElement(w.outline,T.body),A.outerStroke=this._nextElement(w.outerStroke,T.body),A.body=this._nextElement(w.body,T.body),A.pieChart=this._getNodePatternElement(w.pieChart,T),A.image=this._getNodePatternElement(w.image,T),A.icon=this._getNodePatternElement(w.icon,T)}_initBadgeComponents(A,w,T){A.image=this._nextElement(w.image,T.body),A.text=this._nextElement(w.text,T.body)}_initTextComponents(A,w,T){A.background=this._nextElement(w.background,T.textBg),A.tip=this._nextElement(w.tip,T.textBg),A.text=this._nextElement(w.text,T.text)}_nextElement(A,w){return A?w.next():this._nullElt}_getNodePatternElement(A,w){return A?this._nodePatternAssigned?w.body.next():(this._nodePatternAssigned=!0,w.body.getCurrentElement()):this._nullElt}}({engine:T,imageManager:C,fontManager:k,formatText:G,attributes:H,attributesPrev:W});for(let w=0;w<pe.length;++w)A.drawNode(pe[w])}if(be.length){let A=new class{constructor({engine:A,imageManager:w,fontManager:T,formatText:C,view:k,attributes:N,attributesPrev:O,nodeAttributes:j,nodeAttributesPrev:G}){this._fullComponents={halo:{body:void 0,head:void 0,tail:void 0},outline:{body:void 0,head:void 0,tail:void 0},body:{body:void 0,head:void 0,tail:void 0},texts:{primary:{text:void 0,background:void 0},secondary:{text:void 0,background:void 0}}},this._startComponents={halo:{body:void 0,head:void 0,tail:void 0},outline:{body:void 0,head:void 0,tail:void 0},body:{body:void 0,head:void 0,tail:void 0},texts:{primary:{text:void 0,background:void 0},secondary:{text:void 0,background:void 0}}},this._endComponents={halo:{body:void 0,head:void 0,tail:void 0},outline:{body:void 0,head:void 0,tail:void 0},body:{body:void 0,head:void 0,tail:void 0},texts:{primary:{text:void 0,background:void 0},secondary:{text:void 0,background:void 0}}},this._startFlags={halo:{body:void 0,head:void 0,tail:void 0},outline:{body:void 0,head:void 0,tail:void 0},body:{body:void 0,head:void 0,tail:void 0},texts:{primary:{text:void 0,background:void 0},secondary:{text:void 0,background:void 0}}},this._endFlags={halo:{body:void 0,head:void 0,tail:void 0},outline:{body:void 0,head:void 0,tail:void 0},body:{body:void 0,head:void 0,tail:void 0},texts:{primary:{text:void 0,background:void 0},secondary:{text:void 0,background:void 0}}},this._startInput=Mf(),this._endInput=Mf(),this._depthInfo={edgeHalo:0,nodeHaloStroke:0,nodeHalo:0,edgeBody:0,edgeTextBackground:0,edgeText:0,nodeBody:0,nodeTextBackground:0,nodeText:0},this._nullElt={id:-1,valid:!0},this._engine=A,this._view=k,this._helper={imageManager:w,fontManager:T,formatText:C},this._attributes=N,this._attributesPrev=O,this._nodeAttributes=j,this._nodeAttributesPrev=G,this._layers=oD((()=>A.createGroup())),this._blockIds=oD((()=>0))}drawEdge(A){if(this._computeBlockIds(A),this._attributes.excluded.get(A))return this._freeBlocks();let w=this._engine,T=this._helper,C=-A,k=this._attributes,N=Yn(k.layer.get(A)-(k.detectable.get(A)?0:1),this._depthInfo),O=k.source.get(A),j=k.target.get(A),G=k.curvature.get(A),H=this._attributesPrev.curvature.get(A),W=k.animationDuration.get(A),$=k.animationStart.get(A),Z=k.animationEasing.get(A),se=W>0,ue=0!==G||se&&0!==H;this._prepareBlocks(se,N,C,ue);let ge=this._extremitiesAttributes={source:this._nodeAttributes,target:this._nodeAttributes};if(Ff(T,this._endInput,k,A,ge,this._view),Bf(this._endFlags,this._endInput),se){let w=this._nodeAttributes.animationDuration.get(O)>0,C=this._nodeAttributes.animationDuration.get(j)>0;ge.source=w?this._nodeAttributesPrev:this._nodeAttributes,ge.target=C?this._nodeAttributesPrev:this._nodeAttributes,Ff(T,this._startInput,this._attributesPrev,A,ge,this._view),Bf(this._startFlags,this._startInput),((A,w)=>{w.halo.body=w.halo.body||A.halo.body,w.halo.head=w.halo.head||A.halo.head,w.halo.tail=w.halo.tail||A.halo.tail,w.outline.body=w.outline.body||A.outline.body,w.outline.head=w.outline.head||A.outline.head,w.outline.tail=w.outline.tail||A.outline.tail,w.body.body=w.body.body||A.body.body,w.body.head=w.body.head||A.body.head,w.body.tail=w.body.tail||A.body.tail;let T=w.texts,C=A.texts;T.primary.text=T.primary.text||C.primary.text,T.primary.background=T.primary.background||C.primary.background,T.secondary.text=T.secondary.text||C.secondary.text,T.secondary.background=T.secondary.background||C.secondary.background})(this._endFlags,this._startFlags)}this._initComponents(this._fullComponents,this._endFlags,this._layers),Aa(this._fullComponents,this._endComponents),zf(w,T,A,this._attributes,this._endComponents,this._endInput),se&&(va(this._fullComponents,this._startComponents),zf(w,T,A,this._attributesPrev,this._startComponents,this._startInput),this._setBlocksAnimation(W,$,Z)),this._setupHaloMasking(O,j),this._storeBlocks()}_setupHaloMasking(A,w){let T=this._nodeAttributes.halo,C=this._layers,k=T.color.get(A)&&T.hideNonAdjacentEdges.get(A),N=T.color.get(w)&&T.hideNonAdjacentEdges.get(w),O=k||N?1:3;C.body.stencilUsage=C.text.stencilUsage=C.textBg.stencilUsage=O}_computeBlockIds(A){let w=10*A,T=this._blockIds;T.body=w+5,T.halo=w+8,T.text=w+6,T.textBg=w+7}_prepareBlocks(A,w,T,C){let k=this._layers;k.body.reset(C?3:1,A,w.edgeBody,T),k.halo.reset(C?3:1,A,w.edgeHalo,T),k.text.reset(2,A,w.edgeText,T),k.textBg.reset(1,A,w.edgeTextBackground,T)}_storeBlocks(){let A=this._engine,w=this._layers,T=this._blockIds;A.storeGroup(T.body,w.body),A.storeGroup(T.halo,w.halo),A.storeGroup(T.text,w.text),A.storeGroup(T.textBg,w.textBg)}_freeBlocks(){let A=this._engine,w=this._blockIds;A.freeBlock(w.body),A.freeBlock(w.halo),A.freeBlock(w.text),A.freeBlock(w.textBg)}_setBlocksAnimation(A,w,T){let C=this._layers;C.body.setGlobalAnimation(A,w,T),C.halo.setGlobalAnimation(A,w,T),C.text.setGlobalAnimation(A,w,T),C.textBg.setGlobalAnimation(A,w,T)}_initComponents(A,w,T){this._initEdgeComponents(A.halo,w.halo,T.halo),this._initEdgeComponents(A.outline,w.outline,T.body),this._initEdgeComponents(A.body,w.body,T.body),this._initTextComponents(A.texts.primary,w.texts.primary,T),this._initTextComponents(A.texts.secondary,w.texts.secondary,T)}_initEdgeComponents(A,w,T){A.head=this._nextElement(w.head,T),A.tail=this._nextElement(w.tail,T),A.body=this._nextElement(w.body,T)}_initTextComponents(A,w,T){A.background=this._nextElement(w.background,T.textBg),A.text=this._nextElement(w.text,T.text)}_nextElement(A,w){return A?w.next():this._nullElt}}({engine:T,imageManager:C,fontManager:k,formatText:G,view:N,attributes:$,attributesPrev:Z,nodeAttributes:H,nodeAttributesPrev:W});for(let w=0;w<be.length;++w)A.drawEdge(be[w])}}var Sa=Ee&&document.fonts,Ea="/qwerty/ [HELLO] ",Ta="serif";function wi(A,w,T){let C=T.length,k=C-1,N=!1;for(let O=0;O<C;++O)(T[O].y<w&&T[k].y>=w||T[k].y<w&&T[O].y>=w)&&(T[O].x<=A||T[k].x<=A)&&(N=N!==T[O].x+(w-T[O].y)/(T[k].y-T[O].y)*(T[k].x-T[O].x)<A),k=O;return N}function Hm(A){let w=A.x*A.x+A.y*A.y;return{x:A.x/w,y:A.y/w}}function lD(A,w){let T=1/0,C=-1/0;for(let k=0,N=A.length;k<N;k++){let N=A[k],O=N.x*w.x+N.y*w.y;O<T&&(T=O),O>C&&(C=O)}return{x:T,y:C}}function Wf(A,w){let T=function UL(A,w){let T=A[1],C=A[0],k=Hm({x:T.x-C.x,y:T.y-C.y}),N=k.x;k.x=-k.y,k.y=N;let O=k;T=A[2],C=A[1],k=Hm({x:T.x-C.x,y:T.y-C.y}),N=k.x,k.x=-k.y,k.y=N;let j=k;T=w[1],C=w[0],k=Hm({x:T.x-C.x,y:T.y-C.y}),N=k.x,k.x=-k.y,k.y=N;let G=k;return T=w[2],C=w[1],k=Hm({x:T.x-C.x,y:T.y-C.y}),N=k.x,k.x=-k.y,k.y=N,[O,j,G,k]}(A,w);for(let C=0,k=T.length;C<k;C++){let k=T[C],N=lD(A,k),O=lD(w,k);if(0==(N.x<=O.y&&N.y>=O.x?Math.min(N.y,O.y)-Math.max(N.x,O.x):0))return!1}return!0}function xl(A){let w=0,T=0,C=A.length;if(0===C)throw new Error("Compute centroid: at least one point is required");for(let k=0;k<C;++k){let C=A[k];w+=C.x,T+=C.y}return w/=C,T/=C,{x:w,y:T}}var La=Yf(4),ka=function QL(){return new Array(12).fill(0).map(((A,w)=>({x:Math.cos(w/12*2*Math.PI),y:Math.sin(w/12*2*Math.PI)})))}(),Ma=Yf(5),Ia=Yf(10,.4),Na=1/3,Fa=[{x:-1,y:-Na},{x:-.55,y:-Na},{x:-1,y:-1},{x:1,y:0},{x:-1,y:1},{x:-.55,y:Na},{x:-1,y:Na}],za=[{x:-.6,y:-.3},{x:.1,y:0},{x:-.6,y:.3}],Pa={circle:{getDistanceFromStrokeVertically:(A,w)=>1,getDistanceFromStrokeHorizontally:(A,w)=>1-Math.sqrt(A*A+w*w),points:[{x:0,y:0,r:1}],isSimple:!0},square:{getDistanceFromStrokeVertically:(A,w)=>1-Math.abs(w),getDistanceFromStrokeHorizontally:(A,w)=>1-Math.abs(A),points:[{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],isSimple:!0},line:{getDistanceFromStrokeVertically:(A,w)=>1-Math.abs(w),getDistanceFromStrokeHorizontally:(A,w)=>1,points:[{x:-1,y:0},{x:1,y:0}],isSimple:!0},triangle:{getDistanceFromStrokeVertically:(A,w)=>(1-A)/2-Math.abs(w),getDistanceFromStrokeHorizontally:(A,w)=>1-Math.abs(A),points:[{x:-1,y:-1},{x:-1,y:1},{x:1,y:0}],isSimple:!0},arrow:{getDistanceFromStrokeVertically:(A,w)=>(1-A)/2-Math.abs(w),getDistanceFromStrokeHorizontally:(A,w)=>1-Math.abs(A),points:[{x:-1,y:-1},{x:-1,y:1},{x:1,y:0}],isSimple:!0},"circle-hole-arrow":{getDistanceFromStrokeVertically:(A,w)=>Math.min(Math.sqrt((A+.4)*(A+.4)+w*w)-.27,(1-A)/2-Math.abs(w)),getDistanceFromStrokeHorizontally:(A,w)=>1-Math.abs(A),points:[{x:-1,y:-1},{x:-1,y:1},{x:1,y:0}],hole:[{x:-.4,y:0,r:.3}],isSimple:!0},"triangle-hole-arrow":{getDistanceFromStrokeVertically:(A,w)=>{let T=Math.min((1-A)/2-Math.abs(w),1-Math.abs(A)),C=-cD(A,w,za);return Math.min(T,C)},getDistanceFromStrokeHorizontally:(A,w)=>1,points:[{x:-1,y:-1},{x:-1,y:1},{x:1,y:0}],hole:za,isSimple:!0},"short-arrow":Os([{x:-1,y:-Na},{x:0,y:-Na},{x:0,y:-1},{x:1,y:0},{x:0,y:1},{x:0,y:Na},{x:-1,y:Na}],!1),"sharp-arrow":Os(Fa,!1),cross:{getDistanceFromStrokeVertically:(A,w)=>1,getDistanceFromStrokeHorizontally:(A,w)=>{let T=Math.abs(A),C=Math.abs(w),k=.31-Math.min(T,C),N=1-Math.max(T,C);return Math.min(k,N)},points:[{x:-1,y:.31},{x:-1,y:-.31},{x:-.31,y:-.31},{x:-.31,y:-1},{x:.31,y:-1},{x:.31,y:-.31},{x:1,y:-.31},{x:1,y:.31},{x:.31,y:.31},{x:.31,y:1},{x:-.31,y:1},{x:-.31,y:.31}],isSimple:!1},diamond:Os(La),roundedSquare:Os(ka),pentagon:Os(Ma),star:Os(Ia)},Da=["circle","square","roundedSquare","triangle","line"],Ba=["cross","diamond","pentagon","star"],ja=["arrow","triangle-hole-arrow","circle-hole-arrow","short-arrow","sharp-arrow"];function Kf(A,w){for(let w of Da)Xf(A,w);let T=w.nodes.current.shape.getValues(),C=w.edges.current.shape.head.getValues(),k=w.edges.current.shape.tail.getValues();for(let w of Ba)T.includes(w)&&Xf(A,w);for(let w of ja)w&&(C.includes(w)||k.includes(w))&&Xf(A,w)}function Xf(A,w){A.registerShape(w,Pa[w])}function cD(A,w,T){let C=1/0,k={x:A,y:w};for(let A=0;A<T.length;++A){let w=T[A],N=T[(A+1)%T.length];C=Math.min(C,df(k,w,N))}return C*(wi(A,w,T)?1:-1)}function Yf(A,w=1){let T=-Math.PI/2+1e-6,C=[],k=2*Math.PI/A,N=T;for(let T=0;T<A;++T){let A=T%2==1?w:1;C.push({x:Math.cos(N)*A,y:Math.sin(N)*A}),N+=k}return C}function Os(A,w=!1){return{getDistanceFromStrokeVertically:()=>1,getDistanceFromStrokeHorizontally:(w,T)=>cD(w,T,A),points:A,isSimple:w}}var JL=({graphWidth:A,graphHeight:w,viewWidth:T,viewHeight:C})=>.2*Math.min(T/A,C/w),eI=({smallestNodeSize:A,viewWidth:w,viewHeight:T})=>A===1/0?1/0:Math.min(w,T)/A*.5,Ga=Math.SQRT2,$a=class extends kt{constructor(A,w){super(A),this._zooming=!1,this.debug=!1,this.debug=w}onMounted(){let A=this._modules.settings;A.register("interactions.zoom.enabled",!0),A.register("interactions.zoom.onDoubleClick",!1),A.register("interactions.zoom.duration",150),A.register("interactions.zoom.modifier",Ga),A.register("interactions.zoom.easing","cubicOut"),A.register("interactions.zoom.minValue",this.debug?null:JL),A.register("interactions.zoom.maxValue",this.debug?null:eI),A.register("interactions.zoom.hideNodes",!1),A.register("interactions.zoom.hideEdges",!1),A.register("interactions.zoom.hideNodeTexts",!1),A.register("interactions.zoom.hideEdgeTexts",!1),A.register("interactions.pan.enabled",!0),A.register("interactions.pan.hideNodes",!1),A.register("interactions.pan.hideEdges",!1),A.register("interactions.pan.hideNodeTexts",!1),A.register("interactions.pan.hideEdgeTexts",!1),A.register("interactions.rotation.enabled",!0),A.register("interactions.rotation.hideNodes",!1),A.register("interactions.rotation.hideEdges",!1),A.register("interactions.rotation.hideNodeTexts",!1),A.register("interactions.rotation.hideEdgeTexts",!1),A.register("interactions.gesture.enabled",!0),A.register("interactions.gesture.hideNodes",!1),A.register("interactions.gesture.hideEdges",!1),A.register("interactions.gesture.hideNodeTexts",!1),A.register("interactions.gesture.hideEdgeTexts",!1),this._setupInteractions()}_setupInteractions(){this._modules.interactions.onMouseWheel({priority:"zoom",check:()=>!!this._modules.settings.get("interactions.zoom.enabled"),handler:Va((({x:A,y:w,delta:T})=>this._smoothZoom(T,A,w)),50)}),this._modules.interactions.onDoubleClick({priority:"zoom",check:()=>{let A=this._modules.settings.get("interactions.zoom.enabled"),w=this._modules.settings.get("interactions.zoom.onDoubleClick");return!(!A||!w)},handler:({x:A,y:w})=>this._smoothZoom(1,A,w)}),this._modules.interactions.onDrag({priority:"panning",disableDetection:!0,check:({button:A})=>{let w=!!this._modules.settings.get("interactions.pan.enabled");return"left"===A&&w},onStart:()=>this._updateVisibility("pan",!0),onProgress:({dx:A,dy:w})=>this._modules.camera.move({x:-A,y:-w}),onStop:()=>this._updateVisibility("pan",!1)}),this._modules.interactions.onDrag({priority:"rotation",disableDetection:!0,check:({button:A,domEvent:w})=>("right"===A||w&&2===w.buttons)&&!!this._modules.settings.get("interactions.rotation.enabled"),onStart:({x:A,y:w})=>{this._rotationStart={x:A,y:w},this._updateVisibility("rotation",!0)},onProgress:({x:A,y:w})=>this._rotate({x:A,y:w}),onStop:()=>this._updateVisibility("rotation",!1)}),this._modules.interactions.onGesture({priority:"gesture",disableDetection:!0,check:()=>!!this._modules.settings.get("interactions.gesture.enabled"),onStart:()=>this._updateVisibility("gesture",!0),onProgress:({dx:A,dy:w,rotation:T,scale:C,x:k,y:N})=>{this._modules.settings.get("interactions.rotation.enabled")&&this._modules.camera.rotate(-T),this._modules.camera.zoomIn({modifier:C},{x:k,y:N}),this._modules.camera.move({x:-A,y:-w})},onStop:()=>this._updateVisibility("gesture",!0)})}_rotate({x:A,y:w}){let{width:T,height:C}=this._modules.camera.getSize(),k=T/2,N=C/2,O=this._rotationStart.x-k,j=this._rotationStart.y-N,G=A-k,H=w-N,W=Math.atan2(j,O)-Math.atan2(H,G);this._rotationStart.x=A,this._rotationStart.y=w,this._modules.camera.rotate(W)}_updateVisibility(A,w){let T=!w,C=this._modules.settings,k=C.get(`interactions.${A}.hideNodes`),N=C.get(`interactions.${A}.hideEdges`),O=C.get(`interactions.${A}.hideNodeTexts`),j=C.get(`interactions.${A}.hideEdgeTexts`);k&&this._modules.graphics.setNodesVisibility(T),O&&this._modules.graphics.setNodeTextsVisibility(T),N&&this._modules.graphics.setEdgesVisibility(T),j&&this._modules.graphics.setEdgeTextsVisibility(T)}_smoothZoom(A,w,T){let C=this._modules.settings,k=C.get("interactions.zoom.modifier")||Ga,N=C.get("interactions.zoom.duration"),O=C.get("interactions.zoom.easing"),j=this._modules.camera.getZoom()*(A>0?k:1/k),G={duration:N,easing:O};this._zooming||(this._zooming=!0,this._updateVisibility("zoom",!0)),this._modules.camera.setZoom(j,G,{x:w,y:T}).then((()=>{this._zooming&&(this._zooming=!1,this._updateVisibility("zoom",!1))}))}};function hD(A){return((A=Math.exp(A))+1/A)/2}var qa=function n(A,w,T){function i(C,k){var N,O,j=C[0],G=C[1],H=C[2],W=k[0],$=k[1],Z=k[2],se=W-j,ue=$-G,ge=se*se+ue*ue;if(ge<1e-12)O=Math.log(Z/H)/A,N=function(w){return[j+w*se,G+w*ue,H*Math.exp(A*w*O)]};else{var ce=Math.sqrt(ge),_e=(Z*Z-H*H+T*ge)/(2*H*w*ce),me=(Z*Z-H*H-T*ge)/(2*Z*w*ce),pe=Math.log(Math.sqrt(_e*_e+1)-_e),be=Math.log(Math.sqrt(me*me+1)-me);O=(be-pe)/A,N=function(T){var C=T*O,k=hD(pe),N=H/(w*ce)*(k*function nI(A){return((A=Math.exp(2*A))-1)/(A+1)}(A*C+pe)-function rI(A){return((A=Math.exp(A))-1/A)/2}(pe));return[j+N*se,G+N*ue,H*k/hD(A*C+pe)]}}return N.duration=1e3*O*A/Math.SQRT2,N}return i.rho=function(A){var w=Math.max(.001,+A),T=w*w;return n(w,T,T*T)},i}(Math.SQRT2,2,4),Qa=1e8,Ja={duration:0,easing:"linear",startAfter:0,ignoreZoomLimits:!1,callback:Ze};function Wm(A){return Math.abs(A)<1e-9}var Ka=class extends kt{constructor(){super(...arguments),this._minZoom=1e-8,this._maxZoom=Qa,this._timeout=0}onMounted(){this._reset(),this._modules.settings.register("minZoom",1e-8,(A=>{this._minZoom=A,this._zoom<A&&(this._zoom=A,this._modules.events.fire("move"))})),this._modules.settings.register("maxZoom",Qa,(A=>{this._maxZoom=A,this._zoom>A&&(this._zoom=A,this._modules.events.fire("move"))})),this._modules.events.on("setContainer",(()=>{this._reset(),this._modules.events.fire("move")})).on("resize",(()=>{this._reloadDimensions(),this._modules.events.fire("move")}))}get x(){return this._x}get y(){return this._y}get zoom(){return this._zoom}get angle(){return this._angle}get width(){return this._dimensions.width}get height(){return this._dimensions.height}moveEnd(A){this._modules.dom.clearTimeout(this._timeout),this._timeout=this._modules.dom.setTimeout((()=>this._modules.events.fire("viewChanged",{type:A})),80)}getSize(){return{width:this._dimensions.width,height:this._dimensions.height}}getCenter(){return{x:this._x,y:this._y}}setCenter({x:A,y:w},T){let C=this._x,k=this._y,N=A-this._x,O=w-this._y;return Wm(N)&&Wm(O)?Promise.resolve():new Promise((A=>{this._moveAnimation&&this._modules.animations.cancel(this._moveAnimation);let w=this._modules.animations.play((A=>{this._x=C+N*A,this._y=k+O*A,this._modules.events.fire("move"),this._modules.events.fire("pan")}),ke(re(re({},Ja),T),{callback:()=>this.moveEnd("pan"),resolve:A}));w&&(this._moveAnimation=w)}))}move({x:A,y:w},T){let C=pD({x:A,y:w},this._zoom,this._sinAngle,this._cosAngle);return this.setCenter({x:this._x+C.x,y:this._y+C.y},T)}getZoom(){return this._zoom}setZoom(A,w,T={x:void 0,y:void 0}){let{x:C,y:k}=T,N=Vt(A,this._minZoom,this._maxZoom);return w&&w.ignoreZoomLimits||(N=this._applyZoomLimits(N)),Wm(this._zoom-N)?Promise.resolve():new Promise((A=>{let T=ke(re(re({},Ja),w),{callback:()=>this.moveEnd("zoom"),resolve:A}),O=this._dimensions.width/2,j=this._dimensions.height/2,G=this._zoom,H=O/G-O/N;if(void 0!==C&&void 0!==k){let A=(C-O)/G-(C-O)/N,T=(k-j)/G-(k-j)/N,H=this._cosAngle,W=this._sinAngle,$=H*A-W*T,Z=W*A+H*T;this.setCenter({x:this._x+$,y:this._y+Z},w)}this._zoomAnimation&&this._modules.animations.cancel(this._zoomAnimation),this._modules.dom.afterNextFrame().then((()=>{this._modules.events.fire("zoomStart",{duration:T.duration,easing:T.easing,startZoom:G,endZoom:N})}));let W=this._modules.animations.play((A=>{this._zoom=O/(O/G-H*A),this._modules.events.fire("move"),this._modules.events.fire("zoom")}),T);W&&(this._zoomAnimation=W)}))}_applyZoomLimits(A){let w=this._modules.settings.get("interactions.zoom.minValue"),T=this._modules.settings.get("interactions.zoom.maxValue"),{minScaledSize:C,maxScaledSize:k,width:N,height:O,cx:j}=this._modules.locate.getGraphBoundingBox(),G=this._zoom,H=this.getSize(),W=A;if(!isNaN(j)){let A={smallestNodeSize:C,biggestNodeSize:k,graphWidth:N+k,graphHeight:O+k,viewWidth:H.width,viewHeight:H.height},j=w&&w(A),$=T&&T(A);fD(j)&&W<j?W<G&&(W=Math.min(G,j)):fD($)&&W>$&&W>G&&(W=Math.max(G,$))}return W}zoomIn(A,w={x:void 0,y:void 0}){let T=1;return void 0===A&&(A={}),"number"==typeof A&&(A={modifier:A}),T="number"!=typeof A.modifier?this._modules.settings.get("interactions.zoom.modifier")||Ga:A.modifier,this.setZoom(this._zoom*T,A,w)}moveToBounds(A,w={}){let T=this._modules.locate.computeConfigForBounds(A,{ignoreZoomLimits:!0});return this.moveTo(T,w)}moveTo(A,w={}){let T=this.getZoom(),C=this.getCenter(),k=A.zoom||this._zoom;return 0===w.duration?this.setView(A):new Promise((N=>{let O=Math.min(this.width,this.height),j=qa([C.x,C.y,O/T],[A.x,A.y,O/k]),G=j.duration,H=w.duration||G;this._moveAnimation&&this._modules.animations.cancel(this._moveAnimation);let W=this._modules.animations.play((A=>{let[w,T,C]=j(A);this._x=w,this._y=T,this._zoom=O/C,this._modules.events.fire("move"),this._modules.events.fire("pan")}),{duration:H,easing:w.easing,callback:()=>this.moveEnd("pan"),resolve:N});W&&(this._moveAnimation=W)}))}zoomOut(A,w={x:void 0,y:void 0}){let T=1;return void 0===A&&(A={}),"number"==typeof A&&(A={modifier:A}),T="number"!=typeof A.modifier?this._modules.settings.get("interactions.zoom.modifier")||Ga:A.modifier,this.setZoom(this._zoom/T,A,w)}getAngle(){return this._angle}setAngle(A,w){let T=this._angle,C=A-T;return Wm(C)?Promise.resolve():new Promise((A=>{this._rotateAnimation&&this._modules.animations.cancel(this._rotateAnimation);let k=this._modules.animations.play((A=>{for(this._angle=T+C*A;this._angle>Math.PI;)this._angle-=2*Math.PI;for(;this._angle<-Math.PI;)this._angle+=2*Math.PI;this._sinAngle=Math.sin(this._angle),this._cosAngle=Math.cos(this._angle),this._modules.events.fire("move").fire("rotate")}),ke(re(re({},Ja),w),{callback:()=>this.moveEnd("rotate"),resolve:A}));k&&(this._rotateAnimation=k)}))}rotate(A,w){return this.setAngle(this._angle+A,w)}getScreenCenter(){return{x:this._dimensions.width/2,y:this._dimensions.height/2}}graphToScreenCoordinates({x:A,y:w},T={x:0,y:0}){let C=this._dimensions.width/2,k=this._dimensions.height/2;return xs((A-this._x)*this._zoom+C,(w-this._y)*this._zoom+k,C,k,-this._angle,T)}screenToGraphCoordinates({x:A,y:w},T={x:0,y:0}){return xs(this._x+(A-this._dimensions.width/2)/this._zoom,this._y+(w-this._dimensions.height/2)/this._zoom,this._x,this._y,this._angle,T)}projectBounds(A,w=A){let[T,C,k,N]=A,O=this._x,j=this._y,G=this._dimensions.width/2,H=this._dimensions.height/2,W=this._sinAngle,$=this._cosAngle,Z=1/this._zoom,se=1/0,ue=1/0,ge=-1/0,ce=-1/0,_e=[T,C,T,N,k,N,k,C];for(let A=0;A<_e.length;A+=2){let w=_e[A],T=_e[A+1];w=O+(w-G)*Z,T=j+(T-H)*Z;let C=w-O,k=T-j;w=$*C-W*k+O,T=W*C+$*k+j,w<se&&(se=w),w>ge&&(ge=w),T<ue&&(ue=T),T>ce&&(ce=T)}return w[0]=se,w[1]=ue,w[2]=ge,w[3]=ce,w}screenToGraphVector({x:A,y:w}){return pD({x:A,y:w},this._zoom,this._sinAngle,this._cosAngle)}getView(){return{x:this._x,y:this._y,zoom:this._zoom,angle:this._angle,width:this._dimensions.width,height:this._dimensions.height}}setView(A,w){let{x:T,y:C,zoom:k,angle:N}=re({x:this._x,y:this._y,zoom:this._zoom,angle:this._angle},A);return Promise.all([this.setCenter({x:T,y:C},w),this.setZoom(k,w),this.setAngle(N,w)]).then(Ze)}_reloadDimensions(){this._dimensions=this._modules.dom.getDimensions()}animationInProgress(){let A=this._moveAnimation,w=this._zoomAnimation,T=this._rotateAnimation;return Boolean(A&&!A.done||w&&!w.done||T&&!T.done)}getProjectedScreenBounds(A=0){let{width:w,height:T}=this._dimensions,C=Math.max(w,T)*A;return this.projectBounds([0-C,0-C,w+C,T+C])}_reset(){this._zoom=1,this._x=0,this._y=0,this._angle=0,this._sinAngle=0,this._cosAngle=1,this._dimensions=this._modules.dom.getDimensions()}clone(A){let w=new Ka(this._ogma);return w._zoom=A.zoom||this._zoom,w._x=A.x||this._x,w._y=A.y||this._y,w._angle=A.angle||this._angle,w._sinAngle=A.sinAngle||this._sinAngle,w._cosAngle=A.cosAngle||this._cosAngle,w._dimensions=A.dimensions?re({},A.dimensions):re({},this._dimensions),w}};function pD({x:A,y:w},T,C,k){return{x:k*(A/=T)-C*(w/=T),y:C*A+k*w}}function fD(A){return"number"==typeof A&&isFinite(A)}var el={maxBlockId:1024,maxCoord:-1/0,maxScaledSize:16,maxPixelSize:255,maxMinVisibleSize:64,maxDashOffset:4,maxDashLength:3,maxGapLength:1,maxSymbolicSize:0,maxPatternScale:0},tl=Se?"webgl":null,il=class extends kt{constructor(){super(...arguments),this._debug=!1,this._initDone=!1,this._boundaries={maxSize:10,maxMinVisibleSize:64},this._visibility={nodes:0,edges:0,nodeTexts:0,edgeTexts:0},this._nextAnimationId=1,this._animations=[],this._rendererState={type:null,code:null,state:"ok",message:""},this._cursorStyle=[],this._fontsNewlyLoaded=[],this._nextGeIndex=1,this._availableGeIndexes=[],this._renderOnNewFrame=!0,this._isBufferDisplayable=A=>{let w=function Sx(A){let w=A.depth;return 2===w||1===w||(w-30)%6>=3}(A),T=Rm(A),C=w?this._visibility.nodes:this._visibility.edges,k=w?this._visibility.nodeTexts:this._visibility.edgeTexts;return 0===C&&(!T||0===k)},this._applyCursorStyle=()=>{let A=this._cursorStyle[this._cursorStyle.length-1]||this._modules.settings.get("cursor.default");Qo(this._domWrapper,A)},this._updateImageCrossOrigin=()=>{this._imageManager.setImgCrossOrigin(this._modules.settings.get("imgCrossOrigin")||null)}}onMounted(){this._debug=this._ogma.isDebug(),this._renderOnNewFrame=!0,this._formatText=ch().applyArabicShaping,this._attributesManager=new class{constructor(A,{graph:w,dom:T}){this._layerIdCounter=0,this._layers=[],this._destroyedLayers=[],this._layersNeedUpdate=!1,this._updateOngoing=!1,this._needUpdate=!1,this._ogma=A,this._graph=w,this._dom=T,this._emptySubgraph={nodes:A.nodeList(),edges:A.edgeList()},this._textHiddenSet=new Ss(this._graph,"textHidden"),this._layerController=new class{constructor(A,w){this.nodes=new xa(A,w,!0,Ax),this.edges=new xa(A,w,!1,vx)}setNodeDefaultAttributes(A){this.nodes.setDefaultAttributes(A)}setEdgeDefaultAttributes(A){this.edges.setDefaultAttributes(A)}getFlexArrays(){return{nodes:{current:this.nodes.getAttributeFlexArrays(),previous:this.nodes.getPrevAttributeFlexArrays()},edges:{current:this.edges.getAttributeFlexArrays(),previous:this.edges.getPrevAttributeFlexArrays()}}}redrawAll(){this.nodes.redrawAll(),this.edges.redrawAll()}clear(){this.nodes.clear(),this.edges.clear()}redrawElements(A){this._fetch(A).redrawElements(A)}getAnimationInformation(A){return this._fetch(A).getAnimationInformation(A)}redrawNodes(A){this.nodes.redrawElements(A)}getUsedAttributes(A,w){return this._fetch(w).getUsedAttributeNames(w.isNode?A.nodes:A.edges)}startUpdate(){this.nodes.startUpdate(),this.edges.startUpdate()}notifyDestroyed(A){this.nodes.notifyLayerDestroyed(A.nodes),this.edges.notifyLayerDestroyed(A.edges)}prepareUpdate(A){this.nodes.prepareFlexArraysUpdate(A.nodes),this.edges.prepareFlexArraysUpdate(A.edges)}onUpdate(A){this.nodes.updateFlexArrays(A.nodes),this.edges.updateFlexArrays(A.edges)}afterLayersUpdate(){this.nodes.endUpdate(),this.edges.endUpdate()}getAndResetElementsToRedraw(){return{nodes:this.nodes.getAndResetElementsToRedraw(),edges:this.edges.getAndResetElementsToRedraw()}}getAndResetElementsUpdated(){let A=this.nodes,w=this.edges;return{nodes:A.getAndResetElementsUpdated(),edges:w.getAndResetElementsUpdated(),nodeAttributesSet:A.getUpdatedAttributesSet(),nodeAttributes:A.getAndResetAttributesUpdated(),edgeAttributes:w.getAndResetAttributesUpdated()}}setAnimationAttributes({nodes:A,edges:w},T){this.nodes.setAnimationAttributes(A,T),this.edges.setAnimationAttributes(w,T)}resetAnimationAttributes({nodes:A,edges:w}){this.nodes.resetAnimationAttributes(A),this.edges.resetAnimationAttributes(w)}setLastOutput(A,w){this.nodes.setLastFlexArrays(A),this.edges.setLastFlexArrays(w)}getCurrentInput(){let A=nt(this.nodes.getDefaultFlexArrays()),w=nt(this.edges.getDefaultFlexArrays());return{currentNodeFlexArrays:A,currentEdgeFlexArrays:w,allNodeAttributePaths:Rn(A),allEdgeAttributePaths:Rn(w)}}initializeLayer(A,w,T){A.nodes.allAttributePaths=w,A.edges.allAttributePaths=T,A.nodes.formattedDependencies=function yx(A){let w=A.dependencies;void 0===w?w=ca:wt(w)||(w={});let T=Ha(A.attributes).some((A=>"function"==typeof A)),C=A.selector&&!A.standaloneSelector,k=!(!T&&!C),N=w.adjacentEdges;return!N&&w.adjacentNodes&&(N=!0),{self:Tn(w.self,k,A.allAttributePaths),adjacentNodes:Tn(w.adjacentNodes,k,A.allAttributePaths),adjacentEdges:Tn(N,k,A.allAttributePaths),allNodes:Tn(w.allNodes,k,A.allAttributePaths),allEdges:Tn(w.allEdges,k,A.allAttributePaths)}}(A.nodes),A.edges.formattedDependencies=function xx(A){let w=A.dependencies;void 0===w?w=_a:wt(w)||(w={});let T=Ha(A.attributes).some((A=>"function"==typeof A)),C=A.selector&&!A.standaloneSelector,k=!(!T&&!C);return{self:Tn(w.self,k,A.allAttributePaths),extremities:Tn(w.extremities,k,A.allAttributePaths),parallelEdges:Tn(w.parallelEdges,k,A.allAttributePaths),allNodes:Tn(w.allNodes,k,A.allAttributePaths),allEdges:Tn(w.allEdges,k,A.allAttributePaths)}}(A.edges),A.nodes.formattedOutput={attributes:Tf(A.nodes),tags:A.tag?[A.tag]:[]},A.edges.formattedOutput={attributes:Tf(A.edges),tags:A.tag?[A.tag]:[]},A.nodes.redrawAdjacentEdges=A.nodes.formattedOutput.attributes.some((A=>ma[A])),A.initialized=!0}connectLayerInputOutput(A,w,T){let C=A.nodes.formattedOutput,k=A.edges.formattedOutput;for(let T of C.attributes){let C=Tt(w,T),k=Tt(A.nodes.outputFlexArrays,T);k.setFallback(C),Nr(w,T,k)}for(let w of k.attributes){let C=Tt(T,w),k=Tt(A.edges.outputFlexArrays,w);k.setFallback(C),Nr(T,w,k)}}setupLayerDependencies(A,w){if(A===w)return;let T=A.priority,C=w.priority,k=A.nodes.formattedOutput,N=A.edges.formattedOutput,O=w.nodes.formattedDependencies,j=w.edges.formattedDependencies;un(A.depsNodeSelf,w,k,O.self,T,C),un(A.depsNodeAdjacentNodes,w,k,O.adjacentNodes,T,C),un(A.depsNodeAdjacentEdges,w,N,j.extremities,T,C),un(A.depsNodeAllNodes,w,k,O.allNodes,T,C),un(A.depsNodeAllEdges,w,N,j.allNodes,T,C),un(A.depsEdgeSelf,w,N,j.self,T,C),un(A.depsEdgeExtremities,w,k,O.adjacentEdges,T,C),un(A.depsEdgeParallelEdges,w,N,j.parallelEdges,T,C),un(A.depsEdgeAllNodes,w,k,O.allEdges,T,C),un(A.depsEdgeAllEdges,w,N,j.allEdges,T,C)}createAttributeLayerData(A,w,T,{tag:C,onBeforeUpdate:k,standaloneSelectors:N}){let O=!!N;return{index:-1,id:w,name:A,tag:C||null,priority:0,depsNodeSelf:[],depsNodeAdjacentNodes:[],depsNodeAdjacentEdges:[],depsNodeAllNodes:[],depsNodeAllEdges:[],depsEdgeSelf:[],depsEdgeExtremities:[],depsEdgeParallelEdges:[],depsEdgeAllNodes:[],depsEdgeAllEdges:[],initialized:!1,onBeforeUpdate:k,nodes:{type:"node",name:A,standaloneSelector:O,toUpdate:new Fn({graph:T,isNode:!0,includeRemovedElements:!1}),outputFlexArrays:this.nodes.createFlexArrays(),inputFlexArrays:null,formattedDependencies:null,formattedOutput:null},edges:{type:"edge",name:A,standaloneSelector:O,toUpdate:new Fn({graph:T,isNode:!1,includeRemovedElements:!1}),outputFlexArrays:this.edges.createFlexArrays(),inputFlexArrays:null,formattedDependencies:null,formattedOutput:null}}}setAttributeValues(A,w,T,C,k){this._fetch(w).setAttributeValues(A,w,T,C,k)}getAttributeValues(A,w,T,C){return this._fetch(A).getAttributeValues(A,w,T,C)}_fetch(A){return A.isNode?this.nodes:this.edges}}(this._graph,new Fs)}_getLayerById(A){for(let w=0;w<this._layers.length;++w){let T=this._layers[w];if(T.id===A)return T.index=w,T}throw new Error("usage of a destroyed style rule or class")}setDefaultAttributes(A,w){this._layerController.setNodeDefaultAttributes(A),this._layerController.setEdgeDefaultAttributes(w)}getFlexArrays(){return this._layerController.getFlexArrays()}clear(){this._updateOngoing=!1,this._needUpdate=!1,this._destroyedLayers=[],this._layerController.clear(),this.updateAllForAllAttributeLayers()}redrawElements(A){A.size&&(this._layerController.redrawElements(A),this._dom.refresh())}redrawAll(){this._layerController.redrawAll(),this._dom.refresh()}_triggerUpdate(){this._needUpdate=!0,this._dom.refresh()}_reconstructAttributeLayersIfNecessary(){return!!this._layersNeedUpdate&&(this._reconstructAttributeLayers(),this._layersNeedUpdate=!1,this._dom.refresh(),!0)}getAnimationInformation(A){return this._layerController.getAnimationInformation(A)}update(){if(!this._needUpdate||this._updateOngoing||!this._ogma._token)return!1;this._reconstructAttributeLayersIfNecessary(),this._updateOngoing=!0,this._layerController.startUpdate();for(let A of this._destroyedLayers)A.initialized&&this._layerController.notifyDestroyed(A);for(let A of this._layers)this._layerController.prepareUpdate(A),"function"==typeof A.onBeforeUpdate&&A.onBeforeUpdate(A,this,this._layerController),this._layerController.onUpdate(A);return this._layerController.afterLayersUpdate(),this._updateOngoing=!1,this._needUpdate=!1,!0}setAttributeLayerValues(A,w,T,C){let k=this._getLayerById(A),N=w.isNode?k.nodes:k.edges;this._reconstructAttributeLayersIfNecessary(),this._layerController.setAttributeValues(N,w,T,C,k),this._updateElementsForAttributeLayers([k],w)}getAttributeLayerFlexArrays(A){let w=this._getLayerById(A);return{nodes:w.nodes.outputFlexArrays,edges:w.edges.outputFlexArrays}}getUsedAttributeLayerAttributes(A,w){let T=this._getLayerById(A);return this._layerController.getUsedAttributes(T,w)}getUpdatedElements(){return{elementsToRedraw:this._layerController.getAndResetElementsToRedraw(),elementsUpdated:this._layerController.getAndResetElementsUpdated()}}addAttributeLayer(A){let{name:w,layerFactory:T=lL}=A;if(!w)throw new Error("Attribute layer must have a name");if(w&&this._layers.find((A=>A.name===w)))throw new Error(`attribute layer with name "${A.name}" already exists`);let C=this._layerController.createAttributeLayerData(w,++this._layerIdCounter,this._graph,A);return this._layers.push(C),this._updateLayer(C,A),T(this,this._layerIdCounter)}_reconstructAttributeLayers(){this._layers.sort(((A,w)=>A.priority-w.priority));let{currentNodeFlexArrays:A,currentEdgeFlexArrays:w,allNodeAttributePaths:T,allEdgeAttributePaths:C}=this._layerController.getCurrentInput();for(let A of this._layers)this._layerController.initializeLayer(A,T,C);for(let T of this._layers){T.nodes.inputFlexArrays=nt(A),T.edges.inputFlexArrays=nt(w),T.depsNodeSelf=[],T.depsNodeAdjacentNodes=[],T.depsNodeAdjacentEdges=[],T.depsNodeAllNodes=[],T.depsNodeAllEdges=[],T.depsEdgeSelf=[],T.depsEdgeExtremities=[],T.depsEdgeParallelEdges=[],T.depsEdgeAllNodes=[],T.depsEdgeAllEdges=[],T.nodes.toUpdate.addAll(),T.edges.toUpdate.addAll(),this._layerController.connectLayerInputOutput(T,A,w);for(let A of this._layers)this._layerController.setupLayerDependencies(T,A)}this._layerController.setLastOutput(A,w);for(let A of this._layers)A.nodes.needAdjacentElements=A.nodes.redrawAdjacentEdges||A.depsNodeAdjacentNodes.length>0||A.depsNodeAdjacentEdges.length>0,A.edges.needAdjacentElements=A.depsEdgeExtremities.length>0||A.depsEdgeParallelEdges.length>0}_updateLayer(A,{priority:w,fullOverwrite:T,nodeAttributes:C,nodeSelector:k,nodeContext:N,nodeDependencies:O,nodeOutput:j,edgeAttributes:G,edgeSelector:H,edgeContext:W,edgeDependencies:$,edgeOutput:Z}={}){void 0!==C&&(A.nodes.attributes=T?C:Wa(A.nodes.attributes,C)),void 0!==k&&(A.nodes.selector=k),void 0!==N&&(A.nodes.context=N),void 0!==O&&(A.nodes.dependencies=O),void 0!==j&&(A.nodes.output=j),void 0!==G&&(A.edges.attributes=T?G:Wa(A.edges.attributes,G)),void 0!==H&&(A.edges.selector=H),void 0!==W&&(A.edges.context=W),void 0!==$&&(A.edges.dependencies=$),void 0!==Z&&(A.edges.output=Z),void 0!==w&&(A.priority=w),this._triggerLayerUpdate()}_triggerLayerUpdate(){this._layersNeedUpdate=!0,this._triggerUpdate()}updateAllForAttributeLayer(A){let w=this._getLayerById(A);this._updateAllForAttributeLayer(w)}updateAllForAllAttributeLayers(){for(let A of this._layers)this._updateAllForAttributeLayer(A)}_updateAllForAttributeLayer(A,w=!0,T=!0){if(w&&!A.nodes.toUpdate.isFull()){A.nodes.toUpdate.addAll();for(let w of A.depsNodeSelf)this._updateAllForAttributeLayer(w,!0,!1);for(let w of A.depsNodeAdjacentNodes)this._updateAllForAttributeLayer(w,!0,!1);for(let w of A.depsNodeAdjacentEdges)this._updateAllForAttributeLayer(w,!1,!0);for(let w of A.depsNodeAllNodes)this._updateAllForAttributeLayer(w,!0,!1);for(let w of A.depsNodeAllEdges)this._updateAllForAttributeLayer(w,!1,!0)}if(T&&!A.edges.toUpdate.isFull()){A.edges.toUpdate.addAll();for(let w of A.depsEdgeSelf)this._updateAllForAttributeLayer(w,!1,!0);for(let w of A.depsEdgeExtremities)this._updateAllForAttributeLayer(w,!0,!1);for(let w of A.depsEdgeParallelEdges)this._updateAllForAttributeLayer(w,!1,!0);for(let w of A.depsEdgeAllNodes)this._updateAllForAttributeLayer(w,!0,!1);for(let w of A.depsEdgeAllEdges)this._updateAllForAttributeLayer(w,!1,!0)}this._triggerUpdate()}updateElementsForAttributeLayer(A,w){let T=this._getLayerById(A);this._updateElementsForAttributeLayers([T],w)}updateForAllAttributeLayers(A){this._updateElementsForAttributeLayers(this._layers,A)}_updateElementsForAttributeLayers(A,w){let T=this._emptySubgraph;if(w.isNode){for(let C of A)if(!C.nodes.toUpdate.isFull()){C.nodes.needAdjacentElements&&(T=T===this._emptySubgraph?w.fastGetAdjacentElements():T),C.nodes.toUpdate.add(w);for(let A of C.depsNodeSelf)A.nodes.toUpdate.add(w);for(let A of C.depsNodeAdjacentNodes)A.nodes.toUpdate.add(T.nodes);for(let A of C.depsNodeAdjacentEdges)A.edges.toUpdate.add(T.edges);for(let A of C.depsNodeAllNodes)this._updateAllForAttributeLayer(A,!0,!1);for(let A of C.depsNodeAllEdges)this._updateAllForAttributeLayer(A,!1,!0);C.nodes.redrawAdjacentEdges&&this._layerController.redrawElements(T.edges)}}else for(let C of A)if(!C.edges.toUpdate.isFull()){C.edges.needAdjacentElements&&(T=T===this._emptySubgraph?w.fastGetAdjacentElements():T),C.edges.toUpdate.add(w);for(let A of C.depsEdgeSelf)A.edges.toUpdate.add(w);for(let A of C.depsEdgeExtremities)A.nodes.toUpdate.add(T.nodes);for(let A of C.depsEdgeParallelEdges)A.edges.toUpdate.add(T.edges);for(let A of C.depsEdgeAllNodes)this._updateAllForAttributeLayer(A,!0,!1);for(let A of C.depsEdgeAllEdges)this._updateAllForAttributeLayer(A,!1,!0)}this._triggerUpdate()}destroyAttributeLayer(A){let w=this._getLayerById(A);this._destroyedLayers.push(w),this._layers.splice(w.index,1),this._triggerLayerUpdate()}updateAttributeLayer(A,w){let T=this._getLayerById(A);this._updateLayer(T,w)}getAttributeLayerDefinition(A){let w=this._getLayerById(A),{priority:T,nodes:C,edges:k}=w;return{priority:T,nodeAttributes:C.attributes,nodeSelector:C.selector,nodeContext:C.context,nodeDependencies:C.dependencies,nodeOutput:C.output,edgeAttributes:k.attributes,edgeSelector:k.selector,edgeContext:k.context,edgeDependencies:k.dependencies,edgeOutput:k.output}}getAttributeValues(A,w,T,C){return this.update(),this._layerController.getAttributeValues(A,w,T,C)}setAnimationAttributes(A,w){return this._layerController.setAnimationAttributes(A,w)}resetAnimationAttributes(A){return this._layerController.resetAnimationAttributes(A)}setTextHidden(A,w){let T=this._textHiddenSet.addOrRemoveElements(A,w);this.redrawElements(T)}resetTextHidden(){let{nodes:A,edges:w}=this._textHiddenSet.getElements();this._textHiddenSet.clear(),this._layerController.redrawElements(A),this._layerController.redrawElements(w)}getUsedNodeAttributes(){return this._layerController.nodes.getUsedAttributes()}getUsedEdgeAttributes(){return this._layerController.edges.getUsedAttributes()}}(this._ogma,this._modules),this._imageManager=new class{constructor(){this._images={},this._crossOrigin="anonymous",this._whenReady=[],this._onFetch=[],this._nbLoaded=0,this._nbToLoad=0}setImgCrossOrigin(A){this._crossOrigin=A}clear(){this._images={},this._nbLoaded=0,this._nbToLoad=0}getImage(A){let w=this._images[A];return void 0===w&&(this._nbToLoad+=1,w=function By(A,w){return new("undefined"!=typeof Image?Image:Ln)(A,w)}(),w.crossOrigin=this._crossOrigin,w.onload=()=>this._onImgLoad(A),w.onerror=()=>{this._onImgLoad(A),this._images[A]=null},w.src=A,this._images[A]=w),w}_onImgLoad(A){this._nbLoaded+=1,this._onFetch.forEach((w=>w(A))),this._nbLoaded===this._nbToLoad&&(this._whenReady.forEach((A=>A())),this._whenReady=[])}onFetch(A){this._onFetch.push(A)}whenReady(){return this._nbLoaded===this._nbToLoad?Promise.resolve():new Promise((A=>this._whenReady.push(A)))}destroy(){this._whenReady=[],this._onFetch=[]}},this._fontManager=new class{constructor(){this._fontFaceSet=new class{constructor(){this._fontFaceSet=Sa?document.fonts:null,this._canvas=Lt(),this._ctx=this._canvas.getContext("2d"),this._ctx=this._canvas.getContext("2d")}_measureText(A,w){return this._ctx.font=`12px ${w}`,this._ctx.measureText(A).width}check(A){if(A===Ta)return!0;let w=this._measureText(Ea,Ta);return this._measureText(Ea,A)!==w}load(A){return this._fontFaceSet&&this._fontFaceSet.load?this._fontFaceSet.load(`12px ${A}`):(this._ctx.font=`12px ${A}`,this._ctx.fillText(Ea,10,50),Promise.resolve())}},this._fonts={},this._onFontLoaded=[],this._hideUntilFontsLoaded=!0}setHideUntilFontsLoaded(A){this._hideUntilFontsLoaded=A}getFont(A){let w=this._fonts[A];return w||(w=new class{constructor(A,w){this._fontLoaderCounter=0,this._loaded=!1,this._value=null,this._timeout=0,this._fontFaceSet=A,this._fontName=w,this._loaded=!1,this._value=null,this._timeout=0,(!Ee||this._fontFaceSet.check(this._fontName))&&this._setLoaded()}_setLoaded(){this._loaded=!0,this._value=this._fontName}getValue(){return this._value}isLoaded(){return this._loaded}destroy(){clearTimeout(this._timeout)}load(){return this._tryLoad(200).then((()=>{this._setLoaded()}))}_tryLoad(A){return this._fontFaceSet.load(this._fontName).then((()=>{if(!this._fontFaceSet.check(this._fontName)&&this._fontLoaderCounter<16)return new Promise((w=>{A<6e4&&(this._timeout=setTimeout(w,A))})).then((()=>(this._fontLoaderCounter++,this._tryLoad(1.5*A))))}))}}(this._fontFaceSet,A),this._fonts[A]=w,w.isLoaded()||w.load().then((()=>this._triggerFontLoaded(A)))),!this._hideUntilFontsLoaded&&A||w.getValue()}onFontLoaded(A){this._onFontLoaded.push(A)}destroy(){this._onFontLoaded=[],Object.keys(this._fonts).forEach((A=>this._fonts[A].destroy()))}_triggerFontLoaded(A){this._onFontLoaded.forEach((w=>w(A)))}},this._engine=new Cn(Cn.getCachedInitData()),this._domWrapper=this._engine.getDomWrapper(),this._nodeAnimationList=this._modules.graph.createNodeAttribute({storage:32,default:0},!1),this._edgeAnimationList=this._modules.graph.createEdgeAttribute({storage:32,default:0},!1),this._modules.events.register(["reloadFonts","rendererStateChange","beforeUpdateAttributes","updateAttributes","animate","move","pan","zoom","rotate","viewExportStart","viewExport","viewExportEnd","viewChanged","zoomStart"]),this._modules.settings.register("renderer",tl,(A=>{this._updateRendererState({type:A,state:"requested",code:null,message:void 0}),this._engine.setRenderType(A),this._modules.dom.refresh()})),this._modules.settings.register("backgroundColor","white",(A=>{this._engine.parseColor(A)?this._modules.dom.refresh():(zr(`Invalid background color "${A}" specified; will default to black.`),this._modules.settings.set("backgroundColor","black"))})),this._modules.settings.register("texts.hideUntilFontsLoaded",!0,(A=>{this._fontManager.setHideUntilFontsLoaded(!!A)})),this._modules.settings.register("texts.cornerRadius",5,(A=>{this._engine.getTextManager().setCornerRadius("number"==typeof A?A:5),this._modules.dom.refresh()})),this._modules.settings.register("imgCrossOrigin","anonymous",this._updateImageCrossOrigin),this._modules.settings.register("cursor.default","default",this._applyCursorStyle),this._modules.dom.setLayer("graphics",this._domWrapper),this._engine.setGlobalBoundaries(el),this._modules.dom.beforeNextFrame().then((()=>{this._initDone=!0,this._fireRendererStateChangeEvent()})),this._imageManager.onFetch((()=>{this._engine.notifyPatternUpdate(),this._modules.dom.refresh()})),this._fontManager.onFontLoaded((A=>{this._fontsNewlyLoaded.push(A),this._engine.notifyPatternUpdate(),this._engine.notifyFontsReloaded(),this._modules.dom.refresh()})),this._modules.dom.addMediaListener("(min-resolution: 2dppx)",(()=>this._modules.dom.refresh())),this._visibleAttributeLayer=this._attributesManager.addAttributeLayer({priority:0,name:`internal(${Kt})`,tag:Kt,nodeOutput:{attributes:"all"},edgeOutput:{attributes:"all"},nodeDependencies:void 0,edgeDependencies:void 0}),this._dataAttributeLayer=this._attributesManager.addAttributeLayer({priority:0,name:"internal(_data)",tag:ei,nodeDependencies:void 0,edgeDependencies:void 0}),Kf(this._engine,this._attributesManager.getFlexArrays()),this._modules.events.on("move",(()=>this._modules.dom.refresh())).on("newFrame",(()=>{this._processAnimations(),this._loadGraphInGraphicsEngine(),this._renderOnNewFrame&&this._render()})).on("viewExportStart",(()=>{this._renderOnNewFrame=!1})).on("viewExportEnd",(()=>{this._renderOnNewFrame=!0})).on("clearGraph",(()=>{this._nextGeIndex=1,this._availableGeIndexes=[],this._engine.clear(),this._attributesManager.clear(),this._modules.dom.refresh()})).on("viewChanged",(({type:A})=>{if("rotate"===A){let A=this._modules.graph.getEdges().filter((A=>A.getAttribute("adjustAnchors")));this._attributesManager.redrawElements(A)}})).on("addNodes",(A=>{this._attributesManager.updateForAllAttributeLayers(A.nodes)})).on("addEdges",(A=>{this._attributesManager.updateForAllAttributeLayers(A.edges)})).on("excludedStateChange",(A=>{this._visibleAttributeLayer.updateElements(A.elements)})).on("setData",(A=>{this._dataAttributeLayer.updateElements(A.elements)})),Cn.clearCachedInitData(),this._modules.dom.addWindowEventListener("unload",(()=>this.destroy()))}onReady(A){void 0!==A.renderer&&this._ogma.setOptions({renderer:A.renderer}),void 0!==A.imgCrossOrigin&&this._ogma.setOptions({imgCrossOrigin:A.imgCrossOrigin})}getTransparentBackgroundColor(){let A=this._modules.settings.get("backgroundColor");return A?this._engine.transparentify(A):null}_render(){let A=this._modules.dom.getDimensions(),w=this._modules.camera.getView(),T=Ye(),C=Ut(),k=this._modules.settings.get("backgroundColor"),N=this._isBufferDisplayable;this._engine.setView({x:w.x,y:w.y,zoom:w.zoom,angle:w.angle,width:A.width,height:A.height,pixelRatio:T,currentTime:C,backgroundColor:k,isBufferDisplayable:N});try{this._engine.render(),"requested"===this._rendererState.state&&this._updateRendererState({state:"ok"})}catch(A){if(this._debug)throw A;let{message:w,code:T="OTHER"}=A,C=this._rendererState.type,k=function Hy(A){return null===A?"none":"webgl"===A?"WebGL":"svg"===A?"SVG":"canvas"===A?"Canvas":A}(C),N=`Error while initializing the ${k} renderer`,O=`The ${k} renderer encountered an unexpected runtime error`,j="requested"===this._rendererState.state?N:O,G=null;"webgl"===C&&(j+="; fallbacking on canvas renderer",G="canvas"),zr(w||""),zr(j),this._updateRendererState({state:"error",code:T,message:w}),this._modules.settings.set("renderer",G)}}_fireRendererStateChangeEvent(){let A=this._rendererState;this._modules.events.fire("rendererStateChange",{type:A.type,state:A.state,code:A.code,message:A.message})}_updateRendererState({type:A,state:w,code:T,message:C}){let k=!1;void 0!==A&&this._rendererState.type!==A&&(this._rendererState.type=A,k=!0),void 0!==w&&this._rendererState.state!==w&&(this._rendererState.state=w,k=!0),void 0!==T&&this._rendererState.code!==T&&(this._rendererState.code=T,k=!0),void 0!==C&&this._rendererState.message!==C&&(this._rendererState.message=C,k=!0),k&&this._initDone&&this._fireRendererStateChangeEvent()}getImageData(){return this._modules.dom.afterNextFrame().then((()=>this._engine.getImageData()))}getNodeAttributes(){return this._attributesManager.getFlexArrays().nodes.current}getEdgeAttributes(){return this._attributesManager.getFlexArrays().edges.current}getGraphicsEngine(){return this._engine}getImageManager(){return this._imageManager}getFontManager(){return this._fontManager}allocateGraphicsEngineBlockId(){return this._availableGeIndexes.length?this._availableGeIndexes.pop():10*this._nextGeIndex+++9}releaseGraphicsEngineBlockId(A){this._engine.freeBlock(A),this._availableGeIndexes.push(A),this._modules.dom.refresh()}addCursorStyle(A){!A||(this._cursorStyle.push(A),this._applyCursorStyle())}removeCursorStyle(A){if(!A)return;let w=this._cursorStyle.lastIndexOf(A);-1!==w&&(this._cursorStyle.splice(w,1),this._applyCursorStyle())}reloadFonts(){this._modules.events.fire("reloadFonts"),this._engine.notifyFontsReloaded(),this._modules.dom.refresh()}getDomElement(){return this._domWrapper}setTextHidden(A,w){this._attributesManager.setTextHidden(A,w)}resetTextHidden(){this._attributesManager.resetTextHidden(),this._modules.dom.refresh()}getAttributesManager(){return this._attributesManager}_checkFontsNewlyLoaded(){return!!this._fontsNewlyLoaded.length&&(this._fontsNewlyLoaded=[],!0)}_loadGraphInGraphicsEngine(){this._attributesManager.update(),this._checkFontsNewlyLoaded()&&this._attributesManager.redrawAll(),this._modules.events.fire("beforeUpdateAttributes");let{elementsToRedraw:A,elementsUpdated:w}=this._attributesManager.getUpdatedElements(),T=w.nodes.size>0||w.edges.size>0;(w.nodeAttributesSet.has("radius")||w.edgeAttributes.includes("width"))&&(this._boundaries.maxSize=function Vy(A){let w=A.getNodeAttribute("radius"),T=A.getEdgeAttribute("width"),C=A.getNodes(),k=A.getEdges(),N=0,O=0;for(let A=0;A<C._indexes.length;A++){let T=C._indexes[A],k=w.get(T);k>N&&(N=k)}for(let A=0;A<k._indexes.length;A++){let w=k._indexes[A],C=T.get(w);C>O&&(O=C)}return Math.max(2*N,O)}(this._modules.graph)),(w.nodeAttributesSet.has("shape")||w.edgeAttributes.includes("shape.head")||w.edgeAttributes.includes("shape.tail"))&&Kf(this._engine,this._attributesManager.getFlexArrays()),aD({graph:this._modules.graph,elements:A,engine:this._engine,imageManager:this._imageManager,fontManager:this._fontManager,view:this._modules.camera.getView(),attributes:this._attributesManager.getFlexArrays(),boundaries:this._boundaries,formatText:this._formatText}),T&&this._modules.events.fire("updateAttributes",w)}_forceCompleteGraphRefresh(){this._attributesManager.redrawAll(),this._loadGraphInGraphicsEngine()}export(A,w,T,C){let k;return Promise.all([this._modules.graph.getNodes().addClass(gi),this._modules.graph.getEdges().addClass(gi)]).then((()=>this.resolveAtNextFrame())).then((()=>this._imageManager.whenReady())).then((()=>{"all"===T?(k=function hI(A){return{nodes:ED(A,!0),edges:ED(A,!1)}}(this._modules.graph),this._forceCompleteGraphRefresh()):this._loadGraphInGraphicsEngine();let N=this._modules.camera.clone(re({},w));return this._modules.events.fire("viewExportStart",{preventOverlap:C.preventOverlap,camera:N}),this._ogma.view.afterNextFrame().then((()=>this._engine.export(A,w,C))).then((A=>{if("CANVAS"!==(null==A?void 0:A.tagName)||!C.exportCanvasLayers)return A;let T=document.createElement("canvas");return T.width=A.width,T.height=A.height,w.backgroundColor=this._engine.parseColor(w.backgroundColor)||"rgba(255,255,255,0)",this._modules.events.fire("viewExport",{inputCanvas:A,view:w,outputCanvas:T}),T}))})).then((A=>Promise.all([this._modules.graph.getNodes().removeClass(gi),this._modules.graph.getEdges().removeClass(gi)]).then((()=>A)))).then((A=>("all"===T&&(function mI({nodes:A,edges:w}){yD(A),yD(w)}(k),this._forceCompleteGraphRefresh()),this._modules.events.fire("viewExportEnd"),A)))}addAttributeLayer(A){return this._attributesManager.addAttributeLayer(A)}getAttributeValues(A,w,T,C){return this._attributesManager.getAttributeValues(A,w,T,C)}forceAttributesComputation(){this._attributesManager.update()}resolveAtNextFrame(A){return this._modules.dom.afterNextFrame().then((()=>A))}animate(A,w,T){let C=function uI(A){return"number"==typeof A?A={duration:A}:("object"!=typeof A||null===A)&&(A={duration:0}),{duration:cI(A.duration),easing:A.easing||"linear",chain:!!A.chain}}(T);return C.duration&&this._engine.ensureAnimationsReady(),this._animate(A,w,C)}isAnimating(){return this._animations.length>0}getAnimationInformation(A){return this._attributesManager.getAnimationInformation(A)}_toSubGraph(A){if(A instanceof Gi||A instanceof Vi)return{nodes:A.toList(),edges:A.getAdjacentEdges()};if(A instanceof Yi||A instanceof Xi)return{nodes:this._modules.graph.nodeList(),edges:A.toList()};let w=A,T={nodes:w.nodes||this._modules.graph.nodeList(),edges:w.edges||this._modules.graph.edgeList()};return T.nodes.size&&(T.edges.size?T.edges=T.edges.concat(T.nodes.getAdjacentEdges()).dedupe():T.edges=T.nodes.getAdjacentEdges()),T}_animate(A,w,{duration:T,easing:C}){if(!this._animations.length&&!T)return w(A),Promise.resolve(A);let k=this._toSubGraph(A),N=k.nodes,O=k.edges;if(0===N.size&&0===O.size)return w(A),Promise.resolve(A);N.size&&this._modules.events.fire("animate",{elements:N,duration:T,easing:C}),O.size&&this._modules.events.fire("animate",{elements:O,duration:T,easing:C});let j={id:this._nextAnimationId++,startTime:-1,finished:!1,func:()=>w(A),duration:T,easing:C,nodes:N,edges:O,resolve:Ze},G=new Promise((w=>j.resolve=()=>w(A)));for(let A=0;A<N._indexes.length;A++)this._nodeAnimationList.set(N._indexes[A],j.id);for(let A=0;A<O._indexes.length;A++)this._edgeAnimationList.set(O._indexes[A],j.id);return this._animations.push(j),this._modules.dom.refresh(),T||this._processAnimations(),G}_removeFinishedAnimations(){this._animations=this._animations.filter((A=>!A.finished))}_getAnimationElements(A){let w=[],T=[];for(let T=0;T<A.nodes._indexes.length;T++){let C=A.nodes._indexes[T];this._nodeAnimationList.get(C)===A.id&&w.push(C)}for(let w=0;w<A.edges._indexes.length;w++){let C=A.edges._indexes[w];this._edgeAnimationList.get(C)===A.id&&T.push(C)}return{nodes:this._modules.graph.nodeList(new Uint32Array(w)),edges:this._modules.graph.edgeList(new Uint32Array(T))}}_resetAnimationAttributes({nodes:A,edges:w}){this._attributesManager.resetAnimationAttributes({nodes:A,edges:w}),this._nodeAnimationList.fill(A._indexes,0),this._edgeAnimationList.fill(w._indexes,0)}_processAnimations(){if(!this._animations.length)return;let A=Ut(),w=[];this._attributesManager.update();for(let T of this._animations)-1===T.startTime&&(T.startTime=A,w.push(T.func),T.duration>0&&this._attributesManager.setAnimationAttributes(this._getAnimationElements(T),T));for(let A of w)A();for(let w of this._animations)A>=w.startTime+w.duration&&(this._resetAnimationAttributes(this._getAnimationElements(w)),w.resolve(w.elements),w.finished=!0);this._removeFinishedAnimations(),this._animations.length&&this._modules.dom.refresh()}hideTexts(){this.setNodeTextsVisibility(!1),this.setEdgeTextsVisibility(!1)}showTexts(){this.setNodeTextsVisibility(!0),this.setEdgeTextsVisibility(!0)}setNodesVisibility(A){return this._updateVisibilityCounter("nodes",A)}setNodeTextsVisibility(A){return this._updateVisibilityCounter("nodeTexts",A)}setEdgesVisibility(A){return this._updateVisibilityCounter("edges",A)}setEdgeTextsVisibility(A){return this._updateVisibilityCounter("edgeTexts",A)}_updateVisibilityCounter(A,w){this._visibility[A]+=w?-1:1,this._modules.dom.refresh()}detectNode(A){return function zy({x:A,y:w,margin:T,texts:C,indexes:k},N,O,j,G,H){k=k||N.getNodes()._indexes;let W=j.getZoom(),$=N.getObjectList(!0),Z=O.getFlexArrays().nodes.current,se=1/0,ue=0;O.update();for(let N=0;N<k.length;++N){let O=k[N];if(!Z.excluded.get(O)&&Z.detectable.get(O)&&0===Z.animationDuration.get(O)){let k=Z.x.get(O),N=Z.y.get(O),$=j.graphToScreenCoordinates({x:k,y:N}),ge=$.x,ce=$.y,_e=Z.shape.get(O),me="scaled"===Z.scalingMethod.get(O),pe=Z.radius.get(O)*(me?W:1),be=pe+T,Se=(A-ge)/be,Ee=(w-ce)/be;if(G.checkShapeHit(_e,Se,Ee))be<=se&&(se=be,ue=O);else if(C){let T=H(Z.text.content.get(O)||null),C=Z.textHidden.get(O),k=Z.text.minVisibleSize.get(O),N=me?2*pe:1/0;if(!C&&T&&N>=k){let C=Es(T,Z.text.maxLineLength.get(O)),k=Z.innerStroke.width.get(O),N=Z.text.margin.get(O),j=Z.text.padding.get(O),H=Z.text.size.get(O),W=Z.text.scale.get(O),$=Z.text.scaling.get(O),se=Z.text.font.get(O),_e=Z.text.style.get(O),me=Z.text.position.get(O),be=G.measureText(C,se,_e,1),Se=$?W*pe*2:H,Ee=be.width*Se/2+j,Te=be.height*Se/2+j,Ce=kn[me],Ie=k+N+pe,ze=ge+(Ie+Ee)*Ce.x,Pe=ce+(Ie+Te)*Ce.y,Re=ze+Ee,Ue=Pe-Te,Ve=Pe+Te;A>ze-Ee&&A<Re&&w>Ue&&w<Ve&&(ue=O)}}}}return $.get(ue)||null}(A,this._modules.graph,this._attributesManager,this._modules.camera,this._engine,this._formatText)}detectEdge(A){return function Uy(A,w,T,C){let{margin:k,texts:N,indexes:O=w.getEdges()._indexes}=A,j=w.getObjectList(!1),G=C.getFlexArrays(),H=G.edges.current,W=G.nodes.current,$=T.getZoom(),Z=k/$,se=T.screenToGraphCoordinates(A),ue=se.x,ge=se.y,ce=0;C.update();for(let A=0;A<O.length;++A){let w=O[A],T=H.source.get(w),C=H.target.get(w),k=H.excluded.get(w),N=H.detectable.get(w),j=0!==H.animationDuration.get(w),G=0!==W.animationDuration.get(T),se=0!==W.animationDuration.get(C);if(!k&&N&&!j&&!G&&!se){let A=T===C,k=H.curvature.get(w),N="triangle"===H.shape.body.get(w),O="scaled"===H.scalingMethod.get(w),j=H.width.get(w)/(O?1:$),G=W.x.get(T),se=W.y.get(T),_e=W.x.get(C),me=W.y.get(C);if(A){let A="scaled"===W.scalingMethod.get(T),C=xr(G,se,k,W.radius.get(T)/(A?1:$),0);mf(ue,ge,G,se,G,se,C.x1,C.y1,C.x2,C.y2,j,Z)&&(ce=w)}else if(0!==k){let A=jt(G,se,_e,me,k);hf(ue,ge,G,se,_e,me,A.x,A.y,j,Z,N)&&(ce=w)}else sf(ue,ge,G,se,_e,me,j,Z,N)&&(ce=w)}}return j.get(ce)||null}(A,this._modules.graph,this._modules.camera,this._attributesManager)}getVisibilityCounters(){return this._visibility}destroy(){this.getGraphicsEngine().destroy(),this.getImageManager().destroy(),this.getFontManager().destroy()}};function cI(A){return"number"!=typeof A||!isFinite(A)||A<0?0:A}function ED(A,w){let T=w?A.getNodeAttribute("excluded"):A.getEdgeAttribute("excluded"),C=(w?A.getNodes("all"):A.getEdges("all"))._indexes,k=T.getMultiple(C);return T.fill(C,0),{excludedList:T,indexes:C,values:k}}function yD({excludedList:A,indexes:w,values:T}){A.setMultiple(w,T)}var sl=class extends kt{constructor(){super(...arguments),this._onAnyEvents=[]}onMounted(){this._registeredEvents={}}isRegistered(A){return!!this._registeredEvents[A]}register(A,w=[]){A.forEach((A=>{if(this._registeredEvents[A])throw new Error(`event "${A}" already exists`);this._registeredEvents[A]=new rl(!1,A)}))}onAnyEvent(A){this._onAnyEvents.push(A)}on(A,w){return Array.isArray(A)&&A.forEach((A=>this.on(A,w))),this._registeredEvents[A]?(this._registeredEvents[A].on(w),this):this}off(A){return Object.values(this._registeredEvents).forEach((w=>{w.off(A)})),this}fire(A,w=null){let T=this._getEvent(A);return this._onAnyEvents.forEach((T=>T(A,w))),T.trigger(w),this}once(A,w){let T=this,o=function(){w.apply(null,arguments),T.off(o)};return this.on(A,o)}_getEvent(A){if(!(A in this._registeredEvents))throw new Error(`Event ${A} does not exist`);return this._registeredEvents[A]}destroy(){Object.values(this._registeredEvents).forEach((A=>{A.destroy()}))}},rl=class{constructor(A,w){this._subscribers=[],this._handlers=[],this._reverseOrder=A,this._name=w}trigger(A){for(let w of this._handlers)w(A,this._name);return this}on(A){if("function"!=typeof A)throw new Error("handler is not a function");let w=this._reverseOrder?0:this._subscribers.length;return this._handlers.splice(w,0,A),this._subscribers.splice(w,0,A),this}off(A){let w;for(;-1!==(w=this._subscribers.indexOf(A));)this._subscribers.splice(w,1),this._handlers.splice(w,1);return this}destroy(){this._subscribers=[],this._handlers=[]}},nl=class extends kt{onMounted(){this._graphics=this._modules.graphics,this._modules.events.register(["setMultipleAttributes"]),this._modules.events.on(["addNodes","addEdges"],(({nodes:A,edges:w,objects:T})=>{this._onAddElements(A||w,T)})),this._originalAttributesLayer=this._graphics.addAttributeLayer({name:"original-attributes",priority:1,nodeOutput:{attributes:"all"},edgeOutput:{attributes:"all"},nodeDependencies:void 0,edgeDependencies:void 0}),this._individualAttributesLayer=this._graphics.addAttributeLayer({name:"individual-attributes",priority:4,nodeOutput:{attributes:"all"},edgeOutput:{attributes:"all"},nodeDependencies:void 0,edgeDependencies:void 0})}_onAddElements(A,w){let T=w.map((A=>A.attributes));this._originalAttributesLayer.setAttributeValues(A,T)}getOriginalAttributes(){return this._originalAttributesLayer.getFlexArrays()}getIndividualAttributes(){return this._individualAttributesLayer.getFlexArrays()}setMultipleAttributes(A,w,T,C){return this._modules.events.fire("setMultipleAttributes",{elements:A,values:w,options:T,updatedAttributes:C}),this._graphics.animate(A,(()=>{this._individualAttributesLayer.setAttributeValues(A,w,C)}),T)}setSingleAttribute(A,w,T,C){let k={};return Nr(k,w,T),this.setMultipleAttributes(A,k,C)}resetMultipleAttributes(A,w,T){let C=w||this._individualAttributesLayer.getUsedAttributeNames(A),k={};for(let A of C)Nr(k,A,void 0);return this._graphics.animate(A,(()=>{this._individualAttributesLayer.setAttributeValues(A,k)}),T)}getMultipleAttributes(A,w){return this._graphics.getAttributeValues(A,w,!0,!1)}getSingleAttribute(A,w){return this._graphics.getAttributeValues(A,w,!1,!1)}replaceOriginalAttributes(A,w,T=[]){let C={},k=this._originalAttributesLayer.getUsedAttributeNames(A).filter((A=>!T.includes(A)));for(let A=0;A<k.length;++A)Nr(C,k[A],void 0);this._originalAttributesLayer.setAttributeValues(A,C),this._originalAttributesLayer.setAttributeValues(A,w)}getSinglePreviousAttribute(A,w){return this._graphics.getAttributeValues(A,w,!1,!0)}getMultiplePreviousAttributes(A,w){return this._graphics.getAttributeValues(A,w,!0,!0)}},ol=class extends kt{constructor(){super(...arguments),this._currentValue={},this._onChange={},this._defaultValues={},this._keys=[]}onReady(A){A.renderer&&this.update({renderer:A.renderer}),A.options&&this.update(A.options)}register(A,w,T,C){return void 0===C&&(C=!0),this._keys.push(A),this._currentValue[A]=w,this._defaultValues[A]=w,this._onChange[A]=T||Ze,T&&C&&T(w),this}update(A){A=Qi(A);let w=this._keys,T={},C=this._currentValue;for(let k=0;k<w.length;++k){let N=w[k];if(N in A){let w=A[N];void 0===w&&(w=this._defaultValues[N]),T[N]=C[N],C[N]=w}}let k=Object.keys(T);for(let A=0;A<k.length;++A){let w=k[A],C=this._currentValue[w],N=T[w];C!==N&&this._onChange[w](C,N)}return nc(T)}get(A){return 0===arguments.length?nc(this._currentValue):this._currentValue[A]}set(A,w){let T=this._currentValue[A],C=this._onChange[A];this._currentValue[A]=w,C&&C(w,T)}},al=class{constructor(A,w){this._classes=A,this._name=w}getName(){return this._name}getIndex(){return this._classes.getIndex(this._name)}setIndex(A){return this._classes.setIndex(this._name,A)}update(A){return this._classes.update(this._name,A),this}getDefinition(){return this._classes.getDefinition(this._name)}getNodes(A){return this._classes.getElementsByClass(this._name,A).nodes}getEdges(A){return this._classes.getElementsByClass(this._name,A).edges}clearNodes(A){this.getNodes(A).removeClass(this._name)}clearEdges(A){this.getEdges(A).removeClass(this._name)}add(A){A.addClass(this._name)}remove(A){A.removeClass(this._name)}},ll=class extends kt{constructor(){super(...arguments),this._builtinClasses=[],this._userClasses=[],this._classesByName={}}onMounted(){this._modules.events.on("excludedStateChange",(({elements:A,value:w})=>{if(w){let w=this._builtinClasses.map((A=>A.name));this._addOrRemoveClassesToElements(w,A,!1)}})).on("clearGraph",(()=>{this._builtinClasses.concat(this._userClasses).forEach((A=>A.elementSet.clear()))}))}_getClassList(A){return A?this._builtinClasses:this._userClasses}createClass({name:A,isBuiltin:w=!1,after:T,nodeAttributes:C,nodeDependencies:k,nodeOutput:N,edgeAttributes:O,edgeDependencies:j,edgeOutput:G}={}){if("string"!=typeof A)throw new Error('the "name" argument should be a string');let H=this._getClassList(w),W=T?function EI(A,w){for(let T=0;T<A.length;++T)if(A[T].name===w)return T;return-1}(H,T)+1:H.length;if(-1===W)throw new Error(`createClass: class specified as \`after\` parameter "${T}" does not exist`);if(w&&!A.startsWith("_"))throw new Error(`invalid builtin class name "${A}": builtin classes should start with '_'`);let $=new Ss(this._modules.graph),Z=new al(this,A),se={name:A,elementSet:$,attributeLayer:this._modules.graphics.addAttributeLayer({name:`class(${A})`,tag:A,standaloneSelectors:!0,nodeAttributes:C||void 0,edgeAttributes:O||void 0,nodeSelector:(A,w)=>w.hasElement(A),edgeSelector:(A,w)=>w.hasElement(A),nodeContext:$,edgeContext:$,nodeOutput:N,edgeOutput:G,nodeDependencies:k,edgeDependencies:j}),isBuiltin:w,wrapper:Z};return H.splice(W,0,se),w&&H.sort(((A,w)=>bi.indexOf(A.name)-bi.indexOf(w.name))),this._updatePriorities(w),this._classesByName[A]=se,this._modules.events.register([ks(A,!0,!0),ks(A,!0,!1),ks(A,!1,!0),ks(A,!1,!1)]),Z}_updatePriorities(A){let w=this._getClassList(A),T=5+(A?.5:0);for(let A=0;A<w.length;++A){let C=T+5e-4*A;w[A].attributeLayer.update({priority:C})}}_get(A){let w=this._classesByName[A];if(!w)throw new Error(`class "${A}" does not exist`);return w}getIndex(A){let w=this._get(A);return this._getClassList(w.isBuiltin).indexOf(w)}setIndex(A,w){let T=this._get(A),C=this._getClassList(T.isBuiltin),k=C.indexOf(T),N=Vt(w,0,C.length-1);C.splice(k,1),C.splice(N,0,T),this._updatePriorities(T.isBuiltin)}update(A,{nodeAttributes:w,edgeAttributes:T,nodeDependencies:C,edgeDependencies:k,nodeOutput:N,edgeOutput:O,fullOverwrite:j}={}){this._get(A).attributeLayer.update({nodeAttributes:w,edgeAttributes:T,nodeDependencies:C,edgeDependencies:k,nodeOutput:N,edgeOutput:O,fullOverwrite:j})}getDefinition(A){let w=this._get(A),{nodeAttributes:T,nodeDependencies:C,nodeOutput:k,edgeAttributes:N,edgeDependencies:O,edgeOutput:j}=w.attributeLayer.getDefinition();return{nodeAttributes:T||void 0,edgeAttributes:N||void 0,nodeDependencies:C,edgeDependencies:O,nodeOutput:k,edgeOutput:j}}_addOrRemoveClassesToElements(A,w,T){let C=w.isNode;for(let k=0;k<A.length;++k){let N=A[k],{elementSet:O,attributeLayer:j}=this._get(N),G=O.addOrRemoveElements(w,T),H=ks(N,C,T);G.size&&(j.updateElements(G),this._modules.events.fire(H,C?{nodes:G}:{edges:G}))}}addClassesToElements(A,w,T){let C=w.toList();return this._modules.graphics.animate(w,(()=>{this._addOrRemoveClassesToElements(A,C,!0)}),T)}removeClassesFromElements(A,w,T){let C=w.toList();return this._modules.graphics.animate(w,(()=>{this._addOrRemoveClassesToElements(A,C,!1)}),T)}hasSingleElementClass(A,w){return this._get(A).elementSet.hasElement(w)}getElementsClassList(A,w={}){let{includeBuiltinClasses:T=!1}=w,C=new Array(A.size);for(let A=0;A<C.length;++A)C[A]=[];return this._addClassNamesToList(C,A,this._userClasses),T&&this._addClassNamesToList(C,A,this._builtinClasses),C}_addClassNamesToList(A,w,T){let C=w.toList();for(let w=0;w<T.length;++w){let{name:k,elementSet:N}=T[w];for(let w=0;w<C.size;++w){let T=C.get(w);N.hasElement(T)&&A[w].push(k)}}}getClassByName(A,w=!1){let T=this._classesByName[A]||null;if(w&&!T)throw new Error(`class "${A}" does not exist`);return T&&T.wrapper}getClassList(){return this._userClasses.map((A=>A.wrapper))}getElementsByClass(A,w="visible"){let{elementSet:T}=this._get(A),C=T.getElements(),k=C.nodes,N=C.edges;return"visible"===w?(k=k.filter((A=>A.isVisible())),N=N.filter((A=>A.isVisible()))):"raw"===w&&(k=k.filter((A=>!A.isVirtual())),N=N.filter((A=>!A.isVirtual()))),{nodes:k,edges:N}}_onClassEvent(A,w,T,C){let k=ks(A,T,C);this._modules.events.on(k,w)}onNodeClassAdded(A,w){this._onClassEvent(A,w,!0,!0)}onNodeClassRemoved(A,w){this._onClassEvent(A,w,!0,!1)}onEdgeClassAdded(A,w){this._onClassEvent(A,w,!1,!0)}onEdgeClassRemoved(A,w){this._onClassEvent(A,w,!1,!1)}};function ks(A,w,T){return`${w?"node":"edge"}Class${T?"Added":"Removed"}_${A}`}var dl=class{constructor(A,w){this.key=A,this.data=w,this.left=null,this.right=null}};function yI(A,w){return A>w?1:A<w?-1:0}function Mi(A,w,T){if(null===w)return w;let C,k,N,O=new dl;for(C=k=O;;){let O=T(A,w.key);if(O<0){if(null===w.left||T(A,w.left.key)<0&&(N=w.left,w.left=N.right,N.right=w,null===(w=N).left))break;k.left=w,k=w,w=w.left}else{if(!(O>0))break;if(null===w.right||T(A,w.right.key)>0&&(N=w.right,w.right=N.left,N.left=w,null===(w=N).right))break;C.right=w,C=w,w=w.right}}return C.right=w.left,k.left=w.right,w.left=O.right,w.right=O.left,w}function Qf(A,w,T,C,k){let N=new dl(A,w);if(k._size++,null===T)return N.left=N.right=null,N;let O=C(A,(T=Mi(A,T,C)).key);return O<0?(N.left=T.left,N.right=T,T.left=null):O>=0&&(N.right=T.right,N.left=T,T.right=null),N}function xD(A,w,T,C){let k;return null===w?null:0===T(A,(w=Mi(A,w,T)).key)?(null===w.left?k=w.right:(k=Mi(A,w.left,T),k.right=w.right),C._size--,k):w}function DD(A,w,T){let C,k;if(null===w)C=k=null;else{let N=T((w=Mi(A,w,T)).key,A);0===N?(C=w.left,k=w.right):N<0?(k=w.right,w.right=null,C=w):(C=w.left,w.left=null,k=w)}return{left:C,right:k}}function Jf(A,w,T,C,k){if(A){C(`${w}${T?" ":" "}${k(A)}\n`);let N=w+(T?"    ":"   ");A.left&&Jf(A.left,N,!1,C,k),A.right&&Jf(A.right,N,!0,C,k)}}function e_(A,w,T,C,k){let N=k-C;if(N>0){let O=C+Math.floor(N/2),j={key:w[O],data:T[O],parent:A};return j.left=e_(j,w,T,C,O),j.right=e_(j,w,T,O+1,k),j}return null}function t_(A,w,T){let C=T-w;if(C>0){let k=w+Math.floor(C/2),N=t_(A,w,k),O=A.head;return O.left=N,A.head=A.head.next,O.right=t_(A,k+1,T),O}return null}function r_(A,w,T,C,k){if(T>=C)return;let N=A[T+C>>1],O=T-1,j=C+1;for(;;){do{O++}while(k(A[O],N)<0);do{j--}while(k(A[j],N)>0);if(O>=j)break;let T=A[O];A[O]=A[j],A[j]=T,T=w[O],w[O]=w[j],w[j]=T}r_(A,w,T,j,k),r_(A,w,j+1,C,k)}var hl=class extends class{constructor(A=yI){this._comparator=A,this._root=null,this._size=0}insert(A,w){return this._root=Qf(A,w,this._root,this._comparator,this)}add(A,w){return this._root=function xI(A,w,T,C,k){let N=new dl(A,w);if(null===T)return N.left=N.right=null,k._size++,N;let O=C(A,(T=Mi(A,T,C)).key);return 0===O?T:(O<0?(N.left=T.left,N.right=T,T.left=null):O>0&&(N.right=T.right,N.left=T,T.right=null),k._size++,N)}(A,w,this._root,this._comparator,this)}remove(A){this._root=xD(A,this._root,this._comparator,this)}pop(){let A=this._root;if(A){for(;A.left;)A=A.left;return this._root=Mi(A.key,this._root,this._comparator),this._root=xD(A.key,this._root,this._comparator,this),{key:A.key,data:A.data}}return null}findStatic(A){let w=this._root,T=this._comparator;for(;w;){let C=T(A,w.key);if(0===C)return w;w=C<0?w.left:w.right}return null}find(A){return this._root&&(this._root=Mi(A,this._root,this._comparator),0!==this._comparator(A,this._root.key))?null:this._root}contains(A){let w=this._root,T=this._comparator;for(;w;){let C=T(A,w.key);if(0===C)return!0;w=C<0?w.left:w.right}return!1}forEach(A,w){let T=this._root,C=[],k=!1;for(;!k;)null!==T?(C.push(T),T=T.left):0!==C.length?(T=C.pop(),A.call(w,T),T=T.right):k=!0;return this}range(A,w,T,C){let k,N=[],O=this._comparator,j=this._root;for(;0!==N.length||j;)if(j)N.push(j),j=j.left;else{if(j=N.pop(),k=O(j.key,w),k>0)break;if(O(j.key,A)>=0&&T.call(C,j))return this;j=j.right}return this}keys(){let A=[];return this.forEach((({key:w})=>A.push(w))),A}values(){let A=[];return this.forEach((({data:w})=>A.push(w))),A}min(){return this._root?this.minNode(this._root).key:null}max(){return this._root?this.maxNode(this._root).key:null}minNode(A=this._root){if(A)for(;A.left;)A=A.left;return A}maxNode(A=this._root){if(A)for(;A.right;)A=A.right;return A}at(A){let w=this._root,T=!1,C=0,k=[];for(;!T;)if(w)k.push(w),w=w.left;else if(k.length>0){if(w=k.pop(),C===A)return w;C++,w=w.right}else T=!0;return null}next(A){let w=this._root,T=null;if(A.right){for(T=A.right;T.left;)T=T.left;return T}let C=this._comparator;for(;w;){let k=C(A.key,w.key);if(0===k)break;k<0?(T=w,w=w.left):w=w.right}return T}prev(A){let w=this._root,T=null;if(null!==A.left){for(T=A.left;T.right;)T=T.right;return T}let C=this._comparator;for(;w;){let k=C(A.key,w.key);if(0===k)break;k<0?w=w.left:(T=w,w=w.right)}return T}clear(){return this._root=null,this._size=0,this}toList(){return function vI(A){var w=A,T=[],C=!1;let k={next:null},N=k;for(;!C;)w?(T.push(w),w=w.left):T.length>0?w=(w=N=N.next=T.pop()).right:C=!0;return N.next=null,k.next}(this._root)}load(A=[],w=[],T=!1){let C=A.length,k=this._comparator;if(T&&r_(A,w,0,C-1,k),null===this._root)this._root=e_(this._root,A,w,0,C),this._size=C;else{let T=function NI(A,w,T=((A,w)=>A-w)){let C={},k=C,N=A,O=w;for(;null!==N&&null!==O;)T(N.key,O.key)<0?(k.next=N,N=N.next):(k.next=O,O=O.next),k=k.next;return null!==N?k.next=N:null!==O&&(k.next=O),C.next}(this.toList(),function AI(A,w){let T={next:null},C=T;for(let T=0;T<A.length;T++)C=C.next={key:A[T],data:w[T]};return C.next=null,T.next}(A,w),k);C=this._size+C,this._root=t_({head:T},0,C)}return this}isEmpty(){return null===this._root}get size(){return this._size}toString(A=(A=>A.key)){let w=[];return Jf(this._root,"",!0,(A=>w.push(A)),A),w.join("")}update(A,w,T){let C=this._comparator,{left:k,right:N}=DD(A,this._root,C);this._size--,C(A,w)<0?N=Qf(w,T,N,C,this):k=Qf(w,T,k,C,this),this._root=function DI(A,w,T){return null===w?A:(null===A||((w=Mi(A.key,w,T)).left=A),w)}(k,N,C)}split(A){return DD(A,this._root,this._comparator)}}{constructor(A){super(A,!0)}};hl.prototype.lte=function(A){let w,T=this._comparator,C=this._root;for(;C;){if(w=T(C.key,A),null===C.left&&null===C.right&&w>0)return null;if(w<=0&&null===C.right||w<=0&&T(C.right.key,A)>0)return C;C=w>=0?C.left:C.right}return C},hl.prototype.gte=hl.prototype.gte||function(A){let w=[],T=this._comparator,C=this._root;for(;0!==w.length||C;)if(C)w.push(C),C=C.left;else{if(C=w.pop(),T(C.key,A)>=0)break;C=C.right}return C},hl.prototype.clear=hl.prototype.clear||function(){return this._root=null,this._size=0,this};var ul=class{constructor(A=Int32Array,w=16,T=8){this._BIG_LIST=new Uint8Array([-1])[0],this._ArrayType=A,this._capacity=w,this._MAX_LIST_SIZE=T,this._freeIndex=-1,this.clear()}clear(){this._buffer=new this._ArrayType(this._capacity*this._MAX_LIST_SIZE),this._sizes=new Uint8Array(this._capacity),this._bigLists=[],this._nextIndex=0,this._idToIndex={},this._constList=new Array(this._MAX_LIST_SIZE)}addEntry(A){let w;return-1===this._freeIndex?w=this._nextIndex++:(w=this._freeIndex,this._freeIndex=-1),this._idToIndex[A]=w,w>=this._capacity&&this._expand(w+1),this._sizes[w]=0,w}getItems(A){let w=this._idToIndex[A];if(void 0===w)return;let T=this._sizes[w],C=this._MAX_LIST_SIZE*w;if(T<=this._MAX_LIST_SIZE){this._constList.length=T;for(let A=0,w=T;A<w;++A)this._constList[A]=this._buffer[C+A];return this._constList}if(T===this._BIG_LIST){let A=this._buffer[C];return this._bigLists[A]}}removeEntry(A){let w=this._idToIndex[A];if(this._sizes[w]===this._BIG_LIST){let A=this._MAX_LIST_SIZE*w,T=this._buffer[A];this._bigLists[T].length=0}this._sizes[w]=0,this._freeIndex=w}size(A){let w=this._idToIndex[A],T=this._sizes[w];return T<=this._MAX_LIST_SIZE?T:this._bigLists[this._buffer[w*this._MAX_LIST_SIZE]].length}sizes(A){let w=this._sizes,T=this._bigLists,C=this._buffer,k=this._MAX_LIST_SIZE,N=A.length,O=new Array(N);for(let j=0;j<N;j++){let N=this._idToIndex[A[j]],G=w[N];O[j]=G<=k?G:T[C[N*k]].length}return O}addTo(A,w){let T=this._idToIndex[A],C=this._sizes[T],k=T*this._MAX_LIST_SIZE;if(C<this._MAX_LIST_SIZE)this._buffer[k+C]=w,this._sizes[T]=C+1;else if(C===this._BIG_LIST){let A=this._buffer[k];this._bigLists[A].push(w)}else{let A=new Array(this._MAX_LIST_SIZE);for(let w=0;w<this._MAX_LIST_SIZE;++w)A[w]=this._buffer[k+w];A.push(w),this._bigLists.push(A),this._sizes[T]=this._BIG_LIST,this._buffer[k]=this._bigLists.length-1}}removeFrom(A,w){this.removeFromAndGetSize(A,w)}removeFromAndGetSize(A,w){let T=this._idToIndex[A],C=this._sizes[T],k=this._MAX_LIST_SIZE*T;if(C<=this._MAX_LIST_SIZE){for(let A=k,N=k+C;A<N;++A)if(this._buffer[A]===w)return C-=1,this._buffer[A]=this._buffer[N-1],this._sizes[T]=C,C}else if(C===this._BIG_LIST){let A=this._buffer[k],T=this._bigLists[A],C=T.indexOf(w);if(-1!==C)return T.splice(C,1),T.length}}reserve(A){this._capacity<A&&this._expand(A)}_expand(A){this._capacity=Math.pow(2,Math.ceil(Math.log2(A))),this._buffer=vD(this._buffer,this._capacity*this._MAX_LIST_SIZE),this._sizes=vD(this._sizes,this._capacity)}has(A){let w=this._idToIndex[A];return!(void 0===w||w>=this._capacity)&&0!==this._sizes[w]}get averageSize(){let A=0;for(let w=0;w<this._capacity;w++)A+=this._sizes[w];return A/this._capacity}};function vD(A,w){let T=new A.constructor(w);return T.set(A),T}var gl,cl,ml,pl,yl,vl=[0,1],Al=[0,2];for(ml=4;ml<65535;ml<<=2)for(gl=0,cl=vl.length;gl<cl;gl++)vl.push(vl[gl]|ml),Al.push((vl[gl]|ml)<<1);function Ct(A,w){return(Al[255&w]|vl[255&A])+65536*(Al[w>>8&255]|vl[A>>8&255])+4294967296*(Al[w>>16&255]|vl[A>>16&255])}function TD(A,w=[0,0]){if(A>0xffffffffffff)throw"Only morton codes up to 48 bits are supported.";if(!pl){pl={},yl={};for(var T=0;T<256;T++)pl[Ct(T,0)]=T,yl[Ct(0,T)]=T}var C=pl[21845&A],k=yl[43690&A];return A>65535&&(C|=pl[21845&(A/=65536)]<<8,k|=yl[43690&A]<<8,A>65535&&(C|=pl[21845&(A/=65536)]<<16,k|=yl[43690&A]<<16)),w[0]=C,w[1]=k,w}Ct.code=function(A,w,T){if(A>24)throw"Morton codes are only supported up to Z=24";var C=1<<24-A;return Ct(w*C,T*C)},Ct.range=function(A,w,T){if(A>24)throw"Morton ranges are only supported up to Z=24";var C=1<<24-A,k=Ct(w*C,T*C);return[k,k+C*C-1]},Ct.reverse=TD,Ct.decode=function(A,w){var T=TD(w),C=1<<24-A;return[T[0]/C,T[1]/C]},Ct.min=function(A,w){var T=1431655765&A,C=1431655765&w,k=2863311530&A,N=2863311530&w;return Math.min(T,C)+Math.min(k,N)};
/**
 * Bresenham rasterisation functions by Alois Zingl
 * @author Alois Zingl
 * @preserve
 */
var Sl;!function OI(A){1<<(Sl=A),1<<Sl-1}(14);var wl="undefined"==typeof Map?class{constructor(){this._values={},this._size=0}get size(){return this._size}has(A){return!!this._values[A]}set(A,w){A in this._values||this._size++,this._values[A]=w}get(A){return this._values[A]}delete(A){A in this._values&&(delete this._values[A],this._size--)}keys(){return Object.keys(this._values)}clear(){this._values={},this._size=0}}:Map,Tl="undefined"==typeof Set?class{constructor(){this._values={},this._size=0}get size(){return this._size}has(A){return!!this._values[A]}add(A){A in this._values||this._size++,this._values[A]=!0}delete(A){A in this._values&&(delete this._values[A],this._size--)}keys(){return Object.keys(this._values)}clear(){this._values={},this._size=0}}:Set,Cl=class{constructor(){this._intersects=null,this._getBounds=null}setBoundsGetter(A){return this._getBounds=A,this}setIntersector(A){return this._intersects=A,this}},Ll=class extends Cl{constructor(A,w,T=16,C=65536,k=Int32Array,N=16){super(),this._occupied=0,this._idToCode=new wl,this._codeCache=[0,0,0],this.code=(A,w,T)=>T|Ct(A,w)<<this._bitsForZoom,this.decode=(A,w)=>(Ct.reverse(A>>this._bitsForZoom,w),w[2]=A&this._zoomMask,w),this._intersects=A,this._getBounds=w,this._cells=new ul(k),this._offset=C,this._maxLevels=N,this._mortonMax=(1<<this._maxLevels)-1,this._bitsForZoom=Math.log2(this._maxLevels),this._zoomMask=(1<<this._bitsForZoom)-1,this._objectsAtLevel=new Array(this._maxLevels).fill(0),this._min=-C,this._max=C,this._resolution=this._mortonMax/(this._max-this._min),this._minCellSize=T*this._resolution,this._bounds=new Array(4*this._maxLevels);for(let A=0;A<this._maxLevels;A++)this._bounds[4*A]=1/0,this._bounds[4*A+1]=1/0,this._bounds[4*A+2]=-1/0,this._bounds[4*A+3]=-1/0}setMinCellSize(A){return this._minCellSize=A,this}setOffset(A){return this._offset=A,this._min=-A,this._max=A,this._resolution=this._mortonMax/(this._max-this._min),this}insert(A,w,T,C,k){void 0===w&&([w,T,C,k]=this._getBounds(A));let N,O=Math.max(C-w,k-T),j=this._minCellSize;for(N=0;j<O&&N<this._maxLevels-1;N++)j*=2;let G=this._resolution,H=this._min,W=G*(.5*(C+w)-H)/j|0,$=G*(.5*(k+T)-H)/j|0,Z=this.code(W,$,N);this._cells.has(Z)||this._cells.addEntry(Z),this._cells.addTo(Z,A),this._objectsAtLevel[N]++,this._occupied|=1<<N;let se=4*N,ue=this._bounds;return W<ue[se]&&(ue[se]=W),$<ue[se+1]&&(ue[se+1]=$),W>ue[se+2]&&(ue[se+2]=W),$>ue[se+3]&&(ue[se+3]=$),this._idToCode.set(A,Z),Z}has(A){return this._idToCode.has(A)}update(A,w,T,C,k){return this.remove(A),this.insert(A,w,T,C,k)}remove(A){let w=this._idToCode.get(A);this.decode(w,this._codeCache);let T=this._codeCache[2];return 0==--this._objectsAtLevel[T]&&(this._occupied&=~(1<<T),this._bounds[4*T]=1/0,this._bounds[4*T+1]=1/0,this._bounds[4*T+2]=-1/0,this._bounds[4*T+3]=-1/0),this._cells.removeFrom(w,A),this._idToCode.delete(A),this}query(A,w,T,C){let k=this._cells,N=this._bounds,O=this._intersects,j=this._min,G=this._resolution,H=this._minCellSize,W=this._occupied,$=[];for(let Z=0;Z<this._maxLevels&&0!==W;H*=2,W>>=1,Z++){if(0==(1&W))continue;let se=1/H,ue=4*Z,ge=Math.max(N[ue],G*(A-j)*se-1>>0),ce=Math.max(N[ue+1],G*(w-j)*se-1>>0),_e=Math.min(N[ue+2],G*(T-j)*se+1>>0),me=Math.min(N[ue+3],G*(C-j)*se+1>>0);for(let N=ge;N<=_e;N++)for(let j=ce;j<=me;j++){let G=this.code(N,j,Z),H=k.getItems(G);if(void 0!==H)for(let k=0;k<H.length;k++){let N=H[k];O(N,A,w,T,C)&&$.push(N)}}}return $}traverse(A,w,T,C,k){let N=this._cells,O=this._bounds,j=this._intersects,G=this._min,H=this._resolution,W=this._minCellSize,$=this._occupied,Z=[];for(let se=0;se<this._maxLevels&&0!==$;W*=2,$>>=1,se++){if(0==(1&$))continue;let ue=1/W,ge=4*se,ce=Math.max(O[ge],H*(A-G)*ue-1>>0),_e=Math.max(O[ge+1],H*(w-G)*ue-1>>0),me=Math.min(O[ge+2],H*(T-G)*ue+1>>0),pe=Math.min(O[ge+3],H*(C-G)*ue+1>>0);for(let O=ce;O<=me;O++)for(let G=_e;G<=pe;G++){let H=this.code(O,G,se),W=N.getItems(H);if(void 0!==W)for(let N=0;N<W.length;N++){let O=W[N];if(j(O,A,w,T,C)&&(Z.push(O),k(O)))return Z}}}return Z}collisions(A,w=this._getBounds){if("function"!=typeof w)throw new Error("getBounds function is required to get the object bounds");let T=Array.from(this._idToCode.keys()),C=this._min,k=this._resolution,N=this._cells,O=new wl,j=[];for(let G=0;G<T.length;G++){let H=0,W=this._minCellSize,$=this._occupied,Z=T[G],[se,ue,ge,ce]=w(Z),_e=Math.max(ge-se,ce-ue);for(H=0;W<_e;H++)W*=2,$>>=1;se=k*(se-C),ue=k*(ue-C),ge=k*(ge-C),ce=k*(ce-C);for(let w=H;w<this._maxLevels&&0!==$;W*=2,$>>=1,w++){if(0==(1&$))continue;let T=1/W,C=ue*T-1>>0,k=ge*T+1>>0,H=ce*T+1>>0;for(let W=se*T-1>>0;W<=k;W++)for(let T=C;T<=H;T++){let C=this.code(W,T,w);if(O.get(C)===G)continue;O.set(C,G);let k=N.getItems(C);if(void 0!==k)for(let w=0;w<k.length;w++){let T=k[w],[C,N,O,G]=this._getBounds(T);T!==Z&&A(Z,C,N,O,G)&&j.push(Z,T)}}}}return function BI(A){let w=new Tl,T=[];for(let C=0;C<A.length;C+=2){let k=A[C],N=A[C+1],O=k<N?k*N+(N-k-1)*(N-k-1)/4:k*N+(k-N-1)*(k-N-1)/4;w.has(O)||(w.add(O),T.push(k,N))}return T}(j)}clear(){this._occupied=0,this._cells.clear(),this._idToCode.clear(),this._objectsAtLevel=new Array(this._maxLevels).fill(0),this._bounds=new Array(4*this._maxLevels);for(let A=0;A<this._maxLevels;A++)this._bounds[4*A]=1/0,this._bounds[4*A+1]=1/0,this._bounds[4*A+2]=-1/0,this._bounds[4*A+3]=-1/0;return this}keyToBBox(A){let[w,T,C]=this.decode(A,[0,0,0]),k=this._minCellSize*(1<<C),N=this._min,O=this._resolution;return[w*k/O+N,T*k/O+N,(w+1)*k/O+N,(T+1)*k/O+N]}keys(){return Object.keys(this._cells._idToIndex)}get averageCellOccupancy(){return this._cells.averageSize}get size(){return this._idToCode.size}getBoxes(){return Array.from(this._idToCode.keys()).map((A=>this._getBounds(A)))}};function $n(A,w,T,C,k,N,O,j){return C>=N&&w<=j&&T>=k&&A<=O}var Zn=(A,w,T,C,k,N)=>({minX:A,minY:w,maxX:T,maxY:C,leaf:!0,level:N,parent:k,objects:[],final:!1,children:null});function zD(A){let{minX:w,minY:T,maxX:C,maxY:k}=A;return[w,T,C,k]}function Rl(A,w,T,C,k,N,O,j){return A>=k&&T<=O&&w>=N&&C<=j}function $m(A,w,T,C,k,N,O,j){let G=(N+j)/2,H=(w+C)/2;return(A+T)/2<=(k+O)/2?H<=G?0:1:H<=G?3:2}var WI=A=>A,kl=class extends Cl{constructor(A=WI,w=10,T,C=0){super(),this._nodeCapacity=10,this._root=null,this._objects={},this._size=0,this._rootLevel=0,this._maxLevel=30,this._idToCell={},this._nodeCapacity=w,this._root=null,this._getBounds=A,this._rootLevel=C,this._maxLevel=C+30,this._idToCell={},T&&(this._root=Zn(T[0],T[1],T[2],T[3],null,C))}get size(){return this._size}get root(){return this._root}clear(){return this._root=null,this._objects={},this._size=0,this._idToCell={},this._rootLevel=0,this._maxLevel=this._rootLevel+30,this}insert(A,w,T,C,k,N=this._root){if(w||([w,T,C,k]=this._getBounds(A)),this._objects[A])return;if(this._objects[A]=!0,this._size++,!this._root){let N=Math.max(Math.abs(C-w),Math.abs(k-T));return this._root=Zn(w,T,w+N,T+N,null,this._rootLevel),this._idToCell[A]=[this._root],this._root.objects=[A],A}let O,j,G=[N],H=!1,W=this._nodeCapacity,$=this._idToCell,Z=this._maxLevel;for(;j=G.pop();){O=j;let{minX:N,minY:se,maxX:ue,maxY:ge}=O;$n(w,T,C,k,N,se,ue,ge)&&(O.leaf?O.objects&&(O.objects.length<W||O.final)?(O.objects.push(A),$[A]?$[A].push(O):$[A]=[O],H=!0,(O.level>=Z||Math.abs(ue-N)<=Math.abs(C-w)||Math.abs(ge-se)<=Math.abs(k-T))&&(O.final=!0)):(this.splitNode(O),G.push(O)):G.push.apply(G,O.children))}if(!Rl(w,T,C,k,(N=this._root).minX,N.minY,N.maxX,N.maxY)){let H=this._rootLevel;for(;!Rl(w,T,C,k,this._root.minX,this._root.minY,this._root.maxX,this._root.maxY);){N=this._root;let{minX:A,minY:C,maxX:k,maxY:O}=N,j=A,G=C,W=k,$=O,Z=Math.abs(k-A),se=Math.abs(O-C);if(0===se&&0===Z)break;let ue=Math.max(Z,se);w<A?(j-=ue,T<C?G-=ue:$+=ue):(W+=ue,T<C?G-=ue:$+=ue);let ge=Zn(j,G,W,$,null,--H);this.splitNode(ge),ge.children[$m(A,C,k,O,j,G,W,$)]=N,this._root=N.parent=ge}for(G=[this._root],this._root.level=this._rootLevel;j=G.shift();)if(O=j,!O.leaf)for(let A=0;A<4;A++){let w=O.children[A];w.level=O.level+1,G.push(w)}N=this._root;for(let w=0;w<4;w++){let T=N.children[w];T&&T.leaf&&T.objects&&(T.objects.push(A),$[A]?$[A].push(T):$[A]=[T])}}return H?A:void 0}removeById(A){if(!this._objects[A])return A;this._size--;let w=this._idToCell[A];for(let T=0;T<w.length;T++){let C=w[T].objects||[];for(let w=0,T=C.length;w<T;w++)if(C[w]===A){C.splice(w,1);break}}return delete this._objects[A],delete this._idToCell[A],A}remove(A){let w,T,[C,k,N,O]=this._getBounds(A),j=[this._root],G=[];for(;w=j.pop();)if($n(C,k,N,O,w.minX,w.minY,w.maxX,w.maxY))if(w.leaf){let T=w.objects||[];for(let C=0,k=T.length;C<k;C++)if(T[C]===A){T.splice(C,1),1===k&&G.push(w);break}}else j.push.apply(j,w.children);if(delete this._idToCell[A],delete this._objects[A],this._size--,G.length)for(;T=G.pop();){let A=T.parent,C=!0;for(;A&&C;){if(!A.leaf){for(let T=0;T<4;T++)if(w=A.children[T],!w.leaf||w.objects&&0!==w.objects.length){C=!1;break}C&&(A.leaf=!0,A.children=[],A.objects=[])}A=A.parent}}return A}splitNode(A){let{minX:w,minY:T,maxX:C,maxY:k}=A,N=(w+C)/2,O=(T+k)/2,j=A.level+1,G=this._idToCell,H=this._maxLevel,W=[Zn(w,T,N,O,A,j),Zn(w,O,N,k,A,j),Zn(N,O,C,k,A,j),Zn(N,T,C,O,A,j)];if(null!==A.objects){let w=A.objects,T=this._getBounds;for(let C=0,k=w.length;C<k;C++){let k=w[C],N=T(k),O=G[k];for(let A=0;A<4;A++){let w=W[A],{minX:T,minY:C,maxX:j,maxY:G}=w;$n(N[0],N[1],N[2],N[3],T,C,j,G)&&(w.objects&&w.objects.push(k),(w.level>=H||Math.abs(j-T)<=Math.abs(N[2]-N[0])||Math.abs(G-C)<=Math.abs(N[3]-N[1]))&&(w.final=!0),O?O.push(w):O=[w])}O&&O.splice(O.indexOf(A),1)}}A.children=W,A.objects=null,A.leaf=!1}point(A,w,T){let C,k,N,O=[],j=[this._root],G=this._getBounds;for(;C=j.pop();)if(A>=C.minX&&A<=C.maxX&&w>=C.minY&&w<=C.maxY){if(C.leaf){T&&C.objects&&(O=C.objects);let j=C.objects||[];for(let T=0,C=j.length;T<C;T++)N=j[T],k=G(N),A>=k[0]&&A<=k[2]&&w>=k[1]&&w<=k[3]&&O.push(N);break}j.push.apply(j,C.children)}return O.length?O:null}neigbours(A,w){let T,C=[],k=[this._root];for(;T=k.pop();)if(A>=T.minX&&A<=T.maxX&&w>=T.minY&&w<=T.maxY){if(T.leaf){C=T.objects;break}k.push.apply(k,T.children)}return C}query(A,w,T,C){let k,N,O,j,G=[],H=[this._root],W=this._getBounds,$={},Z=this._intersects;for(;k=H.pop();)if($n(A,w,T,C,k.minX,k.minY,k.maxX,k.maxY))if(k.leaf){let j=k.objects||[];for(let k=0,H=j.length;k<H;k++)O=j[k],$[O]||(N=W(O),$n(A,w,T,C,N[0],N[1],N[2],N[3])&&(!Z||Z(O,A,w,T,C))&&G.push(O),$[O]=!0)}else j=$m(A,w,T,C,k.minX,k.minY,k.maxX,k.maxY),H.push(k.children[(j+3)%4],k.children[(j+2)%4],k.children[(j+1)%4],k.children[j]);return G}traverse(A,w,T,C,k){let N,O,j,G,H=[],W=[this._root],$=this._getBounds,Z={},se=this._intersects;for(;N=W.pop();)if($n(A,w,T,C,N.minX,N.minY,N.maxX,N.maxY))if(N.leaf){let G=N.objects||[];for(let N=0,W=G.length;N<W;N++)if(j=G[N],!Z[j]){if(O=$(j),$n(A,w,T,C,O[0],O[1],O[2],O[3])&&(!se||se(j,A,w,T,C))&&(H.push(j),k(j)))return H;Z[j]=!0}}else G=$m(A,w,T,C,N.minX,N.minY,N.maxX,N.maxY),W.push(N.children[(G+3)%4],N.children[(G+2)%4],N.children[(G+1)%4],N.children[G]);return H}getOverlaps(){let A,w,T,C=[this._root],k=[],N=this._getBounds,O={};for(;A=C.pop();)if(A.leaf){let C=A.objects||[],j=C.length;for(let A=0;A<j;A++)for(let G=0;G<j;G++)if(w=C[A],T=C[G],A!==G&&!O[w+":"+T]&&!O[T+":"+w]){O[w+":"+T]=!0;let A=N(w),C=N(T);$n(A[0],A[1],A[2],A[3],C[0],C[1],C[2],C[3])&&k.push(w,T)}}else C.push.apply(C,A.children);return k}cover(A,w,T,C){if(null===this._root)return this._root=Zn(A,w,T,C,null,0),this;let k=this._root;if(!Rl(A,w,T,C,k.minX,k.minY,k.maxX,k.maxY)){let N=this._rootLevel;for(;!Rl(A,w,T,C,this._root.minX,this._root.minY,this._root.maxX,this._root.maxY);){k=this._root;let{minX:T,minY:C,maxX:O,maxY:j}=k,G=T,H=C,W=O,$=j,Z=Math.abs(O-T),se=Math.abs(j-C);if(0===se&&0===Z)break;let ue=Math.max(Z,se);A<T?(G-=ue,w<C?H-=ue:$+=ue):(W+=ue,w<C?H-=ue:$+=ue);let ge=Zn(G,H,W,$,null,--N);this.splitNode(ge),ge.children[$m(T,C,O,j,G,H,W,$)]=k,this._root=k.parent=ge}let O,j,G=[this._root];for(this._root.level=this._rootLevel;O=G.shift();)if(j=O,!j.leaf)for(let A=0;A<4;A++){let w=j.children[A];w.level=j.level+1,G.push(w)}}return this}getAll(){return Object.keys(this._objects).map((A=>Number(A)))}forEach(A,w){let T,C=[this._root];for(;T=C.pop();)if(T.leaf&&T.objects)for(let C=0,k=T.objects.length;C<k;C++)A.call(w,T.objects[C]);else C.push.apply(C,T.children);return this}getLeafs(){let A,w=[this._root],T=[];for(;A=w.pop();)A.leaf?T.push(A):w.push.apply(w,A.children);return T}traverseFromRoot(A,w){let T,C=[this._root];for(;T=C.pop();)!A.call(w,T,T.objects)&&!T.leaf&&C.push.apply(C,T.children);return this}update(A,w,T,C,k){return this.remove(A),this.insert(A,w,T,C,k),this}getNodeBounds(A){return zD(A)}};function VD(A,w,T,C){if(isNaN(w)||isNaN(T))return A;var k,N,O,j,G,H,W,$,Z,se=A._root,ue={data:C},ge=A._x0,ce=A._y0,_e=A._x1,me=A._y1;if(!se)return A._root=ue,A;for(;se.length;)if((H=w>=(N=(ge+_e)/2))?ge=N:_e=N,(W=T>=(O=(ce+me)/2))?ce=O:me=O,k=se,!(se=se[$=W<<1|H]))return k[$]=ue,A;if(j=+A._x.call(null,se.data),G=+A._y.call(null,se.data),w===j&&T===G)return ue.next=se,k?k[$]=ue:A._root=ue,A;do{k=k?k[$]=new Array(4):A._root=new Array(4),(H=w>=(N=(ge+_e)/2))?ge=N:_e=N,(W=T>=(O=(ce+me)/2))?ce=O:me=O}while(($=W<<1|H)==(Z=(G>=O)<<1|j>=N));return k[Z]=se,k[$]=ue,A}function ar(A,w,T,C,k){this.node=A,this.x0=w,this.y0=T,this.x1=C,this.y1=k}function eA(A){return A[0]}function rA(A){return A[1]}function Fl(A,w,T){var C=new __(null==w?eA:w,null==T?rA:T,NaN,NaN,NaN,NaN);return null==A?C:C.addAll(A)}function __(A,w,T,C,k,N){this._x=A,this._y=w,this._x0=T,this._y0=C,this._x1=k,this._y1=N,this._root=void 0}function iA(A){for(var w={data:A.data},T=w;A=A.next;)T=T.next={data:A.data};return w}kl.flatAccessor=(A,w)=>T=>{let C=w*T;return A.slice(C,C+w)},kl.inside=Rl,kl.intersects=function GI(A,w,T,C,k,N,O,j){return A>k&&A<O&&w>N&&w<j||T>k&&T<O&&C>N&&C<j},kl.overlaps=$n,kl.getNodeBBox=zD;var Il=Fl.prototype=__.prototype;Il.copy=function(){var A,w,T=new __(this._x,this._y,this._x0,this._y0,this._x1,this._y1),C=this._root;if(!C)return T;if(!C.length)return T._root=iA(C),T;for(A=[{source:C,target:T._root=new Array(4)}];C=A.pop();)for(var k=0;k<4;++k)(w=C.source[k])&&(w.length?A.push({source:w,target:C.target[k]=new Array(4)}):C.target[k]=iA(w));return T},Il.add=function UD(A){let w=+this._x.call(null,A),T=+this._y.call(null,A);return VD(this.cover(w,T),w,T,A)},Il.addAll=function HD(A){var w,T,C,k,N=A.length,O=new Array(N),j=new Array(N),G=1/0,H=1/0,W=-1/0,$=-1/0;for(T=0;T<N;++T)isNaN(C=+this._x.call(null,w=A[T]))||isNaN(k=+this._y.call(null,w))||(O[T]=C,j[T]=k,C<G&&(G=C),C>W&&(W=C),k<H&&(H=k),k>$&&($=k));if(G>W||H>$)return this;for(this.cover(G,H).cover(W,$),T=0;T<N;++T)VD(this,O[T],j[T],A[T]);return this},Il.cover=function WD(A,w){if(isNaN(A=+A)||isNaN(w=+w))return this;var T=this._x0,C=this._y0,k=this._x1,N=this._y1;if(isNaN(T))k=(T=Math.floor(A))+1,N=(C=Math.floor(w))+1;else{for(var O,j,G=k-T||1,H=this._root;T>A||A>=k||C>w||w>=N;)switch(j=(w<C)<<1|A<T,O=new Array(4),O[j]=H,H=O,G*=2,j){case 0:k=T+G,N=C+G;break;case 1:T=k-G,N=C+G;break;case 2:k=T+G,C=N-G;break;case 3:T=k-G,C=N-G}this._root&&this._root.length&&(this._root=H)}return this._x0=T,this._y0=C,this._x1=k,this._y1=N,this},Il.data=function XD(){var A=[];return this.visit((function(w){if(!w.length)do{A.push(w.data)}while(w=w.next)})),A},Il.extent=function KD(A){return arguments.length?this.cover(+A[0][0],+A[0][1]).cover(+A[1][0],+A[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},Il.find=function YD(A,w,T){var C,k,N,O,j,G,H,W=this._x0,$=this._y0,Z=this._x1,se=this._y1,ue=[],ge=this._root;for(ge&&ue.push(new ar(ge,W,$,Z,se)),null==T?T=1/0:(W=A-T,$=w-T,Z=A+T,se=w+T,T*=T);G=ue.pop();)if(!(!(ge=G.node)||(k=G.x0)>Z||(N=G.y0)>se||(O=G.x1)<W||(j=G.y1)<$))if(ge.length){var ce=(k+O)/2,_e=(N+j)/2;ue.push(new ar(ge[3],ce,_e,O,j),new ar(ge[2],k,_e,ce,j),new ar(ge[1],ce,N,O,_e),new ar(ge[0],k,N,ce,_e)),(H=(w>=_e)<<1|A>=ce)&&(G=ue[ue.length-1],ue[ue.length-1]=ue[ue.length-1-H],ue[ue.length-1-H]=G)}else{var me=A-+this._x.call(null,ge.data),pe=w-+this._y.call(null,ge.data),be=me*me+pe*pe;if(be<T){var Se=Math.sqrt(T=be);W=A-Se,$=w-Se,Z=A+Se,se=w+Se,C=ge.data}}return C},Il.remove=function qD(A){if(isNaN(N=+this._x.call(null,A))||isNaN(O=+this._y.call(null,A)))return this;var w,T,C,k,N,O,j,G,H,W,$,Z,se=this._root,ue=this._x0,ge=this._y0,ce=this._x1,_e=this._y1;if(!se)return this;if(se.length)for(;;){if((H=N>=(j=(ue+ce)/2))?ue=j:ce=j,(W=O>=(G=(ge+_e)/2))?ge=G:_e=G,w=se,!(se=se[$=W<<1|H]))return this;if(!se.length)break;(w[$+1&3]||w[$+2&3]||w[$+3&3])&&(T=w,Z=$)}for(;se.data!==A;)if(C=se,!(se=se.next))return this;return(k=se.next)&&delete se.next,C?(k?C.next=k:delete C.next,this):w?(k?w[$]=k:delete w[$],(se=w[0]||w[1]||w[2]||w[3])&&se===(w[3]||w[2]||w[1]||w[0])&&!se.length&&(T?T[Z]=se:this._root=se),this):(this._root=k,this)},Il.removeAll=function jD(A){for(var w=0,T=A.length;w<T;++w)this.remove(A[w]);return this},Il.root=function ZD(){return this._root},Il.size=function $D(){var A=0;return this.visit((function(w){if(!w.length)do{++A}while(w=w.next)})),A},Il.visit=function QD(A){var w,T,C,k,N,O,j=[],G=this._root;for(G&&j.push(new ar(G,this._x0,this._y0,this._x1,this._y1));w=j.pop();)if(!A(G=w.node,C=w.x0,k=w.y0,N=w.x1,O=w.y1)&&G.length){var H=(C+N)/2,W=(k+O)/2;(T=G[3])&&j.push(new ar(T,H,W,N,O)),(T=G[2])&&j.push(new ar(T,C,W,H,O)),(T=G[1])&&j.push(new ar(T,H,k,N,W)),(T=G[0])&&j.push(new ar(T,C,k,H,W))}return this},Il.visitAfter=function JD(A){var w,T=[],C=[];for(this._root&&T.push(new ar(this._root,this._x0,this._y0,this._x1,this._y1));w=T.pop();){var k=w.node;if(k.length){var N,O=w.x0,j=w.y0,G=w.x1,H=w.y1,W=(O+G)/2,$=(j+H)/2;(N=k[0])&&T.push(new ar(N,O,j,W,$)),(N=k[1])&&T.push(new ar(N,W,j,G,$)),(N=k[2])&&T.push(new ar(N,O,$,W,H)),(N=k[3])&&T.push(new ar(N,W,$,G,H))}C.push(w)}for(;w=C.pop();)A(w.node,w.x0,w.y0,w.x1,w.y1);return this},Il.x=function tA(A){return arguments.length?(this._x=A,this):this._x},Il.y=function nA(A){return arguments.length?(this._y=A,this):this._y};var Ml=function(A,w,T,C,k){this.node=A,this.x0=w,this.y0=T,this.x1=C,this.y1=k};Fl.prototype.visit2=function(A){let w,T,C,k,N,O,j,G=[],H=this._root;for(H&&G.push(new Ml(H,this._x0,this._y0,this._x1,this._y1));(w=G.pop())&&(j=A(H=w.node,C=w.x0,k=w.y0,N=w.x1,O=w.y1),"break"!==j);)if(!j&&H.length){let A=(C+N)/2,w=(k+O)/2;(T=H[3])&&G.push(new Ml(T,A,w,N,O)),(T=H[2])&&G.push(new Ml(T,C,w,A,O)),(T=H[1])&&G.push(new Ml(T,A,k,N,w)),(T=H[0])&&G.push(new Ml(T,C,k,A,w))}return this};function E_(A,w,T,{cells:C=!0,boxes:k=!0,query:N=!0}={}){let O=w.keys().map((A=>w.keyToBBox(Number(A)))),j=w.getBoxes();if(C&&(A.beginPath(),A.lineWidth=1,A.strokeStyle="#707070",O.forEach((w=>{A.rect(w[0],w[1],w[2]-w[0],w[3]-w[1])})),A.stroke()),k&&(A.beginPath(),A.lineWidth=1,A.strokeStyle="#ff7070",j.forEach((w=>{A.rect(w[0],w[1],w[2]-w[0],w[3]-w[1])})),A.closePath(),A.stroke()),N&&T){let w=T;A.beginPath(),A.lineWidth=2,A.strokeStyle="#3030ff",A.rect(w[0],w[1],w[2]-w[0],w[3]-w[1]),A.closePath(),A.stroke()}}var Nl=["x","y","radius"],Pl=["width","curvature"],Dl=class extends kt{constructor(){super(...arguments),this._minCellSize=8,this._clear=()=>{this._index.clear(),this._elementsToUpdate.clear()},this._onGraphUpdate=A=>{if(A.nodes&&(!A.nodeAttributes||A.nodeAttributes.some((A=>Nl.includes(A))))){let w=A.nodes.fastGetAdjacentElements().edges;this._elementsToUpdate.addElements(A.nodes),this._elementsToUpdate.addElements(w)}A.edges&&(!A.edgeAttributes||A.edgeAttributes.some((A=>Pl.includes(A))))&&this._elementsToUpdate.addElements(A.edges)}}onMounted(){this._index=new Ll(this._getIntersector(),function oA(A){let[w,T,C]=A.getNodeAttributes(["x","y","radius"]),[k,N,O]=A.getEdgeAttributes(["source","target","curvature"]),j={x:0,y:0,x1:0,y1:0,x2:0,y2:0},G={minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return A=>{if(A<0){A=-A;let H=k.get(A),W=N.get(A),$=O.get(A),Z=w.get(H),se=T.get(H),ue=w.get(W),ge=T.get(W);H===W?(xr(Z,se,$,C.get(H),0,j),Ns(Z,se,j.x1,j.y1,j.x2,j.y2,ue,ge,G)):0===$?(G.minX=Math.min(Z,ue),G.minY=Math.min(se,ge),G.maxX=Math.max(Z,ue),G.maxY=Math.max(se,ge)):(jt(Z,se,ue,ge,$,j),Yd(Z,se,j.x,j.y,ue,ge,G))}else{let k=w.get(A),N=T.get(A),O=C.get(A);G.minX=k-O,G.minY=N-O,G.maxX=k+O,G.maxY=N+O}return[G.minX,G.minY,G.maxX,G.maxY]}}(this._modules.graph),this._minCellSize,1e6),this._elementsToUpdate=new Ss(this._modules.graph),this._removedNodes=this._modules.graph.getNodeAttribute("removed"),this._removedEdges=this._modules.graph.getEdgeAttribute("removed"),this._excludedNodes=this._modules.graph.getNodeAttribute("excluded"),this._excludedEdges=this._modules.graph.getEdgeAttribute("excluded"),this._queryResult={edges:[],nodes:[]},this._queryBounds=[0,0,0,0],this._modules.events.on(["addNodes","addEdges","removeNodes","removeEdges","updateAttributes"],this._onGraphUpdate).on("excludedStateChange",(({elements:A})=>{this._elementsToUpdate.addElements(A)})).on("clearGraph",this._clear)}_getIntersector(){let A=this._modules.graph,[w,T,C]=A.getNodeAttributes(["x","y","radius"]),[k,N,O,j]=A.getEdgeAttributes(["source","target","width","curvature"]),G={x:0,y:0,x1:0,y1:0,x2:0,y2:0};return(A,H,W,$,Z)=>{if(A<0){A=-A;let se=k.get(A),ue=N.get(A),ge=j.get(A),ce=O.get(A)/2,_e=w.get(se),me=T.get(se),pe=w.get(ue),be=T.get(ue);return se===ue?(xr(_e,me,ge,C.get(se),0,G),As(_e,me,G.x1,G.y1,G.x2,G.y2,pe,be,H-ce,W-ce,$+ce,Z+ce)):0===ge?Kd(_e,me,pe,be,H-ce,W-ce,$+ce,Z+ce):(jt(_e,me,pe,be,ge,G),Ds(_e,me,G.x,G.y,pe,be,H-ce,W-ce,$+ce,Z+ce))}return bl(w.get(A),T.get(A),C.get(A),H,W,$,Z)}}reindex(){this._modules.graphics.forceAttributesComputation(),this._index.clear(),this._elementsToUpdate.clear(),this._updateItems(this._modules.graph.getNodes("all")._indexes,this._modules.graph.getEdges("all")._indexes)}getSize(){return this._index.size}_updateIndex(){if(!this._elementsToUpdate.isEmpty()){let{nodes:A,edges:w}=this._elementsToUpdate.getElements();this._updateItems(A._indexes,w._indexes),this._elementsToUpdate.clear()}}_updateItems(A,w){let T=this._index,C=this._removedNodes,k=this._removedEdges,N=this._excludedNodes,O=this._excludedEdges,j=[],G=[];if(C&&N)for(let w=0;w<A.length;w++){let k=A[w];0!==C.get(k)||0!==N.get(k)?j.push(k):(T.has(k)&&j.push(k),G.push(k))}if(k&&O)for(let A=0;A<w.length;A++){let C=-w[A];0!==k.get(-C)||0!==O.get(-C)?j.push(C):(T.has(C)&&j.push(C),G.push(C))}for(let A of j)T.remove(A);for(let A of G)T.insert(A)}getNodesInScreenByDistance(A){let{x:w,y:T}=A.getPositionOnScreen();return this._modules.graph.getNodes().filter((w=>w.isInScreen()&&w!==A)).sort(((A,C)=>{let k=A.getPositionOnScreen(),N=C.getPositionOnScreen();return Et(k.x,k.y,w,T)-Et(N.x,N.y,w,T)}))}getNearestNodesForNode(A,w=240,T){let{x:C,y:k}=A.getPosition();return this.getNearestNodes(C,k,w,T,A)}getNearestNodes(A,w,T,C,k){if(this._updateIndex(),C){let A=this._modules.camera.screenToGraphVector({x:T,y:T});T=Et(0,0,A.x,A.y)}return this._getNearestNodes(A,w,T,k)}_getNearestNodes(A,w,T,C){let k=[],N=T*T,O=C?C._index:0,j=this._modules.graph.getNodes()._indexes,[G,H]=this._modules.graph.getNodeAttributes(["x","y"]);for(let T=0,C=j.length;T<C;T++){let C=j[T];if(C===O)continue;let W=A-G.get(C),$=w-H.get(C);W*W+$*$<=N&&k.push(C)}return this._modules.graph.nodeList(new Uint32Array(k))}queryRaw(A,w,T,C){this._updateIndex();let k=this._queryBounds;k[0]=A,k[1]=w,k[2]=T,k[3]=C;let N=this._index.query(A,w,T,C),{nodes:O,edges:j}=this._queryResult;O.length=j.length=0;for(let A=0;A<N.length;A++){let w=N[A];w<0?j.push(-w):O.push(w)}return this._queryResult}queryRawProjected(A,w,T,C){let k=this._queryBounds;return k[0]=A,k[1]=w,k[2]=T,k[3]=C,this._modules.camera.projectBounds(k),this.queryRaw(k[0],k[1],k[2],k[3])}query(A,w,T,C){let k=this._modules.graph,{nodes:N,edges:O}=this.queryRaw(A,w,T,C);return{nodes:k.nodeList(new Uint32Array(N.slice())),edges:k.edgeList(new Uint32Array(O.slice()))}}queryProjected(A,w,T,C){let k=this._modules.graph,{nodes:N,edges:O}=this.queryRawProjected(A,w,T,C);return{nodes:k.nodeList(new Uint32Array(N.slice())),edges:k.edgeList(new Uint32Array(O.slice()))}}getNodesByBoundingBox(A,w,T,C,k){if(this._updateIndex(),k){let k;k=this._modules.camera.screenToGraphVector({x:A,y:w}),A=k.x,w=k.y,k=this._modules.camera.screenToGraphVector({x:T,y:C}),T=k.x,C=k.y}let N=this._modules.graph,O=N.getNodes()._indexes,j=[],G=N.getNodeAttribute("excluded"),[H,W]=N.getNodeAttributes(["x","y"]);for(let k=0,N=O.length;k<N;k++){let N=O[k];if(G&&G.get(N))continue;let $=H&&H.get(N),Z=W&&W.get(N);$>=A&&$<=T&&Z>=w&&Z<=C&&j.push(N)}return N.nodeList(new Uint32Array(j))}toggleDebug(A){A?(this._layer=this._modules.layers.addCanvasLayer((A=>{E_(A,this._index,this._queryBounds)}),{isStatic:!1,noClear:!1}),this._layer.moveToTop()):this._layer&&(this._layer.destroy(),this._layer=null)}renderDebug(A){if(!this._layer)return this.toggleDebug(!0);this._layer.refresh((w=>{E_(w,this._index,this._queryBounds,A)}))}},Ol={};function Io(A,w,T,C,k=0,N=Math.sin(k),O=Math.cos(k),j=[0,0,0,0]){let G,H,W,$,Z,se,ue,ge,ce=T/2,_e=C/2,me=A+ce,pe=w+_e;return 0===k?(j[0]=A,j[1]=w,j[2]=A+T,j[3]=w+C,j):(W=-ce,$=-_e,G=me+W*O-$*N,H=pe+W*N+$*O,Z=ue=G,se=ge=H,W=-ce,$=_e,G=me+W*O-$*N,H=pe+W*N+$*O,G<Z?Z=G:G>ue&&(ue=G),H<se?se=H:H>ge&&(ge=H),W=ce,$=_e,G=me+W*O-$*N,H=pe+W*N+$*O,G<Z?Z=G:G>ue&&(ue=G),H<se?se=H:H>ge&&(ge=H),W=ce,$=-_e,G=me+W*O-$*N,H=pe+W*N+$*O,G<Z?Z=G:G>ue&&(ue=G),H<se?se=H:H>ge&&(ge=H),j[0]=Z,j[1]=se,j[2]=ue,j[3]=ge,j)}function Qn(A,w,T,C,k=0){let N=T/2,O=C/2,j=A+N,G=w+O;if(0===k)return[{x:A,y:w},{x:A+T,y:w},{x:A+T,y:w+C},{x:A,y:w+C}];let H,W,$,Z,se=Math.sin(k),ue=Math.cos(k);$=-N,Z=-O,H=j+$*ue-Z*se,W=G+$*se+Z*ue;let ge={x:H,y:W};$=-N,Z=O,H=j+$*ue-Z*se,W=G+$*se+Z*ue;let ce={x:H,y:W};$=N,Z=O,H=j+$*ue-Z*se,W=G+$*se+Z*ue;let _e={x:H,y:W};return $=N,Z=-O,H=j+$*ue-Z*se,W=G+$*se+Z*ue,[ge,ce,_e,{x:H,y:W}]}function Qm(A,w=0,T=1,C=dn.slice()){let k=T*Math.sin(w),N=T*Math.cos(w);return C[0]=A[0]+k,C[1]=A[1]+N,C[2]=A[2]+k,C[3]=A[3]+N,C}function qI(A,w){return tf(A,w)}function jI(A,w){return sA(A[0],A[1],A[2],A[3],w[0],w[1],w[2],w[3])}function ZI(A,w,T,C,k,N,O,j){return A>k&&A<O&&w>N&&w<j||T>k&&T<O&&C>N&&C<j}function sA(A,w,T,C,k,N,O,j){return C>=N&&w<=j&&T>=k&&A<=O}Ua(Ol,{angle:()=>yS,circleCircleIntersection:()=>fl,circleContainsCircle:()=>SL,circleContainsPoint:()=>TL,circleIntersectsBox:()=>bl,circleLineIntersection:()=>Rf,circleSortCompare:()=>_l,computeCentroid:()=>xl,cubicBezierAABB:()=>As,defaultAABB:()=>dn,degreesToRadians:()=>uS,distToSegmentSquared:()=>Ah,distance:()=>Et,distancePointSegment:()=>df,extendBounds:()=>tf,getAABB:()=>Io,getBezierCurveBoundingBox:()=>Ns,getClosestPointOnLine:()=>DS,getClosestPointOnSegment:()=>lf,getNormalOnEdge:()=>SS,getNormalOnQuadraticCurve:()=>Gy,getOBBPoints:()=>Qn,getPointOnBezierCurve:()=>bo,getPointOnEdge:()=>TS,getPointOnQuadraticCurve:()=>vs,getQuadraticCurveBoundingBox:()=>Yd,getQuadraticCurveControlPoint:()=>jt,getSelfLoopControlPoints:()=>xr,getTangentOnEdge:()=>LS,getTangentOnQuadraticCurve:()=>cf,intersects:()=>ZI,isPointInLine:()=>sf,isPointInPolygon:()=>wi,isPointOnBezierCurve:()=>mf,isPointOnQuadraticCurve:()=>hf,lineAABB:()=>Kd,lineAngle:()=>Ai,lineIntersection:()=>xS,lineLine:()=>_o,move:()=>lS,moveAABB:()=>Qm,normalize:()=>ef,overlaps:()=>sA,overlapsAABB:()=>jI,padBounds:()=>qI,polygonsIntersect:()=>Wf,quadBezierAABB:()=>Ds,radiansToDegrees:()=>Eh,rotate:()=>xs,segmentIntersection:()=>Xd,segmentRectangleIntersection:()=>af,squaredDistance:()=>kd,twoSegmentsIntersect:()=>ES});function aA(A,w){let T=A.getAttribute("curvature"),C=A.getSource(),k=A.getTarget(),N=C.getPositionOnScreen();if(C===k){let A=5*(T+C.getAttribute("radius"))*w,k=N.x,O=N.y,j=k-A,G=O,H=k,W=O+A;return[N,...[.2,.4,.6,.8].map((A=>bo(A,k,O,k,O,j,G,H,W))),N]}let O=k.getPositionOnScreen();if(0===T)return[N,O];let j=O.x-N.x,G=O.y-N.y,H=Math.sqrt(j*j+G*G),W=(N.x+O.x)/2,$=(N.y+O.y)/2,Z=T*(H/5)*2,se=W+G/H*Z,ue=$+-j/H*Z;return[N,...[.25,.5,.75].map((A=>vs(A,N.x,N.y,O.x,O.y,se,ue))),O]}function x_(A,w,T,C){"number"==typeof T&&(T={left:T,right:T,top:T,bottom:T});let k=void 0===T.left?40:T.left,N=void 0===T.right?40:T.right,O=void 0===T.top?40:T.top,j=void 0===T.bottom?40:T.bottom,G=k+N,H=O+j,W=0===A.width?A.maxFixedSize:A.width,$=0===A.height?A.maxFixedSize:A.height,Z=function _D(A){let w=A.filter((A=>isFinite(A)&&A>0));return w.length?Hr(w):1}([(w.width-G)/(W+A.maxScaledSize),(w.height-H)/($+A.maxScaledSize),(w.width-G-A.maxFixedSize)/W,(w.height-H-A.maxFixedSize)/$,C/A.maxScaledSize||NaN]);return{x:A.cx+(N-k)/(2*Z),y:A.cy+(j-O)/(2*Z),zoom:Z}}var jl="quadraticInOut",Hl=200,Xl=class extends kt{constructor(){super(...arguments),this._isLocating=!1,this._cacheValid=!0,this._cachedGraphBoundingBox=new ws,this._invalidCache=()=>{this._cacheValid=!1}}onMounted(){this._modules.events.on(["addNodes","removeNodes","addEdges","removeEdges","excludedStateChange","clearGraph","updateAttributes"],this._invalidCache)}onReady(){this.locateGraph({},!0)}locateGraph(A,w=!1){return this._onLocateStart(),w?this._locateGraph(A):this._modules.transformations.whenApplied().then((()=>this._locateGraph(A)))}_locateGraph(A){return this._locateBoundingBox(this.getGraphBoundingBox(),A).then((()=>this._onLocated()))}locateElements(A,w){return this._modules.transformations.whenApplied().then((()=>this._locateBoundingBox(this.getBoundingBox(A),w))).then((()=>this._onLocated()))}locateRawGraph(A,w){return this._onLocateStart(),this._locateBoundingBox(this.getRawGraphBoundingBox(A),w).then((()=>this._onLocated()))}_onLocateStart(){this._isLocating=!0}_onLocated(){this._isLocating=!1}isLocating(){return this._isLocating}getGraphBoundingBox(A=!1){return A?this.getBoundingBox(this._ogma.getNodes(),!0,A):(this._cacheValid||this._updateCache(),Object.assign({},this._cachedGraphBoundingBox))}forceInvalidCache(){this._invalidCache()}_updateCache(){this._cacheValid=!0,this._cachedGraphBoundingBox=this.getBoundingBox(this._modules.graph.getNodes())}getBoundingBox(A,w=!1,T=!1,C){let k;if(k=A.isNode?this._getNodesBoundingBox(A.toList(),w):this._getEdgesBoundingBox(A.toList(),C),T){let w=this._ogma.modules.labels.getTextsBoundingBox(A.isNode?A.toList():null,A.isNode?null:A.toList());k=k.extend(w)}return k}_getNodesBoundingBox(A,w=!1){this._modules.graphics.forceAttributesComputation();let T=this._modules.graphics.getNodeAttributes(),C=[],k=[],N=[],O=[];for(let j=0;j<A.size;++j){let G=A._indexes[j];if(0===T.excluded.get(G)){let A=T.x.get(G),j=T.y.get(G),H=T.radius.get(G),W=2*H;"scaled"===T.scalingMethod.get(G)?N.push(W):O.push(W),w?(C.push(A-H,A+H),k.push(j-H,j+H)):(C.push(A),k.push(j))}}return new ws({xValues:C,yValues:k,scaledSizeValues:N,fixedSizeValues:O})}_getEdgesBoundingBox(A,w=!1){this._modules.graphics.forceAttributesComputation();let T=this._modules.graphics.getEdgeAttributes(),C=this._modules.graphics.getNodeAttributes(),k={x1:0,y1:0,x2:0,y2:0},N={x:0,y:0},O={minX:0,minY:0,maxX:0,maxY:0},j=[],G=[],H=[],W=[];for(let $=0;$<A.size;++$){let Z=A._indexes[$],se=T.source.get(Z),ue=T.target.get(Z),ge=T.curvature.get(Z),ce=C.x.get(se),_e=C.y.get(se),me="scaled"===C.scalingMethod.get(se),pe=2*C.radius.get(se),be=C.x.get(ue),Se=C.y.get(ue),Ee="scaled"===C.scalingMethod.get(ue),Te=2*C.radius.get(ue);if(me?H.push(pe):W.push(pe),Ee?H.push(Te):W.push(Te),w||0===ge)j.push(ce,be),G.push(_e,Se);else if(se===ue){xr(ce,_e,ge,pe/2,0,k),Ns(ce,_e,k.x1,k.y1,k.x2,k.y2,be,Se,O),j.push(O.minX,O.maxX),G.push(O.minY,O.maxY)}else jt(ce,_e,be,Se,ge,N),Yd(ce,_e,N.x,N.y,be,Se,O),j.push(O.minX,O.maxX),G.push(O.minY,O.maxY)}return new ws({xValues:j,yValues:G,scaledSizeValues:H,fixedSizeValues:W})}getRawGraphBoundingBox(A){let w=A.nodes.length,T=new Array(w),C=new Array(w),k=new Array(w);for(let N=0;N<w;N++){let w=A.nodes[N].attributes||{};T[N]=w.x||0,C[N]=w.y||0,k[N]=w.radius||5}return new ws({xValues:T,yValues:C,scaledSizeValues:k})}_locateBoundingBox(A,w={}){if(isNaN(A.cx))return Promise.resolve();let{padding:T={},easing:C=jl,duration:k=0,maxNodeSizeOnScreen:N=Hl,ignoreZoomLimits:O=!1}=w,j=x_(A,this._modules.dom.getDimensions(),T,N),G=j.x,H=j.y,W=j.zoom,$=W/this._modules.camera.getZoom();return this._moveCamera(G,H,W,k,C,$,O)}_moveCamera(A,w,T,C,k,N,O){return N>1.01?(this._modules.camera.setCenter({x:A,y:w},{duration:C,easing:k,ignoreZoomLimits:O}),this._modules.camera.setZoom(T,{duration:C,easing:k,ignoreZoomLimits:O,startAfter:.5})):N<.99?(this._modules.camera.setCenter({x:A,y:w},{duration:C,easing:k,ignoreZoomLimits:O,startAfter:.5}),this._modules.camera.setZoom(T,{duration:C,easing:k,ignoreZoomLimits:O})):this._modules.camera.setCenter({x:A,y:w},{duration:C,easing:k,ignoreZoomLimits:O})}computeConfigForBounds(A,w={}){let{padding:T={},maxNodeSizeOnScreen:C=Hl}=w;return x_(A,this._modules.dom.getDimensions(),T,C)}layoutDataBoundingBox({x:A,y:w,indexes:T}){let C=this._modules.graphics.getNodeAttributes(),k=[],N=[],O=[],j=[];for(let G=0;G<T.length;++G){let H=T[G],W=A[G],$=w[G],Z=2*C.radius.get(H),se="scaled"===C.scalingMethod.get(H);k.push(W),N.push($),se?O.push(Z):j.push(Z)}return new ws({xValues:k,yValues:N,scaledSizeValues:O,fixedSizeValues:j})}isEdgeInPolygon(A,w){return function dA(A,w,T){let C=A.getSource(),k=A.getTarget(),N=C.getPositionOnScreen(),O=k.getPositionOnScreen();if(wi(N.x,N.y,w)||wi(O.x,O.y,w))return!0;let j=aA(A,T);for(let A=0;A<j.length-1;++A){let T=j[A],C=j[A+1];for(let A=0;A<w.length-1;++A){let k=w[A],N=w[A+1];if(_o(T.x,T.y,C.x,C.y,k.x,k.y,N.x,N.y))return!0}}return!1}(A,w,this._modules.camera.getZoom())}isElementInView(A,{margin:w=0}={}){let{width:T,height:C}=this._modules.camera.getSize(),k={minX:-w,minY:-w,maxX:T+w,maxY:C+w};return A.isNode?this.isNodeInRectangle(A,k):this.isEdgeInRectangle(A,k)}isNodeInRectangle(A,w){return function lA(A,w,T){let C=A.getPositionOnScreen(),k=Number(A.getAttribute("radius"))*T,N=C.x-k,O=C.y-k,j=C.x+k,G=C.y+k;return j>=w.minX&&N<=w.maxX&&G>=w.minY&&O<=w.maxY}(A,w,this._modules.camera.getZoom())}isNodeInPolygon(A,w){let T=A.getPositionOnScreen();return wi(T.x,T.y,w)}isEdgeInRectangle(A,w){return function uA(A,w,T){let C=aA(A,T);for(let A=0;A<C.length-1;++A){let T=C[A],k=C[A+1];if(Kd(T.x,T.y,k.x,k.y,w.minX,w.minY,w.maxX,w.maxY))return!0}return!1}(A,w,this._modules.camera.getZoom())}},$l=be&&void 0!==typeof navigator&&"msLaunchUri"in navigator&&pe&&!("documentMode"in document);var ql=class extends kt{constructor(){super(...arguments),this._px=0,this._py=0,this._pressX=0,this._pressY=0,this._left=!1,this._middle=!1,this._right=!1,this._clickCounter={left:0,middle:0,right:0},this._buttons={left:!1,middle:!1,right:!1},this._skipNextMove=!1,this._onMouseWheel=A=>{this._isEnabled()&&this._isWheelEnabled()&&(!this._disableWheelUntilMouseDown()||this._modules.dom.hasFocus())&&(A.preventDefault(),A.stopPropagation(),this._applyMouseWheelZoom(A))},this._onMouseMove=A=>{if(!this._isEnabled()||!this._setXY(A))return;let w=this._modules.position.x,T=this._modules.position.y,C=w-this._px,k=T-this._py;0===C&&0===k||(this._skipNextMove?this._skipNextMove=!1:Et(w,T,this._pressX,this._pressY)>=6&&(this._resetClickCounter(),this._modules.events.fire("mousemoveInternal",{x:w,y:T,dx:C,dy:k,domEvent:this._evt})))},this._onDocumentMouseMove=A=>{if(!this._isEnabled()||!this._setXY(A))return;let w=this._modules.position.x,T=this._modules.position.y,C=this._bounds,k=w-this._px,N=T-this._py;(w<0||w>C.width||T<0||T>C.height)&&this._modules.events.fire("documentMouseMove",{x:w,y:T,dx:k,dy:N,domEvent:this._evt})},this._onMouseUp=A=>{if(!this._isEnabled()||!this._setXY(A))return;let w=this._modules.position.x,T=this._modules.position.y,C=this._button,k=this._evt;this._buttons[C]=!1,1===this._clickCounter[this._button]?this._modules.events.fire("clickInternal",{button:C,x:w,y:T,domEvent:k}):this._clickCounter[C]>1&&(this._modules.events.fire("doubleclickInternal",{button:C,x:w,y:T,domEvent:k}),this._resetClickCounter(C)),this._modules.events.fire("mouseupInternal",{button:C,x:w,y:T,domEvent:k})},this._onDocumentMouseup=A=>{if(!this._isEnabled()||!this._setXY(A))return;let w=this._modules.position.x,T=this._modules.position.y,C=this._button;this._buttons[C]=!1;let k=this._modules.dom;this._modules.events.fire("documentMouseUp",{button:C,x:w,y:T,domEvent:this._evt}),k.removeDirectWindowEventListener("mousemove",this._onDocumentMouseMove),k.removeDirectWindowEventListener("mouseup",this._onDocumentMouseup)},this._onMouseDown=A=>{if(!this._isEnabled()||!this._setXY(A))return;let w=this._modules.position.x,T=this._modules.position.y,C=this._button,k=this._modules.dom;this._skipNextMove=!0,this._pressX=w,this._pressY=T,this._lastMouseDownTarget=A.target,k.focus(),this._buttons[C]=!0,this._clickCounter[C]+=1;let N=C;this._dbclickTimer=k.setTimeout((()=>{this._resetClickCounter(N,0)}),this._getDoubleClickTimer()),this._modules.events.fire("mousedownInternal",{button:C,x:w,y:T,domEvent:this._evt}),k.addDirectWindowEventListener("mousemove",this._onDocumentMouseMove),k.addDirectWindowEventListener("mouseup",this._onDocumentMouseup)},this._onDrop=A=>{if(!this._isEnabled()||!this._setXY(A))return;A.preventDefault();let{x:w,y:T}=this._modules.camera.screenToGraphCoordinates(this._modules.position);this._modules.events.fire("drop",{domEvent:this._evt,x:w,y:T})}}onMounted(){this._domElt=this._modules.graphics.getDomElement(),this._modules.settings.register("mouse.enabled",!0),this._modules.settings.register("mouse.wheelEnabled",!0),this._modules.settings.register("mouse.disableWheelUntilMouseDown",!1),this._modules.settings.register("mouse.doubleClickTimer",500),this._modules.events.register(["mousedownInternal","mouseupInternal","mousemoveInternal","mousewheelInternal","clickInternal","doubleclickInternal","mouseoverInternal","mouseoutInternal","documentMouseUp","documentMouseMove","drop"]),this._modules.dom.afterNextFrame().then((()=>this._initializeListeners()))}get x(){return this._modules.position.x}get y(){return this._modules.position.y}get left(){return this._left}get right(){return this._right}get middle(){return this._middle}_isEnabled(){return this._modules.settings.get("mouse.enabled")}_isWheelEnabled(){return this._modules.settings.get("mouse.wheelEnabled")}_disableWheelUntilMouseDown(){return this._modules.settings.get("mouse.disableWheelUntilMouseDown")}_getDoubleClickTimer(){return this._modules.settings.get("mouse.doubleClickTimer")}_resetClickCounter(A,w=0){A?this._clickCounter[A]=w:(this._clickCounter.left=w,this._clickCounter.middle=w,this._clickCounter.right=w),this._modules.dom.clearTimeout(this._dbclickTimer),this._lastMouseDownTarget=null}_setXY(A){let w=this._domElt.getBoundingClientRect();return this._bounds=w,!!w&&(this._evt=A,this._button=st[A.button],this._px=this._modules.position.x,this._py=this._modules.position.y,this._modules.position.x=A.clientX-w.left,this._modules.position.y=A.clientY-w.top,this._left=this._buttons.left,this._right=this._buttons.right,this._middle=this._buttons.middle,!0)}_applyMouseWheelZoom(A){var w;this._setXY(A)&&this._modules.events.fire("mousewheelInternal",{delta:(w=A,$l?w.wheelDeltaY/2:w.deltaY&&0===w.deltaMode?-w.deltaY/Ye():w.deltaY&&1===w.deltaMode?20*-w.deltaY:w.deltaY&&2===w.deltaMode?60*-w.deltaY:w.deltaX||w.deltaZ?0:w.wheelDelta?(w.wheelDeltaY||w.wheelDelta)/2:w.detail&&Math.abs(w.detail)<32765?20*-w.detail:w.detail?w.detail/-32765*60:0),x:this._modules.position.x,y:this._modules.position.y,domEvent:this._evt})}_initializeListeners(){let A=this._domElt,w=this._modules.dom;Ee&&this._modules.dom.addElementEventListener(document,"contextmenu",(A=>{this._lastMouseDownTarget&&A.target!==this._lastMouseDownTarget&&A.preventDefault()})),w.addElementEventListener(A,"contextmenu",(A=>{this._setXY(A),this._modules.dom.hasFocus()&&this._modules.settings.get("mouse.enabled")&&A.preventDefault()}),!1);let T="onwheel"in A?"wheel":void 0!==A.onmousewheel?"mousewheel":"DOMMouseScroll";w.addElementEventListener(A,T,this._onMouseWheel),w.addElementEventListener(A,"mousemove",this._onMouseMove),w.addElementEventListener(A,"mouseleave",(w=>{if(!this._isEnabled())return;this._modules.dom.blur();let T=A.getBoundingClientRect();w.clientX>=T.left+1&&w.clientX<=T.right-1&&w.clientY>=T.top+1&&w.clientY<=T.bottom-1||this._modules.events.fire("mouseout",{domEvent:this._evt})})),w.addElementEventListener(A,"mousedown",this._onMouseDown),w.addElementEventListener(A,"mouseup",this._onMouseUp),w.addElementEventListener(A,"dragover",(A=>{A.preventDefault()})),w.addElementEventListener(A,"drop",this._onDrop)}},Ql=500,Jl=class extends kt{constructor(){super(...arguments),this._pressed=!1,this._addEvent=(A,w,T,C)=>{this._modules.dom.addElementEventListener(A,w,T,C)},this._addWinEvent=(A,w,T,C)=>{this._modules.dom.addDirectWindowEventListener(w,T,C)},this._removeWinEvent=(A,w,T)=>{this._modules.dom.removeDirectWindowEventListener(w,T)}}onMounted(){this._domElt=this._modules.graphics.getDomElement(),this._modules.settings.register("touch.enabled",!0),this._modules.events.register(["touchDown","touchUp","touchTap","touchDoubleTap","touchMove","touchStartGesture","touchProgressGesture","touchEndGesture","documentTouchMove","documentTouchUp"]),this._modules.dom.afterNextFrame().then((()=>{this._initialize(this)}))}get x(){return this._modules.position.x}get y(){return this._modules.position.y}get pressed(){return this._pressed}_listen(A,w,T){if(at){if("touchstart"===w)return function uE(A,w,T){let r=A=>{iE(A)||(oE(A)&&A.preventDefault(),_c(A,T))};return A(w,ut,r,!1),r}(this._addEvent,A,T);if("touchmove"===w)return function hE(A,w,T){let r=A=>{iE(A)&&0===A.buttons||_c(A,T)};return A(w,gt,r,!1),r}(this._addWinEvent,A,T);if("touchend"===w)return function mE(A,w,T){let r=A=>_c(A,T);return A(w,_t,r,!1),A(w,mt,r,!1),r}(this._addWinEvent,A,T);if("touchcancel"===w)return function cE(A,w,T){let r=A=>{oE(A)&&A.preventDefault(),_c(A,T)};return A(w,mt,r,!1),r}(this._addWinEvent,A,T)}return this._modules.dom.addElementEventListener(A,w,T)}_initialize(A){let w=0,T=0,C=0,k=0,N=!1,O="left",j=0,G=!1,H=!1,W=1,$=0,Z=null,se=null,f=()=>{this._modules.position.x=w,this._modules.position.y=T,this._pressed=N},E=(A,C)=>{let k=this._domElt.getBoundingClientRect();if(!k||null==A.touches)return null;let N=A.touches[0].clientX-k.left,O=A.touches[0].clientY-k.top,j=A.touches[1].clientX-k.left,G=A.touches[1].clientY-k.top,H=(N+j)/2,Z=(O+G)/2,se=H-w,ue=Z-T,ge=Et(N,O,j,G),ce=ge/W,_e=Ai(N,O,j,G),me={dx:se,dy:ue,rotation:_e-$,scale:ce};return((A,C,k,N)=>{W=A,$=C,w=k,T=N,f()})(ge,_e,H,Z),me},b=A=>{if(A.touches&&2===A.touches.length&&H){let C=E(A);if(C){let{dx:A,dy:k,rotation:N,scale:j}=C;this._modules.events.fire("touchProgressGesture",{dx:A,dy:k,rotation:N,scale:j,x:w,y:T,domEvent:Z,button:O})}}},y=A=>{if(O=st[A.button],!A.touches)return!1;if(1!==A.touches.length)return N=!1,A.touches.length>1&&this._modules.events.fire("touchUp",{x:w,y:T,domEvent:Z,button:O}),!1;let j=this._domElt.getBoundingClientRect();return j&&(C=w,k=T,w=A.touches[0].clientX-j.left|0,T=A.touches[0].clientY-j.top|0,N=!0,Z=A,f()),!0},x=()=>{j=0,this._modules.dom.clearTimeout(se)},D=A=>{if(A.preventDefault(),!A.touches)return;if(2!==A.touches.length&&H&&(H=!1,this._modules.events.fire("touchEndGesture",{domEvent:Z})),y(A),0===A.touches.length){let A={x:w,y:T,domEvent:Z,button:O};1===j&&this._modules.events.fire("touchTap",A),j>1&&(this._modules.events.fire("touchDoubleTap",A),x()),this._modules.events.fire("touchUp",A)}let C=Ur().documentElement;tp(this._removeWinEvent,C,"touchmove",this._onMove),tp(this._removeWinEvent,C,"touchend",this._onEnd)},v=A=>{b(A),G?G=!1:(x(),y(A)&&this._modules.events.fire("touchMove",{x:w,y:T,dx:w-C,dy:T-k,domEvent:Z,button:O}))};this._listen(this._domElt,"touchstart",(A=>{if(!A.touches)return;2===A.touches.length&&!H&&E(A)&&(H=!0,this._modules.events.fire("touchStartGesture",{domEvent:Z})),y(A)&&(this._modules.dom.focus(),this._modules.events.fire("touchDown",{x:w,y:T,domEvent:Z,button:O}),j+=1,se=this._modules.dom.setTimeout(x,Ql),G=!0);let C=Ur().documentElement;this._onMove=this._listen(C,"touchmove",v),this._onEnd=this._listen(C,"touchend",D)}))}};function Jn(A,w,T,C){let k;if(C)k=C;else{k=new Uint32Array(A.length);for(let w=0,T=A.length;w<T;w++)k[w]=w}function s(A,w,T,C,k,N){let O=T-N+1e-9*Math.max(T,N,1),j=C-A,G=k-w;return O>0&&O*O>j*j+G*G}function a(A,w,T,C,k,N,O){for(let j=0;j<C.length;++j){let G=C[j];if(!s(A,w,T,k[G],N[G],O[G]))return!1}return!0}function l(A,w,T,C,k,N){let O=C-A,j=k-w,G=N-T,H=Math.sqrt(O*O+j*j);return[(A+C+O/H*G)/2,(w+k+j/H*G)/2,(H+T+N)/2]}function u(A,w,T,C,k,N,O,j,G){let H=A-C,W=A-O,$=w-k,Z=w-j,se=N-T,ue=G-T,ge=A*A+w*w-T*T,ce=ge-C*C-k*k+N*N,_e=ge-O*O-j*j+G*G,me=W*$-H*Z,pe=($*_e-Z*ce)/(2*me)-A,be=(Z*se-$*ue)/me,Se=(W*ce-H*_e)/(2*me)-w,Ee=(H*ue-W*se)/me,Te=be*be+Ee*Ee-1,Ce=2*(T+pe*be+Se*Ee),Ie=pe*pe+Se*Se-T*T,ze=-(Math.abs(Te)>1e-6?(Ce+Math.sqrt(Ce*Ce-4*Te*Ie))/(2*Te):Ie/Ce);return[A+pe+be*ze,w+Se+Ee*ze,ze]}function c(A,w,T,C){switch(A.length){case 1:let k=A[0];return function d(A,w,T){return[A,w,T]}(w[k],T[k],C[k]);case 2:let[N,O]=A;return l(w[N],T[N],C[N],w[O],T[O],C[O]);case 3:let[j,G,H]=A;return u(w[j],T[j],C[j],w[G],T[G],C[G],w[H],T[H],C[H]);default:return null}}function h(A,w,T,C,k,N){let O=T-N,j=C-A,G=k-w;return O<0||O*O<j*j+G*G}function m(A,w,T,C,k){let N=T[w],O=C[w],j=k[w];if(a(N,O,j,A,T,C,k))return[w];for(let G=0;G<A.length;++G){let H=A[G],W=T[H],$=C[H],Z=k[H];if(h(N,O,j,W,$,Z)){let[H,se,ue]=l(W,$,Z,N,O,j);if(a(H,se,ue,A,T,C,k))return[A[G],w]}}for(let G=0;G<A.length-1;++G)for(let H=G+1;H<A.length;++H){let W=A[G],$=A[H],Z=T[W],se=C[W],ue=k[W],ge=T[$],ce=C[$],_e=k[$],me=l(Z,se,ue,ge,ce,_e);if(h(me[0],me[1],me[2],N,O,j)){let G=l(Z,se,ue,N,O,j);if(h(G[0],G[1],G[2],ge,ce,_e)){let G=l(ge,ce,_e,N,O,j);if(h(G[0],G[1],G[2],Z,se,ue)){let G=u(Z,se,ue,ge,ce,_e,N,O,j);if(a(G[0],G[1],G[2],A,T,C,k))return[W,$,w]}}}}throw new Error}return k=function o(A){for(let w=A.length-1;w>=0;w--){let T=Math.floor(Math.random()*(w+1));T=Math.max(Math.min(T,w),0);let C=A[w];A[w]=A[T],A[T]=C}return A}(k),T=T||new Array(A.length).fill(0),function g(A,w,T,C,k){let N=null,O=[],j=0;for(;j<w;){let w=A[j];N&&s(N[0],N[1],N[2],T[w],C[w],k[w])?j++:(O=m(O,w,T,C,k),N=c(O,T,C,k),j=0)}return N}(k,k.length,A,w,T)}var Kl=["x","y","radius"],ed=-1e7,td=class extends kt{constructor(){super(...arguments),this._visibleGroups=new Set,this._visualGroupsLayers=new Map,this._groupsToHide=[],this._paddingMap=new Map,this._shouldUpdateGroups=!1,this._updateVisualGroups=(A,w,T)=>{let C=T.nodes.getUpdatedElementsList().filter((A=>A)),k=A.nodes.outputFlexArrays,N=A.nodes.inputFlexArrays,O=this._visibleGroups;if(0===C.size||0===O.size&&!this._groupsToHide.length)return A.nodes.toUpdate.clear(),A.edges.toUpdate.clear(),k.radius.reset(),k.x.reset(),k.y.reset(),A.nodes.formattedOutput&&(A.nodes.formattedOutput.attributes=[]),void(A.nodes.output&&(A.nodes.output.attributes=[]));let j=T.nodes.getUpdatedAttributes();for(;this._groupsToHide.length>0;){let A=this._groupsToHide.pop();k.radius.set(A,void 0),k.x.set(A,void 0),k.y.set(A,void 0)}if(j.has("x")||j.has("y")||j.has("radius")||this._shouldUpdateGroups){this._shouldUpdateGroups=!1;let w=this._getAllSubNodes(C),j=this._getAllMetaNodes(C),G=A.nodes.toUpdate,H=A.edges.toUpdate,W=this._subNodeOffsetX,$=this._subNodeOffsetY;A.nodes.formattedOutput&&A.nodes.output&&(A.nodes.formattedOutput.attributes=Kl,A.nodes.output.attributes=Kl);let Z=new Set;C.forEach((A=>{let w=A._index;k.x.set(w,void 0),k.y.set(w,void 0),Z.add(w)})),w.forEach((A=>{if(!N)return;let w=A.getMetaNode(),T=A._index,C=N.x.get(T),se=N.y.get(T);if(w&&O.has(w._index)){let N=W.get(T),O=$.get(T),ue=k.x.get(w._index),ge=k.y.get(w._index),ce=C-ue,_e=se-ge;if(N===ed||O===ed)return W.set(T,ce),$.set(T,_e),void(j.includes(w)||(j=j.concat(w.toList())));G.addIndex(T),H.add(A.getAdjacentEdges()),!Z.has(T)&&(N!==ce||O!==_e)&&(C=ue+N,se=ge+O,k.x.set(T,C),k.y.set(T,se)),W.set(T,C-ue),$.set(T,se-ge)}})),j.forEach((A=>{let w=A.getSubNodes();if(!w)return;let T=k.x.getMultiple(w._indexes),C=k.y.getMultiple(w._indexes),N=k.radius.getMultiple(w._indexes),O=ws.fromValues(T,C,N),[j,Z,se]=O.width===O.height&&O.width===O.maxScaledSize?[O.cx,O.cy,2*O.maxScaledSize]:Jn(T,C,N),ue=this._paddingMap.get(A._index)||0;w.forEach(((A,w)=>{W.set(A._index,T[w]-j),$.set(A._index,C[w]-Z)})),k.x.set(A._index,j),k.y.set(A._index,Z),k.radius.set(A._index,se+ue),G.addIndex(A._index),H.add(A.getAdjacentEdges())})),T.nodes.addUpdatedAttribute("radius"),T.nodes.addUpdatedAttribute("x"),T.nodes.addUpdatedAttribute("y"),T.nodes.redrawElements(j)}}}onMounted(){this._subNodesList=this._modules.graph.createNodeAttribute({storage:"any",default:null},!1),this._subEdgesList=this._modules.graph.createEdgeAttribute({storage:"any",default:null},!1),this._metaNodeList=this._modules.graph.createNodeAttribute({storage:"any",default:null},!1),this._metaEdgeList=this._modules.graph.createEdgeAttribute({storage:"any",default:null},!1),this._subNodeOffsetX=this._modules.graph.createNodeAttribute({storage:"float",default:ed},!1),this._subNodeOffsetY=this._modules.graph.createNodeAttribute({storage:"float",default:ed},!1),this._recursiveGuard=!1,this._modules.events.register(["groupingRun"]),this._modules.events.on("setMultipleAttributes",(({elements:A,values:w,options:T})=>{if(this._recursiveGuard||!this._visibleGroups.size)return;let C=A.toList().map(((A,T)=>({group:A,translation:w.constructor===Array?{x:w[T]&&w[T].x||0,y:w[T]&&w[T].y||0}:{x:w.x||0,y:w.y||0},isGroup:A.isNode&&this._visibleGroups.has(A._index)}))).filter((({isGroup:A})=>A));!C.length||(this._recursiveGuard=!0,C.forEach((({group:A,translation:w})=>this.animateChildren(A,T,w))),this._recursiveGuard=!1)})).on("groupingRun",(({metaNodes:A,padding:w})=>{isNaN(+w)?A._indexes.forEach(((A,T)=>this._paddingMap.set(A,w[T]))):A._indexes.forEach((A=>this._paddingMap.set(A,w))),this._shouldUpdateGroups=!0})).on("removeNodes",(({nodes:A})=>{A.forEach((A=>this.removeVisibleGroup(A)))})),this._groupAttributeLayer=this._modules.graphics.addAttributeLayer({name:"internal(_compound)",priority:7,nodeSelector:A=>this._visibleGroups.has(A._index),edgeSelector:A=>A.isVirtual(),nodeAttributes:{layer:A=>this._visualGroupsLayers.get(A._index)},nodeOutput:{attributes:["layer"]},nodeDependencies:{self:{data:!1,attributes:["radius"],hover:!0},adjacentNodes:{attributes:"all"},adjacentEdges:{attributes:"all"}}}),this._topologyLayer=this._modules.graphics.addAttributeLayer({name:"internal(position-forcer)",priority:6.9,nodeDependencies:{self:{attributes:["x","y","radius"]},adjacentNodes:{attributes:"all"}},onBeforeUpdate:this._updateVisualGroups,nodeOutput:{attributes:["x","y","radius","layer"]}})}animateChildren(A,w,T){0===T.x&&0===T.y||A.getSubNodes().forEach((A=>{let C=this._subNodeOffsetX.get(A._index),k=this._subNodeOffsetY.get(A._index),N={x:T.x+C,y:T.y+k};A.setAttributes(N,w),A.getSubNodes()&&this.animateChildren(A,w,N)}))}resetOffsets(){this._recursiveGuard=!0;let A=this._modules.graph.getNodes(),w=this._topologyLayer.getFlexArrays().nodes;A.setAttribute("x",w.x.getMultiple(A._indexes)),A.setAttribute("y",w.y.getMultiple(A._indexes)),w.x.reset(),w.y.reset(),this._recursiveGuard=!1}addVisibleGroup(A,w){this._visualGroupsLayers.set(A._index,w),this._visibleGroups.add(A._index)}getNodeDepth(A){return this._visualGroupsLayers.get(A._index)||0}removeVisibleGroup(A){let w=A._index;!this._visibleGroups.delete(w)||(this._groupsToHide.push(w),this._visualGroupsLayers.delete(w))}_getAllSubNodes(A){let w=Array.from(A._indexes),T=[],C=this._visibleGroups,k=this._subNodesList;for(;0!==w.length;){let A=w.pop();if(null!=A&&C.has(A)){let C=k.get(A),N=Array.from(C._indexes);T.push.apply(T,N),w.unshift.apply(w,N)}}return this._modules.graph.nodeList(new Uint32Array(T))}_getAllMetaNodes(A){let w=Array.from(A._indexes),T=this._visibleGroups,C=this._metaNodeList,k=[],N=new Set;for(;0!==w.length;){let A=w.pop();if(null!=A){let O=C.get(A);null!==O&&!N.has(O._index)&&T.has(O._index)&&(N.add(O._index),k.push(O._index),w.unshift(O._index))}}return this._modules.graph.nodeList(new Uint32Array(k))}isVisibleGroup(A){return this._visibleGroups.has(A._index)}getSubNodeOffset(A){return{x:this._subNodeOffsetX.get(A._index),y:this._subNodeOffsetY.get(A._index)}}_fetchSubEltsList(A){return A?this._subNodesList:this._subEdgesList}_fetchMetaEltList(A){return A?this._metaNodeList:this._metaEdgeList}setSubElements(A,w){this._fetchSubEltsList(A.isNode).setMultiple(A._indexes,w)}setMetaElement(A,w){this._fetchMetaEltList(A.isNode).setMultiple(A._indexes,w)}getSubElements(A){return this._fetchSubEltsList(A.isNode).getMultiple(A._indexes)}getMetaElement(A){return this._fetchMetaEltList(A.isNode).getMultiple(A._indexes)}},id=class extends kt{constructor(){super(...arguments),this._list=[],this._idCounter=0,this._mustRefresh=!1,this._safeGuard=!1,this._preventFiringEvents=!1,this._afterCurrentUpdate=Promise.resolve(),this._destroyed=!1,this._update=()=>{let A=Promise.resolve();this._modules.captor.setDetectionEnabled(!1);let w,T,C=this._list.filter((({shouldDo:A})=>A)),k=this._list.filter((({enabled:A,shouldUndo:w})=>A||w)),N=!1;if(k.length===C.length+1&&mA(k,C,C.length)){let A=k.pop();w=A?[A]:[],T=[],N=!0}else if(C.length===k.length+1&&mA(k,C,k.length)){w=[];let A=C.pop();T=A?[A]:[],N=!0}else w=k,T=C,N=!1;return A=A.then((()=>this._resolveTransformations(w,T,N))).then((()=>this._modules.captor.setDetectionEnabled(!0))).then((()=>{w.filter((({shouldUndo:A})=>A)).forEach((A=>{A.shouldUndo=!1,A.enabled=!1})),T.forEach((A=>{A.shouldDo=!0,A.enabled=!0}))})),A}}onMounted(){this._modules.classes.createClass({name:_i,isBuiltin:!0,nodeAttributes:{opacity:0,radius:0},edgeAttributes:{opacity:0,width:0}}),this._modules.classes.createClass({name:fi,isBuiltin:!0,nodeAttributes:{opacity:0},edgeAttributes:{opacity:0}}),this._nodeTransformationIdList=this._modules.graph.createNodeAttribute({storage:16,default:0},!1),this._edgeTransformationIdList=this._modules.graph.createEdgeAttribute({storage:16,default:0},!1),this._modules.settings.register("transformations.updateOnDataChange",!0),this._modules.events.register(["transformationEnabled","transformationDisabled","transformationSetIndex","transformationDestroyed","transformationRefresh"]),this._modules.events.on(["addNodes","addEdges","removeNodes","removeEdges"],(({virtual:A})=>{A||this._afterCurrentUpdate.then((()=>this.refresh(!0)))})).on("requestElementsToDelete",(A=>{A.virtual||(A.elementsToRemove=this._getSubElements(A.elementsToRemove),A.elementsToRemove.size&&this._resolveTransformations(this._list,[],!1))})).on(["updateNodeData","updateEdgeData"],(()=>{this._modules.settings.get("transformations.updateOnDataChange")&&!this._safeGuard&&this.refresh(!0)}))}refresh(A=!1){return this._list.length?(this._mustRefresh||this._safeGuard||(this._preventFiringEvents=!0,this._mustRefresh=!0,this._safeGuard=!0,this._afterCurrentUpdate=this._afterCurrentUpdate.then((()=>this._update())).then((()=>(this._modules.dom.refresh(),this._modules.dom.afterNextFrame()))).then((()=>(this._modules.dom.refresh(),this._mustRefresh=!1,this._safeGuard=!1,this._list.forEach((w=>{if(w.getError())return w.cleanup(),w.resetContext(),w.reject();w.resolve(),this._preventFiringEvents=!A,this._fireEvent("transformationRefresh",{target:w}),this._preventFiringEvents=!1})),Promise.resolve())))),this._afterCurrentUpdate):Promise.resolve()}_fireEvent(A,w){!this._preventFiringEvents&&!this._destroyed&&this._modules.events.fire(A,w)}_getSubElements(A){return A.reduce(((A,w)=>{if(void 0===w)return A;let T=this._modules.grouping.getSubElements(w)[0];return T?A.concat(this._getSubElements(T)):A.concat(w)}),A.slice(0,0))}_assignTransformationIds(A,w,T){null!==w&&this._nodeTransformationIdList.setMultiple(w._indexes,A),null!==T&&this._edgeTransformationIdList.setMultiple(T._indexes,A)}_resolveTransformations(A,w,T){if(T||(A.forEach((A=>A.setDuration(0))),w.forEach((A=>A.setDuration(0)))),this._destroyed)return Promise.resolve();let C=this._modules.selection.getSelectedNodes().getId(),k=this._modules.selection.getSelectedEdges().getId(),N=Promise.resolve();return A.slice().reverse().forEach((A=>{null!==A.getContext()&&(N=N.then((()=>A.undo())))})),w.forEach((A=>{N=N.then((()=>A.run())).catch((w=>(A.setError(w),!0))).then((w=>{if(!0===w)return Promise.resolve();let T=w;return this._assignTransformationIds(A.getId(),T.virtualNodes,T.virtualEdges),A.setContext(T),Promise.resolve()}))})),N=N.then((()=>{this._destroyed||(this._modules.graph.getNodes(C).setSelected(!0),this._modules.graph.getEdges(k).setSelected(!0))})),N}getList(){return this._list}clear(){let A=this._list.slice();return A.forEach((A=>{A.shouldUndo=!0,A.shouldDo=!1,A.setRemovalDuration(0)})),this.refresh().then((()=>(this._list=this._list.filter((w=>!A.includes(w))),Promise.resolve()))).then((()=>Promise.all(A.slice().reverse().map((A=>A.cleanup()))))).then((()=>{A.forEach((A=>{this._fireEvent("transformationDestroyed",{target:A})}))}))}_get(A,w=!0){let T=this._list.find((w=>w.getId()===A));if(!T){if(w)throw new Error("calling a method on a destroyed transformation");return null}return T}enable(A,w){return this._afterCurrentUpdate.then((()=>(A.shouldDo=!0,A.shouldUndo=A.enabled,A.setDuration(w),this.refresh()))).then((()=>{this._preventFiringEvents||this._fireEvent("transformationEnabled",{target:A})}))}disable(A,w){return this._afterCurrentUpdate.then((()=>(A.shouldUndo=!0,A.shouldDo=!1,A.setRemovalDuration(w),this.refresh()))).then((()=>{this._preventFiringEvents||this._fireEvent("transformationDisabled",{target:A})}))}remove(A,w){return this._afterCurrentUpdate.then((()=>(A.setRemovalDuration(w),A.shouldUndo=!0,A.shouldDo=!1,this.refresh().then((()=>{A.cleanup(),this._list.splice(A.getIndex(),1)}))))).then((()=>{this._fireEvent("transformationDestroyed",{target:A})}))}setIndex(A,w){if(!A)return this._afterCurrentUpdate;let T,C;return this._preventFiringEvents=!0,this._afterCurrentUpdate.then((()=>{let k=A.getIndex(),N=Math.min(k,w);return T=this._list.slice(N).filter((A=>A.isEnabled())),C=T.map((A=>[A.getDuration(),A.getRemovalDuration()])),T.forEach((A=>A.disable(0))),this.refresh()})).then((()=>(this._list.splice(A.getIndex(),1),this._list.splice(Vt(w,0,this._list.length),0,A),T.forEach(((A,w)=>{A.enable(0)})),this.refresh()))).then((()=>(T.forEach(((A,w)=>{A.setDuration(C[w][0]),A.setRemovalDuration(C[w][1])})),this._afterCurrentUpdate))).then((()=>{this._preventFiringEvents=!1,this._fireEvent("transformationSetIndex",{target:A,index:w})}))}setOptions(A,w){return A._setOptions(w),A.setDuration(w.duration),A.enabled===w.enabled&&A.enabled?this.refresh(!0):w.enabled?this.enable(A,w.duration):this.disable(A,w.duration)}getIndex(A){for(let w=0;w<this._list.length;w++)if(this._list[w]===A)return w;return-1}add(A){return this._list.push(A),A.initialize({ogma:this._ogma,id:++this._idCounter}),this.refresh().then((()=>A.isEnabled()?this._fireEvent("transformationEnabled",{target:A}):this._fireEvent("transformationDisabled",{target:A}))),A}whenApplied(){return this._modules.dom.afterNextFrame().then((()=>this._afterCurrentUpdate))}isEnabled(A){let w=this._get(A);return w&&w.enabled||!1}_getElementTransformationId(A){return(A.isNode?this._nodeTransformationIdList:this._edgeTransformationIdList).get(A._index)}isElementVirtual(A){return 0!==this._modules.graph.getAttribute(A.isNode,"virtual").get(A._index)}getElementTransformation(A){return this._get(this._getElementTransformationId(A),!1)}destroy(){this._destroyed=!0}};function mA(A,w,T){for(let C=0;C<T;++C)if(A[C].getId()!==w[C].getId())return!1;return!0}var sd={layer:2,outline:!0,outerStroke:{color:Un,width:5},innerStroke:{minVisibleSize:0},text:{backgroundColor:Vn,minVisibleSize:0}},rd={layer:2,color:Un,text:{backgroundColor:Vn,minVisibleSize:0},stroke:{color:Un,width:0}},nd=class extends kt{onMounted(){this._modules.events.register(["nodesSelected","nodesUnselected","edgesSelected","edgesUnselected"]),this._selectionExtremityHighlightedClass=this._modules.classes.createClass({name:ai,isBuiltin:!0,nodeAttributes:sd}),this._selectedClass=this._modules.classes.createClass({name:ri,isBuiltin:!0,nodeAttributes:sd,edgeAttributes:rd}),this._modules.events.on(`nodeClassAdded_${ri}`,(A=>{this._modules.events.fire("nodesSelected",A)})),this._modules.events.on(`edgeClassAdded_${ri}`,(A=>{this._modules.events.fire("edgesSelected",A)})),this._modules.events.on(`nodeClassRemoved_${ri}`,(A=>{this._modules.events.fire("nodesUnselected",A)})),this._modules.events.on(`edgeClassRemoved_${ri}`,(A=>{this._modules.events.fire("edgesUnselected",A)})),this._modules.settings.register("interactions.selection.enabled",!0),this._modules.settings.register("interactions.selection.multiSelectionKey","ctrl"),this._modules.interactions.onClick({priority:"selection",check:({button:A})=>{let w=this._modules.settings.get("interactions.selection.enabled");return"left"===A&&w&&!this._modules.graphics.isAnimating()},handler:({target:A})=>{if(A){let w=this._modules.settings.get("interactions.selection.multiSelectionKey"),T=w&&this._modules.keyboard.isPressed(w);A.isNode?this._selectedClass.clearEdges():this._selectedClass.clearNodes(),T?A.hasClass(ri)?A.removeClass(ri):A.addClass(ri):((A.isNode?this._selectedClass.getNodes():this._selectedClass.getEdges()).filter((w=>w!==A)).removeClass(ri),A.hasClass(ri)||A.addClass(ri))}else this._selectedClass.clearNodes(),this._selectedClass.clearEdges()}});let e=()=>{this._selectionExtremityHighlightedClass.clearNodes(),this._selectedClass.getEdges().getExtremities().addClass(ai)};this._modules.events.on("beforeRemoveEdges",(({edges:A})=>A.setSelected(!1))).on("excludedStateChange",(({elements:A,value:w})=>{w||A.setSelected(!1)})).on(`edgeClassAdded_${ri}`,e).on(`edgeClassRemoved_${ri}`,e)}setNodeAttributes(A,w){this._selectedClass.update({nodeAttributes:A,fullOverwrite:w}),this._selectionExtremityHighlightedClass.update({nodeAttributes:A,fullOverwrite:w}),this._updateExtremityHighlightLayer()}setEdgeAttributes(A,w){this._selectedClass.update({edgeAttributes:A,fullOverwrite:w}),this._updateExtremityHighlightLayer()}_updateExtremityHighlightLayer(){let A=this._selectedClass.getDefinition().edgeAttributes,w=A?A.layer:void 0;this._selectionExtremityHighlightedClass.update({nodeAttributes:{layer:w},fullOverwrite:!1})}setActive(A,w){if(At(w)){let T=[],C=[];A.toList().forEach(((A,k)=>{(w[k]?T:C).push(A.getId())})),0!==T.length&&this._modules.graph.getElements(A.isNode,T).addClass(ri),0!==C.length&&this._modules.graph.getElements(A.isNode,C).removeClass(ri)}else A[w?"addClass":"removeClass"](ri)}areActive(A){return A.hasClass(ri)}getSelectedNodes(){return this._selectedClass.getNodes()}getSelectedEdges(){return this._selectedClass.getEdges()}getNonSelectedNodes(){return this._modules.graph.getNodes().filter((A=>!A.hasClass(ri)))}getNonSelectedEdges(){return this._modules.graph.getEdges().filter((A=>!A.hasClass(ri)))}clear(){this._selectedClass.clearNodes(),this._selectedClass.clearEdges()}},ad=class extends kt{onMounted(){this._delayedCalls=[],this._idIdle=()=>!this._modules.captor.isAnyButtonPressed()&&!this._modules.dom.isPlayingFrame(),this._modules.events.on(["mousedown","mouseup","beforeNewFrame","newFrame"],(()=>{this._delayedCalls.forEach((A=>A.reset()))}))}_nextTimeIdle(A){let w=new ld(this._modules.dom,this._idIdle,A);return this._delayedCalls.push(w),w.whenDone().then((()=>{this._delayedCalls.splice(this._delayedCalls.indexOf(w),1)}))}debounceIdle(A,w=0){let T=!1,C=[],s=()=>{let w=C;T=!1,C=[],A(),w.forEach((A=>A()))};return()=>new Promise((A=>{C.push(A),T||(T=!0,this._nextTimeIdle(w).then(s))}))}},ld=class{constructor(A,w,T){this._timeout=null,this._done=!1,this._dom=A,this._promise=new Promise((A=>this._resolve=A)),this._isIdle=w,this._delay=T,this._startTimeout()}_startTimeout(){this._timeout=this._dom.setTimeout((()=>{this._isIdle()?(this._done=!0,this._resolve()):this._startTimeout()}),this._delay)}reset(){this._done||(this._dom.clearTimeout(this._timeout),this._startTimeout())}whenDone(){return this._promise}},hd={number:1,duration:1e3,interval:800,startColor:"rgba(0,0,0,0.6)",endColor:"rgba(0,0,0,0.0)",width:50,startRatio:1,endRatio:2,enabled:!1},gd={number:1,duration:1e3,interval:800,startColor:"rgba(0,0,0,0.6)",endColor:"rgba(0,0,0,0.0)",width:10,startRatio:1,endRatio:2,enabled:!1},cd=class extends kt{constructor(){super(...arguments),this._nodePromiseMap=new Map,this._edgePromiseMap=new Map,this._onAttributeChange=({nodes:A,edges:w,nodeAttributes:T,edgeAttributes:C})=>{this._onElementsAttributeChange(A,T),this._onElementsAttributeChange(w,C,!1)},this._refreshPulses=()=>{let{nodes:A,edges:w}=this._hasPulses.getElements();if(0!==A.size||0!==w.size){let T=this._engine.getCurrentTime();this._refreshElementsPulses(A,T),this._refreshElementsPulses(w,T),this._modules.dom.refresh()}}}onMounted(){this._modules.events.on("updateAttributes",this._onAttributeChange).on("newFrame",this._refreshPulses).on("beforeRemoveEdges",(({edges:A})=>{this._removePulses(A)})).on("beforeRemoveNodes",(({nodes:A})=>{this._removePulses(A)})).on("excludedStateChange",(({elements:A,value:w})=>{!w||(this._hasPulses.removeElements(A),this._removePulses(A))})).on("clearGraph",(()=>this._hasPulses.clear())),this._engine=this._modules.graphics.getGraphicsEngine(),this._group=this._engine.createGroup(),this._nodePulses=this._modules.graph.createNodeAttribute({storage:"any"},!1),this._edgePulses=this._modules.graph.createEdgeAttribute({storage:"any"},!1),this._nodeNbPulsesRemaining=this._modules.graph.createNodeAttribute({storage:"int16",default:-1},!1),this._edgeNbPulsesRemaining=this._modules.graph.createEdgeAttribute({storage:"int16",default:-1},!1),this._nodeFlexArrays=this._modules.graphics.getNodeAttributes(),this._edgeFlexArrays=this._modules.graphics.getEdgeAttributes(),this._edgeSourceList=this._modules.graph.getEdgeAttribute("source"),this._edgeTargetList=this._modules.graph.getEdgeAttribute("target"),this._hasPulses=new Ss(this._modules.graph)}_onElementsAttributeChange(A,w,T=!0){if(!w.includes("pulse.enabled"))return;let{valid:C,invalid:k}=Cc(this._modules.graph,A,(A=>A.getAttribute("pulse.enabled")&&A.isVisible()));this._hasPulses.removeElements(k),this._hasPulses.addElements(C);let N=T?this._nodeNbPulsesRemaining:this._edgeNbPulsesRemaining;for(let A=0;A<C.size;A++)N.get(C._indexes[A])>0||N.set(C._indexes[A],-2);this._removePulses(k)}_removePulses(A){let w=A.isNode?this._nodePulses:this._edgePulses,T=A.isNode?this._nodePromiseMap:this._edgePromiseMap;for(let C=0;C<A._indexes.length;C++){let k=A._indexes[C],N=w.get(k);if(N){for(let A=0;A<N.length;A++){let w=N[A];this._modules.graphics.releaseGraphicsEngineBlockId(w.blockId)}w.set(k,null);let A=T.get(k);A&&(A.resolve(),T.delete(k))}}}_refreshElementsPulses(A,w){let T=A.isNode,C=T?this._nodePulses:this._edgePulses,k=T?this._nodeFlexArrays.pulse.duration:this._edgeFlexArrays.pulse.duration,N=T?"_createNodePulseBlock":"_createEdgePulseBlock",O=T?this._nodeFlexArrays.pulse.interval:this._edgeFlexArrays.pulse.interval,j=T?this._nodeNbPulsesRemaining:this._edgeNbPulsesRemaining;for(let T=0;T<A._indexes.length;T++){let G=A._indexes[T],H=C.get(G);H||(H=[],C.set(G,H));for(let A=0;A<H.length;A++){let{startTime:T,duration:C,blockId:k}=H[A];w>=T+C&&(this._modules.graphics.releaseGraphicsEngineBlockId(k),H.splice(A--,1))}let W=H[H.length-1];if(W&&w<W.startTime+O.get(G))continue;let $=k.get(G),Z=j.get(G);if(Z<1&&-2!==Z)continue;H.push({blockId:this[N](G,w,$),startTime:w,duration:$});let se=-2===Z?-2:Z-1;j.set(G,se)}}_createNodePulseBlock(A,w,T){let C=this._nodeFlexArrays,k=C.color.get(A),N=C.layer.get(A),O=C.x.get(A),j=C.y.get(A),G=C.radius.get(A),H="scaled"===C.scalingMethod.get(A),W=C.pulse.startRatio.get(A),$=C.pulse.endRatio.get(A),Z=C.pulse.width.get(A),se=2*G*W,ue=2*G*$,ge=Yn(N).nodeBody,ce=C.pulse.startColor.get(A),_e=C.pulse.endColor.get(A),me=this._modules.graphics.allocateGraphicsEngineBlockId(),pe=this._group.reset(1,!0,ge),be=pe.nextAndReset(),Se=hr(ce,k),Ee=hr(_e,k);return be.end.shape="circle",be.end.pieceId=1,be.end.x1=O,be.end.y1=j,be.end.x2=O,be.end.y2=j,be.end.rectWidthOrSourceRadiusScaled=H?ue:0,be.end.rectHeightOrTargetRadiusScaled=H?ue:0,be.end.rectWidthOrSourceRadiusFixed=H?0:ue,be.end.rectHeightOrTargetRadiusFixed=H?0:ue,be.end.strokeWidthFixed=Z,be.end.strokeColor=Ee,be.start.shape="circle",be.start.pieceId=1,be.start.x1=O,be.start.y1=j,be.start.x2=O,be.start.y2=j,be.start.rectWidthOrSourceRadiusScaled=H?se:0,be.start.rectHeightOrTargetRadiusScaled=H?se:0,be.start.rectWidthOrSourceRadiusFixed=H?0:se,be.start.rectHeightOrTargetRadiusFixed=H?0:se,be.start.strokeWidthFixed=Z,be.start.strokeColor=Se,be.animation.duration=T,be.animation.beginTime=w,this._engine.storeGroup(me,pe),me}_createEdgePulseBlock(A,w,T){let C=this._edgeFlexArrays,k=this._nodeFlexArrays,N=C.pulse.startRatio.get(A),O=C.pulse.endRatio.get(A),j=C.pulse.startColor.get(A),G=C.pulse.endColor.get(A),H=Yn(C.layer.get(A)).edgeBody,W=this._edgeSourceList.get(A),$=this._edgeTargetList.get(A),Z=C.curvature.get(A),se=0!==Z,ue=this._modules.graphics.allocateGraphicsEngineBlockId(),ge=this._group.reset(se?3:1,!0,H),ce=ge.nextAndReset(),_e={isSelfLoop:W===$,curvature:Z,sourceX:k.x.get(W),sourceY:k.y.get(W),targetX:k.x.get($),targetY:k.y.get($),sourceRadius:k.radius.get(W),targetRadius:k.radius.get($),isSourceRadiusScaled:"scaled"===k.scalingMethod.get(W),isTargetRadiusScaled:"scaled"===k.scalingMethod.get($),width:C.width.get(A),isWidthScaled:"scaled"===C.scalingMethod.get(A),strokeWidth:C.pulse.width.get(A)};return pA(ce.start,_e),pA(ce.end,_e),ce.start.strokeColor=j,ce.end.strokeColor=G,ce.start.thicknessOrFontSizeScaled*=N,ce.start.thicknessOrFontSizeFixed*=N,ce.end.thicknessOrFontSizeScaled*=O,ce.end.thicknessOrFontSizeFixed*=O,ce.animation.duration=T,ce.animation.beginTime=w,this._engine.storeGroup(ue,ge),ue}pulse(A,w){let T=A.isNode,C=re(re(re({},T?hd:gd),T?this._nodePulseTheme:this._edgePulseTheme),w),k=C.number,N=C.interval,O=C.duration,j=T?this._nodeNbPulsesRemaining:this._edgeNbPulsesRemaining,G=(k-1)*N+O;C.enabled=!0,delete C.number,A.setAttributes({pulse:C}),j.setMultiple(A._indexes,k),this._modules.dom.setTimeout((()=>{A.isList?A.filter(ur).setAttribute("pulse.enabled",!1):A.setAttribute("pulse.enabled",!1),j.setMultiple(A._indexes,-1)}),G);let H,W=new Promise((w=>{H=()=>w(A)})),$=A.isNode?this._nodePromiseMap:this._edgePromiseMap;return A.isList?A._indexes.forEach((A=>{this._setPromise(A,$,W,H)})):this._setPromise(A._index,$,W,H),W}_setPromise(A,w,T,C){w.has(A)&&w.get(A).resolve(),w.set(A,{promise:T,resolve:C})}setTheme(A,w){this._nodePulseTheme=A,this._edgePulseTheme=w}};function pA(A,{sourceX:w,sourceY:T,targetX:C,targetY:k,isSourceRadiusScaled:N,isTargetRadiusScaled:O,targetRadius:j,sourceRadius:G,isWidthScaled:H,width:W,strokeWidth:$,curvature:Z,isSelfLoop:se}){A.pieceId=2,A.shape="line",A.x1=w,A.y1=T,A.x2=C,A.y2=k,A.rectWidthOrSourceRadiusScaled=N?G:0,A.rectWidthOrSourceRadiusFixed=N?0:G,A.rectHeightOrTargetRadiusScaled=O?j:0,A.rectHeightOrTargetRadiusFixed=O?0:j,A.thicknessOrFontSizeScaled=H?W:0,A.thicknessOrFontSizeFixed=H?0:W,A.strokeWidthFixed=$,A.curvature=Z,A.isSelfLoop=se}var fd={duration:0,easing:"linear",callback:Ze,resolve:Ze,startAfter:0},pd=0,xd=class extends kt{constructor(){super(...arguments),this._animationList=[],this._update=()=>{if(0===this._animationList.length)return;let A=Ut(),w=[];for(let T=0;T<this._animationList.length;++T){let C=this._animationList[T],k=(A-C.creationDate)/C.duration,N=C.startAfter,O=C.easing(k);if(k>=1)C.func(1),C.done=!0,C.resolve(void 0),this._animationList.splice(T,1),T-=1,w.push(C.callback);else if(O>=N){O=(O-N)*(1/(1-N)),C.func(O)}}for(let A=0;A<w.length;A++)w[A](!1);this._modules.dom.refresh()}}onMounted(){this._modules.events.on("beforeNewFrame",this._update)}play(A,w){let{duration:T,easing:C,callback:k,startAfter:N,resolve:O}=Ft(w,fd);if(T<=0)return A(1),k(),O(void 0),null;let j={func:A,easing:"function"==typeof C?C:fa[C],duration:T,callback:k,resolve:O,startAfter:N,creationDate:Ut(),done:!1,id:++pd};return this._animationList.push(j),this._modules.dom.refresh(),j}cancel(A){let w=this._animationList.indexOf(A);-1!==w&&(A.func(1),this._animationList.splice(w,1),A.done=!0,A.resolve(void 0))}};function fA(A){return A+(-1===A.indexOf("?")?"?":"&")+"noCache="+Date.now()}var yd={tileLayers:(A,w,T,C,k)=>{let N=T._getMapPanePos(),O=A.getContainer();if(!O)throw new Error(`Trying to access the container of ${A} but it does not exist.`);let j=C.DomUtil.getPosition(O);T.removeLayer(A),A.options.crossOrigin="anonymous";let G=[],H=[];return A.on("tileload",(({tile:A})=>{let{x:w,y:T}=C.DomUtil.getPosition(A);G.push(A),H.push({x:w-j.x+N.x,y:T-j.y+N.y})})),T.addLayer(A),new Promise((T=>{A.once("load",(()=>{let C=A.getTileSize();G.forEach(((A,T)=>{let{x:k,y:N}=H[T];w.drawImage(A,k,N,C.x,C.y)})),T()}))}))},imageOverlays:(A,w,T,C,k)=>new Promise((C=>{T.removeLayer(A),A.setUrl(fA(A.getUrl())),A.options.crossOrigin="anonymous",A.once("load",(()=>{let k=A.getBounds(),N=T.latLngToContainerPoint(k.getNorthWest()),O=T.latLngToContainerPoint(k.getSouthEast()),j=O.x-N.x,G=O.y-N.y;w.drawImage(A._image,N.x,N.y,j,G),C()})),T.addLayer(A)})),vectorLayers:(A,w,T,C,k,N)=>new Promise((O=>{let j=A.options.renderer;T.removeLayer(A),A.options.renderer=N,T.addLayer(A),N._updatePaths();let G=T._getMapPanePos(),H=N._container,W=C.DomUtil.getPosition(H);w.drawImage(N._container,W.x+G.x,W.y+G.y,H.width/k,H.height/k),T.removeLayer(A),A.options.renderer=j,T.addLayer(A),O()})),markers:(A,w,T,C,k)=>new Promise((C=>{let N=T.getPixelBounds().min,O=T.project(A.getLatLng(),T.getZoom()),j=/^data\:/.test(A._icon.src),G=j?A._icon.src:fA(A._icon.src),H=new Image,W=A.options.icon;if(W){let A=W.options,T=A.iconSize||[24,24],$=O.subtract(N),Z=A.iconAnchor||[0,0];Array.isArray(T)||(T=[T.x,T.y]),Array.isArray(Z)||(Z=[Z.x,Z.y]);let se=Math.round($.x-(T[0]-Z[0])*k),ue=Math.round($.y-Z[1]*k);H.crossOrigin="";let b=()=>{w.drawImage(H,se,ue,T[0]*k,T[1]*k),C()};H.onload=b,H.src=G,j&&b()}})),vectorMap:(A,w,T,C)=>{let k=T._getMapPanePos(),N=A.getMapboxMap(),O=A.getCanvas(),j=A.getSize().round(),G=C.DomUtil.getPosition(A.getContainer()),H=G.x+k.x,W=G.y+k.y;return new Promise((A=>{function h(){w.drawImage(O,H,W,j.x,j.y),A()}if(N.loaded())return h();N.once("idle",h)}))}};function bA(A,w,T,C){let k=A.filter((A=>A.isVisible())),N=0===k.size,{mapX:O,mapY:j}=k.reduce(((A,w)=>{let{latitude:T,longitude:k}=w.getGeoCoordinates(),{x:N,y:O}=C(T,k);return A.mapX.push(N),A.mapY.push(O),A}),{mapX:[],mapY:[]}),G=k.getAttribute("x"),H=k.getAttribute("y"),W=k.getAttribute("radius").map(Number),$=new ws({xValues:G,yValues:H,scaledSizeValues:W}),Z=new ws({xValues:O,yValues:j});N&&($.cx=$.cy=0,$.width=$.height=0),(!isFinite(Z.width)||!isFinite(Z.height))&&(Z.cx=Z.cy=0,Z.width=Z.height=0);let se=Z.cx-$.cx,ue=Z.cy-$.cy,ge=N?1:Math.max(Z.width,Z.height)/Math.max($.width,$.height),[ce,_e]=W.reduce(((A,w)=>(A[0]=Math.min(A[0],w*ge),A[1]=Math.max(A[1],w*ge),A)),[1/0,0]);Z.pad(_e),Z.minScaledSize=ce,Z.maxScaledSize=_e;let me=T.computeConfigForBounds(Z),pe=w.zoom/function OE(A){return Math.pow(2,Math.ceil(Math.log2(A)))}(me.zoom);se+=($.cx-w.x)*pe,ue+=($.cy-w.y)*pe;let be=$.cx+se,Se=$.cy+ue;return{offsetChanges:{name:"graph-to-geo",nodeAttributes:{radius:A=>Number(A.getAttribute("radius"))*pe,x:A=>(A.getAttribute("x")+se-be)*pe+be,y:A=>(A.getAttribute("y")+ue-Se)*pe+Se},edgeAttributes:{width:A=>Number(A.getAttribute("width"))*pe}},camera:re({zoom:w.zoom/pe,x:(w.x+se-be)*pe+be,y:(w.y+ue-Se)*pe+Se,angle:0},w.getSize())}}var bd={"top-left":"left","bottom-left":"left","top-right":"right","bottom-right":"right"},vd={"top-left":"top","bottom-left":"bottom","top-right":"top","bottom-right":"bottom"},Ad={position:"bottom-right",horizontalMargin:0,verticalMargin:0,className:void 0},Sd=class extends kt{onMounted(){this._brand=null}set(A,w){let{position:T,horizontalMargin:C,verticalMargin:k,className:N}=re(re({},Ad),w);bd[T]||(T=Ad.position),this.remove();let O=document.createElement("div");return O.innerHTML=A,O.style.position="absolute",v_(O,T,C,k),O.style.padding="0px 0px 0px 0px",O.style.zIndex="10",N&&O.setAttribute("class",N),this._brand=O,this._modules.dom.setLayer("brand",this._brand),O}remove(){this._modules.dom.setLayer("brand",null),this._brand=null}};function v_(A,w,T,C){let k=void 0===T?"":T+"px",N=void 0===C?"":C+"px";A.style[bd[w]]=k,A.style[vd[w]]=N}var Ed={},wd=class extends kt{constructor(){super(...arguments),this._enabled=!1,this._settings=re({},Ri),this._edgesOriginalTextStyle={},this._nodesOriginalTextStyle={},this._nodeDraggingSetting=!1,this._transition=!1,this._attribution=null,this._updating=!1,this._updateRate=50,this._x=0,this._y=0,this._onCameraUpdate=()=>{if(this.L&&this._enabled&&this._map&&this._map._loaded){let A=this._x-this._modules.camera.x,w=this._y-this._modules.camera.y;if(A||w){this._updating||(this._updating=!0,this._layer.setLocked(!0),this._map._moveStart(!0,!1));let A=this._fromPointToLatLng(this._modules.camera.x,this._modules.camera.y),w=Tc(this._modules.camera.zoom),T=this.L.latLng(A.latitude,A.longitude);this._map._move(T,w,{pinch:!0,round:!1}),clearTimeout(this._updateRequest),this._updateRequest=this._modules.dom.setTimeout((()=>{this._updating=!1,this._layer.setLocked(!1),this._map&&this._map._move(T,w,{pinch:!0})._moveEnd(!0)}),this._updateRate)}}},this._onNodesDragStart=()=>{this._enabled&&(this._setMapDragging(!1),this._nodeDragOffsetX=this._nodeDragOffsetY=0)},this._onNodesDragged=({nodes:A,dx:w,dy:T})=>{if(this._enabled){let C=A.map((A=>{let{x:C,y:k}=A.getAttributes(["x","y"]);return this._fromPointToLatLng(C+w-this._nodeDragOffsetX,k+T-this._nodeDragOffsetY)}));return this._nodeDragOffsetX=w,this._nodeDragOffsetY=T,A.setGeoCoordinates(C)}return Promise.resolve(this._modules.graph.nodeList())},this._onMapUpdate=()=>{if(!this._map)return Promise.resolve(void 0);let{lat:A,lng:w}=this._map.getCenter(),T=this._fromLatLngToPoint(A,w);this._x=T.x,this._y=T.y;let C=function IE(A){return 2**(A-1)}(this._map.getZoom());return this._modules.events.fire("beforeGeoCameraMove",{zoom:this._map.getZoom()}),this._modules.camera.setView({zoom:C,x:T.x,y:T.y},{ignoreZoomLimits:!0}).then((()=>this._adjustMinvisibleSizes()))}}onMounted(){this._filters=this._modules.filters,this._modules.events.register(["geoEnabled","geoDisabled","geoLoaded","geoReady"]),pp()&&(this.L=$t("L")||$t("leaflet"),this.L&&function A_(A){A.TileLayer.prototype.getUrl=function(){return this._url},A.ImageOverlay.prototype.getUrl=function(){return this._url};let w="leaflet-zoom-animated";A.OgmaOverlay||(A.OgmaOverlay=A.Layer.extend({options:{pane:"overlayPane",padding:0,onUpdate:()=>{}},initialize:function(w){let{container:T}=w;A.Util.setOptions(this,w),this._container=T},setLocked:function(A){return this._locked=A,this},onAdd:function(T){this._map=T,this.getPane().appendChild(this._container),this._wgsOrigin=A.latLng([0,0]),this._wgsInitialShift=T.project(this._wgsOrigin,this._initialZoom),A.DomUtil.addClass(this._container,"leaflet-layer"),this._zoomAnimated&&(A.DomUtil.addClass(this._container,w),this._container.style.position="absolute",this._container.style.zIndex=9999),this._initialZoom=(this._map.getMaxZoom()+this._map.getMinZoom())/2,this._mapInitialZoom=this._map.getZoom(),this._updateBounds(),this._update({})},_updateBounds(){let w=this.options.padding,T=this._map.getSize(),C=this._map.containerPointToLayerPoint(T.multiplyBy(-w));this._bounds=new A.Bounds(C,C.add(T.multiplyBy(1+2*w))),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()},_update(w){this._updateBounds(),this._redraw(this._bounds.min,w),this._positionTimer=A.Util.requestAnimFrame((()=>{this._container&&A.DomUtil.setPosition(this._container,this._bounds.min)}))},_redraw(A,w){this.options.onUpdate()},_updateTransform(w,T){if(this._locked)return;let C=this._map.getZoomScale(T,this._zoom),k=this._map.getSize().multiplyBy(.5+this.options.padding),N=this._map.project(this._center,T),O=k.multiplyBy(-C).add(N).subtract(this._map._getNewPixelOrigin(w,T));A.Browser.any3d?A.DomUtil.setTransform(this._container,O,C):A.DomUtil.setPosition(this._container,O)},_onZoom(A){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_onMoveEnd(A){this._update(A)},_onAnimZoom({center:A,zoom:w}){this._updateTransform(A,w)},bringToFront(){A.DomUtil.toFront(this._container)},getEvents(){return{zoom:this._onZoom,moveend:this._onMoveEnd,zoomanim:this._onAnimZoom,layeradd:this.bringToFront,zoomend:this.options.onUpdate}},onRemove:function(){A.DomUtil.removeClass(this._container,w);let T=this._container;["transform","webkitTransform","OTransform","MozTransform","msTransform","zIndex","position"].forEach((A=>T.style[A]=null)),A.Util.cancelAnimFrame(this._positionTimer),this._container=null}}))}(this.L)),this._modules.graph.createNodeAttribute({name:"geo.prevLat",storage:"float"},!0),this._modules.graph.createNodeAttribute({name:zi,storage:"float"},!0),this._modules.graph.createNodeAttribute({name:ki,storage:"float"},!0),this._modules.graph.createNodeAttribute({name:Ii,storage:"float"},!0),this._modules.events.register(["beforeGeoCameraMove"]),this._modules.events.on("addNodes",(A=>this._refreshOrAddNodes(A.nodes,!0))).on("updateNodeData",(A=>{this._onDataChange(A.changes)})).on("nodesDragProgress",this._onNodesDragged).on(["nodesDragStart","lassoEnabled"],this._onNodesDragStart).on(["nodesDragEnd","lassoDisabled"],(()=>this._setMapDragging(!0))).on("move",this._onCameraUpdate).on("viewChanged",this._onCameraUpdate)}_onDataChange(A){let w=A.filter((({property:A})=>A&&"string"!=typeof A?A.find((A=>A===this.latitudePath||A===this.longitudePath)):null===A||A===this.latitudePath||A===this.longitudePath));if(w.length){let A=function UE(A){return A.reduce(((A,{nodes:w,newValues:T})=>{if(!w)return A;let C=w.filter(((A,w)=>null!=T[w]));return A?A.concat(C):C}),null)}(w);null!==A&&this._refreshOrAddNodes(A,!1)}}_refreshOrAddNodes(A,w){w&&this._updatePrevNodesCoordinates(A),this._updateNodesCoordinates(A),this._enabled&&(this._cacheOriginalTextStyles(A,null),this._filter._refresh())}_updatePrevNodesCoordinates(A){od(this._modules.graph,A,ki,Fi),od(this._modules.graph,A,Ii,zi)}_restorePrevNodesCoordinates(A){od(this._modules.graph,A,Fi,ki),od(this._modules.graph,A,zi,Ii)}_updateNodesCoordinates(A){!function GE(A,w,T){let{longitudePath:C,latitudePath:k,wrapCoordinates:N}=T,[O,j]=A.getAttributes(!0,[ki,Ii]),G=w._indexes,H=w.getId(),W=G.length,$=w.getData(k),Z=w.getData(C);for(let A=0;A<W;A++){let w=Z[A],T=$[A],C=G[A],k=H[A];null!=T&&null!=w&&(_p(k,w),bp(k,T),N&&(w%=180,T=Vt(+T,-Pi,Pi)),j.set(C,w),O.set(C,T))}}(this._modules.graph,A,this._settings)}_createMapTileLayer(A,w){if(A&&!wt(A))return A;let T=A,C=T.wms?this.L.tileLayer.wms:this.L.tileLayer,k=function PE(A,w){return null==w&&A.url===Ri.tiles.url?'Map data &copy; <a target="_blank" href="http://osm.org/copyright">OpenStreetMap contributors</a>':null}(T,w)||"";return C(T.url,re({attribution:k},A))}_setupTileLayer(A,w){let T=this._createMapTileLayer(A,w);return T.once("load",(()=>{this._modules.events.fire("geoLoaded")})),T.addTo(this._map),T}_onSettingsChanged(A,w){let T=A.wrapCoordinates!==w.wrapCoordinates,C=A.latitudePath!==w.latitudePath||A.longitudePath!==w.longitudePath;if(T||C){let A=Promise.resolve();this._enabled&&this._filter&&(A=A.then((()=>this._filter.refresh()))),A.then((()=>this._updateNodesCoordinates(this._modules.graph.getNodes("all"))))}!this._enabled||(function FE(A,w){return A.attribution!==w.attribution||A.tiles!==w.tiles}(A,w)&&this._map&&(this._map.removeLayer(this._tileLayer),this._tileLayer=this._setupTileLayer(w.tiles,w.attribution)),A.sizeRatio!==w.sizeRatio&&this._updateSizes(),A.maxZoomLevel!==w.maxZoomLevel&&this._modules.settings.update({minZoom:1,maxZoom:Math.pow(2,w.maxZoomLevel)}),A.disableNodeDragging!==w.disableNodeDragging&&this._setDragging(!w.disableNodeDragging),A.attributionOptions!==w.attributionOptions&&this._setAttributionOptions(w.attributionOptions,w.attribution))}_setMapDragging(A){if(this._map){let w=A?"enable":"disable";this._map.dragging[w]()}}_fromLatLngToPoint(A,w){return this._map.options.crs.latLngToPoint(this.L.latLng(A,w),1)}_fromPointToLatLng(A,w){let{lat:T,lng:C}=this._map.options.crs.pointToLatLng(this.L.point({x:A,y:w}),1);return{latitude:T,longitude:C}}_updateSizes(){this._enabled&&this._projection&&this._projection.updateAll()}enable(A){return this.setEnabled(!0,A)}getMap(){return this._enabled?this._map:null}getOptions(){return this._enabled?ke(re({},this._settings),{tiles:re({},this._settings.tiles)}):re({},Ri)}setOptions(A){if(!this._enabled||this._transition)return;!function wE(A={},w){let{tileUrlSubdomains:T,tileUrlTemplate:C,attribution:k,attributionOptions:N,latitudePath:O,longitudePath:j,sizeRatio:G,tiles:H}=A;if(null!=C&&"string"!=typeof C)throw new TypeError("Geo mode: tileUrlTemplate must be a URL string");if(null!=T&&"string"!=typeof T)throw new TypeError("Geo mode: tileUrlTemplate must be a string");if(null!=H){if(!(wt(H)||H instanceof w.Layer))throw new TypeError("Geo mode: tiles must be a object or L.Layer instance");let A=H;if(null!=A.url&&"string"!=typeof A.url)throw new TypeError("Geo mode: tiles.url must be a string");if(null!=A.subdomains&&"string"!=typeof A.subdomains)throw new TypeError("Geo mode: tiles.subdomains must be a string");if(A.tms&&"boolean"!=typeof A.tms)throw new TypeError("Geo mode: tiles.tms must be a boolean");if(A.wms&&"boolean"!=typeof A.wms)throw new TypeError("Geo mode: tiles.wms must be a boolean")}if(null!=k&&"string"!=typeof k)throw new TypeError("Geo mode: Map attribution must be a string");if(null!=N&&!wt(N))throw new TypeError("Geo mode: attributionOptions must to be a BrandOptions object");if(null!=O&&"string"!=typeof O&&!Array.isArray(O))throw new TypeError("Geo mode: Latitude path must be a valid property path: a string or an array of strings.");if(null!=j&&"string"!=typeof j&&!Array.isArray(j))throw new TypeError("Geo mode: Longitude path must be a valid property path: a string or an array of strings.");if(null!=G&&(!isFinite(G)||G<=0))throw new TypeError("Geo mode: sizeRatio must be a positive number.")}(A,this.L);let w=this._settings;this._settings=ke(re(re(re({},Ri),w),A),{tiles:RE(Ri,A)}),this._onSettingsChanged(w,this._settings)}disable(A){return this.setEnabled(!1,A)}isEnabled(){return this._enabled}toggle(A={}){return this.setEnabled(!this._enabled,A)}getContainerCoords(A){return A.getGeoCoordinates().map((({latitude:A,longitude:w})=>this._map.latLngToContainerPoint([A,w])))}getContainerCoord(A){let{latitude:w,longitude:T}=A.getGeoCoordinates();return this._map.latLngToContainerPoint([w||0,T||0])}setEnabled(A,w){if(!pp())throw new Error("Ogma Geo cannot be used outside a browser");if(!this.L)throw new Error("You are trying to use Geo mode but Leaflet has not been found. Please follow our migration guide: https://bit.ly/2SYkF8A");if(this._transition||A===this._enabled)return Promise.resolve();let T=this._modules.settings;this._enabled||(this._prevSettings=T.get(),this._nodeDraggingSetting=!!T.get("interactions.drag.enabled")),this._enabled=A,this.setOptions(w),this._transition=!0;let C=this._settings;return A?this._show().then((()=>(this._registerTextStyle(this._modules.graph.getNodes(),this._modules.graph.getEdges()),this._setDragging(!C.disableNodeDragging),this._transition=!1,this._updating=!1,this._modules.events.fire("geoEnabled").fire("geoReady"),this._adjustMinvisibleSizes()))):this._restoreTextStyle().then((()=>this._hide())).then((()=>{this._transition=!1,this._modules.events.fire("geoDisabled"),this._setDragging(this._nodeDraggingSetting,!0)})).then((()=>this._ogma.view.afterNextFrame()))}destroy(){return this._enabled&&this._destroyMapSync(),Promise.resolve()}_cacheOriginalTextStyles(A,w){w&&(this._edgesOriginalTextStyle=Ep(w,this._edgesOriginalTextStyle)),A&&(this._nodesOriginalTextStyle=function VE(A,w){return A.getAttributes(["text.minVisibleSize","text.size","text.scale","radius"]).forEach((({text:T,radius:C},k)=>{w[A.get(k).getId()]={"text.minVisibleSize":T.minVisibleSize,"text.size":T.size,"text.scale":T.scale,minVisibleSize:T.minVisibleSize,size:Math.max(1,Number(C))}})),w}(A,this._nodesOriginalTextStyle))}_registerTextStyle(A,w){this._cacheOriginalTextStyles(A,w);let{nodeAttributes:T,edgeAttributes:C}=this._modules.hover.getHoverClassDefinition();this._hoverEdgesOriginalTextStyle=C||null,this._hoverNodesOriginalTextStyle=T||null,this._modules.hover.updateEdgeAttributes({text:{size:A=>(this._edgesOriginalTextStyle[A.getId()]||Ed)["text.size"]}}),this._modules.hover.updateNodeAttributes({text:{size:A=>(this._nodesOriginalTextStyle[A.getId()]||Ed)["text.size"]}})}_restoreTextStyle(){return this._modules.hover.updateEdgeAttributes(this._hoverEdgesOriginalTextStyle,!0),this._modules.hover.updateNodeAttributes(this._hoverNodesOriginalTextStyle,!0),Promise.all([WE(this._modules.graph.getEdges(),this._edgesOriginalTextStyle)]).then((()=>(this._edgesOriginalTextStyle=Ep(this._modules.graph.edgeList(),{}),this._nodesOriginalTextStyle={},this._edgesOriginalTextStyle={},Promise.resolve())))}_setDragging(A,w=!1){this._modules.settings.update({interactions:{drag:{enabled:A,applyResult:w}}})}_setAttributionOptions(A,w){if(this._map){if(this._attribution&&(this._attribution.remove(),this._attribution=null),this._attribution=this.L.control.attribution({prefix:!1}).addTo(this._map),wt(A)){this._attribution.setPrefix(""),A.position=A.position||"bottom-right";let w=A.position.replace("-","");this._attribution.setPosition(w);let T=this._attribution.getContainer();T&&(A.className&&this.L.DomUtil.addClass(T,A.className),v_(T,A.position||"bottom-right",A.horizontalMargin,A.verticalMargin))}null!=w&&this._attribution.addAttribution(w)}}_nodeIsVisible(A){return function zE(A,{longitudePath:w,latitudePath:T,wrapCoordinates:C},k){let N=A.getData(w),O=A.getData(T);return null!=N&&null!=O&&(!(!C&&!k)||Math.abs(O)<=Pi&&Math.abs(N)<=180)}(A,this._settings,this._hasCustomProjection())}_updateSettingsForMap(){let A=this._modules.graphics.getGraphicsEngine().parseColor(this._settings.backgroundColor);A[3]=0,this._modules.settings.update({backgroundColor:Cp(A),minZoom:1e-6,interactions:{rotation:{enabled:!1},drag:{enabled:!1},pan:{enabled:!1},zoom:{enabled:!1,onDoubleClick:!1}},mouse:{wheelEnabled:!1}})}getGraphPosition(A){let w=this.L.latLngBounds(function kE(A){return A.getGeoCoordinates().reduce(((A,{latitude:w,longitude:T})=>{let[C,k]=A;return C[0]=Math.min(C[0],w),C[1]=Math.min(C[1],T),k[0]=Math.max(k[0],w),k[1]=Math.max(k[1],T),A}),[[1/0,1/0],[-1/0,-1/0]])}(A));return{center:A.size>0?w.getCenter():this.L.latLng([0,0]),zoom:this._clampZoom(this._map.getBoundsZoom(w))}}_initMap(){this._updateSettingsForMap(),this._mapContainer=function ME(A){let w=Ur().createElement("div");w.className="ogma-geo-container",rn(w,"100%","100%");let T=A||Bi;return T.insertBefore(w,T.firstChild),w}(this._modules.dom.getContainer());let A=ke(re({},Oi),{minZoom:this._settings.minZoomLevel,maxZoom:this._settings.maxZoomLevel});this._hasCustomProjection()&&(A.crs=this._settings.crs,A.worldCopyJump=!1,A.maxBoundsViscosity=0),this._map=new this.L.Map(this._mapContainer,A),this._hasCustomProjection()||this._map.setMaxBounds(this.L.latLngBounds([[Pi,-180],[-Pi,180]])),this._setAttributionOptions(this._settings.attributionOptions,this._settings.attribution),this._setupLayers()}_clampZoom(A){let w=this._tileLayer.options.maxZoom;return void 0===w&&(w=1/0),Math.min(A,w)}_show(){let A;return this._filter?A=this.filter.enable(0):(this._filter=this._filters.addNodeFilter({criteria:A=>this._nodeIsVisible(A)}),A=this._filter.whenApplied()),A.then((()=>{this._initMap();let A=this._map,w=this._modules.graph.getNodes(),T=this._modules.graph.getEdges(),{center:C,zoom:k}=this.getGraphPosition(w),{offset:N,newCameraView:O}=this._transformToGeo();return this._modules.camera.setView(O,{ignoreZoomLimits:!0}).then((()=>(this._updatePrevNodesCoordinates(w),A.setView(C,k,{animate:!1}),this._modules.graphics.animate({nodes:w,edges:T},(()=>{this._projection=this._createFinalPositionLayer()}),this._settings.duration)))).then((()=>N.destroy()))}))}updateProjection(){var A;null==(A=this._projection)||A.update()}_hasCustomProjection(){return null!=this._settings.crs}_setupLayers(){this._settings.tiles&&(this._tileLayer=this._setupTileLayer(this._settings.tiles,this._settings.attribution)),this._layer=new this.L.OgmaOverlay({container:this._modules.graphics.getDomElement(),mapContainer:this._mapContainer,onUpdate:()=>this._onMapUpdate()}),this._layer.addTo(this._map)}_adjustMinvisibleSizes(){return Promise.all([HE(this._modules.graph.getEdges(),this._edgesOriginalTextStyle,this._map.getZoom())])}_hide(){if(!this._map)return Promise.resolve();this._modules.settings.update(this._prevSettings);let A=this._map;A.removeLayer(this._layer);let w=this._modules.dom.getContainer(),T=this._modules.graphics.getDomElement();w&&w.appendChild(T),A.getContainer().style.zIndex="0";let C=this._modules.graph.getNodes("all"),k=this._modules.graph.getEdges("all"),{offset:N,newCameraView:O}=this._transformToGraph();return this._modules.camera.setView(O||{}).then((()=>Promise.all([Jg(A.getContainer(),1,0,this._settings.duration/2).then((()=>this._destroyMapSync())),this._modules.graphics.animate({nodes:C,edges:k},(()=>N&&N.destroy()),this._settings.duration)]))).then((()=>(this._map=null,this._filter.disable(0))))}_destroyMapSync(){if(this._map){this._layer&&this._layer._map&&this._map.removeLayer(this._layer),this._map.remove(),this._map._animatingZoom=!1,this._map=null;let A=this._mapContainer.parentNode;A&&A.removeChild(this._mapContainer)}}_transformToGeo(){let A=this._modules.graph.getNodes(),{offsetChanges:w,camera:T}=bA(A,this._modules.camera,this._modules.locate,((A,w)=>this._fromLatLngToPoint(A,w)));return{offset:this._addGraphAttributesLayer(w),newCameraView:T}}_addGraphAttributesLayer(A){return this._modules.graphics.addAttributeLayer(re({priority:6,nodeSelector:A=>A.isVisible(),edgeSelector:A=>A.isVisible()},A))}_transformToGraph(){let A=this._modules.graph.getNodes("all"),{offsetChanges:w,camera:T}=function EA(A,w,T,C){let k=A.getAttributes(["x","y","radius"]),N=A.getBoundingBox(),O=0===A.size,j=A.reduce(((A,{_index:w},T)=>(A[w]=T,A)),{});C();let G=A.getAttribute("x"),H=A.getAttribute("y"),W=A.getAttribute("radius").map(Number),$=new ws({xValues:G,yValues:H,scaledSizeValues:W.map((A=>2*A))});O&&(N.reset(),$.reset());let Z,se,ue=$.cx-N.cx,ge=$.cy-N.cy,ce=0,_e=0,me=T.computeConfigForBounds($),pe=w.zoom/me.zoom;return isNaN(N.cx)||isNaN(N.cy)?(N.cx=w.x,N.cy=w.y,Z=me.x,se=me.y):(ue+=(N.cx-w.x)*pe,ge+=(N.cy-w.y)*pe,ce=N.cx+ue,_e=N.cy+ge,Z=(w.x+ue-ce)*pe+ce,se=(w.y+ge-_e)*pe+_e),{offsetChanges:{name:"geo-to-graph",nodeAttributes:{x:A=>(k[j[A._index]].x+ue-ce)*pe+ce,y:A=>(k[j[A._index]].y+ge-_e)*pe+_e}},camera:re({zoom:me.zoom,x:Z,y:se,angle:0},w.getSize())}}(A,this._modules.camera,this._modules.locate,(()=>{this._projection&&(this._projection.destroy(),this._projection=null)}));return{offset:this._addGraphAttributesLayer(w),newCameraView:T}}getPointFromLatLng(A){let{latitude:w,longitude:T}=A.getGeoCoordinates();return null==w?A.getAttributes(["x","y"]):this._fromLatLngToPoint(w,T)}_createFinalPositionLayer(){return this._addGraphAttributesLayer({name:"graph-2-geo-animation",nodeAttributes:{scalingMethod:"fixed",radius:A=>Number(A.getAttribute("radius"))*this._settings.sizeRatio,x:A=>this.getPointFromLatLng(A).x,y:A=>this.getPointFromLatLng(A).y},edgeAttributes:{scalingMethod:"fixed",width:A=>Number(A.getAttribute("width"))*this._settings.sizeRatio}})}setCenter(A,w){return this._enabled?this.setView(A,w,Tc(this._modules.camera.getZoom())):Promise.resolve()}setZoom(A){return this._enabled&&this._map?(A=this._clampZoom(A),this._map.setZoom(A),new Promise((w=>{let T=this._map;if(T.getZoom()===A)return w(void 0);T.once("moveend zoomend",w)})).then(this._onMapUpdate)):Promise.resolve()}zoomIn(){return this.setZoom(this.getZoom()+1)}zoomOut(){return this.setZoom(this.getZoom()-1)}setView(A,w,T){if(!this._enabled||!this._map)return Promise.resolve();let C=this._map;T=this._clampZoom(T);let k=this.L.latLng([A,w]);return C.setView(k,T,{animate:!1,reset:!0}),new Promise((A=>{if(C.getZoom()===T&&C.getCenter().equals(k))return A(void 0);C.once("moveend zoomend",A)})).then(this._onMapUpdate)}getView(){if(!this._enabled||!this._map)return;let A=this._map.getCenter();return{zoom:this._map.getZoom(),latitude:A.lat,longitude:A.lng}}getCenter(){if(!this._enabled||!this._map)return;let A=this._map.getCenter();return{latitude:A.lat,longitude:A.lng}}getZoom(){if(this._enabled&&this._map)return this._map.getZoom()}resetCoordinates(){if(!this._enabled||!this._projection)return;let A=this._modules.graph.getNodes();this._restorePrevNodesCoordinates(this._modules.graph.getNodes());let w=this._modules.graph.getNodeAttribute(ki).getMultiple(A._indexes),T=this._modules.graph.getNodeAttribute(Ii).getMultiple(A._indexes);A.setData(this._settings.latitudePath,w),A.setData(this._settings.longitudePath,T),this._projection.update()}getUnprojectedCoordinates(A){this._projection&&this._projection.destroy();let w=A.getPosition();return this._projection=this._createFinalPositionLayer(),w}get latitudePath(){return this._settings.latitudePath}get longitudePath(){return this._settings.longitudePath}get filter(){return this._filter}exportBackground(A){if(!this._map)return Promise.reject("Map is not ready");let{pixelRatio:w,width:T,height:C,zoom:k,x:N,y:O}=A,j=T*w,G=C*w,H=Lt(j,G),W=H.getContext("2d"),$=this._map;if(!W)throw new Error(`Unable to get 2d context from  ${H}`);let Z=this.getView(),se=re({zoom:Math.round(Tc(k*w))},this._fromPointToLatLng(N,O)),ue=new this.L.Canvas;$.addLayer(ue);let{vectorMap:ge,tileLayers:ce,vectorLayers:_e,imageOverlays:me,markers:pe}=function _A(A,w,T,C,k,N){let O={vectorMap:[],tileLayers:[],vectorLayers:[],imageOverlays:[],markers:[]};return w.eachLayer((j=>{if(j!==A){let A=function m0(A,w){return A instanceof w.TileLayer?"tileLayers":A instanceof w.ImageOverlay?"imageOverlays":A instanceof w.Path?"vectorLayers":A instanceof w.Marker?"markers":"MapboxGL"in w&&A instanceof w.MapboxGL?"vectorMap":void 0}(j,C);if(A&&A in O){let G=yd[A];O[A].push((()=>G(j,T,w,C,k,N)))}}})),O}(this._layer,$,W,this.L,w,ue),be=$.options.zoomSnap;return Promise.resolve().then((()=>(rn(this._mapContainer,j+"px",G+"px"),$.invalidateSize({animate:!1}),this.setView(se.latitude,se.longitude,se.zoom)))).then((()=>Ug([...ge,...ce,...me,..._e,...pe]))).then((()=>{rn(this._mapContainer,"100%","100%"),$.invalidateSize({animate:!1}),$.options.zoomSnap=be,this.setView(Z.latitude,Z.longitude,Z.zoom)})).then((()=>new Promise((A=>this.L.Util.requestAnimFrame(A))))).then((()=>$.removeLayer(ue))).then((()=>H))}},Td={};function N_(A,w,T,C,k,N){let O=0;for(let j=0;j<C;j++)for(let G=0;G<C;G++){let C=N[j],H=N[G];if(C!==H){let N=A[C][H]*k,j=1/(N*N);if(j){let A=w[C]-w[H],k=T[C]-T[H];O+=j*Math.pow(N-Math.sqrt(A*A+k*k),2)}}}return O}function T_(A,w,T,C,k,N,O){let j=0;if(-1===k)return 0;for(let G=0;G<C;G++)for(let H=0;H<C;H++){let C=O[G],W=O[H];if(C!==W&&(C===k||W===k)){let k=A[C][W]*N,O=1/(k*k);if(O){let A=w[C]-w[W],N=T[C]-T[W];j+=O*Math.pow(k-Math.sqrt(A*A+N*N),2)}}}return j}function ng(A,w,T,C,k,N,O,j){O=O||0;let G=0,H=0;for(let O=0;O<C;O++)for(let W=0;W<C;W++){let C=j[O],$=j[W];if(C!==$){let O=A[C][$]*N,j=1/(O*O);if(j){let A=w[C]-w[$],N=T[C]-T[$],W=j*Math.pow(O-Math.sqrt(A*A+N*N),2);G+=W,(C===k||$===k)&&(H+=W)}}}return(1-O)*G+O*H}function ig(A,w,T,C,k,N,O,j,G){O=O||0;let H=w,W=T;-1===(k=void 0===k?-1:k)&&(O=0);let $=w[k],Z=T[k];for(let se=0;se<C;se++){let ue=j[se],ge=G(A[k][se]),ce=O/(ge*ge);if(0===ge)continue;let _e=0,me=0,pe=0,be=w[ue],Se=T[ue];for(let k=0;k<C;k++){let C=j[k];if(C!==ue){let k=A[ue][C]*N,j=1/(k*k),G=w[C],H=T[C];if(0!==j){let A=be-G,w=Se-H,T=A*A+w*w,C=T<1e-12?0:1/Math.sqrt(T);me+=(1-O)*j*(G+k*(be-G)*C),pe+=(1-O)*j*(H+k*(Se-H)*C)}_e+=j}}let Ee=(1-O)*_e+ce;if(0!==Ee){let A=be-$,C=Se-Z,k=A*A+C*C;k=k<1e-12?0:1/Math.sqrt(k);let N=0===ge?0:ce*(ge*k);H[ue]=(me+N*w[ue])/Ee,W[ue]=(pe+N*T[ue])/Ee}}return{x:H,y:W}}function f0(A,w,T,C,k,N,O,j){O=O||0;let G,H=w,W=T;-1===(k=void 0===k?-1:k)&&(O=0);for(let $=0;$<C;$++){let Z=j[$],se=0,ue=0,ge=0,ce=w[Z],_e=T[Z];for(let G=0;G<C;G++){let C=j[G],H=0;if(C!==Z){let j=0,G=A[Z][C]*N,W=1/(G*G);(Z===k||C===k)&&(j=W);let $=(1-O)*W+O*j;if(se+=$,0!==W){let A=w[C],k=T[C],N=ce-A,O=_e-k,j=N*N+O*O;j>1e-6&&(H=1/Math.sqrt(j)),ue+=$*(A+G*(ce-A)*H),ge+=$*(k+G*(_e-k)*H)}}}G=se,0!==G&&(H[Z]=ue/G,W[Z]=ge/G)}return{x:H,y:W}}function Co(A=((A,w)=>A-w),w=[],T={},C=(A=>A)){let k=w.length;function o(N){for(;;){let O=2*N+1,j=O+1,G=N;if(O<k&&A(w[O],w[G])<0&&(G=O),j<k&&A(w[j],w[G])<0&&(G=j),G===N)return N;let H=w[G];w[G]=w[N],w[N]=H,T[C(w[G])]=G,T[C(H)]=N,N=G}}return{get keys(){return T},get size(){return k},heapify:o,pop(){if(k<=0)return;if(1===k)return k--,w[0];let A=w[0];return w[0]=w[k-1],k--,o(0),A},decreaseKey(k,N){for(void 0!==N&&(w[k]=N,T[C(N)]=k);k>0;){let N=k-1>>1;if(!(A(w[N],w[k])>0))break;{let A=w[k];w[k]=w[N],w[N]=A,T[C(w[k])]=k,T[C(A)]=N,k=N}}return k},min:()=>w[0],remove(A){return this.decreaseKey(A,Number.NEGATIVE_INFINITY),this.pop()},push(N){k++;let O=k-1;for(w[O]=N;O>0;){let k=O-1>>1;if(!(A(w[k],w[O])>0))break;{let A=w[O];w[O]=w[k],w[k]=A,T[C(w[O])]=O,T[C(A)]=k,O=k}}return O},empty:()=>k<=0,toArray:()=>w.slice(0,k)}}function Oo({sources:A,targets:w,weights:T,source:C,target:k,undirected:N=!1,indexes:O,N:j}){if(!(j=O?O.length:j)||!isFinite(j)||0===j)throw new Error("Invalid number of nodes "+j);let G=new Float32Array(j),H=new Int32Array(j),W={},$=Number.POSITIVE_INFINITY;if(!T){T=[];for(let A=0;A<j;A++)T[A]=1}if(!O){O=new Uint32Array(j);for(let A=0;A<j;A++)O[A]=A+1}for(let A=0;A<j;A++)G[A]=$,H[A]=-1,W[O[A]]=A;G[W[C]]=0;let Z=!1;for(let C=1;C<=j;C++){for(let C=0;C<T.length;C++){let k=A[C],O=w[C],j=W[k],se=W[O];if(void 0!==j&&void 0!==se){let A=T[C],w=G[j]+A;G[j]!==$&&w<G[se]&&(G[se]=w,H[se]=k,Z=!0),N&&(w=G[se]+A,G[se]!==$&&w<G[j]&&(G[j]=w,H[j]=O,Z=!0))}}if(!Z)break}if(Z)for(let C=0;C<T.length;C++){let k=A[C],N=w[C],O=W[k],j=W[N];if(void 0!==O&&void 0!==j){let A=T[C];if(G[O]+A<G[j])return null}}let se=null,ue=null;if(void 0!==k){let A=W[k];if(void 0!==A&&G[A]!==$){se=[];for(let A=k;-1!==A;A=H[W[A]])se.push(A);se=se.reverse(),ue=G[A]}}return{distances:G,path:se,pathLength:ue}}function Po(A,w,T,C,k,N,O){let j=(C=C||A.map(((A,w)=>w+1))).length,G=new Float32Array(j),H=new Int32Array(j),W=new Uint32Array(j),$=Number.POSITIVE_INFINITY,Z={};if(0===j)return{distances:G,path:null,pathLength:null};if(!k){k={};for(let A=0;A<j;A++)k[C[A]]=A}for(let A=0;A<j;A++)G[A]=$,H[A]=-1,W[A]=Z[A]=A;let se=Co(((A,w)=>G[A]-G[w]),W,Z);for(G[k[w]]=0,se.decreaseKey(Z[k[w]]);0!==se.size;){let w=se.pop(),T=G[w],j=A[w];if(T===$)break;for(let A=0,W=j.nodes.length;A<W;A++){let W=j.nodes[A],$=N?1:O?O(C[w],W):j.weights?j.weights[A]:1,ue=k[W];if(void 0===ue)continue;let ge=T+$;ge<G[ue]&&(G[ue]=ge,H[ue]=w,se.decreaseKey(Z[ue]))}}let ue=null,ge=null;if(void 0!==T){let A=k[T];if(G[A]!==$){ue=[];for(let w=A;-1!==w;w=H[w])ue.push(C[w]);ue.reverse(),ge=G[T]}}return{distances:G,path:ue,pathLength:ge}}function Js({sources:A,targets:w,weights:T,indexes:C,adjacency:k,undirected:N,ignoreWeights:O}){let j=Number.POSITIVE_INFINITY,G=C?C.length:k.length;if(!C){C=new Uint32Array(G);for(let A=0;A<G;A++)C[A]=A+1}let H=new Array(G),W={};for(let A=0;A<G;A++){H[A]=new Float32Array(G);for(let w=0;w<G;w++)H[A][w]=A===w?0:j;W[C[A]]=A}let $=G,Z=T.length;A=A.slice(),w=w.slice(),T=T.slice();for(let k=0;k<G;k++)A[Z+k]=$,w[Z+k]=C[k],T[Z+k]=0,O&&(T[k]=1);let se=Oo({sources:A,targets:w,weights:T,undirected:N,N:G+1,source:$});if(null===se)throw new Error("Graph has negative weight loops");let ue=se.distances;for(let C=0;C<T.length;C++){let k=W[A[C]],N=W[w[C]];void 0!==k&&void 0!==N&&(T[C]=T[C]+ue[k]-ue[N])}A=A.slice(0,Z),w=w.slice(0,Z),T=T.slice(0,Z);for(let A=0;A<G;A++){let w=C[A],{distances:T}=Po(k,w,void 0,C,W,!!O);for(let w=0;w<G;w++)H[A][w]=A===w?0:T[w]}return H}Ua(Td,{CyclesFinder:()=>Rd,Quadtree:()=>kl,bellmanFord:()=>Oo,betweenness:()=>Wl,circlePack:()=>O_,constrainedStress:()=>ng,convexhull:()=>C_,detectCyclesDirected:()=>w_,detectCyclesUndirected:()=>R0,detectCyclesUndirectedDFS:()=>F0,dijkstra:()=>Po,distanceStress:()=>T_,johnson:()=>Js,kruskal:()=>sg,largestEmptyCircle:()=>zl,minDisk:()=>Jn,minHeap:()=>Co,removeRadialOverlap:()=>Ul,stressMinimizationStep:()=>ig,stressMinimizationStepGeneral:()=>f0,weightedStress:()=>N_});var Cd=134217729;function wo(A,w,T,C,k){let N,O,j,G,H=w[0],W=C[0],$=0,Z=0;W>H==W>-H?(N=H,H=w[++$]):(N=W,W=C[++Z]);let se=0;if($<A&&Z<T)for(W>H==W>-H?(O=H+N,j=N-(O-H),H=w[++$]):(O=W+N,j=N-(O-W),W=C[++Z]),N=O,0!==j&&(k[se++]=j);$<A&&Z<T;)W>H==W>-H?(O=N+H,G=O-N,j=N-(O-G)+(H-G),H=w[++$]):(O=N+W,G=O-N,j=N-(O-G)+(W-G),W=C[++Z]),N=O,0!==j&&(k[se++]=j);for(;$<A;)O=N+H,G=O-N,j=N-(O-G)+(H-G),H=w[++$],N=O,0!==j&&(k[se++]=j);for(;Z<T;)O=N+W,G=O-N,j=N-(O-G)+(W-G),W=C[++Z],N=O,0!==j&&(k[se++]=j);return(0!==N||0===se)&&(k[se++]=N),se}function fe(A){return new Float64Array(A)}var Ld=fe(4),Md=fe(8),Id=fe(12),Nd=fe(16),Fd=fe(4);function ta(A,w,T,C,k,N){let O=(w-N)*(T-k),j=(A-k)*(C-N),G=O-j;if(0===O||0===j||O>0!=j>0)return G;let H=Math.abs(O+j);return Math.abs(G)>=33306690738754716e-32*H?G:-function y0(A,w,T,C,k,N,O){let j,G,H,W,$,Z,se,ue,ge,ce,_e,me,pe,be,Se,Ee,Te,Ce,Ie=A-k,ze=T-k,Pe=w-N,Re=C-N;be=Ie*Re,Z=Cd*Ie,se=Z-(Z-Ie),ue=Ie-se,Z=Cd*Re,ge=Z-(Z-Re),ce=Re-ge,Se=ue*ce-(be-se*ge-ue*ge-se*ce),Ee=Pe*ze,Z=Cd*Pe,se=Z-(Z-Pe),ue=Pe-se,Z=Cd*ze,ge=Z-(Z-ze),ce=ze-ge,Te=ue*ce-(Ee-se*ge-ue*ge-se*ce),_e=Se-Te,$=Se-_e,Ld[0]=Se-(_e+$)+($-Te),me=be+_e,$=me-be,pe=be-(me-$)+(_e-$),_e=pe-Ee,$=pe-_e,Ld[1]=pe-(_e+$)+($-Ee),Ce=me+_e,$=Ce-me,Ld[2]=me-(Ce-$)+(_e-$),Ld[3]=Ce;let Ue=function Bl(A,w){let T=w[0];for(let C=1;C<A;C++)T+=w[C];return T}(4,Ld),Ve=22204460492503146e-32*O;if(Ue>=Ve||-Ue>=Ve||($=A-Ie,j=A-(Ie+$)+($-k),$=T-ze,H=T-(ze+$)+($-k),$=w-Pe,G=w-(Pe+$)+($-N),$=C-Re,W=C-(Re+$)+($-N),0===j&&0===G&&0===H&&0===W)||(Ve=11093356479670487e-47*O+33306690738754706e-32*Math.abs(Ue),Ue+=Ie*W+Re*j-(Pe*H+ze*G),Ue>=Ve||-Ue>=Ve))return Ue;be=j*Re,Z=Cd*j,se=Z-(Z-j),ue=j-se,Z=Cd*Re,ge=Z-(Z-Re),ce=Re-ge,Se=ue*ce-(be-se*ge-ue*ge-se*ce),Ee=G*ze,Z=Cd*G,se=Z-(Z-G),ue=G-se,Z=Cd*ze,ge=Z-(Z-ze),ce=ze-ge,Te=ue*ce-(Ee-se*ge-ue*ge-se*ce),_e=Se-Te,$=Se-_e,Fd[0]=Se-(_e+$)+($-Te),me=be+_e,$=me-be,pe=be-(me-$)+(_e-$),_e=pe-Ee,$=pe-_e,Fd[1]=pe-(_e+$)+($-Ee),Ce=me+_e,$=Ce-me,Fd[2]=me-(Ce-$)+(_e-$),Fd[3]=Ce;let He=wo(4,Ld,4,Fd,Md);be=Ie*W,Z=Cd*Ie,se=Z-(Z-Ie),ue=Ie-se,Z=Cd*W,ge=Z-(Z-W),ce=W-ge,Se=ue*ce-(be-se*ge-ue*ge-se*ce),Ee=Pe*H,Z=Cd*Pe,se=Z-(Z-Pe),ue=Pe-se,Z=Cd*H,ge=Z-(Z-H),ce=H-ge,Te=ue*ce-(Ee-se*ge-ue*ge-se*ce),_e=Se-Te,$=Se-_e,Fd[0]=Se-(_e+$)+($-Te),me=be+_e,$=me-be,pe=be-(me-$)+(_e-$),_e=pe-Ee,$=pe-_e,Fd[1]=pe-(_e+$)+($-Ee),Ce=me+_e,$=Ce-me,Fd[2]=me-(Ce-$)+(_e-$),Fd[3]=Ce;let We=wo(He,Md,4,Fd,Id);be=j*W,Z=Cd*j,se=Z-(Z-j),ue=j-se,Z=Cd*W,ge=Z-(Z-W),ce=W-ge,Se=ue*ce-(be-se*ge-ue*ge-se*ce),Ee=G*H,Z=Cd*G,se=Z-(Z-G),ue=G-se,Z=Cd*H,ge=Z-(Z-H),ce=H-ge,Te=ue*ce-(Ee-se*ge-ue*ge-se*ce),_e=Se-Te,$=Se-_e,Fd[0]=Se-(_e+$)+($-Te),me=be+_e,$=me-be,pe=be-(me-$)+(_e-$),_e=pe-Ee,$=pe-_e,Fd[1]=pe-(_e+$)+($-Ee),Ce=me+_e,$=Ce-me,Fd[2]=me-(Ce-$)+(_e-$),Fd[3]=Ce;let $e=wo(We,Id,4,Fd,Nd);return Nd[$e-1]}(A,w,T,C,k,N,H)}fe(4),fe(4),fe(4),fe(4),fe(4),fe(4),fe(4),fe(4),fe(4),fe(8),fe(8),fe(8),fe(4),fe(8),fe(8),fe(8),fe(12),fe(192),fe(192),fe(4),fe(4),fe(4),fe(4),fe(4),fe(4),fe(4),fe(4),fe(8),fe(8),fe(8),fe(8),fe(8),fe(8),fe(8),fe(8),fe(8),fe(4),fe(4),fe(4),fe(8),fe(16),fe(16),fe(16),fe(32),fe(32),fe(48),fe(64),fe(1152),fe(1152),fe(4),fe(4),fe(4),fe(4),fe(4),fe(4),fe(4),fe(4),fe(4),fe(4),fe(24),fe(24),fe(24),fe(24),fe(24),fe(24),fe(24),fe(24),fe(24),fe(24),fe(1152),fe(1152),fe(1152),fe(1152),fe(1152),fe(2304),fe(2304),fe(3456),fe(5760),fe(8),fe(8),fe(8),fe(16),fe(24),fe(48),fe(48),fe(96),fe(192),fe(384),fe(384),fe(384),fe(768),fe(96),fe(96),fe(96),fe(1152);var zd=Math.pow(2,-52),Pd=new Uint32Array(512),Dd=class{static from(A,w=T0,T=S0){let C=A.length,k=new Float64Array(2*C);for(let N=0;N<C;N++){let C=A[N];k[2*N]=w(C),k[2*N+1]=T(C)}return new Dd(k)}constructor(A){let w=A.length>>1;if(w>0&&"number"!=typeof A[0])throw new Error("Expected coords to contain numbers.");this.coords=A;let T=Math.max(2*w-5,0);this._triangles=new Uint32Array(3*T),this._halfedges=new Int32Array(3*T),this._hashSize=Math.ceil(Math.sqrt(w)),this._hullPrev=new Uint32Array(w),this._hullNext=new Uint32Array(w),this._hullTri=new Uint32Array(w),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(w),this._dists=new Float64Array(w),this.update()}update(){let{coords:A,_hullPrev:w,_hullNext:T,_hullTri:C,_hullHash:k}=this,N=A.length>>1,O=1/0,j=1/0,G=-1/0,H=-1/0;for(let w=0;w<N;w++){let T=A[2*w],C=A[2*w+1];T<O&&(O=T),C<j&&(j=C),T>G&&(G=T),C>H&&(H=C),this._ids[w]=w}let W,$,Z,se=(O+G)/2,ue=(j+H)/2,ge=1/0;for(let w=0;w<N;w++){let T=S_(se,ue,A[2*w],A[2*w+1]);T<ge&&(W=w,ge=T)}let ce=A[2*W],_e=A[2*W+1];ge=1/0;for(let w=0;w<N;w++){if(w===W)continue;let T=S_(ce,_e,A[2*w],A[2*w+1]);T<ge&&T>0&&($=w,ge=T)}let me=A[2*$],pe=A[2*$+1],be=1/0;for(let w=0;w<N;w++){if(w===W||w===$)continue;let T=v0(ce,_e,me,pe,A[2*w],A[2*w+1]);T<be&&(Z=w,be=T)}let Se=A[2*Z],Ee=A[2*Z+1];if(be===1/0){for(let w=0;w<N;w++)this._dists[w]=A[2*w]-A[0]||A[2*w+1]-A[1];ra(this._ids,this._dists,0,N-1);let w=new Uint32Array(N),T=0;for(let A=0,C=-1/0;A<N;A++){let k=this._ids[A];this._dists[k]>C&&(w[T++]=k,C=this._dists[k])}return this.hull=w.subarray(0,T),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(ta(ce,_e,me,pe,Se,Ee)<0){let A=$,w=me,T=pe;$=Z,me=Se,pe=Ee,Z=A,Se=w,Ee=T}let Te=function N0(A,w,T,C,k,N){let O=T-A,j=C-w,G=k-A,H=N-w,W=O*O+j*j,$=G*G+H*H,Z=.5/(O*H-j*G);return{x:A+(H*W-j*$)*Z,y:w+(O*$-G*W)*Z}}(ce,_e,me,pe,Se,Ee);this._cx=Te.x,this._cy=Te.y;for(let w=0;w<N;w++)this._dists[w]=S_(A[2*w],A[2*w+1],Te.x,Te.y);ra(this._ids,this._dists,0,N-1),this._hullStart=W;let Ce=3;T[W]=w[Z]=$,T[$]=w[W]=Z,T[Z]=w[$]=W,C[W]=0,C[$]=1,C[Z]=2,k.fill(-1),k[this._hashKey(ce,_e)]=W,k[this._hashKey(me,pe)]=$,k[this._hashKey(Se,Ee)]=Z,this.trianglesLen=0,this._addTriangle(W,$,Z,-1,-1,-1);for(let N,O,j=0;j<this._ids.length;j++){let G=this._ids[j],H=A[2*G],se=A[2*G+1];if(j>0&&Math.abs(H-N)<=zd&&Math.abs(se-O)<=zd||(N=H,O=se,G===W||G===$||G===Z))continue;let ue=0;for(let A=0,w=this._hashKey(H,se);A<this._hashSize&&(ue=k[(w+A)%this._hashSize],-1===ue||ue===T[ue]);A++);ue=w[ue];let ge,ce=ue;for(;ge=T[ce],ta(H,se,A[2*ce],A[2*ce+1],A[2*ge],A[2*ge+1])>=0;)if(ce=ge,ce===ue){ce=-1;break}if(-1===ce)continue;let _e=this._addTriangle(ce,G,T[ce],-1,-1,C[ce]);C[G]=this._legalize(_e+2),C[ce]=_e,Ce++;let me=T[ce];for(;ge=T[me],ta(H,se,A[2*me],A[2*me+1],A[2*ge],A[2*ge+1])<0;)_e=this._addTriangle(me,G,ge,C[G],-1,C[me]),C[G]=this._legalize(_e+2),T[me]=me,Ce--,me=ge;if(ce===ue)for(;ge=w[ce],ta(H,se,A[2*ge],A[2*ge+1],A[2*ce],A[2*ce+1])<0;)_e=this._addTriangle(ge,G,ce,-1,C[ce],C[ge]),this._legalize(_e+2),C[ge]=_e,T[ce]=ce,Ce--,ce=ge;this._hullStart=w[G]=ce,T[ce]=w[me]=G,T[G]=me,k[this._hashKey(H,se)]=G,k[this._hashKey(A[2*ce],A[2*ce+1])]=ce}this.hull=new Uint32Array(Ce);for(let A=0,w=this._hullStart;A<Ce;A++)this.hull[A]=w,w=T[w];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(A,w){return Math.floor(function D0(A,w){let T=A/(Math.abs(A)+Math.abs(w));return(w>0?3-T:1+T)/4}(A-this._cx,w-this._cy)*this._hashSize)%this._hashSize}_legalize(A){let{_triangles:w,_halfedges:T,coords:C}=this,k=0,N=0;for(;;){let O=T[A],j=A-A%3;if(N=j+(A+2)%3,-1===O){if(0===k)break;A=Pd[--k];continue}let G=O-O%3,H=j+(A+1)%3,W=G+(O+2)%3,$=w[N],Z=w[A],se=w[H],ue=w[W];if(A0(C[2*$],C[2*$+1],C[2*Z],C[2*Z+1],C[2*se],C[2*se+1],C[2*ue],C[2*ue+1])){w[A]=ue,w[O]=$;let C=T[W];if(-1===C){let w=this._hullStart;do{if(this._hullTri[w]===W){this._hullTri[w]=A;break}w=this._hullPrev[w]}while(w!==this._hullStart)}this._link(A,C),this._link(O,T[N]),this._link(N,W);let j=G+(O+1)%3;k<Pd.length&&(Pd[k++]=j)}else{if(0===k)break;A=Pd[--k]}}return N}_link(A,w){this._halfedges[A]=w,-1!==w&&(this._halfedges[w]=A)}_addTriangle(A,w,T,C,k,N){let O=this.trianglesLen;return this._triangles[O]=A,this._triangles[O+1]=w,this._triangles[O+2]=T,this._link(O,C),this._link(O+1,k),this._link(O+2,N),this.trianglesLen+=3,O}};function S_(A,w,T,C){let k=A-T,N=w-C;return k*k+N*N}function A0(A,w,T,C,k,N,O,j){let G=A-O,H=w-j,W=T-O,$=C-j,Z=k-O,se=N-j,ue=W*W+$*$,ge=Z*Z+se*se;return G*($*ge-ue*se)-H*(W*ge-ue*Z)+(G*G+H*H)*(W*se-$*Z)<0}function v0(A,w,T,C,k,N){let O=T-A,j=C-w,G=k-A,H=N-w,W=O*O+j*j,$=G*G+H*H,Z=.5/(O*H-j*G),se=(H*W-j*$)*Z,ue=(O*$-G*W)*Z;return se*se+ue*ue}function ra(A,w,T,C){if(C-T<=20)for(let k=T+1;k<=C;k++){let C=A[k],N=w[C],O=k-1;for(;O>=T&&w[A[O]]>N;)A[O+1]=A[O--];A[O+1]=C}else{let k=T+1,N=C;Gl(A,T+C>>1,k),w[A[T]]>w[A[C]]&&Gl(A,T,C),w[A[k]]>w[A[C]]&&Gl(A,k,C),w[A[T]]>w[A[k]]&&Gl(A,T,k);let O=A[k],j=w[O];for(;;){do{k++}while(w[A[k]]<j);do{N--}while(w[A[N]]>j);if(N<k)break;Gl(A,k,N)}A[T+1]=A[N],A[N]=O,C-k+1>=N-T?(ra(A,w,k,C),ra(A,w,T,N-1)):(ra(A,w,T,N-1),ra(A,w,k,C))}}function Gl(A,w,T){let C=A[w];A[w]=A[T],A[T]=C}function T0(A){return A[0]}function S0(A){return A[1]}function zl(A,w=1,T=0,C,k){if(!C||!k){let w=A.map((A=>[A.x,A.y])),T=Dd.from(w,(A=>A.x),(A=>A.y));C=ji(T.triangles,w),k=ji(T.hull,w)}if(!k)return[];let N=T*T,O=[],j={};for(let A=0;A<C.length;A+=3){if(L0(k,L_(C[A],C[A+1],C[A+2]))){let w=C0(C[A],C[A+1],C[A+2]);w>N&&(O.push(A),j[A]=w)}}if(0===O.length)return[];O.sort(((A,w)=>j[A]-j[w]));let G=O[0],H=j[G],W=[];for(let A=0;A<O.length;A++){let T=O[A],C=j[T];C>H&&C>N&&(G=T,H=C,W.push(G),W.length>w&&W.shift())}return W.map((A=>function I0(A,w,T){let C=L_(A,w,T),k=0;for(let A=0;A<3;A++){let w=arguments[A],T=w[0]-C[0],N=w[1]-C[1],O=Math.sqrt(T*T+N*N);O>k&&(k=O)}return[C[0],C[1],k]}(C[A],C[A+1],C[A+2])))}function L0(A,w){let T=A.length,C=A[T-1],[k,N]=w,[O,j]=C,G=!1;for(let w=0;w<T;w++){let T=A[w],[C,H]=T;H>N!=j>N&&k<(O-C)*(N-H)/(j-H)+C&&(G=!G),O=C,j=H}return G}function C0(A,w,T){let[C,k]=L_(A,w,T),[N,O]=A,j=C-N,G=k-O;return j*j+G*G}function L_(A,w,T){let C=[(A[0]+w[0])/2,(A[1]+w[1])/2],k=[(w[0]+T[0])/2,(w[1]+T[1])/2],N=-1/((w[1]-A[1])/(w[0]-A[0])),O=-1/((T[1]-w[1])/(T[0]-w[0])),j=C[1]-N*C[0],G=(j-(k[1]-O*k[0]))/(O-N);return[G,N*G+j]}function Ul({X:A,Y:w,sizes:T,indexes:C,R:k,center:N,gap:O=0,epsilon:j=.001,maxLoops:G=5,inPlace:H=!0}){let W=C.length,[$,Z]=N,se=W;H||(A=A.slice(),w=w.slice());let ue=fl,ge=_l,ce=C.slice().sort(((T,C)=>ge(A[T],w[T],A[C],w[C],$,Z))),_e=ce[W-1],me=A[_e],pe=w[_e],be=!1;for(let C=0;C<se-1;C++){let N=C%W,H=(C+1)%W;-1===C&&(N=W-1,H=0),N=ce[N],H=ce[H];let _e=A[N],me=w[N],pe=A[H],Se=w[H],Ee=T[N]+T[H]+O,Te=ge(_e,me,pe,Se,$,Z);if(-1===Te&&be&&(Te=1),!(Ee>k)){if(1===Te||Ee-Et(_e,me,pe,Se)>j){let T=ue($,Z,k,_e,me,Ee);if(T){let C=T[0];be=pe>$&&C[0]<$,pe=A[H]=C[0],Se=w[H]=C[1]}}else be=!1;if(C%W==W-2){let C=ce[W-1],k=ce[0];if(w[C]>Z&&w[k]>Z&&A[C]-T[C]<A[k]+T[C]){let T=0;for(se=Math.min(W*G,se+W);w[ce[C]]>Z&&w[ce[0]]>Z&&A[ce[C]]<A[ce[0]]&&++T<W;){let A=ce.pop();A&&ce.unshift(A)}}}}}let Se=me-$,Ee=pe-Z,Te=A[_e]-$,Ce=w[_e]-Z,Ie=Se===Te?0:Math.abs(Math.acos((Se*Te+Ee*Ce)/(Math.sqrt(Se*Se+Ee*Ee)*Math.sqrt(Te*Te+Ce*Ce))));if(0!==Ie){let T,C=Math.sin(-Ie),k=Math.cos(-Ie);for(let N=0;N<W;N++){T=ce[N];let O=A[T]-$,j=w[T]-Z;A[T]=O*k-j*C+$,w[T]=O*C+j*k+Z}}return{X:A,Y:w}}function I_(A,w,T,C,k,N){let O={},j=T[A],G=j,H=0,W=j*k;for(let A in w){let j=w[A],$=0,Z=0;for(let A=0,w=j.length;A<w;A++){let w=T[j[A]];Z=Math.max(Z,w),$+=2*w+C}let se=$/(2*Math.PI),ue=Z+G,ge=N?H+Math.max(N,ue):H*k;H=Math.max(ue,H,se,W,ge),O[A]=H,G=Z}return O[0]=0,O[Number.POSITIVE_INFINITY]=H,O}function O0(A,w,T){return(w[0]-A[0])*(T[1]-A[1])-(w[1]-A[1])*(T[0]-A[0])}function LA(A){let w=A.length,T=[0,1],C=2;for(let k=2;k<w;k++){for(;C>1&&O0(A[T[C-2]],A[T[C-1]],A[k])<=0;)--C;T[C++]=k}return T.slice(0,C)}function C_(A){let w=A.length;if(w<3)return null;let T=new Array(w),C=new Array(w);for(let C=0;C<w;C++)T[C]=[+A[C][0],+A[C][1],C];T.sort(((A,w)=>A[0]-w[0]||A[1]-w[1]));for(let A=0;A<w;A++)C[A]=[T[A][0],-T[A][1]];let k=LA(T),N=LA(C),O=N[N.length-1],j=k[k.length-1],G=N[0]===k[0],H=O===j?1:0,W=[];for(let w=k.length-1;w>=0;--w)W.push(A[T[k[w]][2]]);for(let w=+G;w<N.length-H;w++)W.push(A[T[N[w]][2]]);return W}var IA=A=>--A*A*A+1,CA=(A,w,T)=>{let C=A-T[0],k=w-T[1];return C*C+k*k};function O_({X:A,Y:w,R:T,center:C,maxSteps:k=1e3,padding:N=5,epsilon:O=1e-9,damping:j=2,pinned:G,indexes:H,onUpdate:W,pushSmallerOut:$=!0}){let Z=H?H.length:A.length,se=H;if(isFinite(G)||(G=-1),void 0===se){se=new Uint32Array(Z);for(let A=0;A<Z;A++)se[A]=A}else se=H;if(-1!==G)C=[A[G],w[G]];else if(!C){let T=0,k=0;for(let C=0;C<Z;C++)T+=A[se[C]],k+=w[se[C]];C=[T/Z,k/Z]}let{min:ue,max:ge}=((A,w)=>{let T=1/0,C=-1/0;for(let k=0;k<A.length;k++){let N=A[k],O=w?w[N]:N;T=Math.min(O,T),C=Math.max(O,C)}return{min:T,max:C}})(se,T);function f(k,O){let H=0;for(let C=0;C<Z-1;C++)for(let j=C+1;j<Z;j++){if(C===j)continue;let W=se[C],$=se[j],Z=A[W],ge=w[W],ce=T[W],_e=A[$],me=w[$],pe=T[$],be=_e-Z,Se=me-ge,Ee=ce+pe+N,Te=be*be+Se*Se;if(Te<Ee*Ee-k){let T=(Ee-Math.sqrt(Te))*O,C=1/Te,k=be*C*T,N=Se*C*T,j=k*k+N*N;if($!==G){let T=ce/ue;H+=j*T,A[$]+=k*T,w[$]+=N*T}if(W!==G){let T=pe/ue;H+=j*T,A[W]-=k*T,w[W]-=N*T}}}let W=k*j*(1-O),ce=C[0],_e=C[1];for(let C=0;C<Z;C++){let k=se[C];if(k!==G){let C=A[k],N=w[k],O=T[k]/ge,j=$?W*O:W,G=(C-ce)*j,Z=(N-_e)*j;H+=G*G+Z*Z,A[k]-=G,w[k]-=Z}}return H}se.sort(((k,N)=>T[N]*CA(A[N],w[N],C)-T[k]*CA(A[k],w[k],C)));let ce=0,_e=0,me=IA(1/Z);for(let T=0;T<k&&(ce=f(me,IA((T+1)/k)),W&&setTimeout((()=>W(A,w))),!(Math.abs(ce-_e)<O));T++)_e=ce;return{X:A,Y:w}}function P_(A,w,T,C,k){let N=new Array(A.length);for(let A=0;A<w.length;A++){let O=C[w[A]],j=C[T[A]];N[O]=N[O]||[],N[O].push(j),k&&(N[j]=N[j]||[],N[j].push(O))}return N}function Vl(A,w){return-1===A[w]?w:Vl(A,A[w])}function w0(A,w,T){let C=Vl(A,w),k=Vl(A,T);A[C]=k}function R0(A,w,T,C=!1){let k=new Int32Array(A.length),N={};for(let w=0;w<A.length;w++)k[w]=-1,N[A[w]]=w;for(let A=0;A<w.length;A++){let O=N[w[A]],j=N[T[A]];if(C&&O===j)return!0;let G=Vl(k,O),H=Vl(k,j);if(G===H)return!0;w0(k,G,H)}return!1}function OA(A,w,T,C,k,N,O,j){if(C[A]=k,T[A])return!0;if(w[A])return!1;w[A]=1,T[A]=1;let G=N[A];if(G)for(let k of G)if(OA(k,w,T,C,A,N,O,j))return O.push(j[k]),!0;return T[A]=0,!1}function w_(A,w,T){let C=A.length,k=new Uint8Array(C),N=new Uint8Array(C),O=new Int32Array(C),j={};for(let w=0;w<C;w++)j[A[w]]=w;let G=P_(A,w,T,j,!1);for(let w=0;w<C;w++){let T=[];if(OA(w,k,N,O,-1,G,T,A)&&T.length>1){let A=T[0];for(let w=1;w<T.length;w++)if(T[w]===A){T.length=w;break}return T.push(A),T.reverse()}}return!1}function PA(A,w,T,C,k,N,O){w[A]=1,C[A]=T;let j=k[A];if(j)for(let G of j)if(w[G]){if(G!==T)return C[G]=A,N.push(O[G]),!0}else if(PA(G,w,A,C,k,N,O))return N.push(O[G]),!0;return!1}function F0(A,w,T){let C=A.length,k=new Uint8Array(C),N=new Int32Array(C),O={};for(let w=0;w<C;w++)O[A[w]]=w,N[w]=-1;let j=P_(A,w,T,O,!0);for(let A=0;A<w.length;A++){let C=O[w[A]],k=O[T[A]];j[C]=j[C]||[],j[C].push(k)}for(let w=0;w<C;w++){let T=w,C=[];if(!k[T]&&PA(T,k,-1,N,j,C,A))return!0}return!1}var Rd=class{constructor(A,w,T){this.cycles=[],this.visitedLength=0,this.visitedStack=[],this.stack=[],this.idToIndex={},this.removed={},this.nodes=A,this.visited=new Uint8Array(this.nodes.length);for(let w=0;w<A.length;w++)this.idToIndex[A[w]]=w;this.adjacency=P_(A,w,T,this.idToIndex)}getCycles(){this.visited=new Uint8Array(this.nodes.length),this.visitedStack=[];for(let A=0;A<this.nodes.length;A++)for(this.backtrack(A,A);0!==this.visitedLength;){let A=this.visitedStack.pop();void 0!==A&&this.visited[A]&&(this.visited[A]=0,this.visitedLength--)}return this.cycles}backtrack(A,w){let T=!1;this.stack.push(w),this.visited[w]||(this.visited[w]=1,this.visitedLength++),this.visitedStack.push(w);let C=this.adjacency[w]||[];for(let k of C)if(this.removed[w]=this.removed[w]||{},!this.removed[w][k])if(k<A)this.removed[w][k]=!0;else if(k===A){T=!0;let w=[];for(let T=0,C=!1;T<this.stack.length;T++){let k=this.stack[T];A===k&&(C=!0),C&&w.push(this.nodes[k])}this.cycles.push(w)}else if(!this.visited[k]){let w=this.backtrack(A,k);T=T||w}if(T){let A;do{A=this.visitedStack.pop(),this.visited[A]&&(this.visited[A]=0,this.visitedLength--)}while(A!==w)}return this.stack.pop(),T}};function wA(A,w){let T=A.index[w];if(void 0===T)return-1;for(;T>=0;)w=T,T=A.parent[T];return w}function B0(A,w,T){A.parent[T]=w,A.count-=1}function G0(A){return A.count<=1}function sg(A,w,T,C,k){k&&w.sort(((A,w)=>k(A)-k(w)));let N=[],O={index:{},parent:[],count:0};A.forEach((A=>function k0(A,w){void 0===A.index[w]&&(A.count+=1,A.index[w]=A.parent.push(-A.count))}(O,A)));for(let A=0;A<w.length&&!G0(O);A++){let k=wA(O,T(w[A])),j=wA(O,C(w[A]));k!==j&&k>0&&j>0&&(B0(O,k,j),N.push(w[A]))}return N}function Wl({adjacency:A,directed:w=!1,normalized:T=!0}){let C,k=[],N=[],O={},j={},G={},H={},W=new Array(A.length),$={},Z={},se={};for(let T=0;T<A.length;T++){let C=A[T];se[C.id]=C.adj,$[C.id]=!0,Z[C.id]=T,w||C.adj.forEach((A=>{$[A]=!0}))}let ue=Object.keys($).map((A=>+A));for(let A=0;A<ue.length;A++)W[A]=0;for(let A=0;A<ue.length;A++)C=ue[A],_(C),f();let ge=T?ue.length>2?1/((ue.length-1)*(ue.length-2)):0:w?0:.5;if(ge)for(let A=0;A<W.length;A++)W[A]*=ge;return W;function f(){for(let A=0;A<ue.length;A++)H[ue[A]]=0;for(;N.length;){let A=N.pop(),w=(1+H[A])/G[A],T=O[A];for(let A=0;A<T.length;++A){let C=T[A];H[C]+=G[C]*w}A!==C&&(W[Z[A]]+=H[A])}}function _(A){for(let A=0;A<ue.length;A++){let w=ue[A];O[w]=[],j[w]=-1,G[w]=0}for(j[A]=0,G[A]=1,k.push(A);k.length;){let A=k.shift();N.push(A),se[A].forEach((w=>{-1===j[w]&&(j[w]=j[A]+1,k.push(w)),j[w]===j[A]+1&&(G[w]+=G[A],O[w].push(A))}))}}}var Od=class extends kt{onMounted(){let A=this._modules.graph;this._nodeList=A.getNodeAttribute("object"),this._edgeList=A.getEdgeAttribute("object"),this._sourceList=A.getEdgeAttribute("source"),this._targetList=A.getEdgeAttribute("target"),this._excludedList=A.getEdgeAttribute("excluded"),this._virtualList=A.getEdgeAttribute("virtual")}shortestPath(A={source:void 0,target:void 0}){let{source:w,target:T,directed:C=!1,edges:k,nodes:N,edgeCostFunction:O=(()=>1),heuristicFunction:j=(()=>0)}=A;k||(k=this._ogma.getEdges()),N||(N=this._ogma.getNodes());let G=k.reduce(((A,w)=>(A[w._index]=!0,A)),{}),H=N.reduce(((A,w)=>(A[w._index]=!0,A)),{}),W=this._modules.graph.getNode(w),$=this._modules.graph.getNode(T);if(!W)throw new Error("the source is not a node");if(!$)throw new Error("the target is not a node");let Z=W._index,se=$._index;H[Z]=!0,H[se]=!0;let ue=null;if(Z===se)ue={nodes:W.toList(),edges:this._modules.graph.edgeList()};else{let A=this._modules.graph.getNodeMaxIndex()+1,w=new Int32Array(A),T=new Float32Array(A),k=new Float32Array(A),N=new Set,ge=new bs(k);for(T.fill(1/0),k.fill(1/0),w.fill(-1),ge.add(Z),T[Z]=0,k[Z]=j(W,$);!ge.isEmpty();){let A=ge.removeMin();if(A===se){ue=this._constructPath(w,Z,se);break}N.add(A);let W=this._modules.graph.getAdjacentDirections(A);if(W)for(let Z=0;Z<W.length;++Z){let se=W[Z],ue=this._modules.graph.getEdgeIndexesInDirection(se),ce=-1,_e=0,me=-1;for(let w=0;w<ue.length;++w){let T=ue[w],k=this._sourceList.get(T),N=this._targetList.get(T);if(k===N||!H[k]||!H[N]||C&&A!==k||!G[T])continue;let j=O(this._edgeList.get(T));(-1===ce||j<_e)&&(ce=T,_e=j,me=k===A?N:k)}if(-1!==me||N.has(me)){let C=T[A]+_e;if(!ge.has(me)||C<T[me]){let N=this._nodeList.get(A);w[me]=ce,T[me]=C,k[me]=C+j(N,$),ge.add(me)}}}}}return Promise.resolve(ue)}_constructPath(A,w,T){let C=[T],k=[],N=T;for(;N!==w;){let w=A[N],T=this._sourceList.get(w),O=this._targetList.get(w);N=N===T?O:T,C.push(N),k.push(w)}return C.reverse(),k.reverse(),{nodes:this._modules.graph.nodeList(new Uint32Array(C)),edges:this._modules.graph.edgeList(new Uint32Array(k))}}detectCycle(A,w){let T=w.getSource(),C=w.getTarget(),k=w_(A._indexes,T._indexes,C._indexes);return k?this._modules.graph.nodeList(new Uint32Array(k)).dedupe():this._modules.graph.nodeList()}getAllSimpleCycles(A,w){let T=w.getSource(),C=w.getTarget();return new Rd(A._indexes,T._indexes,C._indexes).getCycles().map((A=>this._modules.graph.nodeList(new Uint32Array(A))))}minimumSpanningTree(A,w,T){let C=this._modules.graph;A=C.getNodes(A),w=C.getEdges(w);let k=new Set;A.forEach((A=>k.add(A._index)));let N=C.getConnectedComponents(A,{filter:A=>k.has(A),internalIndexes:!0}),O={};N.forEach(((A,w)=>A.forEach((A=>O[A]=w))));let j=[];return w.forEach((A=>{let w=O[A.getSource()._index];void 0!==w&&(void 0===j[w]&&(j[w]=[]),j[w].push(A._index))})),N.map(((A,w)=>{let k=sg(A,j[w]||[],(A=>C.edge(A).getSource()._index),(A=>C.edge(A).getTarget()._index),T?A=>T(C.edge(A)):void 0);return{nodes:C.nodeList(new Uint32Array(A)),edges:C.edgeList(new Uint32Array(k))}}))}bfs({root:A,onNode:w,onEdge:T=Ze}){let C=this._modules.graph,k=[A],N=new Set,O={direction:"out"};for(;k.length;){let A=k.pop();if(!N.has(A._index)){if(!0===w(A))return;N.add(A._index),C.getAdjacentEdges(A,O).forEach((w=>{if(!1===T(w))return;let C=w.getSource()===A?w.getTarget():w.getSource();k.unshift(C)}))}}}dfs({root:A,onNode:w,onEdge:T=Ze}){let C=this._modules.graph,k=[A],N=new Set,O={direction:"out"};for(;k.length;){let A=k.pop();if(!N.has(A._index)){if(!0===w(A))return;N.add(A._index),C.getAdjacentEdges(A,O).forEach((w=>{if(!1===T(w))return;let C=w.getSource()===A?w.getTarget():w.getSource();k.push(C)}))}}}betweenness({nodes:A,edges:w,directed:T,normalized:C}){let k=this._ogma.getNodes().subtract(A),N=this._ogma.getEdges().subtract(w).concat(k.fastGetAdjacentElements().edges).dedupe();return Wl({adjacency:A.map((A=>{let w=this._ogma.edgeList(this._ogma.modules.graph.topology.getAdjacentElements(!1,A.toList()._indexes,{direction:T?"out":"both"})).subtract(N).dedupe();return{id:A._index,adj:w.map((w=>w.getSource()._index===A._index?w.getTarget()._index:w.getSource()._index))}})),directed:T,normalized:C})}},Bd=class extends kt{constructor(){super(...arguments),this._context={edgesAlwaysCurvy:!1,directedEdges:!1}}onMounted(){this._attributeLayer=this._addAttributeLayer(),this._modules.settings.register("edgesAlwaysCurvy",!1,(A=>{this._context.edgesAlwaysCurvy=A,this._attributeLayer.updateAll()})),this._modules.settings.register("directedEdges",!1,(A=>{this._context.directedEdges=A,this._attributeLayer.updateAll()}))}computeCurvature(A,w="visible",T){let{edgesAlwaysCurvy:C,directedEdges:k}=this._context,N=A.getSource()===A.getTarget(),O=A.getParallelEdges({filter:w});T&&(O=O.filter((A=>T(A))));let j,G=O.indexOf(A);if(-1===G)return 0;if(N)j=(G+1)*Math.max(+A.getAttribute("width")||0,1);else{let w=A.getSource(),T=O.size;if(1===T&&!C)return 0;if(k){let A=0;for(let T=0;T<G;++T)O.get(T).getSource()===w&&(A+=1);j=A+1}else{let A=w!==O.get(0).getSource();j=T%2!=1||C?(1+(G/2|0))*(G%2==0?1:-1)*(A?-1:1):0===G?0:((G+1)/2|0)*(G%2==0?1:-1)*(A?-1:1)}}return j}_addAttributeLayer(){return this._modules.graphics.addAttributeLayer({name:"curvature",priority:2,edgeDependencies:{parallelEdges:!0},edgeContext:this._context,edgeAttributes:{curvature:A=>this.computeCurvature(A)}})}},U0=function(){},V0=function(){},H0=function(){return!1},W0=function(A){return A},X0=function(){},jd="worker_start",Ud="worker_update",Vd="worker_stop",Gd=class extends Ls{constructor(A,w){super(),this._complete=!1,this._destroyed=!1,this._data=null,this._modules=w,this.configure(A)}configure(A){this._configure=A.configure||W0,this._update=A.update||V0,this._createContext=A.context||U0,this._isRunning=A.isRunning||H0,this._stop=A.stop||X0}setData(A){this._data=A}getData(){return this._data}start(A){return this._complete=!1,this.fire(jd,{target:this}),this.send(this._configure(A,this._modules)),this}stop(A){return this._complete||(this.send({type:Vd}),this._complete=!0),this}isBusy(){return!this._complete}destroy(){this._destroyed||(this._destroyed=!0,this._modules&&(this.stop(),delete this._modules))}},Hd=/^function\s*\(/,Wd=/^\(|^\w+\s?\=\>/;function dg(A){let w=A.toString();return 0===w.indexOf("function")||Wd.test(w)?w:`function ${w}`}var $d=class extends Gd{constructor(A,w){super(A,w);let T=dg(this._createContext),C=dg(this._update),k=dg(this._isRunning),N=dg(this._stop),O=`\n      ${function K0(A={}){let w=Object.keys(A),T=[];for(let C=0,k=w.length;C<k;C++){let k=w[C],N=A[k];if("function"!=typeof N)throw new Error(`Asynchronous worker: dependency "${k}" is not found`);{let A=Y0(N);A?(T.push(RA(N,k)),A!==k&&T.push(`var ${k} = ${A};`)):T.push(`var ${k} = ${RA(N,k)};`)}}return T.join("\n")}(A.imports)}\n      const __CONTEXT = (${T})();\n      const __UPDATE_FUNC = ${C} ;\n      const __IS_RUNNING_FUNC = ${k};\n      const __STOP_FN = ${N};\n      let result;\n\n      self.addEventListener("message", function (evt) {\n        if (evt.data && evt.data.type === '${Vd}') {\n          __STOP_FN(__CONTEXT);\n          return self.postMessage({ result, isRunning: false });\n        }\n        result = __UPDATE_FUNC(evt.data, __CONTEXT);\n        const isRunning = __IS_RUNNING_FUNC(__CONTEXT, evt.data);\n\n        self.postMessage({ result, isRunning });\n      });\n    `;this._worker=Ip(O),this._worker.addEventListener("message",(A=>{w.dom.isDestroyed()||this.onWorkerMessage(A)}))}onWorkerMessage(A){let w=A.data.isRunning,T=A.data.result,C={data:void 0};return this.fire(Ud,{worker:this,workerMessage:T,modules:this._modules,data:C,isRunning:w}),w?this.send(C.data):(this.fire(Vd,{worker:this,result:T,modules:this._modules}),this.stop(T))}destroy(){super.destroy(),this._worker.terminate()}send(A){return this._complete||this._worker.postMessage(Lp(A)),this}};function RA(A,w){let T=A.toString();return Hd.test(T)?`function ${A.name||w} ${T.substring(T.indexOf("("))}`:Wd.test(T)?`const ${A.name||w} = ${T.toString()}`:T}function Y0(A){let w=A.toString();return A.name?A.name:Hd.test(w)?null:w.substring(9,w.indexOf("(")).trim()}var qd=class extends Gd{constructor(A,w){super(A,w),this._context=this._createContext()}sync(A){if(A&&A.type===Vd)return this._stop(this._context);let w=this._update(A,this._context),T=this._isRunning(this._context,A),C={data:void 0};return this.fire(Ud,{worker:this,workerMessage:w,modules:this._modules,data:C,isRunning:T}),T?this.send(C.data):(this.fire(Vd,{worker:this,result:w,modules:this._modules}),this.stop(w))}send(A){return this._complete||this._modules.dom.setTimeout((()=>this.sync(A)),0),this}},Zd=class extends kt{constructor(){super(...arguments),this._pool={}}create(A,w){let T=w&&hs,C=this._modules,k=`${A.name||"worker"}-${T?"async":"sync"}`,N=this._pool[k];N||(N=this._pool[k]=[]);let O=N.find((A=>!A.isBusy()));return O?O.configure(A):(O=T?new $d(A,C):new qd(A,C),this._pool[k].push(O)),O.on(Vd,(()=>{O.clearEvents(),!(this._pool[k].length<2)&&(O.destroy(),this._pool[k]=this._pool[k].filter((A=>A!==O)))})),O}start(A,w){return A.start(w)}run(A,w,T){let C=this.create(A,T);return this.start(C,w)}destroy(){for(let A in this._pool)this._pool[A].forEach((A=>A.destroy())),delete this._pool[A]}};function Yl(A,w={},T=!0){T||(w.edges=void 0);let C=function q0(A,w,T,C=A.getNodes()){if(!w)return T?A.nodeList():C.filter((A=>null===A.getMetaNode()));if(!(w instanceof Gi)){if(Array.isArray(w)&&w.length>0)return A.getNodes(w);throw Error("[Layout]: 'nodes' must be a NodeList or an NodeId[]")}return w}(A,w.nodes,w.edges),k=function j0(A,w,T=A.getEdges()){if(!w)return T;if(!(w instanceof Yi)){if(Array.isArray(w)&&w.length>0)return A.getEdges(w);throw Error("[Layout]: 'edges' must be a EdgeList or a valid EdgeId[]")}return w}(A,w.edges,function Z0(A){if(!A.size)return;let w=new Set(A.getId());return A.getAdjacentEdges().filter((A=>A.getExtremities().getId().every((A=>w.has(A)))))}(C));return ke(re({},w),{nodes:C.concat(k.getExtremities()).dedupe(),edges:k})}var Qd=500,Jd=!0,eh=!0,th=!1,ih=class extends kt{constructor(){super(...arguments),this._running=[],this._textsHidden=!1,this._onWorkerUpdate=(A,w,T,C,k,N)=>{let{duration:O,onSync:j,onUpdate:G,dryRun:H,locate:W}=N;if(j&&this._modules.dom.setTimeout((()=>j(T,this._modules,C)),O),k){let j=k(T,this._modules,C);this._modules.events.fire("layoutComputed",{type:"layoutComputed",name:w,positions:j}),G&&G(T,j,C);let $=this._assignNodePositions(j,O,H);C||(W&&j&&this._animateCamera(j,W,N.duration),$.then((()=>A.fire("taskComplete",j))))}else C||A.fire("taskComplete",T)},this._onWorkerComplete=(A,w,T,C,k,N,O)=>{for(let w=0;w<this._running.length;w++)if(this._running[w]===A){this._running.splice(w,1);break}C.onEnd&&w&&C.onEnd(w,this._modules);let j=this._modules.graph.nodeList(new Uint32Array(O.indexes)),G=k.dryRun&&w?T:this.collectNodesData(j),H=j.getId(),W={before:F_(O),current:F_(G)};this._modules.events.fire("layoutEnd",{type:"layoutEnd",name:C.name,positions:W,ids:H}),this._modules.dom.setTimeout((()=>{k.onEnd&&k.onEnd(w),k.skipTextDrawing&&this._textsHidden&&(this._modules.graphics.showTexts(),this._textsHidden=!1),N({name:C.name,positions:W,ids:H})}))},this._onWorkerStart=(A,w,T)=>{w.skipTextDrawing&&!this._textsHidden&&(this._modules.graphics.hideTexts(),this._textsHidden=!0);let C=this._modules.graph.getNodes(w.nodes),k=this.collectNodesData(C),N=k.ids;T.setData(k),this._modules.events.fire("layoutStart",{type:"layoutStart",name:A.name,ids:N,worker:T})}}onMounted(){this._layouts={},this._modules.events.register(["layoutStart","layoutEnd","layoutComputed"]),this._modules.events.on("clearGraph",(()=>this.stop()))}register(A){if(this._layouts[A.name])throw new Error(`Layout ${A.name} already exists`);this._layouts[A.name]=A}getAvailableLayouts(){return Object.keys(this._layouts)}start(A,w={}){let T=this._layouts[A],C=Yl(this._modules.graph,w,-1===["radial","grid"].indexOf(A));return new Promise((w=>{if(!T)throw new Error(`layout ${A} does not exist`);C.duration="number"==typeof C.duration?C.duration:Qd;let k=T.onSync;C.skipTextDrawing=void 0===C.skipTextDrawing?!!Jd:!!C.skipTextDrawing;let N=C.locate||th;N&&"boolean"==typeof N&&(N={}),C.locate=N;let O={name:A,update:T.update,isRunning:T.isRunning,configure:T.configure,context:T.context,imports:T.imports,stop:T.stop};this._modules.graphics.forceAttributesComputation();let j=void 0===C.useWebWorker?!!eh:!!C.useWebWorker,G=this._modules.workers.create(O,j);G.on(jd,(()=>this._onWorkerStart(T,C,G))),G.on(Ud,(({workerMessage:w,isRunning:T})=>{let N=w.lastUpdate||-1/0,O=Ut();T&&(!C.continuous||O-N<16)||(w.lastUpdate=O,this._onWorkerUpdate(G,A,w,T,k,C))})),G.on(Vd,(({result:A})=>{G.once("taskComplete",(k=>{this._onWorkerComplete(G,A,k,T,C,w,G.getData())}))})),this._modules.workers.start(G,C),this._running.push(G)}))}_animateCamera(A,w,T){if(0===A.indexes.length)return Promise.resolve();let C=this._modules.locate.layoutDataBoundingBox(A),k=this._modules.locate.computeConfigForBounds(C,w);return this._modules.camera.setView(k,{duration:T,easing:w.easing,ignoreZoomLimits:!0})}stop(){for(;0!==this._running.length;){let A=this._running.pop();A.stop(),A.fire("taskComplete",null)}return Promise.resolve()}isRunning(){return 0!==this._running.length}_assignNodePositions(A,w,T){if(!A||T){let w=A?new Uint32Array(A.indexes):void 0,T=this._modules.graph.nodeList(w);return Promise.resolve(T)}let{indexes:C,x:k,y:N}=A,O=this._modules.graph.nodeList(new Uint32Array(C)),j=F_(A);for(let A=0;A<j.length;A++)j[A]={x:k[A],y:N[A]};return O.setAttributes(j,w)}collectNodesData(A){let w=A._indexes,T=this._modules.graph.getNodeAttribute("x").getMultiple(w),C=this._modules.graph.getNodeAttribute("y").getMultiple(w);return{ids:A.getId(),indexes:w,x:T,y:C}}};function F_({x:A,y:w,indexes:T}){let C=T.length,k=new Array(C);for(let T=0;T<C;T++)k[T]={x:A[T],y:w[T]};return k}function da(A){return"number"==typeof A&&isFinite(A)}var sh=class{constructor(A,w,{path:T,filter:C,unwindArrays:k}){this._module=A,this._isNode=w,this._path=T||[],this._filter=C,this._unwindArrays=k,this._onUpdateHandlers=[],this._triggerUpdate=A=>{for(let w=0;w<this._onUpdateHandlers.length;++w)this._onUpdateHandlers[w](A)},this._info=A.watchPropertyInformation(this._isNode,this._path,this._triggerUpdate,this._filter,this._unwindArrays)}onUpdate(A){this._onUpdateHandlers.push(A)}getPropertyInfo(){return this._info}getPath(){return this._path.slice()}destroy(){this._module.unwatchPropertyInformation(this._isNode,this._path,this._triggerUpdate,this._filter,this._unwindArrays)}},rh=class{constructor(A,w,{path:T,filter:C,unwindArrays:k}){this._module=A,this._isNode=w,this._path=T,this._filter=C,this._unwindArrays=k,this._propertyList=[],this._properties={},this._onAddHandlers=[],this._onRemoveHandlers=[],this._onUpdateHandlers=[]}get path(){return this._path}onPropertyAdded(A){return this._onAddHandlers.push(A),this}onPropertyRemoved(A){return this._onRemoveHandlers.push(A),this}onPropertyUpdated(A){return this._onUpdateHandlers.push(A),this}getPath(){return this._path.slice()}getProperties(){return this._propertyList.slice()}getPropertyInfo(A){let w=this._properties[A];return w?w.info:null}destroy(){cr(this._properties,(({handler:A},w)=>{let T=this._path.concat([w]);this._module.unwatchPropertyInformation(this._isNode,T,A,this._filter,this._unwindArrays)})),this._propertyList=[],this._properties={},this._onAddHandlers=[],this._onRemoveHandlers=[],this._onUpdateHandlers=[];let A=this._module._objectPropertyWatchers.indexOf(this);this._module._objectPropertyWatchers.splice(A,1)}updateSubPropertiesToWatch(A,w){if(A!==this._isNode)return;let T=w.getData(this._path);for(let A=0;A<T.length;A++){let w=T[A];if(wn(w)){let A=Object.keys(w);for(let w=0;w<A.length;w++)this._addSubPropertyToWatch(A[w])}}}_addSubPropertyToWatch(A){if(!this._properties[A]){let w=this._path.concat([A]),r=()=>this._triggerPropertyUpdate(A),T=this._unwindArrays,C=this._isNode,k=this._filter,N=this._module.watchPropertyInformation(C,w,r,k,T);this._properties[A]={handler:r,info:N},this._triggerPropertyUpdate(A)}}_triggerPropertyUpdate(A){let{info:w}=this._properties[A],T=this._propertyList.indexOf(A),C=-1!==T,k="undefined"!==w.getType();!C&&k?(this._propertyList.push(A),this._triggerHandlers("_onAddHandlers",A,w),this._triggerHandlers("_onUpdateHandlers",A,w)):C&&!k?(this._propertyList.splice(T,1),this._triggerHandlers("_onUpdateHandlers",A,w),this._triggerHandlers("_onRemoveHandlers",A,w)):C&&k&&this._triggerHandlers("_onUpdateHandlers",A,w)}_triggerHandlers(A,w,T){let C=this[A];for(let A=0,k=C.length;A<k;A++)C[A](w,T)}},oh=class{constructor(){}setWatcher(A){this._watcher=A}isNode(){return this._watcher.isNode}getPath(){return this._watcher.property.slice()}getBoundaries(){let A=this._watcher.boundaries;return A?{min:A.min,max:A.max}:null}getValues(){return this._watcher.values.keys()}getValueCount(A){return this._watcher.values.get(A)||0}getCount(){return this._watcher.total}getType(){return this._watcher.any>0?"any":this._watcher.numbers>0?"number":"undefined"}};function kA(A){return"number"==typeof A&&isNaN(A)}var ah=class{constructor(){this._keys=[],this._values=[]}set(A,w){let T=this._getIndex(A);return-1===T?(this._keys.push(A.slice()),this._values.push(w),!0):(this._values[T]=w,!1)}get(A){let w=this._getIndex(A);return-1===w?void 0:this._values[w]}has(A){return-1!==this._getIndex(A)}delete(A){let w=this._getIndex(A);return-1!==w&&(this._keys.splice(w,1),this._values.splice(w,1),!0)}keys(){return this._keys.map((A=>A.slice()))}values(){return this._values.slice()}_getIndex(A){for(let w=0;w<this._keys.length;w++){let T=this._keys[w];if(T.length===A.length){let C=!0;for(let w=0;w<A.length;w++){let k=T[w],N=A[w];if(!(k===N||kA(k)&&kA(N))){C=!1;break}}if(C)return w}}return-1}get size(){return this._keys.length}},lh=class{constructor(){this._map=new Map,this._arrays=new ah}clear(){return this._arrays=new ah,this._map.clear()}delete(A){return At(A)?this._arrays.delete(A):this._map.delete(A)}get(A){return At(A)?this._arrays.get(A):this._map.get(A)}set(A,w){return At(A)?this._arrays.set(A,w):this._map.set(A,w),this}keys(){return[...oo(this._map),...this._arrays.keys()]}values(){return[...Sr(this._map),...this._arrays.values()]}get size(){return this._map.size+this._arrays.size}},hh=class extends kt{constructor(){super(...arguments),this._onExcludedStateChange=({elements:A,value:w})=>{let T=!w;for(let w=0,C=this._propertyWatchers.length;w<C;w++){let C=this._propertyWatchers[w];C.isNode===A.isNode&&"visible"===C.filter&&(T?Zl(C,A.getData(C.property)):mg(C,A.getData(C.property)),cg(C))}},this._onDataChange=({isNode:A,changes:w})=>{for(let T=0;T<this._propertyWatchers.length;++T){let C=this._propertyWatchers[T],k=C.property,N="all"===C.filter;if(C.isNode===A)for(let A=0;A<w.length;++A){let T=w[A],O=eC(T.property||[],k);if(O){let A=T.nodes||T.edges,w=[],k=[];if(A)for(let C=0;C<A.size;++C){let j=A.get(C);(N||j.isVisible())&&(w.push(Tt(T.newValues[C],O)),k.push(Tt(T.previousValues[C],O)))}w.length&&(Zl(C,w),mg(C,k),cg(C))}}}for(let A=0,T=this._objectPropertyWatchers.length;A<T;A++){let T=this._objectPropertyWatchers[A],C=T.path;for(let A=0;A<w.length;++A){let{property:k,nodes:N,edges:O}=w[A],j=N||O;if(j){let A=j.isNode;(!k||k.length<=C.length+1&&C.every(((A,w)=>A===k[w])))&&T.updateSubPropertiesToWatch(A,j)}}}},this._onElementsAdded=A=>{let w=A.nodes||A.edges;for(let A=0;A<this._propertyWatchers.length;++A){let T=this._propertyWatchers[A];if(T.isNode===w.isNode){let A=w.getData(T.property);A.length&&(Zl(T,A),cg(T))}}for(let A=0;A<this._objectPropertyWatchers.length;A++)this._objectPropertyWatchers[A].updateSubPropertiesToWatch(w.isNode,w)},this._onElementsRemoved=A=>{let w=A.nodes||A.edges;for(let A=0;A<this._propertyWatchers.length;++A){let T=this._propertyWatchers[A],C="all"===T.filter;if(T.isNode===w.isNode&&C){let A=w.getData(T.property);A.length&&(mg(T,A),cg(T))}}},this._onGraphClear=()=>{this._propertyWatchers.forEach((A=>{A.numbers=0,A.any=0,A.total=0,A.boundaries=null,A.values.clear()}))}}onMounted(){this._propertyWatchers=[],this._objectPropertyWatchers=[],this._modules.events.on("excludedStateChange",this._onExcludedStateChange).on(["updateNodeData","updateEdgeData"],this._onDataChange).on(["addNodes","addEdges"],this._onElementsAdded).on(["removeNodes","removeEdges"],this._onElementsRemoved).on("clearGraph",this._onGraphClear)}watchNodeObjectProperty(A){return this._watchObjectProperty(!0,hg(A))}watchEdgeObjectProperty(A){return this._watchObjectProperty(!1,hg(A))}watchNodeNonObjectProperty(A){return this._watchNonObjectProperty(!0,hg(A))}watchEdgeNonObjectProperty(A){return this._watchNonObjectProperty(!1,hg(A))}watchPropertyInformation(A,w,T,C,k){let N=this._findWatcher(A,w,C,k)||this._createWatcher(A,w,C,k);return T&&N.onChange.push(T),N.info}unwatchPropertyInformation(A,w,T,C,k){let N=this._findWatcher(A,w,C,k);if(!N)return;let O=N.onChange,j=O.indexOf(T);if(-1!==j&&(O.splice(j,1),0===O.length)){let A=this._propertyWatchers.indexOf(N);this._propertyWatchers.splice(A,1)}}_watchObjectProperty(A,w){let T=new rh(this,A,w);return this._objectPropertyWatchers.push(T),T.updateSubPropertiesToWatch(A,this._modules.graph[A?"getNodes":"getEdges"](w.filter)),T}_watchNonObjectProperty(A,w){return new sh(this,A,w)}_findWatcher(A,w,T,C){for(let k=0;k<this._propertyWatchers.length;++k){let N=this._propertyWatchers[k];if(N.isNode===A&&N.filter===T&&N.unwindArrays===C&&J0(N.property,w))return N}return null}_createWatcher(A,w,T,C){let k={isNode:A,property:w,numbers:0,any:0,total:0,values:new lh,boundaries:null,onChange:[],filter:T,unwindArrays:C,info:new oh};return k.info.setWatcher(k),Zl(k,this._modules.graph[A?"getNodes":"getEdges"](T).getData(w)),this._propertyWatchers.push(k),k}};function BA(A){return null==A?[]:Br(A)}function Q0(A){return"all"===A?"all":"visible"}function cg(A){for(let w=0;w<A.onChange.length;++w)A.onChange[w](A.info)}function J0(A,w){if(A.length!==w.length)return!1;for(let T=0;T<A.length;++T)if(A[T]!==w[T])return!1;return!0}function eC(A,w){if(A.length>w.length)return null;let T=0;for(;T<A.length;++T)if(A[T]!==w[T])return null;return w.slice(T)}function Zl(A,w,T){let C=A.values,k=!T&&A.unwindArrays;for(let N=0;N<w.length;++N){let O=w[N];if(!T&&void 0!==O&&(A.total+=1),k&&Array.isArray(O))Zl(A,O,!0);else{let w=C.get(O);w?C.set(O,w+1):(C.set(O,1),da(O)?(A.boundaries?O<A.boundaries.min?A.boundaries.min=O:O>A.boundaries.max&&(A.boundaries.max=O):A.boundaries={min:O,max:O},A.numbers+=1):void 0!==O&&(A.any+=1))}}}function mg(A,w,T){let C=A.values,k=!T&&A.unwindArrays,N=A.boundaries,O=!1;for(let j=0;j<w.length;++j){let G=w[j];if(!T&&void 0!==G&&(A.total-=1),k&&Array.isArray(G))O=O||mg(A,G,!0);else{let w=C.get(G);w>1?C.set(G,w-1):(C.delete(G),da(G)?(A.numbers-=1,N&&(N.min===G||N.max===G)&&(O=!0)):void 0!==G&&(A.any-=1))}}return!T&&O&&(A.boundaries=function tC(A){let w=null,T=null;for(let C=0;C<A.length;++C){let k=A[C];da(k)&&((null==w||k<w)&&(w=k),(null==T||k>T)&&(T=k))}return null==w||null==T?null:{min:w,max:T}}(C.keys())),O}function hg(A){return"object"!=typeof A||null===A||Array.isArray(A)?{path:BA(A),filter:"visible",unwindArrays:!1}:{path:BA(A.path),filter:Q0(A.filter||"visible"),unwindArrays:!!A.unwindArrays}}var gh=class extends kt{onMounted(){this._modules.events.register(["virtualDown","virtualUp","virtualMove","virtualClick","virtualDoubleClick","virtualWheel"])}get x(){return this._modules.position.x||0}get y(){return this._modules.position.y||0}_later(){return this._modules.dom.afterNextFrame()}move({x:A,y:w}){return void 0!==A&&void 0!==w?this._modules.dom.afterNextFrame().then((()=>{let T=A-this.x,C=w-this.y;return this._modules.events.fire("virtualMove",{x:A,y:w,dx:T,dy:C}),this._later()})):Promise.resolve()}down({x:A,y:w,button:T="left"}={}){return this.move({x:A,y:w}).then((()=>(this._modules.events.fire("virtualDown",{x:this.x,y:this.y,button:T}),this._modules.events.fire("virtualMove",{x:this.x,y:this.y,dx:0,dy:0,button:T}),this._later())))}up({x:A,y:w,button:T="left"}={}){return this.move({x:A,y:w}).then((()=>(this._modules.events.fire("virtualUp",{x:A,y:w,button:T}),this._later())))}click({x:A,y:w,button:T="left"}={}){return this.move({x:A,y:w}).then((()=>(this._modules.events.fire("virtualClick",{x:A,y:w,button:T}),this._later())))}rightClick({x:A,y:w,button:T="right"}={}){return this.move({x:A,y:w}).then((()=>(this._modules.events.fire("virtualClick",{x:A,y:w,button:T}),this._later())))}doubleclick({x:A,y:w,button:T="left"}={}){return this.move({x:A,y:w}).then((()=>(this._modules.events.fire("virtualDoubleClick",{x:A,y:w,button:T}),this._later())))}drag(A,w){return this.down(A).then((()=>this.move(w))).then((()=>this.up(w)))}wheel({x:A,y:w,delta:T}){return this.move({x:A,y:w}).then((()=>(this._modules.events.fire("virtualWheel",{x:A,y:w,delta:T}),this._later())))}};function wr(A,w,T,C,k,N){let O=Ye(),j=N.graphToScreenCoordinates(A),G=N.graphToScreenCoordinates(w);k.beginPath(),k.moveTo(j.x*O,j.y*O),k.lineTo(G.x*O,G.y*O),k.strokeStyle=C,k.lineWidth=T,k.stroke()}function M_(A,w,T,C){let k,N,O,j=0,G=A.length-1;for(;j<G&&j>-1;)if(k=(j+G)/2|0,N=Math.abs(w[A[k]]-T),O=Math.abs(w[A[k+1]]-T),O<N)j=k+1;else if(O>N)G=k;else{let C=Math.abs(w[A[j]]-T),N=Math.abs(w[A[G]]-T);if(C<N)G=k;else{if(!(C>N))return G;j=k+1}}return C?G:A[G]}function k_(A,w,T,C,k,N,O){let j,G,H,W,$,Z;for(let se=0,ue=A.length;se<ue;se++)for(let ge=0;ge<ue;ge++){if(se===ge)continue;let ue=A[se],ce=A[ge];ge<se&&(W=ce,ce=ue,ue=W);let _e=w[ue],me=w[ce],pe=N.get(ue),be=N.get(ce);if(_e+pe<C-k&&me-be>C+k&&Math.abs(Math.abs(_e+pe-(C-k))-Math.abs(me-be-(C+k)))<=O)return j=ue,G=T,H=ce,Z=_e+pe+Math.abs(me-be-(_e+pe))/2,$=[_e+pe,Z-k,Z+k,me-be],{a:j,b:G,c:H,current:T,target:Z,points:$};if(_e+pe<C-k&&me+be<C-k&&Math.abs(Math.abs(_e+pe-(me-be))-Math.abs(Math.max(_e+pe,me+be)-(C-k)))<=O)return j=ue,G=ce,H=T,Z=me+pe+Math.abs(Math.abs(_e+pe-(me-be)))+k,$=[_e+pe,me-be,me+be,Z-k],{a:j,b:G,c:H,current:T,target:Z,points:$};if(_e-pe>C+k&&me-be>C+k&&Math.abs(Math.abs(_e+pe-(me-be))-Math.abs(Math.min(_e-pe,me-be)-(C+k)))<=O)return j=T,G=ue,H=ce,Z=_e-pe-Math.abs(Math.abs(_e+pe-(me-be)))-k,$=[Z+k,_e-pe,_e+pe,me-be],{a:j,b:G,c:H,current:T,target:Z,points:$}}return null}var _h={enabled:!1,tolerance:5,centerSnapDistance:240,sideSnapDistanceFactor:3,guidelineWidth:1,guidelineColor:"#ff0000",preferredDistance:{enabled:!0,ratio:1.13,tolerance:10,lineColor:"#00C3FF",lineWidth:1},neighbours:{enabled:!0,offset:5,tolerance:3,lineColor:"#00C3FF",lineWidth:1}},mh=class extends kt{constructor(){super(...arguments),this._options=nt(_h),this._enabled=!1,this._ysnap=0,this._xsnap=0,this._node=null,this._nodes=null,this._r=0,this._vguideline={start:{x:0,y:0},end:{x:0,y:0}},this._hguideline={start:{x:0,y:0},end:{x:0,y:0}},this._gridResolution=0,this._onNodeDragStart=({nodes:A})=>{1===A.size&&(this._node=A.get(0),this._cacheViewportData(),this._r=Number(this._node.getAttribute("radius")))},this._onNodeDragEnd=()=>{this._node=null,this._layer.refresh()}}onMounted(){this._options=nt(_h),this._enabled=!1}enable(A){this._enabled||(this._options=Ft(A,_h),this._enabled=!0,this._layer=this._modules.layers.addCanvasLayer((A=>{A.clearRect(0,0,A.canvas.width,A.canvas.height)}),{isStatic:!0,noClear:!1}),this._layer.moveToTop(),this._modules.events.on("nodesDragStart",this._onNodeDragStart).on("nodesDragEnd",this._onNodeDragEnd),this._modules.settings.update({"interactions.drag.onBeforeDrag":(A,w,T,C)=>this._onBeforeDrag(w,T,C)}))}disable(){!this._enabled||(this._modules.events.off(this._onNodeDragStart).off(this._onNodeDragEnd),this._layer.destroy(),this._modules.settings.update({"interactions.drag.onBeforeDrag":null}),this._enabled=!1)}enabled(){return this._enabled}_onBeforeDrag(A,w,T){if(this._node){let A=T[0];this._layer.refresh((w=>{this._scan(w,A)})),this._node.setAttributes(A)}}_cacheViewportData(){let A=this._modules.camera,w=A.screenToGraphCoordinates({x:0,y:0}),T=A.screenToGraphCoordinates({x:A.width,y:A.height});if(this._nodes=this._modules.spatial.getNodesByBoundingBox(w.x,w.y,T.x,T.y),null==this._node)return;let C=this._node._index,k=Array.from(this._nodes._indexes);k.splice(k.indexOf(C),1);let N=this._modules.graph.getNodeAttribute("radius"),O=this._modules.graph.getNodeAttribute("x"),j=this._modules.graph.getNodeAttribute("y"),G=O.buffer(),H=j.buffer(),W=Ho(k.slice(),O),$=Ho(k.slice(),j),Z={},se={},ue={},ge={};this._gridResolution=Number(this._node.getAttribute("radius"));let ce=this._gridResolution;for(let A=0,w=k.length;A<w;A++){let w=W[A],T=$[A],C=G[w]/ce|0,k=H[T]/ce|0;Z[C]||(Z[C]=[]),se[k]||(se[k]=[]),Z[C].push(w),se[k].push(T),ue[w]=ge[T]=A}this._nodesByX=W,this._nodesByY=$,this._xGrid=Z,this._yGrid=se,this._xList=O,this._yList=j,this._X=G,this._Y=H,this._R=N}_scan(A,w){if(null==this._node)return;let T,C,k,N,O,j,G,H,W=this._node._index,$=w.x,Z=w.y,se=this._r,ue=this._options,ge=this._xList,ce=this._yList,_e=this._R,me=this._X,pe=this._Y,be=this._modules.camera.zoom,Se=Math.min(se,this._options.tolerance/be),Ee=2*se*ue.sideSnapDistanceFactor,Te=ue.guidelineWidth,Ce=ue.guidelineColor,Ie=W,ze=W,Pe=null,Re=!1,Ue=!1;if(Ie=M_(this._nodesByX,me,$),ze=M_(this._nodesByY,pe,Z),Math.abs(me[Ie]-$)>ue.centerSnapDistance&&(Ie=W),Math.abs(pe[ze]-Z)>ue.centerSnapDistance&&(ze=W),this._xsnap=0,Ie!==W){T=this._vguideline.start,C=this._vguideline.end,H=Ie,k=me[H],N=pe[H],Pe=_e.get(H),G=Math.abs($-k);let w=Math.abs($-se-(k-Pe)),O=Math.abs($+se-(k+Pe));if(G<Math.max(se,Pe)){N<Z?(T.y=N-Pe,C.y=Z+se):(T.y=N+Pe,C.y=Z-se);let A=Math.min(w,G,O);A===G?(T.x=C.x=k,C.y=Z,T.y=N,this._xsnap=1):Math.abs(Z-N)<Pe+se+Ee&&(A===w?(T.x=C.x=k-Pe,this._xsnap=2):(T.x=C.x=k+Pe,this._xsnap=3)),A<Se&&(Re=!0)}0!==this._xsnap&&wr(T,C,Te,Ce,A,this._modules.camera)}if(this._ysnap=0,ze!==W){T=this._hguideline.start,C=this._hguideline.end,H=ze,k=me[H],N=pe[H],Pe=_e.get(H),G=Math.abs(Z-N);let w=Math.abs(Z-se-(N-Pe)),O=Math.abs(Z+se-(N+Pe));if(G<Math.max(se,Pe)){k<$?(T.x=k-Pe,C.x=$+se):(T.x=k+Pe,C.x=$-se);let A=Math.min(w,G,O);A===G?(T.y=C.y=N,C.x=$,T.x=k,this._ysnap=1):Math.abs($-k)<Pe+se+Ee&&(A===w?(T.y=C.y=N-Pe,this._ysnap=4):(T.y=C.y=N+Pe,this._ysnap=5)),A<Se&&(Ue=!0)}0!==this._ysnap&&wr(T,C,Te,Ce,A,this._modules.camera)}if(null!=Pe&&ue.preferredDistance.enabled){let w=ue.preferredDistance.ratio,G=Math.min(ue.preferredDistance.tolerance/be,se),ge=Math.max(se,Pe);if(Ie===W||0!==this._xsnap&&Re){if(ze!==W&&(0===this._ysnap||!Ue)&&(H=ze,k=me[H],N=pe[H],Pe=_e.get(H),j=Math.abs(Z-N)-(se+Pe)*(1+w),j<=G&&j>=-G)){let O=Z<N?-1:1;T=this._hguideline.start,C=this._hguideline.end,T.x=k-ge,C.x=k+ge,T.y=C.y=N,wr(T,C,Te,Ce,A,this._modules.camera),T.x=$-ge,C.x=$+ge,T.y=C.y=N+O*(1+w)*(se+Pe),wr(T,C,Te,Ce,A,this._modules.camera),this._ysnap=1,Ue=!0}}else if(H=Ie,k=me[H],N=pe[H],Pe=_e.get(H),O=Math.abs($-k)-(se+Pe)*(1+w),O<=G&&O>=-G){let O=$<k?-1:1;T=this._vguideline.start,C=this._vguideline.end,T.x=C.x=k+O*(1+w)*(se+Pe),T.y=N-ge,C.y=N+ge,T.x=C.x=k,wr(T,C,Te,Ce,A,this._modules.camera),T.y=Z-ge,C.y=Z+ge,T.x=C.x=k+O*(1+w)*(se+Pe),wr(T,C,Te,Ce,A,this._modules.camera),this._xsnap=1,Re=!0}}if(ue.neighbours.enabled){let T,C=this._gridResolution,k=$/C|0,N=Z/C|0,O=this._xGrid,j=this._yGrid,G=[],H=[].concat(j[N-1]||G,j[N]||G,j[N+1]||G),ue=[].concat(O[k-1]||G,O[k]||G,O[k+1]||G);H.length>1&&(Ho(H,ge),T=k_(H,me,W,$,se,_e,Se),T&&(this._drawNeighbourGuidelines(A,T,w,!1),Re=!1)),ue.length>1&&!T&&(Ho(ue,ce),T=k_(ue,pe,W,Z,se,_e,Se),T&&(this._drawNeighbourGuidelines(A,T,w,!0),Ue=!1))}(Re||Ue)&&this._snap(w,!Re,!Ue)}_drawNeighbourGuidelines(A,{a:w,b:T,c:C,points:k,target:N},O,j){let G,H,W={x:0,y:0},$={x:0,y:0},Z=this._R,se=this._X,ue=this._Y,[ge,ce,_e]=Z.getMultiple([w,T,C]),{offset:me,lineWidth:pe,lineColor:be}=this._options.neighbours;j?(O.y=N,ge=-ge,ce=-ce,_e=-_e,G=$.x=W.x=Math.min(se[w]+ge,se[T]+ce,se[C]+_e)-me,H=se):(O.x=N,G=$.y=W.y=Math.max(ue[w]+ge,ue[T]+ce,ue[C]+_e)+me,H=ue);let Se=j?"y":"x",Ee=j?"x":"y";W[Se]=k[0],$[Se]=k[1],wr(W,$,pe,be,A,this._modules.camera),W[Se]=k[2],$[Se]=k[3],wr(W,$,pe,be,A,this._modules.camera),W[Se]=k[0],W[Ee]=G-me/2,$[Se]=k[0],W[Ee]=H[w]+ge,wr(W,$,pe,be,A,this._modules.camera),W[Se]=k[1],W[Ee]=G-me/2,$[Se]=k[1],W[Ee]=H[T]+ce,wr(W,$,pe,be,A,this._modules.camera),W[Se]=k[2],W[Ee]=G-me/2,$[Se]=k[2],W[Ee]=H[T]+ce,wr(W,$,pe,be,A,this._modules.camera),W[Se]=k[3],W[Ee]=G-me/2,$[Se]=k[3],W[Ee]=H[C]+_e,wr(W,$,pe,be,A,this._modules.camera)}_snap(A,w,T){let C,k=this._xsnap,N=this._ysnap;!w&&0!==k&&(C=this._vguideline.end,A.x=2===k?C.x+this._r:3===k?C.x-this._r:C.x),!T&&0!==N&&(C=this._hguideline.end,A.y=4===N?C.y+this._r:5===N?C.y-this._r:C.y)}},fh=class{constructor(A,w,T){this._module=A,this._id=w,this._whenApplied=T.then((()=>this))}getId(){return this._id}whenApplied(){return this._whenApplied}refresh(){return this._module.refreshRule(this._id)}getIndex(){return this._module.getRuleIndex(this._id)}setIndex(A){return this._module.setRuleIndex(this._id,A)}update(A){return this._module.updateRule(this._id,A)}getDefinition(){return this._module.getRuleDefinition(this._id)}destroy(){return this._module.destroyRule(this._id)}},ph=class extends kt{constructor(){super(...arguments),this._idCounter=1,this._rules=[]}onMounted(){this._rules=[],this._modules.events.register(["addStyleRule","removeStyleRule","updateStyleRule"])}_get(A){for(let w=0;w<this._rules.length;++w){let T=this._rules[w];if(T.id===A)return T.index=w,T}throw new Error("calling a method on a destroyed style rule")}_updatePriorities(){for(let A=0;A<this._rules.length;++A){let w=3+.001*A;this._rules[A].attributeLayer.update({priority:w})}}addRule(A={}){let w=this._idCounter++,T=this._modules.graphics.addAttributeLayer(re({name:`rule(${w})`},G_(A))),C=this._modules.dom.afterNextFrame(),k=new fh(this,w,C),N={id:w,attributeLayer:T,wrapper:k};return this._rules.push(N),this._updatePriorities(),this._modules.events.fire("addStyleRule",{rule:N,options:A}),k}getRuleIndex(A){let w=this._get(A);return null==w.index?null:w.index}setRuleIndex(A,w){let T=this._get(A),C=Vt(w,0,this._rules.length-1);return this._rules.splice(T.index,1),this._rules.splice(C,0,T),this._updatePriorities(),this._modules.dom.afterNextFrame()}updateRule(A,w){let T=this._get(A),C=Object.assign({fullOverwrite:w.fullOverwrite},G_(w));return T.attributeLayer.update(C),this._modules.events.fire("updateStyleRule",{rule:T,options:w}),this._modules.dom.afterNextFrame()}getRuleDefinition(A){return G_(this._get(A).attributeLayer.getDefinition())}destroyRule(A){let w=this._get(A);return this._modules.events.fire("removeStyleRule",{rule:w}),w.attributeLayer.destroy(),this._rules.splice(w.index,1),this._modules.dom.afterNextFrame()}refreshRule(A){return this._get(A).attributeLayer.updateAll(),this._modules.dom.afterNextFrame()}refreshAllRules(){for(let A=0;A<this._rules.length;A++)this._rules[A].attributeLayer.updateAll();return this._modules.dom.afterNextFrame()}getRuleList(){return this._rules.map((A=>A.wrapper))}};function G_(A){return{nodeAttributes:A.nodeAttributes,edgeAttributes:A.edgeAttributes,nodeSelector:A.nodeSelector,edgeSelector:A.edgeSelector,nodeDependencies:A.nodeDependencies,edgeDependencies:A.edgeDependencies,nodeOutput:A.nodeOutput,edgeOutput:A.edgeOutput}}var xh,bh={strokeColor:"#00C3FF",fillColor:"rgba(0,195,255,0.1)",strokeWidth:1,cursorStyle:"cell",callback:({nodes:A})=>A.setSelected(!0),bothExtremities:!1},Sh=class extends kt{constructor(){super(...arguments),this._enabled=!1,this._points=[],this._bbox=new ws,this._onStart=({x:A,y:w})=>{this._bbox.reset(),this.savePoint(A,w,!1)},this._onStop=()=>{let{minX:A,minY:w,maxX:T,maxY:C}=this._bbox,{nodes:k,edges:N}=this._modules.spatial.queryProjected(A,w,T,C),O={},j=k.filter((A=>{let w=A.isVisible(),T=A.getAttribute("detectable"),C=w&&T&&this._modules.locate.isNodeInPolygon(A,this._points);return O[A._index]=C,C})),G=N.filter((A=>{let w=A.isVisible(),T=A.getAttribute("detectable");return w&&T&&this._modules.locate.isEdgeInPolygon(A,this._points)}));this._options.bothExtremities&&(G=this.filterByExtremities(G,O)),this._layer.clear(),this._points=[],this.disable(),this._options.callback({nodes:j,edges:G})}}onMounted(){this._options=nt(bh),this._cachedCursor="",this._modules.events.isRegistered("lassoEnabled")||this._modules.events.register(["lassoEnabled","lassoDisabled"]),this._interaction=this._modules.interactions.onDrag({priority:"lasso",check:()=>this._enabled,onStart:this._onStart,onProgress:({x:A,y:w})=>this.savePoint(A,w,!0),onStop:this._onStop})}enable(A={}){var w;return this._enabled||(this._enabled=!0,this._modules.captor.setDetectionEnabled(!1),this._options=Ft(A,bh),this._layer=this._modules.layers.addCanvasLayer(Ze,{isStatic:!0,noClear:!1}),this._layer.moveToTop(),this._cachedCursor=(null==(w=this._layer.element.parentElement)?void 0:w.style.cursor)||"",Qo(this._layer.element.parentElement,this._options.cursorStyle),this._modules.captor.isLeftPressed()&&this._interaction.start(this._modules.captor.getCursorPosition()),this._modules.events.fire("lassoEnabled")),this}disable(){return this._enabled?(this._enabled=!1,this._modules.captor.setDetectionEnabled(!0),Qo(this._layer.element.parentElement,this._cachedCursor),this._layer.destroy(),this._modules.events.fire("lassoDisabled"),this):this}enabled(){return this._enabled}savePoint(A,w,T){let C=Ye(),k=this._options,N=this._points;if(this._bbox.addPoint(A,w),N.push({x:A,y:w}),T){let A=N[0];this._layer.refresh((w=>{w.lineWidth=k.strokeWidth,w.lineJoin="bevel",w.strokeStyle=k.strokeColor,w.fillStyle=k.fillColor,w.beginPath(),w.moveTo(A.x*C,A.y*C);for(let A=1;A<N.length;++A){let T=N[A];w.lineTo(T.x*C,T.y*C)}w.stroke(),k.fillColor&&w.fill()}))}}filterByExtremities(A,w){let T=this._modules.graph.getEdgeAttribute("source"),C=this._modules.graph.getEdgeAttribute("target");return A.filter((A=>{let k=A._index,N=T.get(k),O=C.get(k);return w[N]&&w[O]}))}},wh={strokeColor:"#00C3FF",fillColor:"rgba(0,195,255,0.1)",strokeWidth:1,cursorStyle:"cell",callback:({nodes:A,edges:w})=>{A.size?A.setSelected(!0):w.setSelected(!0)},bothExtremities:!1},Ch=class extends Sh{constructor(){super(...arguments),this._onStart=({x:A,y:w})=>{var T;this._rectangle.reset(),this._start={x:A,y:w},null==(T=this._layer)||T.refresh((A=>{A.fillStyle=this._options.fillColor,A.strokeStyle=this._options.strokeColor,A.lineWidth=this._options.strokeWidth}))},this._onStop=()=>{var A;let w=this._modules.captor.getCursorPosition(),T=this._formatRectangle(w),{nodes:C,edges:k}=this._modules.spatial.queryProjected(T.minX,T.minY,T.maxX,T.maxY),N={},O=C.filter((A=>{let w=A.isVisible(),C=A.getAttribute("detectable"),k=w&&C&&this._modules.locate.isNodeInRectangle(A,T);return N[A._index]=k,k})),j=k.filter((A=>{let w=A.isVisible(),C=A.getAttribute("detectable");return w&&C&&this._modules.locate.isEdgeInRectangle(A,T)}));this._options.bothExtremities&&(j=this.filterByExtremities(j,N)),null==(A=this._layer)||A.clear(),this.disable(),this._options.callback({nodes:O,edges:j})}}onMounted(){this._options=nt(wh),this._enabled=!1,this._rectangle=new ws,this._interaction=this._modules.interactions.onDrag({priority:"lasso",disableDetection:!0,check:()=>this._enabled,onStart:this._onStart,onProgress:({x:A,y:w})=>this._refreshRectangle({x:A,y:w}),onStop:this._onStop})}enable(A){return super.enable(Ft(A,wh))}_formatRectangle(A){let w=this._start.x,T=this._start.y,C=A.x,k=A.y,N=Math.abs(w-C),O=Math.abs(T-k),j=w<C?w:C,G=T<k?T:k;return this._rectangle.reset().addPoint(j,G).addPoint(j+N,G+O)}_refreshRectangle(A){var w;let{minX:T,minY:C,width:k,height:N}=this._formatRectangle(A),O=Ye();null==(w=this._layer)||w.refresh((A=>{A.strokeRect(T*O,C*O,k*O,N*O),this._options.fillColor&&A.fillRect(T*O,C*O,k*O,N*O)}))}},Lh=0,kh=0,Mh=-1;function gg(A,w,T,C){Lh=A,xh=T,kh=w?1:0,Mh=C}var H_=(A,w,T,C)=>k=>{let{rects:N,bboxes:O,intersects:j,indexToLayer:G,indexToRemoveNodeText:H,indexToRemoveEdgeText:W}=C;if(O[6*k+5]===Lh&&O[6*k+4]===T)return!1;let $=5*k,Z=Qn(N[$],N[$+1],N[$+2],N[$+3],N[$+4]);if(Wf(xh,Z)){if(C.realIntersection=!0,Mh<=0&&j.push(xh,Z),!(w||G[O[6*k+5]]<Mh))return!0;A.remove(k),C.realIntersection=!1,O[6*k+4]===kh?H[O[6*k+5]]=!0:W[O[6*k+5]]=!0}return!1},Ih={left:-1,right:1,top:0,bottom:0,center:0},Nh={left:0,right:0,top:-1,bottom:1,center:0},Fh={left:-1,right:0,top:-.5,bottom:-.5,center:-.5},zh={left:-.5,right:-.5,top:-1,bottom:0,center:-.5},uC=(A,w,T,C,k,N,O)=>{let{lines:j,data:G}=((A,w,T)=>uh(w,T.get(A))||{lines:0,data:[" "],maxLength:1})(A,w,C),H=T(G[0],k,N,O).width;for(let A=1;A<j;A++)H=Math.max(H,T(G[A],k,N,O).width);return[H,j*O*1]},HA=(A,w,T)=>{let C=w.text.content,k=w.radius,N=w.text.scaling,O=w.text.position,j=w.text.padding,G=w.text.scale,H=w.text.size,W=w.text.style,$=w.text.font,Z=w.text.maxLineLength,se=w.text.margin,ue=C.get(A),ge=k.get(A),ce=!N.get(A),_e=O.get(A),me=j.get(A),pe=G.get(A),be=1*(ce?H.get(A):pe*ge*2),Se=W.get(A),Ee=$.get(A),Te=me+se.get(A),Ce=Ih[_e],Ie=Nh[_e],[ze,Pe]=uC(A,`${ue}`,T,Z,Ee,Se,be);return[Fh[_e]*ze,zh[_e]*Pe,Ce*Te,Ie*Te,Ce*ge,Ie*ge,ze,Pe,ze/2,Pe/2]};var Ph={x1:0,y1:0,x2:0,y2:0},Rh={x:0,y:0},Oh={x:0,y:0},Bh=Math.PI/2;function WA(A,w,T="#22ff00"){return Y_([[A[0],A[1]],[A[2],A[1]],[A[2],A[3]],[A[0],A[3]]].map((A=>({x:A[0],y:A[1]}))),w,T)}function Y_(A,w,T="#ff0000"){w.strokeStyle=T,w.beginPath();for(let T=0,C=A.length;T<C;T++)0===T?w.moveTo(A[T].x,A[T].y):w.lineTo(A[T].x,A[T].y);w.closePath(),w.stroke()}var jh=["x","y","radius","width","layer","text.content","text.minVisibleSize","text.size","text.scale","text.scaling","text.padding","text.margin","text.position","text.style"].reduce(((A,w)=>(A.add(w),A)),new Set),Vh=class extends kt{constructor(A,w){super(A),this._textBBoxes=[],this._rects=[],this._enabled=!1,this._geoEnabled=!1,this._intersects=[],this._textDisplacement={},this._textDisplacementUpdate={},this._output={remove:{nodes:[],edges:[]},redraw:{nodes:[],edges:[]},rects:this._rects,bboxes:this._textBBoxes,intersects:this._intersects,realIntersection:!1,indexToLayer:{},byLayer:[],indexToRedrawEdgeText:{},indexToRemoveEdgeText:{},indexToRedrawNodeText:{},indexToRemoveNodeText:{},indexToQuadIndex:{}},this._onZoomStart=Va((({startZoom:A,endZoom:w})=>{this._enabled&&w<A&&this._updateLabels(this._modules.camera.clone({zoom:w}))}),80),this._onAttributesChanged=A=>{if([...A.edgeAttributes,...A.nodeAttributes].some((A=>jh.has(A)))){let w=A.nodes._indexes;for(let A=0;A<w.length;A++)this._textDisplacementUpdate[w[A]]=!0;this._update()}},this._onItemsAdded=A=>{let w=A.nodes||A.edges;(this._enabled||this._forceEnabled)&&this._modules.settings.get("texts.preventOverlap")&&this._modules.graphics.setTextHidden(w,!0)},this._onToggle=A=>(A?this._update():this._reset(),this),this._update=()=>{(this._enabled||this._forceEnabled)&&this._updateDebounced()},this._toggleDebug=A=>{A?this._modules.layers.whenReady((()=>{this._layer=this._modules.layers.addCanvasLayer((A=>{A.lineWidth=1/this._modules.camera.getZoom(),function XA(A,w,T,C,k){for(let T=0,C=w.length;T<C;T+=6)WA(w.slice(T,T+4),A,"#aaaaaa");for(let w=0;w<T.length;w+=5)Y_(Qn(T[w],T[w+1],T[w+2],T[w+3],T[w+4]),A,"green");let N=[k.root],O=k.root;for(;O=N.pop();)O.leaf||N.push.apply(N,O.children),WA(k.getNodeBounds(O),A,"rgba(0,0,0,0.2)"),O=N.pop();C.forEach((w=>Y_(w,A,"red")))}(A,this._textBBoxes,this._rects,this._intersects,this._quadtree)}),{isStatic:!1,noClear:!1}),this._layer.moveToTop(),this._canvas=this._layer.element,this._ctx=this._canvas.getContext("2d"),this._update()})):this._canvas&&(this._layer.destroy(),this._canvas=this._ctx=null)},this._measureText=(A,w,T,C)=>this._engine.measureText(A,w,T,C),this._textDisplacement={},this._textDisplacementUpdate={},this._quadtree=new kl((A=>{let w=6*A;return this._textBBoxes.slice(w,w+6)}),1),w.forceEnableTextOverlapRemoval&&this.forceEnable()}onMounted(){this._engine=this._modules.graphics.getGraphicsEngine(),this._modules.events.register(["labelCollisionsRemoved"]),this.setRate(200),this._modules.settings.register("texts.preventOverlap",!0,this._onToggle),this._modules.settings.register("texts.debug",!1,this._toggleDebug),this._modules.settings.register("texts.removalStrategy","topDown");let A=this._output;this._nodeTraversal=H_(this._quadtree,!1,1,A),this._edgeTraversal=H_(this._quadtree,!1,0,A),this._modules.events.on(["addNodes","addEdges"],this._onItemsAdded).on("layoutEnd",(()=>this._updateLabels())).on(["viewChanged","mouseover","mouseout"],this._update).on("updateAttributes",this._onAttributesChanged).on("setContainer",(({element:A})=>{if(A)return this._enable();this._disable()})).on("zoomStart",this._onZoomStart).on("viewExportStart",(({preventOverlap:A,camera:w})=>{!A||this.forceUpdate(w)})).on("viewExportEnd",(()=>{this.forceUpdate()})).on("geoEnabled",(()=>this._geoEnabled=!0)).on("geoDisabled",(()=>this._geoEnabled=!1))}getTextsBoundingBox(A,w){A||w?this._updateLabels(this._modules.camera,A?Array.from(A._indexes):[],w?Array.from(w._indexes):[]):this._updateLabels();let T=this._rects,C=new ws;for(let A=0;A<T.length;A+=5){let w=T[A],k=T[A+1],N=T[A+2],O=T[A+3],j=T[A+4],[G,H,W,$]=Io(w,k,N,O,j);C.addPoint(G,H).addPoint(W,$)}return C}setRate(A){this._updateDebounced=this._modules.sync.debounceIdle((A=>this._updateLabels(A)),A)}forceEnable(){this._forceEnabled=!0}update(){this._update()}forceUpdate(A=this._modules.camera){this._updateLabels(A)}_enable(){this._enabled=!0,this._update()}_disable(){this._textBBoxes=[],this._rects=[],this._intersects=[],this._enabled=!1}_onCameraMove(){this._update()}_updateLabels(A=this._modules.camera,w,T){if(!this._modules.settings.get("texts.preventOverlap"))return;let C=this._modules.graphics.getNodeAttributes(),k=this._modules.graphics.getEdgeAttributes();this._intersects=[],this._textBBoxes=[],this._rects=[];let N=A.getAngle(),O=A.getProjectedScreenBounds(.15),j="bottomUp"===this._modules.settings.get("texts.removalStrategy"),G={angle:N,zoom:A.zoom,screen:O,sin:Math.sin(N),cos:Math.cos(N)};this._resetOutput();let H=this._output;if(!w||!T){let A=this._modules.spatial.queryRaw(O[0],O[1],O[2],O[3]);w=A.nodes,T=A.edges}let W=this._quadtree.clear().cover(O[0],O[1],O[2],O[3]);if(w.length+T.length===0)return;let $=this._modules.captor.getPointedElement(),Z=null,se=null;null!==$&&($.isNode?Z=$._index:se=$._index);for(let A of w)(this._textDisplacementUpdate[A]||!this._textDisplacement[A])&&(this._textDisplacement[A]=HA(A,C,this._measureText),this._textDisplacementUpdate[A]=!1);(function W_(A,w,T,C,k,N,O,j,G){let H=O.remove.nodes,W=O.remove.edges,$=O.redraw.nodes,Z=T.angle,se=T.zoom,ue=T.sin,ge=T.cos,ce=C.x,_e=C.y,me=C.radius,pe=C.layer,be=C.scalingMethod,Se=C.text.content,Ee=C.text.scaling,Te=C.text.minVisibleSize,Ce=C.animationDuration,Ie=C.textHidden,ze=C.excluded;O.indexToLayer={},O.indexToQuadIndex={},O.indexToRemoveNodeText={},O.indexToRemoveEdgeText={},O.indexToRedrawNodeText={},O.byLayer=[];let{indexToLayer:Pe,indexToRedrawNodeText:Re,indexToRemoveNodeText:Ue,indexToRemoveEdgeText:Ve,indexToQuadIndex:He,byLayer:We}=O;for(let w=0;w<A.length;w++){let T=A[w],C=pe.get(T)- -1;(We[C]=We[C]||[]).push(T),Pe[T]=C}if(null!==j){let A=We.length;for(let w=Pe[j]+1;w<=A;w++)(We[w]=We[w]||[]).unshift(j);Pe[j]=A}let $e,Ye=[0,0,0,0],qe=[0,0,0,0,0],{bboxes:Qe,rects:Ke}=O,ne=(A,T=-1)=>{let C=Ce.get(A),j=Se.get(A);if(null===j||""===j||0!==C)return!1;let H=me.get(A),W=Te.get(A);if(1===ze.get(A))return Ue[A]=!0,!1;if(2*H*se<W)return 0===Ie.get(A)&&(Ue[A]=!0),!1;"fixed"===be.get(A)&&(H/=se);let $=ce.get(A),pe=_e.get(A);"number"==typeof j&&(j=j.toString());let[Pe,Ve,We,et,st,at,ut,gt,_t,mt]=k(A),vt=!Ee.get(A),St=vt?se:1,kt="fixed"===be.get(A)?se:1;vt?(We+=_t,et+=mt,_t/=se,mt/=se,ut/=se,gt/=se):(We+=_t*se,et+=mt*se),Pe=Pe/St+We/se+st/kt,Ve=Ve/St+et/se+at/kt,Io($-_t,pe-mt,ut,gt,-Z,ue,-ge,Ye),qe[0]=$-_t,qe[1]=pe-mt,qe[2]=ut,qe[3]=gt,qe[4]=Z;let Mt=ge*Pe-ue*Ve,Nt=ue*Pe+ge*Ve;if(Ye[0]+=Mt,Ye[1]+=Nt,Ye[2]+=Mt,Ye[3]+=Nt,qe[0]+=Mt,qe[1]+=Nt,O.realIntersection=!1,gg(A,!0,Qn(qe[0],qe[1],qe[2],qe[3],qe[4]),T),w.traverse(Ye[0],Ye[1],Ye[2],Ye[3],G),O.realIntersection&&!N)return Ue[A]=!0,!1;Re[A]=!0,Ue[A]=!1,T<=0?($e=Qe.length/6,He[A]=$e,Qe.push(Ye[0],Ye[1],Ye[2],Ye[3],1,A),w.insert($e,Ye[0],Ye[1],Ye[2],Ye[3]),Ke.push(qe[0],qe[1],qe[2],qe[3],qe[4])):w.insert(He[A],Ye[0],Ye[1],Ye[2],Ye[3])};for(let w of A)ne(w);let et=!0;for(let A=0;A<We.length;A++){let w=We[A];if(w){if(et){et=!1;continue}for(let T of w)ne(T,A)}}for(let w=0;w<A.length;w++){let T=A[w];Ue[T]?H.push(T):Re[T]&&$.push(T),Ve[T]&&W.push(T)}return O})(w,W,G,C,(A=>this._textDisplacement[A]),j,H,Z,this._nodeTraversal),function K_(A,w,T,C,k,N,O,j,G,H,W){let $=j.remove.nodes,Z=j.remove.edges,se=j.redraw.edges,ue=T.angle,ge=T.zoom,ce=k.x,_e=k.y,me=k.radius,pe=Math.PI,{source:be,target:Se,scalingMethod:Ee}=C,Te=C.width,Ce=C.curvature,Ie=C.layer,ze=C.text.content,Pe=C.text.scaling,Re=C.text.size,Ue=C.text.font,Ve=C.text.style,He=C.text.scale,We=C.text.maxLineLength,$e=C.text.margin,Ye=C.text.minVisibleSize,qe=C.text.padding,Qe=C.animationDuration,Ke=C.text.adjustAngle,et=C.text.position;j.indexToLayer={},j.indexToQuadIndex={},j.indexToRemoveNodeText={},j.indexToRemoveEdgeText={},j.indexToRedrawEdgeText={},j.byLayer=[];let{byLayer:st,indexToLayer:at,indexToQuadIndex:ut,indexToRedrawEdgeText:gt,indexToRemoveNodeText:_t,indexToRemoveEdgeText:mt}=j;for(let w=0;w<A.length;w++){let T=A[w],C=Ie.get(T)- -1;for(let A=1;A<=C;A++)(st[A]=st[A]||[]).push(T);at[T]=C}if(null!==G){let A=st.length;for(let w=at[G]+1;w<=A;w++)(st[w]=st[w]||[]).unshift(G);at[G]=A}let vt=[0,0,0,0],St=[0,0,0,0,0],{bboxes:kt,rects:Mt}=j,te=(A,T=-1)=>{let k=Qe.get(A),G=ze?ze.get(A):"";if(null===G||""===G||k)return!1;let $=be.get(A),Z=Se.get(A),se=Te.get(A),Ie=Ce.get(A),st=Ye.get(A);if(se*ge<st)return mt[A]=!0,!1;"fixed"===Ee.get(A)&&(se/=ge);let at=(ce.get($)+ce.get(Z))/2,Nt=(_e.get($)+_e.get(Z))/2;G=G?G.toString():"";let Dt,Bt=!Pe.get(A),Ht=He.get(A)*(Bt?1:ge),Wt=Ue.get(A),Xt=1*(Bt?Re.get(A):Ht*se),Yt=Ve.get(A),qt=We.get(A),Zt=et.get(A)===zn,Qt=+Zt*$e.get(A)+C.text.padding.get(A),Kt=ce.get($),ei=_e.get($),ti=ce.get(Z),si=_e.get(Z),ri=me.get($),ai=me.get(Z),li=$===Z;if(li)Dt=pe/4-ue,xr(Kt,ei,Ie,ri,0,Ph),bo(.5,Kt,ei,ti,si,Ph.x1,Ph.y1,Ph.x2,Ph.y2,Oh),at=Oh.x,Nt=Oh.y,Qt/=-ge;else{if(Kt===ti&&ei===si)return!1;Dt=Ai(Kt,ei,ti,si)-ue,0!==Ie&&(Dt=Ai(Kt,ei,ti,si)-ue,jt(Kt,ei,ti,si,Ie,Rh),vs(.5,Kt,ei,ti,si,Rh.x,Rh.y,Oh),at=Oh.x,Nt=Oh.y)}let ui=Qt+0,gi=uh(G,qt);if(!gi)return!1;let{lines:_i,data:fi}=gi,pi=1*N(fi[0],Wt,Yt,Xt).width;for(let A=1;A<_i;A++)pi=Math.max(pi,1*N(fi[A],Wt,Yt,Xt).width);let xi=_i*Xt,yi=pi/ge/2,bi=xi/ge/2,Ei=Math.abs(rs(Dt))<Bh?1:-1,Ti=Zt?li?xi/ge+se/2+Qt:Ei*(ui/ge+se/2+bi):0;if(!li&&0===Ie&&Ke.get(A)){let w=qe.get(A);Et(Kt,ei,ti,si)*ge-(ri+ai)*(W?1:ge)<pi+2*w+1&&(Ti*=Ei,Dt=0)}if(St[0]=at-yi,St[1]=Nt-bi,St[2]=at+yi,St[3]=Nt+bi,St[4]=Dt+ue,Qm(St,-(Dt+ue),-Ti,St),St[2]=St[2]-St[0],St[3]=St[3]-St[1],Dt=pe-Dt-ue,Io(at-yi,Nt-bi,2*yi,2*bi,Dt,void 0,void 0,vt),Qm(vt,Dt,Ti,vt),j.realIntersection=!1,gg(A,!1,Qn(St[0],St[1],St[2],St[3],St[4]),T),w.traverse(vt[0],vt[1],vt[2],vt[3],H),j.realIntersection&&!O)return mt[A]=!0,!1;if(gt[A]=!0,_t[A]=!1,T<=0){let T=kt.length/6;ut[A]=T,kt.push(vt[0],vt[1],vt[2],vt[3],0,A),w.insert(T,vt[0],vt[1],vt[2],vt[3]),Mt.push(St[0],St[1],St[2],St[3],St[4])}else w.insert(ut[A],vt[0],vt[1],vt[2],vt[3])};for(let w of A)te(w);let Nt=!0;for(let A=0;A<st.length;A++){let w=st[A];if(w){if(Nt){Nt=!1;continue}for(let T of w)te(T,A)}}for(let w=0;w<A.length;w++){let T=A[w];_t[T]?$.push(T):gt[T]&&se.push(T),mt[T]&&Z.push(T)}return j}(T,W,G,k,C,this._measureText,j,H,se,this._edgeTraversal,this._geoEnabled),this._clearOverlaps(H),this._modules.settings.get("texts.debug")&&this._layer.refresh()}_clearOverlaps(A){let w=this._modules.graph.nodeList,T=this._modules.graph.edgeList,C=this._modules.graphics,k=w(new Uint32Array(A.remove.nodes)),N=T(new Uint32Array(A.remove.edges)),O=w(new Uint32Array(A.redraw.nodes)),j=T(new Uint32Array(A.redraw.edges));C.setTextHidden(k,!0),C.setTextHidden(N,!0),C.setTextHidden(O,!1),C.setTextHidden(j,!1),this._modules.events.fire("labelCollisionsRemoved",A)}_resetOutput(){let A=this._output;A.remove.nodes=[],A.remove.edges=[],A.redraw.nodes=[],A.redraw.edges=[],A.rects=this._rects,A.bboxes=this._textBBoxes,A.intersects=this._intersects,A.realIntersection=!1,A.indexToLayer={},A.byLayer=[],A.indexToRedrawEdgeText={},A.indexToRemoveEdgeText={},A.indexToRedrawNodeText={},A.indexToRemoveNodeText={},A.indexToQuadIndex={}}_reset(){this._modules.graphics.resetTextHidden(),this._textDisplacement={},this._textDisplacementUpdate={}}},Gh=class extends kt{constructor(){super(...arguments),this._onStartInteractionEvent=(A,w)=>{if(this._current)return;let T,C=this._interactionsByStartEvent[w];for(let w of C)w.check(A)&&(!T||w.priority>=T.priority)&&(T=w);T&&this._startInteraction(T,A)},this._onProgressInteractionEvent=(A,w)=>{this._current&&this._current.progressEventName===w&&this._current.onProgress&&this._current.onProgress(A)},this._onStopInteractionEvent=(A,w)=>{this._current&&this._current.stopEventName===w&&this._stopCurrentInteraction(null)}}onMounted(){this._interactionsByStartEvent={},this._boundProgressEvents={},this._boundStopEvents={}}_startInteraction(A,w){A.onStart&&A.onStart(w),A.onStop&&(this._current=A,A.disableDetection&&this._modules.captor.setDetectionEnabled(!1))}_stopCurrentInteraction(A){this._current&&this._current.disableDetection&&this._modules.captor.setDetectionEnabled(!0),this._current&&this._current.onStop&&this._current.onStop(A),this._current=void 0}_forceStartInteraction(A,w){this._current&&this._stopCurrentInteraction(w),this._startInteraction(A,w)}_createWrapper(A){return{start:w=>this._forceStartInteraction(A,w)}}_addInteraction(A,w){let T=this._interactionsByStartEvent[A];return T?T.push(w):(this._interactionsByStartEvent[A]=[w],this._modules.events.on(A,this._onStartInteractionEvent)),this._createWrapper(w)}_createProgressiveInteraction(A,w,T,C){let k={priority:KA(C.priority),check:C.check||ro,onStart:C.onStart||Ze,onProgress:C.onProgress||Ze,onStop:C.onStop||Ze,disableDetection:!!C.disableDetection,progressEventName:w,stopEventName:T};return this._boundProgressEvents[w]||(this._boundProgressEvents[w]=!0,this._modules.events.on(w,this._onProgressInteractionEvent)),this._boundStopEvents[T]||(this._boundStopEvents[T]=!0,this._modules.events.on(T,this._onStopInteractionEvent)),this._addInteraction(A,k)}_createNonProgressiveInteraction(A,w){return this._addInteraction(A,{priority:KA(w.priority),check:w.check||ro,onStart:w.handler||Ze,onProgress:void 0,onStop:void 0,disableDetection:!1,progressEventName:void 0,stopEventName:void 0})}onDrag(A){return this._createProgressiveInteraction("dragStart","dragProgress","dragEnd",A)}onGesture(A){return this._createProgressiveInteraction("gestureStart","gestureProgress","gestureEnd",A)}onClick(A){return this._createNonProgressiveInteraction("click",A)}onDoubleClick(A){return this._createNonProgressiveInteraction("doubleclick",A)}onHover(A){return this._createNonProgressiveInteraction("mouseover",A)}onUnhover(A){return this._createNonProgressiveInteraction("mouseout",A)}onMouseWheel(A){return this._createNonProgressiveInteraction("mousewheel",A)}onMouseDown(A){return this._createNonProgressiveInteraction("mousedown",A)}onMouseUp(A){return this._createNonProgressiveInteraction("mouseup",A)}onMouseMove(A){return this._createNonProgressiveInteraction("mousemove",A)}};function KA(A){return"string"==typeof A?Ei.indexOf(A):"number"!=typeof A||isNaN(A)?0:A}var Hh=["virtualUp","mouseupInternal","touchUp"],Wh=["virtualDown","mousedownInternal","touchDown"],Xh=["virtualMove","mousemoveInternal","touchMove"],$h=["virtualClick","clickInternal","touchTap"],Yh=["virtualDoubleClick","doubleclickInternal","touchDoubleTap"],qh=["virtualWheel","mousewheelInternal"],Zh=class extends kt{constructor(){super(...arguments),this._elt=null,this._hoveredElt=null,this._draggedElt=null,this._hover=!1,this._disabledCounter=0,this._accDx=0,this._accDy=0,this._prevX=0,this._prevY=0,this._buttons={left:{isPressed:!1,isDragging:!1},middle:{isPressed:!1,isDragging:!1},right:{isPressed:!1,isDragging:!1}},this._onGraphChanged=()=>{this._resetCurrent(this._modules.position.x,this._modules.position.y),this._onMove({x:this._modules.position.x,y:this._modules.position.y,source:null,domEvent:null})}}onMounted(){this._modules.events.register(["mousemove","mousedown","mouseup","click","doubleclick","mousewheel","mouseout","mouseover","dragStart","dragProgress","dragEnd","gestureStart","gestureProgress","gestureEnd"]),this._modules.settings.register("detect.nodes",!0).register("detect.edges",!0).register("detect.nodeTexts",!0).register("detect.edgeTexts",!0).register("detect.nodeErrorMargin",5).register("detect.edgeErrorMargin",7).register("detect.enableSpatialIndex",!0).register("detect.spatialIndexMarginRatio",20),this._modules.events.on(["removeNodes","removeEdges","clearGraph"],this._onGraphChanged).on(Xh,((A,w)=>{this._onMove(ke(re({},A),{source:Go(w)}))})).on(Wh,(({domEvent:A,x:w,y:T,button:C="left"},k)=>{this._onDown({domEvent:A,x:w,y:T,button:C,source:Go(k)})})).on(Hh,(({domEvent:A,x:w,y:T,button:C="left"},k)=>{this._onUp({domEvent:A,x:w,y:T,button:C,source:Go(k)})})).on($h,(({domEvent:A,x:w,y:T,button:C="left"},k)=>{this._onClick({domEvent:A,x:w,y:T,button:C,source:Go(k)})})).on(Yh,(({domEvent:A,x:w,y:T,button:C="left"},k)=>{this._onDoubleClick({domEvent:A,x:w,y:T,button:C,source:Go(k)})})).on(qh,(({domEvent:A,x:w,y:T,delta:C})=>{this._onWheel({domEvent:A,x:w,y:T,delta:C,source:"mouse"})})).on("touchStartGesture",(A=>this._modules.events.fire("gestureStart",A))).on("touchProgressGesture",(A=>this._modules.events.fire("gestureProgress",A))).on("touchEndGesture",(A=>this._modules.events.fire("gestureEnd",A))).on("documentMouseMove",(({domEvent:A,x:w,y:T},C)=>{this._onDocumentMove({domEvent:A,x:w,y:T,source:Go(C)})})).on("documentMouseUp",(({domEvent:A,x:w,y:T,button:C="left"},k)=>{this._onDocumentUp({domEvent:A,x:w,y:T,source:Go(k),button:C})}))}triggerUnhover(){this._hover=!1,this._hoveredElt=null}triggerDetection(){this._detectElement(this._modules.position.x,this._modules.position.y),this._elt&&(this._hoveredElt=this._elt,this._hover=!0)}getElementAt({x:A,y:w},T){return this._detectElementAt(A,w,T)}getPointedElement(){return this._hoveredElt}getDraggedElement(){return this._draggedElt}isAnyButtonPressed(){return this._buttons.left.isPressed||this._buttons.right.isPressed||this._buttons.middle.isPressed}isAnyButtonDragging(){return this._buttons.left.isDragging||this._buttons.right.isDragging||this._buttons.middle.isDragging}isButtonPressed(A){return this._buttons[A].isPressed}isLeftPressed(){return this.isButtonPressed("left")}getCursorPosition(){return{x:this._modules.position.x,y:this._modules.position.y}}getCursorInformation(){return{x:this._modules.position.x,y:this._modules.position.y,target:this._hoveredElt}}setDetectionEnabled(A){this._disabledCounter=Math.max(0,this._disabledCounter+(A?-1:1))}_resetCurrent(A,w){for(let T in this._buttons){let C=this._buttons[T];C.isDragging&&this._modules.events.fire("dragEnd",{domEvent:null,x:A,y:w,button:T,target:this._draggedElt}),C.isPressed=!1,C.isDragging=!1}this._hover&&this._hoveredElt&&this._modules.events.fire("mouseout",{domEvent:null,x:A,y:w,target:this._hoveredElt}),this._hover=!1,this._hoveredElt=null,this._draggedElt=null}_onMove({domEvent:A,x:w,y:T,source:C}){let{dx:k,dy:N}=this._setPointerPosition(w,T);this._modules.events.fire("mousemove",{domEvent:A,x:w,y:T,dx:k,dy:N,source:C});for(let O in this._buttons){let j=this._buttons[O];if(j.isPressed)if(j.isDragging){let j=this._getStoredDXY();k+=j.dx,N+=j.dy,this._modules.events.fire("dragProgress",{domEvent:A,x:w,y:T,dx:k,dy:N,button:O,source:C,target:this._draggedElt})}else j.isDragging=!0,this._hoveredElt&&this._hover&&(this._modules.events.fire("mouseout",{domEvent:A,x:w,y:T,source:C,target:this._hoveredElt}),this._hover=!1),this._draggedElt||(this._draggedElt=this._hoveredElt),this._storeDXY(k,N),this._modules.events.fire("dragStart",{domEvent:A,x:w,y:T,button:O,source:C,target:this._draggedElt})}(!A||this._modules.graphics.getDomElement().contains(A.target))&&this._detectElement(w,T),this._elt!==this._hoveredElt&&(this._hoveredElt&&this._hover&&(this._hover=!0,this._modules.events.fire("mouseout",{domEvent:A,x:w,y:T,source:C,target:this._hoveredElt})),this._hoveredElt=this._elt,this._elt&&(this._hover=!0,this._modules.events.fire("mouseover",{domEvent:A,x:w,y:T,source:C,target:this._hoveredElt})))}_onDocumentMove({domEvent:A,x:w,y:T,source:C}){for(let k in this._buttons){let{isDragging:N}=this._buttons[k];if(N){let{dx:N,dy:O}=this._setPointerPosition(w,T);this._modules.events.fire("dragProgress",{domEvent:A,x:w,y:T,dx:N,dy:O,button:k,source:C,target:this._draggedElt})}}}_onDocumentUp({domEvent:A,x:w,y:T,source:C,button:k}){if(null!=k&&this._buttons[k].isDragging){this._modules.events.fire("dragEnd",{domEvent:A,x:w,y:T,button:k,source:C,target:this._draggedElt});let N=this._buttons[k];N.isDragging=!1,N.isPressed=!1,this.isAnyButtonDragging()||(this._draggedElt=null)}}_onDown({domEvent:A,x:w,y:T,button:C,source:k}){if(null==C)return;this._detectElement(w,T),this._elt!==this._hoveredElt&&this._resetCurrent(w,T);let N=this._buttons[C];this._hoveredElt=this._elt,N.isPressed=!0,this._elt&&A&&(A.stopPropagation(),A.preventDefault()),this._modules.events.fire("mousedown",{domEvent:A,x:w,y:T,button:C,source:k,target:this._hoveredElt})}_onDoubleClick({domEvent:A,x:w,y:T,button:C,source:k}){null!=C&&(qA(A,"doubleclick")||this._modules.events.fire("doubleclick",{domEvent:A,x:w,y:T,button:C,source:k,target:this._hoveredElt}))}_onUp({domEvent:A,x:w,y:T,button:C,source:k}){if(null==C)return;let N=this._buttons[C];!N.isPressed||(N.isDragging&&(this._modules.events.fire("dragEnd",{domEvent:A,x:w,y:T,button:C,source:k,target:this._draggedElt}),N.isDragging=!1,this.isAnyButtonDragging()||(this._draggedElt=null)),N.isPressed=!1,this._detectElement(w,T),this._modules.events.fire("mouseup",{domEvent:A,x:w,y:T,button:C,source:k,target:this._elt}),!this.isAnyButtonPressed()&&!this._hover&&"touch"!==k&&(this._hoveredElt=this._elt,this._hoveredElt&&(this._modules.events.fire("mouseover",{domEvent:A,x:w,y:T,source:k,target:this._hoveredElt}),this._hover=!0)))}_onClick({domEvent:A,x:w,y:T,button:C,source:k}){qA(A,"click")||this._modules.events.fire("click",{domEvent:A,x:w,y:T,button:C,source:k,target:this._hoveredElt})}_onWheel({domEvent:A,x:w,y:T,delta:C,source:k}){this._modules.position.x=w,this._modules.position.y=T,this._modules.events.fire("mousewheel",{domEvent:A,x:w,y:T,delta:C,source:k,target:this._hoveredElt})}_storeDXY(A,w){this._accDx=A,this._accDy=w}_getStoredDXY(){let A=this._accDx,w=this._accDy;return this._accDx=0,this._accDy=0,{dx:A,dy:w}}_setPointerPosition(A,w){let T=A-this._prevX,C=w-this._prevY;return this._modules.position.x=A,this._modules.position.y=w,this._prevX=A,this._prevY=w,this._accDx=0,this._accDy=0,{dx:T,dy:C}}_detectElement(A,w,T){this._elt=this._detectElementAt(A,w,T)}_detectElementAt(A,w,T){if(0!==this._disabledCounter)return null;let C=this._modules.settings,k=C.get("detect.enableSpatialIndex"),N=C.get("detect.nodeErrorMargin"),O=C.get("detect.edgeErrorMargin"),j=C.get("detect.nodes"),G=C.get("detect.edges"),H=null,W=[],$=[];if(!T&&k&&(j||G)){let T=C.get("detect.spatialIndexMarginRatio"),k=Math.max(N*T,O*T),j=this._modules.spatial.queryRawProjected(A-k,w-k,A+k,w+k);W=j.nodes,$=j.edges}return j&&(H=this._modules.graphics.detectNode({x:A,y:w,indexes:W,margin:N,texts:!!C.get("detect.nodeTexts")})),!H&&G&&(H=this._modules.graphics.detectEdge({x:A,y:w,indexes:$,margin:O,texts:!!C.get("detect.edgeTexts")})),H}};function Go(A){return 0===A.indexOf("touch")?"touch":"mouse"}var Qh=!1,Jh={down:{trigger:"pointerdown",duplicate:"mousedown"},click:{trigger:"pointerdown",duplicate:"mouseup"},doubleclick:{trigger:"pointerdown",duplicate:"mouseup"}};function qA(A,w){if(A&&(A.type===Jh[w].trigger&&(Qh=!0),A.type===Jh[w].duplicate&&Qh))return Qh=!1,!0}var Kh=class extends kt{constructor(){super(...arguments),this._dragged=null,this._start=[],this._end=[],this._shouldDrag=({target:A,button:w})=>{let T="left"===w,C=this._modules.settings.get("interactions.drag.enabled"),k=null!==A&&A.isNode&&!0===A.getAttribute("draggable");return!!(T&&C&&k)},this._onDragStart=({x:A,y:w,target:T})=>{T&&(T.isSelected()?this._dragged=this._modules.selection.getSelectedNodes().filter((A=>A.getAttribute("draggable"))):this._dragged=T.toList()),this._dragged&&(this._start=this._dragged.getPosition(),this._end=nt(this._start),this._onBeforeDrag=this._modules.settings.get("interactions.drag.onBeforeDrag"),this._startDrag=this._modules.camera.screenToGraphCoordinates({x:A,y:w}),this._dragged.addClass(li),this._modules.events.fire("nodesDragStart",{nodes:this._dragged}),this._modules.graphics.addCursorStyle(this._modules.settings.get("interactions.drag.cursor")))},this._onDrag=()=>{if(!this._dragged||!this._startDrag)return;let{x:A,y:w}=this._modules.captor.getCursorInformation(),T=this._dragged._indexes,C=this._modules.camera.screenToGraphCoordinates({x:A,y:w}),k=C.x-this._startDrag.x,N=C.y-this._startDrag.y;for(let A=0;A<T.length;++A){let w=this._start[A],T=this._end[A];T.x=w.x+k,T.y=w.y+N}this._onBeforeDrag&&this._onBeforeDrag(this._dragged,A,w,this._end),this._modules.settings.get("interactions.drag.applyResult")&&this._modules.individualAttributes.setMultipleAttributes(this._dragged,this._end,void 0,["x","y"]),this._modules.events.fire("nodesDragProgress",{nodes:this._dragged,dx:k,dy:N})},this._onDragEnd=()=>{!this._dragged||(this._dragged.removeClass(li),this._modules.graphics.removeCursorStyle(this._modules.settings.get("interactions.drag.cursor")),this._modules.events.fire("nodesDragEnd",{nodes:this._dragged,start:this._start,end:this._end}),this._dragged=null,this._start=[],this._end=[])}}onMounted(){this._modules.classes.createClass({name:li,isBuiltin:!0,nodeAttributes:{layer:3}}),this._modules.events.register(["nodesDragStart","nodesDragProgress","nodesDragEnd"]),this._modules.settings.register("interactions.drag.enabled",!0),this._modules.settings.register("interactions.drag.cursor","move"),this._modules.settings.register("interactions.drag.onBeforeDrag",void 0),this._modules.settings.register("interactions.drag.applyResult",!0),this._modules.interactions.onDrag({priority:"drag",disableDetection:!0,check:this._shouldDrag,onStart:this._onDragStart,onProgress:this._onDrag,onStop:this._onDragEnd})}},eu={color:"#00C3FF",radius:4,cursorOnHover:"grab",cursorOnDrag:"grabbing"},tu=class extends kt{constructor(){super(...arguments),this._hoverHandle=!1,this._grabHandle=!1,this._x=0,this._y=0,this._enabled=!1,this._onDragStart=()=>{if(!this._movedEdges)return;this._nodesToHighlight=this._nodesToHighlight.filter((A=>A!==this._startNode&&!A.isVirtual())),this._movedEdges.setExcluded(!0);let A=this._options.cursorOnDrag;this._prevSettings=this._modules.settings.update({edgeHover:!1,cursor:{default:A,node:A,edge:A}})},this._onDragEnd=()=>{if(!this._movedEdges)return;this._restoreSettings();let A=this._getPointedNode();A&&this._movedEdges.forEach((w=>{w.getTarget()===this._startNode?w.setTarget(A):w.setSource(A)})),this._movedEdges.setExcluded(!1),this._movedEdges.setSelected(!0),this._movedEdges=null,this._refreshHandles()},this._refreshHandles=()=>{if(!this._enabled||this._movedEdges)return;let A=this._modules.selection.getSelectedEdges();this._nodesToHighlight=A.getExtremities().dedupe().filter((A=>!A.isVirtual())),this._rewirableClass.clearEdges(),this._rewirableClass.add(A),this._refreshCanvas()},this._shouldInteractionStart=({target:A})=>{if(!this._enabled||!A||!A.isNode||!this._hoverHandle||A.isVirtual())return!1;let w=A.getAdjacentEdges().filter((A=>A.isSelected()));return!!w.size&&(this._movedEdges=w,this._edgeColors=this._movedEdges.getAttribute("color"),this._startNode=A,!0)},this._refreshCanvas=()=>{!this._enabled||this._layer.refresh()},this._checkForHover=()=>{if(!this._enabled||!this._nodesToHighlight)return;let A=this._options.radius,w=this._nodesToHighlight.toArray(),T=this._modules.camera.screenToGraphCoordinates(this._modules.captor.getCursorPosition());for(let C=0;C<w.length;C++){let{x:k,y:N}=w[C].getPosition();if(Et(k,N,T.x,T.y)<A)return void this._enableCursorOnHover()}this._disableCursorOnHover()}}onMounted(){this._rewirableClass=this._modules.classes.createClass({name:ui,isBuiltin:!0,edgeAttributes:{layer:4}}),this._modules.events.on("move",this._checkForHover).on("mousemove",this._checkForHover).on("dragProgress",(()=>{this._grabHandle&&this._refreshCanvas()})).on("nodesDragProgress",this._refreshCanvas).on("mousedown",(()=>{this._hoverHandle&&(this._grabHandle=!0)})).on("mouseup",(()=>this._grabHandle=!1)).on("edgesSelected",this._refreshHandles).on("edgesUnselected",this._refreshHandles),this._interaction=this._modules.interactions.onDrag({priority:"rewiring",check:this._shouldInteractionStart,onStart:this._onDragStart,onProgress:({x:A,y:w})=>{this._x=A,this._y=w},onStop:this._onDragEnd})}enable(A){this._enabled||(this._options=re(re({},eu),A),this._enabled=!0,this._layer=this._modules.layers.addCanvasLayer((A=>{if(!this._enabled||!this._nodesToHighlight)return;let w=this._modules.captor.getCursorPosition(),T=this._getPointedNode(),C=this._options.color,k=this._options.radius,N=2*k;if(this._displayMovedEdges(A),A.fillStyle=C,A.strokeStyle=C,this._nodesToHighlight.forEach((w=>{let{x:T,y:C}=w.getPosition();A.fillRect(T-k,C-k,N,N)})),this._movedEdges){let C=T?T.getPosition():w;A.fillRect(C.x-k,C.y-k,N,N)}}),{isStatic:!1,noClear:!1}),this._layer.moveToTop(),this._refreshHandles())}disable(){!this._enabled||(this._interaction.stop&&this._interaction.stop(),this._modules.graphics.removeCursorStyle(this._options.cursorOnDrag),this._disableCursorOnHover(),this._restoreSettings(),this._layer.destroy(),this._rewirableClass.clearEdges(),this._enabled=!1)}enabled(){return this._enabled}_restoreSettings(){!this._prevSettings||(this._modules.settings.update(this._prevSettings),this._prevSettings=void 0)}_disableCursorOnHover(){!this._hoverHandle||this._grabHandle||(this._hoverHandle=!1,this._modules.graphics.removeCursorStyle(this._options.cursorOnHover))}_enableCursorOnHover(){this._hoverHandle||(this._hoverHandle=!0,this._modules.graphics.addCursorStyle(this._options.cursorOnHover))}_displayMovedEdges(A){if(!this._movedEdges)return;let w=this._x,T=this._y,C=this._modules.camera.screenToGraphCoordinates({x:w,y:T});this._movedEdges.forEach(((w,T)=>{let k=this._edgeColors[T],N=w.getSource(),O=w.getTarget(),j=this._getPointedNode(),G=O===this._startNode?N:O,H=Number(w.getAttribute("width")),W=G.getPosition(),$=j?j.getPosition():C;G.addClass(ai),A.beginPath(),A.moveTo(W.x,W.y),A.lineTo($.x,$.y),A.strokeStyle=k,A.lineWidth=H,A.stroke()}))}_getPointedNode(){let A=this._modules.captor.getPointedElement();return A&&A.isNode&&!A.isVirtual()?A:null}},iu={cursor:"nesw-resize",color:"#00C3FF",lineWidth:1,handleSize:6,detectionMargin:5,snappingRatio:1.25,nbNodesToSnapTo:5,previewColor:"rgba(0, 0, 0, 0.2)",sizeIndicatorColor:"black",sizeIndicatorOffset:5,sizeIndicatorWidth:3,sizeIndicatorThickness:1},su=class extends kt{constructor(){super(...arguments),this._enabled=!1,this._nodesToHighlight=null,this._cursorEnabled=!1,this._x=0,this._y=0,this._additionalRadiuses=[],this._onSelectionChange=()=>{!this._enabled||(this._nodesToHighlight=this._modules.selection.getSelectedNodes(),this._displayHandles())},this._displayHandlesHandler=()=>this._displayHandles(),this._moveHandler=({x:A,y:w})=>{this._modules.dom.setTimeout((()=>this._detectBoundingBoxes(A,w)))}}onMounted(){this._engine=this._modules.graphics.getGraphicsEngine(),this._modules.interactions.onDrag({priority:"resizing",disableDetection:!0,check:()=>!(!this._enabled||!this._pointedNode),onStart:({x:A,y:w})=>{this._x=A,this._y=w,this._nodeBeingResized=this._pointedNode},onProgress:({x:A,y:w})=>{this._x=A,this._y=w,this._displayHandles()},onStop:()=>{this._nodesToHighlight&&this._nodesToHighlight.forEach(((A,w)=>{let T=this._additionalRadiuses[w]/this._modules.camera.zoom;A.setAttributes({radius:Number(A.getAttribute("radius"))+T,x:A.getPosition().x+T,y:A.getPosition().y-T})})),this._pointedNode=null,this._nodeBeingResized=null,this._displayHandles()}})}onReady(){this._modules.events.on("nodesSelected",this._onSelectionChange),this._modules.events.on("nodesUnselected",this._onSelectionChange)}_enableCursor(){this._cursorEnabled||(this._modules.graphics.addCursorStyle(this._options.cursor),this._cursorEnabled=!0)}_disableCursor(){this._cursorEnabled&&(this._modules.graphics.removeCursorStyle(this._options.cursor),this._cursorEnabled=!1)}_detectBoundingBoxes(A,w){if(!this._enabled||this._nodeBeingResized||!this._nodesToHighlight)return;let T=this._options.handleSize/2,C=this._options.detectionMargin;return this._pointedNode=null,this._forEachNodeToHighlight(((k,N,O)=>{let j=N.x+O-T-C,G=N.x+O+T+C,H=N.y-O-T-C,W=N.y-O+T+C;A>=j&&A<=G&&w>=H&&w<=W&&(this._pointedNode=k)})),this._pointedNode?this._enableCursor():this._disableCursor()}_forEachNodeToHighlight(A){this._nodesToHighlight&&this._nodesToHighlight.forEach((w=>{let T=w.getPositionOnScreen(),C=this._getTotalRadius(w);A(w,T,C)}))}_displayHandles(){!this._enabled||!this._nodesToHighlight||this._layer.refresh()}_displayNodePreview(A,w,T,C,k,N){if(k*=1/this._modules.camera.getZoom(),A.beginPath(),1===N.length)A.arc(T,C,k,0,2*Math.PI);else for(let w=0;w<N.length;++w){let O=N[w],j=T+O.x*k,G=C+O.y*k;0===w?A.moveTo(j,G):A.lineTo(j,G)}A.fillStyle=this._options.previewColor,A.fill()}_getTotalRadius(A,w=!0){return Number(A.getAttribute("radius"))*(this._modules.camera.zoom*(w?1:0))+Number(A.getAttribute("innerStroke.width"))+Number(A.getAttribute("outerStroke.width"))+this._options.lineWidth/2}_snap(A,w,T){let C=this._modules.spatial.getNodesInScreenByDistance(w).filter((A=>!A.isSelected())).slice(0,this._options.nbNodesToSnapTo),k=this._getTotalRadius(w),N=k+T,O=this._options.snappingRatio,j=N/k,G=Math.round(sp(j,O)),H=k*Math.pow(O,G),W=null;if(C.forEach((A=>{let w=this._getTotalRadius(A);Math.abs(w-N)<=Math.abs(H-N)&&(H=w,W=A)})),W){A.save(),A.strokeStyle=this._options.sizeIndicatorColor,A.lineWidth=this._options.sizeIndicatorThickness/this._modules.camera.getZoom();let T=W.getAttribute("radius");this._displaySizeIndicator(A,w,H),C.filter((A=>A.getAttribute("radius")===T)).forEach((w=>this._displaySizeIndicator(A,w))),A.restore()}return H-k}_displaySizeIndicator(A,w,T){T=T||void 0;let C=this._modules.camera.getZoom(),k=w.getPosition(),N=this._getTotalRadius(w),O=(T||N)/C,j=(T?T-N:0)/C,G=j+(-this._options.sizeIndicatorOffset-(T?Number(w.getAttribute("innerStroke.width"))+Number(w.getAttribute("outerStroke.width")):0))/C,H=k.x-O+G|0,W=k.y-O-j|0,$=k.y+O-j|0,Z=this._options.sizeIndicatorWidth/C;A.beginPath(),A.moveTo(H-Z,W),A.lineTo(H+Z,W),A.moveTo(H,W),A.lineTo(H,$),A.moveTo(H-Z,$),A.lineTo(H+Z,$),A.stroke()}enable(A){this._enabled||(this._options=re(re({},iu),A),this._layer=this._modules.layers.addCanvasLayer((A=>{let w=Ye(),T=this._modules.camera.getZoom(),{color:C,lineWidth:k,handleSize:N}=this._options,O=0;if(this._nodeBeingResized){let A=this._getTotalRadius(this._nodeBeingResized),w=this._nodeBeingResized.getPositionOnScreen();O=Math.max(this._x-(w.x+A),-(this._y-(w.y-A)))/2}this._additionalRadiuses=[],this._nodesToHighlight&&this._nodesToHighlight.forEach((j=>{let G=j.getPosition(),H=this._getTotalRadius(j),W=0;if(this._nodeBeingResized){W=O;let C=-H+Number(j.getAttribute("innerStroke.width"))+Number(j.getAttribute("outerStroke.width"))+k/2+1;W=W<C?C:this._snap(A,j,W),this._additionalRadiuses.push(W);let N=j.getAttribute("shape"),$=this._engine.getShapePoints(N),Z=G.x+W/T,se=G.y-W/T,ue=H+W;this._displayNodePreview(A,w,Z,se,ue,$)}A.strokeStyle=C,A.fillStyle=C,A.lineWidth=k/T,H/=T,W/=T,N/=T*w,A.strokeRect(G.x-H,G.y-H-2*W,2*(W+H),2*(W+H)),A.fillRect(G.x+H+2*W-N/2,G.y-H-2*W-N/2,N,N)}))}),{isStatic:!1,noClear:!1}),this._layer.moveToTop(),this._modules.events.on(["mousemove","mousedown"],this._moveHandler),this._enabled=!0)}disable(){!this._enabled||(this._modules.events.off(this._displayHandlesHandler),this._modules.events.off(this._moveHandler),this._layer.destroy(),this._disableCursor(),this._reset())}_reset(){this._enabled=!1,this._nodesToHighlight=null,this._options=re({},iu),this._nodeBeingResized=null,this._pointedNode=null,this._cursorEnabled=!1,this._x=0,this._y=0,this._additionalRadiuses=[]}enabled(){return this._enabled}},nu={strokeColor:"black",strokeWidth:5,dashed:!0,cursorStyle:"cell",createNodes:!0,condition:ni,onNodeCreated:Ze,onEdgeCreated:Ze,createNode:ur,createEdge:ur,onComplete:Ze},ou=class extends kt{constructor(){super(...arguments),this._enabled=!1,this._blockId=0,this._cursorEnabled=!1}onMounted(){this._engine=this._modules.graphics.getGraphicsEngine(),this._group=this._engine.createGroup(),this._depth=Yn(0).edgeBody,this._modules.events.register(["connectNodes"]),this._interaction=this._modules.interactions.onDrag({priority:"connectNodes",check:({target:A,button:w="left"})=>this._enabled&&"left"===w&&A&&A.isNode&&!A.isVirtual(),onStart:({target:A})=>this._onStart(A),onProgress:({x:A,y:w})=>this._onMove(A,w),onStop:()=>this._onStop()}),this._modules.events.on("clearGraph",(()=>this.disable()))}_onStart(A){A&&(this._cursorEnabled=!0,this._startNode=A,this._startPos=A.getPosition(),this._modules.graphics.addCursorStyle(this._options.cursorStyle),this._blockId=this._modules.graphics.allocateGraphicsEngineBlockId())}_onMove(A,w){null!==this._startNode&&(this._endPos=this._modules.camera.screenToGraphCoordinates({x:A,y:w}),this._drawLine())}_onStop(){if(null===this._startNode)return;let{condition:A,onNodeCreated:w,onEdgeCreated:T,createEdge:C,createNode:k,onComplete:N,createNodes:O}=this._options,j=this._modules.captor.getPointedElement(),G=null,H=null;if(this._modules.graphics.releaseGraphicsEngineBlockId(this._blockId),!j&&O){let A=k({attributes:{x:this._endPos.x,y:this._endPos.y}});j=this._modules.graph.addNode(A),H=j,w&&w(H)}if(j&&!j.isVirtual()&&(H||!A||A(this._startNode,j))){let A=C({source:this._startNode.getId(),target:j.getId()});G=this._modules.graph.addEdge(A),T&&T(G)}N&&(this._modules.events.fire("connectNodes",{source:this._startNode,target:j,edge:G}),N(this._startNode,j,G||void 0)),this.disable()}_drawLine(){this._group.reset(1,!1,this._depth);let A=this._group.nextAndReset().end;A.pieceId=2,A.shape="line",A.x1=this._startPos.x,A.y1=this._startPos.y,A.x2=this._endPos.x,A.y2=this._endPos.y,A.fillColor=this._options.strokeColor,A.thicknessOrFontSizeFixed=this._options.strokeWidth,this._options.dashed&&(A.dashLength=3,A.gapLength=1),this._engine.storeGroup(this._blockId,this._group),this._modules.dom.refresh()}enable(A={}){return this._enabled||(this._options=re(re({},nu),A),this._enabled=!0,this._cursorEnabled=!1,this._startNode=null,this._prevSettings=this._modules.settings.update({"cursor.node":this._options.cursorStyle,"detect.edges":!1}),this._modules.captor.isLeftPressed()&&this._interaction.start(this._modules.captor.getCursorInformation())),this}disable(){return this._enabled?(this._enabled=!1,this._modules.settings.update(this._prevSettings),this._cursorEnabled&&this._modules.graphics.removeCursorStyle(this._options.cursorStyle),this):this}enabled(){return this._enabled}},au=["top","bottom","left","right","cssDefined"],lu={top:{x:0,y:-1},bottom:{x:0,y:1},left:{x:-1,y:0},right:{x:1,y:0}},du={position:"top",autoAdjust:!0,delay:100},hu={hover:{node:({target:A})=>A&&A.isNode,edge:({target:A})=>A&&!A.isNode},click:{left:{node:({target:A,button:w})=>"left"===w&&A&&A.isNode,edge:({target:A,button:w})=>"left"===w&&A&&!A.isNode,background:({target:A,button:w})=>"left"===w&&!A},right:{node:({target:A,button:w})=>"right"===w&&A&&A.isNode,edge:({target:A,button:w})=>"right"===w&&A&&!A.isNode,background:({target:A,button:w})=>"right"===w&&!A}},doubleclick:{left:{node:({target:A,button:w})=>"left"===w&&A&&A.isNode,edge:({target:A,button:w})=>"left"===w&&A&&!A.isNode,background:({target:A,button:w})=>"left"===w&&!A},right:{node:({target:A,button:w})=>"right"===w&&A&&A.isNode,edge:({target:A,button:w})=>"right"===w&&A&&!A.isNode,background:({target:A,button:w})=>"right"===w&&!A}}},uu=class extends kt{constructor(){super(...arguments),this._x=0,this._y=0}onMounted(){this._handlers={},this._currentHandlerName=null,this._tooltip=null,this._isHover=!1,this._modules.events.register(["tooltipShow","tooltipHide"]),this._modules.events.on(["mouseup","dragStart"],(()=>{this._isHover||this._hideTooltip(!1)})).on("mouseout",(()=>{this._isHover&&this._hideTooltip(!1)})).on("clearGraph",(()=>this._hideTooltip(!1))),this._modules.interactions.onHover(this._createInteraction("hover",!0)),this._modules.interactions.onClick(this._createInteraction("click")),this._modules.interactions.onDoubleClick(this._createInteraction("doubleclick"))}hide(){this._hideTooltip(!0)}isShown(){return!!this._tooltip}refresh(){this._refreshTooltip()}show(A,{position:w="top",autoAdjust:T=!0,className:C,x:k=0,y:N=0}={}){this._showTooltip(A,{position:w,autoAdjust:T,className:C},{x:k,y:N})}setHandler(A,w,T){let C=re(re({},du),T);C.position&&-1===au.indexOf(C.position)&&(C.position="top"),this._handlers[A]={handler:w,condition:Tt(hu,A),settings:C}}_hideTooltip(A){if(this._timeout&&(this._modules.dom.clearTimeout(this._timeout),this._timeout=null),A&&(this._currentHandlerName=null),this._tooltip){let A=this._tooltip;this._tooltip.parentNode&&this._tooltip.parentNode.removeChild(this._tooltip),this._tooltip=null,this._modules.events.fire("tooltipHide",{tooltip:A})}}_createInteraction(A,w=!1){return{priority:"tooltip",check:T=>{let C=ZA(A,T),k=this._handlers[C];return(!w||!this._modules.connectNodes.enabled())&&(!(!k||!k.condition(T))||!(w||!this._currentHandlerName||this._isHover)&&null!==this._tooltip)},handler:T=>{let{target:C,x:k,y:N}=T;this._hideTooltip(!1),this._isHover=w,this._elt=C,this._x=k,this._y=N,this._currentHandlerName=ZA(A,T),this._refreshTooltip()}}}_refreshTooltip(){if(!this._currentHandlerName)return void this._hideTooltip(!1);let A=this._handlers[this._currentHandlerName];if(!A)return;let{settings:w,handler:T}=A,C=this._elt;if(C){let A=C.isNode?"node":"edge";if(-1===this._currentHandlerName.indexOf(A))return}let k=T(C);Promise.resolve(k).then((A=>{this._schedule((()=>this._showTooltip(A,w)),w.delay)}))}_schedule(A,w){this._timeout&&this._modules.dom.clearTimeout(this._timeout),this._timeout=this._modules.dom.setTimeout((()=>{this._timeout=null,A()}),w)}_showTooltip(A,w,T){this._hideTooltip(!1);let{position:C,className:k,autoAdjust:N}=w,O=this._x,j=this._y,G=this._elt,H=this._modules.dom.getDimensions(),W=0,$=0;if(T&&(O=T.x,j=T.y,G=null),"string"==typeof A)this._tooltip=function wC(A){return pe?document.createElement(A):Zo()}("div"),this._tooltip.innerHTML=A;else{if(!Zg(A))throw new Error(`invalid tooltip ${A}, expected HTML string or HTML element`);this._tooltip=A}let Z=this._tooltip;if(k&&this._tooltip.classList.add(k),"cssDefined"!==C&&(Z.style.position="absolute"),Z.style.zIndex=1e4.toString(),this._modules.dom.appendElement(Z),G&&G.isNode){let A=G,w=A.getPositionOnScreen(),T=Number(A.getAttribute("radius"))*("fixed"===A.getAttribute("scalingMethod")?1:this._modules.camera.getZoom())+Number(A.getAttribute("innerStroke.width"))+Number(A.getAttribute("outerStroke.width"));O=w.x,j=w.y,W=T,$=T}let se=Z.offsetWidth/2,ue=Z.offsetHeight/2;if(W+=se,$+=ue,C&&"cssDefined"!==C){let A=lu[C],w=A.x,T=A.y;if(N){let k=O+W*A.x,N=j+$*A.y;(k-se<0||k+se>=H.width)&&("left"===C||"right"===C?w*=-1:w=k-se<0?(se-k+1)/W:(H.width-(k+se)-1)/W),(N-ue<0||N+ue>=H.height)&&("top"===C||"bottom"===C?T*=-1:T=N-ue<0?(ue-N+1)/$:(H.height-(N+ue)-1)/$)}Z.style.left=O+W*w-se+"px",Z.style.top=j+$*T-ue+"px"}this._modules.events.fire("tooltipShow",{tooltip:Z})}};function ZA(A,{button:w,target:T}){return`${A}${w?`.${w}`:""}.${null!==T?T.isNode?"node":"edge":"background"}`}var cu={65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",13:"enter",16:"shift",17:"ctrl",18:"alt",27:"esc",46:"del",8:"backspace",32:"space",224:"cmd",91:"cmd",92:"cmd",93:"cmd",187:"+",189:"-"},_u=Object.keys(cu).reduce(((A,w)=>{let T=cu[w];return A[T]||(A[T]=[]),A[T].push(w),A}),{}),mu=class extends kt{constructor(){super(...arguments),this._onBlur=()=>this.resetKeys(),this._onKeyUp=A=>{let w=A.keyCode||A.which;this._pressed[w]=!1,this._modules.events.fire("keyup",{domEvent:A,key:cu[w],code:w})},this._onKeyDown=A=>{let w=A.keyCode||A.which,T=this._binds[w];if(!this._pressed[w]){if(this._pressed[w]=!0,T)for(let w of T)w.keys.every((A=>A.some((A=>this._pressed[A]))))&&w.handler({domEvent:A});this._modules.events.fire("keydown",{domEvent:A,key:cu[w],code:w})}}}onMounted(){this._modules.events.register(["keyup","keydown"]),this._binds=[],this._pressed=[],this._modules.dom.addWindowEventListener("keydown",this._onKeyDown).addWindowEventListener("keyup",this._onKeyUp).addWindowEventListener("visibilitychange",this._onBlur).addWindowEventListener("blur",this._onBlur,!1),this._idleTimeout=4e3,this._prevEventTimeStamp=Ut(),this._modules.events.onAnyEvent((()=>{let A=Ut();A-this._prevEventTimeStamp>this._idleTimeout&&this.resetKeys(),this._prevEventTimeStamp=A}))}setIdleTimeout(A){if(!isFinite(A)||A<=1)throw new TypeError("Idle timeout must be a positive number > 1");this._idleTimeout=A}resetKeys(){for(let A=0;A<this._pressed.length;A++)this._pressed[A]&&(this._pressed[A]=!1,this._modules.events.fire("keyup",{key:cu[A],code:A}))}onKeyPress(A,w){let T=[];if("number"==typeof A)T=[A];else if("string"==typeof A)T=A.split(" ");else{if(!Array.isArray(A))throw new TypeError(`${A} is not a number, string or array`);T=A}if(0===T.length)throw new Error("the array should contain at least one element");let C=T.map((A=>{if("number"==typeof A)return[A];if("string"==typeof A){let w=_u[A];if(!w)throw new Error(`${A} is not a valid key identifier`);return w}throw new TypeError(`${A} is not a valid key identifier`)})),k=C.pop(),N={keys:C,handler:w};k&&k.forEach((A=>{this._binds[A]||(this._binds[A]=[]),this._binds[A].push(N)}))}isPressed(A){if("number"==typeof A)return this._pressed[A];if("string"==typeof A){let w=_u[A];if(w)return w.some((A=>this._pressed[A]))}return!1}},fu=[{name:"color",isNode:!0},{name:"shape",isNode:!0},{name:"radius",isNode:!0},{name:"icon.content",isNode:!0},{name:"image.url",isNode:!0},{name:"image",isNode:!0},{name:"color",isNode:!1},{name:"shape",isNode:!1},{name:"width",isNode:!1}],xu=Math.PI,yu=2*Math.PI,bu=Math.cos(xu/2-yu/5),vu=Math.cos(xu/2-yu/5*2),Au=Math.cos(xu/2-yu/5*3),Su=Math.cos(xu/2-yu/5*4),Eu=Math.sin(-xu/2+yu/5),wu=Math.sin(-xu/2+yu/5*2),Tu=Math.sin(-xu/2+yu/5*3),Cu=Math.sin(-xu/2+yu/5*4),Lu=1.6,ku=.31,Mu=1/3,Iu=[8,3],Nu=[3,3],Fu={position:"bottom",widgetWidth:130,fontFamily:"Arial",fontSize:10,fontColor:"black",titleFontSize:12,titleFontColor:"black",titleMaxLength:20,titleTextAlign:"left",shapeColor:"grey",backgroundColor:"white",borderColor:"black",borderRadius:0,borderWidth:1,innerMargin:10,outerMargin:5,circleStrokeWidth:3,titleFunction:A=>A[A.length-1]},Pu=["widgetWidth","fontSize","titleFontSize","borderRadius","borderWidth","innerMargin","outerMargin","circleStrokeWidth"];function ib(A){return Array.isArray(A)?A.reduce(((A,w)=>A&&ib(w)),!0):"undefined"===A||!isNaN(Number(A))}function ob(A){return Array.isArray(A)?A.reduce(((A,w)=>Math.min(A,ob(w))),1/0):"number"==typeof(A=Number(A))?isNaN(A)?1/0:+A:1/0}function sb(A){return Array.isArray(A)?A.reduce(((A,w)=>Math.max(A,sb(w))),-1/0):"number"==typeof(A=Number(A))?isNaN(A)?-1/0:+A:-1/0}function In(A){let w=["K","M","B","T","P","E","Z","Y"];if(A>9999){let T=0;for(;T<w.length&&A>999;)A/=1e3,T++;return(nv(A,3)+w[T-1]).toString()}return nv(A,4).toString()}function nv(A,w=3){let T=4===w?10:1;return A<10?Math.round(100*A*T)/(100*T):A<100?Math.round(10*A*T)/(10*T):A<1e3?Math.round(A*T)/T:Math.round(A)}function fg(A){return A.innerMargin+(A.titleFontSize+A.fontSize)*Lu}var iv=(A,w)=>A.isNode!==w.isNode?A.isNode?-1:1:A.title<=w.title?-1:1,ov=(A,w)=>A.height-w.height,sv=(A,w)=>A.isNode!==w.isNode?A.isNode?-1:1:w.height-A.height,av=(A,w)=>A.isNode!==w.isNode?A.isNode?-1:1:A.content[0].title<=w.content[0].title?-1:1;function dv(A,w,T){let C=w.getContext("2d"),{x:k,y:N,height:O,isNode:j,styleProperty:G,title:H,mapping:W,iconFont:$,iconFontStyle:Z}=T;(function MC(A,w,T,C,k){return function $C(A,w,T,C,k,N,O,j,G){A.setLineDash([]),A.beginPath(),A.moveTo(w+N,T),A.lineTo(w+C-N,T),A.quadraticCurveTo(w+C,T,w+C,T+N),A.lineTo(w+C,T+k-N),A.quadraticCurveTo(w+C,T+k,w+C-N,T+k),A.lineTo(w+N,T+k),A.quadraticCurveTo(w,T+k,w,T+k-N),A.lineTo(w,T+N),A.quadraticCurveTo(w,T,w+N,T),A.closePath(),A.fillStyle=O,A.fill(),A.strokeStyle=j,A.lineWidth=G,A.stroke()}(A,T,C,w.widgetWidth,k,w.borderRadius,w.backgroundColor,w.borderColor,w.borderWidth)})(C,A,k,N,O),function kC(A,w,T,C,k){ru(A,w.fontFamily,w.titleFontSize,w.titleFontColor,w.titleTextAlign);let N="center"===w.titleTextAlign,O=w.widgetWidth-2*w.innerMargin,j=A.measureText(T).width,G=C+(N?w.widgetWidth/2:w.innerMargin),H=k+w.titleFontSize/2+w.innerMargin;if(j>O){let A=O/j,w=(T.length*A|0)-2;T=T.substr(0,w)+""}A.fillText(T,G,H)}(C,A,H,k,N);let se=A.fontSize*Lu,ue=A.fontSize/2*Lu*.9,ge=3*A.fontSize,ce=A.fontSize,_e=function FC(A,w){let T=w?1:3;return A.fontSize*T}(A,j),me=N+fg(A),pe=k+A.innerMargin+_e/2,be=k+2*A.innerMargin+_e,Se=$i(W),Ee=ib(Se),Te=A.fontColor,Ce=A.shapeColor,Ie=Object.keys(W);if(Ee&&(Ie.sort(((A,w)=>Hr(W[w])-Hr(W[A]))),"radius"===G||"width"===G)){let w=ob(Se),T=sb(Se);return(j?QC:JC)(A,C,k,me,w,(w+T)/2,T,Ce)}Ie.forEach((w=>{let T=W[w];"color"===G&&(j?lv(C,pe,me,ue,w):function GC(A,w,T,C,k,N){A.fillStyle=N,A.fillRect(w-C/2,T-k/2,C,k)}(C,pe,me,ge,ce,w)),"shape"===G&&(j?function KC(A,w,T,C,k,N){switch(A.fillStyle=N,k){case"square":return A.fillRect(w-C,T-C,2*C,2*C);case"circle":return lv(A,w,T,C,N);case"cross":return function VC(A,w,T,C){A.fillRect(w-C,T-C*ku,2*C,2*C*ku),A.fillRect(w-C*ku,T-C,2*C*ku,2*C)}(A,w,T,C);case"diamond":return function HC(A,w,T,C){return A.beginPath(),A.moveTo(w-C,T),A.lineTo(w,T-C),A.lineTo(w+C,T),A.lineTo(w,T+C),A.fill()}(A,w,T,C);case"equilateral":return function WC(A,w,T,C){A.beginPath(),A.moveTo(w,T-C),A.lineTo(w+bu*C,T+Eu*C),A.lineTo(w+vu*C,T+wu*C),A.lineTo(w+Au*C,T+Tu*C),A.lineTo(w+Su*C,T+Cu*C),A.fill()}(A,w,T,C);case"star":return function XC(A,w,T,C){A.beginPath(),A.moveTo(w,T-C),A.lineTo(w+vu*C,T+wu*C),A.lineTo(w+Su*C,T+Cu*C),A.lineTo(w+bu*C,T+Eu*C),A.lineTo(w+Au*C,T+Tu*C),A.fill()}(A,w,T,C)}}(C,pe,me,ue,w,Ce):function ZC(A,w,T,C,k,N,O){if(A.fillStyle=O,"line"===N&&A.fillRect(w-C/2,T-k/4,C,k/2),"arrow"===N)return function YC(A,w,T,C,k){A.fillRect(w-C/2,T-k/4,C*(1-Mu),k/2),A.beginPath(),A.moveTo(w+C*(1-Mu-.5),T-k/2),A.lineTo(w+C*(1-Mu-.5),T+k/2),A.lineTo(w+C/2,T),A.fill()}(A,w,T,C,k);if("dashed"===N||"dotted"===N)return function qC(A,w,T,C,k,N,O){A.beginPath(),A.moveTo(w-C/2,T),A.lineTo(w+C/2,T),A.strokeStyle=N,A.lineWidth=k/2,A.setLineDash("dashed"===O?Iu:Nu),A.stroke()}(A,w,T,C,k,O,N);if("tapered"===N)return function jC(A,w,T,C,k){A.beginPath(),A.moveTo(w-C/2,T-k/2),A.lineTo(w-C/2,T+k/2),A.lineTo(w+C/2,T),A.fill()}(A,w,T,C,k)}(C,pe,me,ge,ce,w,Ce)),"icon.content"===G&&function zC(A,w,T,C,k,N,O,j){ru(A,k,2*N,O,"center",j),A.fillText(C,w,T)}(C,pe,me,w,$,ue,Te,Z),("image"===G||"image.url"===G)&&function UC(A,w,T,C,k){if("undefined"==typeof Image)return;A._imgStore||(A._imgStore={});let N=A._imgStore[k];if(N)return A.drawImage(N,w-C,T-C,2*C,2*C);N=new Image,N.src=k,N.onload=()=>{A.drawImage(N,w-C,T-C,2*C,2*C)},A._imgStore[k]=N}(C,pe,me,ue,w),function BC(A,w,T,C,k,N){let O=k.join();if(N)if(1===k.length)O=In(k[0]);else{let A=Hr(k),w=di(k);O=`${In(A)} - ${In(w)}`}ru(A,w.fontFamily,w.fontSize,w.fontColor),A.fillText(O,T,C)}(C,A,be,me,T,Ee),me+=se}))}function RC(A,w,T,C,k,N){A.beginPath(),A.arc(w,T,C,0,yu),A.strokeStyle=k,A.lineWidth=N,A.stroke()}function ru(A,w,T,C,k="left",N="normal"){A.textAlign=k,A.textBaseline="middle",A.fillStyle=C,A.font=`${N} ${T}px "${w}"`}function lv(A,w,T,C,k){A.beginPath(),A.arc(w,T,C,0,2*xu),A.fillStyle=k,A.fill()}function QC(A,w,T,C,k,N,O,j){let G=.7*A.fontSize,H=3*G,W=(G+H)/2,$=T+A.innerMargin+H,Z=$+H+A.innerMargin,se=C+2*H-.5*A.innerMargin,ue=A.circleStrokeWidth;for(let A of[G,W,H])RC(w,$,se-A,A,j,ue);ru(w,A.fontFamily,A.fontSize,A.fontColor,"left"),w.fillText(In(k),Z,se+G-2*G),w.fillText(In(N),Z,se+G-2*W),w.fillText(In(O),Z,se+G-2*H)}function JC(A,w,T,C,k,N,O,j){let G=(A.widgetWidth-2*A.innerMargin)/3,H=A.fontSize,W=C-A.innerMargin/2,$=W+2*H,Z=T+A.innerMargin;w.fillStyle=j,w.fillRect(Z,W-H/2,G+1,H),w.fillRect(Z+G,W-H/3,G+1,H/1.5),w.fillRect(Z+2*G,W-H/6,G,H/3),ru(w,A.fontFamily,A.fontSize,A.fontColor,"center"),w.fillText(In(O),Z+.5*G,$),w.fillText(In(N),Z+1.5*G,$),w.fillText(In(k),Z+2.5*G,$)}function uv(A,w,T,C){let k=C.outerMargin+fg(C),N=C.fontSize*Lu,O=k-.8*C.innerMargin;return"radius"===w||"width"===w?O+N*(T?3:2):O+Object.keys(A).length*N}function cv(A,w,T){let C={width:w.width,height:w.height},k=!1;return!!(C.width&&C.height&&T)&&(k="top"===A.position||"bottom"===A.position?function nO(A,w,T,C){T=T.slice();let k=w.widgetWidth+w.outerMargin,N=Math.floor((A.width-w.outerMargin)/k),O=A.height-w.outerMargin,j=new Array(Math.min(N,T.length)),G=T.length,H=0,W=0,$=0,Z=0;for(let A=0;A<G;++A){let w=T[A];w.isNode?(H+=1,W+=w.height):($+=1,Z+=w.height)}let se=W+Z,ue=W/se,ge=Z/se,ce=Math.round(ue*N),_e=Math.round(ge*N);if(ce>H?ce=H:_e>$&&(ce=N-$),0===N)return!1;for(let A=0;A<j.length;A++)j[A]={content:[],height:0,isNode:A<ce};for(let A=0;A<G;++A){let A=rO(T);tO(T[A],j,w),T.splice(A,1)}j.every((({content:A})=>1===A.length))?j.sort(av):j.sort(sv);let me=w.outerMargin;for(let T=0;T<j.length;++T){let N=j[T];if(N.height>O)return!1;N.content.sort(ov);let G=0;for(let T=0;T<N.content.length;++T){let k=N.content[T];k.x=me,k.y=C?A.height-G-k.height-w.outerMargin:G+w.outerMargin,G+=k.height+w.outerMargin}me+=k}return!0}(C,A,T,"bottom"===A.position):function eO(A,w,T,C){let k=w.widgetWidth+w.outerMargin,N=Math.floor((A.width-w.outerMargin)/k),O=A.height,j=w.outerMargin,G=C?w.outerMargin:A.width-k,H=1;T=T.slice().sort(iv);for(let A=0;A<T.length;++A){let N=T[A];if(j+N.height>O){if(j===w.outerMargin)return!1;j=w.outerMargin,H+=1,C?G+=k:G-=k}N.x=G,N.y=j,j+=N.height}return H<=N}(C,A,T,"left"===A.position),k&&T.forEach((T=>dv(A,w,T))),k)}function tO(A,w,T){let C=null;for(let T=0;T<w.length;++T){let k=w[T];(k.isNode===A.isNode||1===w.length)&&(null===C||k.height<w[C].height)&&(C=T)}if(null!=C){let k=w[C];k.content.push(A),k.height+=A.height+T.outerMargin}}function rO(A){let w=0;for(let T=1;T<A.length;++T)A[T].height>A[w].height&&(w=T);return w}var Du=class extends kt{constructor(){super(...arguments),this._enabled=!1,this._mustRefresh=!1,this._promises=[]}onMounted(){this._modules.events.on("newFrame",(()=>{this._enabled&&this._mustRefresh&&this._layer.refresh()})).on(["resize","reloadFonts"],(()=>{this._mustRefresh=!0}))}enable(A={}){let w=this._settings;return this._settings=re(re({},Fu),A),this._mustRefresh=!this._enabled||!this._sameOptions(w,this._settings),this._enabled?Promise.resolve():(this._enabled=!0,this._layer=this._modules.layers.addCanvasLayer((A=>{this._drawOnCanvas(this._settings,A.canvas,Ye());let w=this._promises;this._promises=[],w.forEach((A=>A())),this._mustRefresh=!1}),{isStatic:!0,noClear:!1}),this._layer.moveToTop(),this.refresh())}_afterNextUpdate(){return new Promise((A=>this._promises.push(A)))}_formatSettings(A,w){let T=re(re({},Fu),A);return Pu.forEach((A=>T[A]*=w)),T}disable(){return this._enabled&&(this._enabled=!1,this._layer.destroy()),Promise.resolve()}enabled(){return this._enabled}refresh(){return this._mustRefresh=!0,this._modules.dom.refresh(),this._afterNextUpdate()}destroy(){this._enabled=!1,this._mustRefresh=!1,this._settings=re({},Fu),this._promises=[]}getOptions(){return this._enabled?re({},this._settings):re({},Fu)}getCurrentOptions(){return this._settings}_sameOptions(A,w){return A===w||Object.keys(A).reduce(((T,C)=>T&&A[C]===w[C]),!0)}_drawOnCanvas(A,w,T){let C=this._formatSettings(A,T);cv(C,w,this._computeWidgetList(C))}exportOnCanvas(A,w,T){return this._drawOnCanvas(w,A,T)}export(A={}){let{width:w,height:T}=re(re({},this._modules.camera.getSize()),A),C=Ye(),k=Lt(w*C,T*C);return this._drawOnCanvas(A,k,C),Promise.resolve().then((()=>k))}_computeWidgetList(A){let w=[];return fu.forEach((({name:T,isNode:C})=>{let k=this._computeWidget(A,T,C);k&&w.push(k)})),w}_computeWidget(A,w,T){let C=this._computePropertyMapping(A,w,T);if(C){if("icon.content"!==w)return C;let A=this._getRulesForAttribute(T,"icon.font"),k=this._getRulesForAttribute(T,"icon.style"),N=null,O=null;if(A.length||(N="Arial",O="normal"),"string"==typeof A[0]&&(N=A[0],O=k[0]),N&&O)return C.iconFont=N,C.iconFontStyle=O,C}return null}_computePropertyMapping(A,w,T){let[C]=this._getRulesForAttribute(T,w),k=C&&C.mapping,N=k&&k.getValues(T);if(k&&N){let C=k.getField(),O={};return cr(N,((A,w)=>{void 0===A||"undefined"===w||(O[A]=O[A]||[],O[A].push(w))})),0===Object.keys(O).length?null:{isNode:T,title:A.titleFunction(C,w),styleProperty:w,dataProperty:C,mapping:O,height:uv(O,w,T,A)}}return null}_getRulesForAttribute(A,w){return this._modules.styleRules.getRuleList().map((T=>{let C=T.getDefinition();return Tt(A?C.nodeAttributes:C.edgeAttributes,w)})).filter(ur).sort(((A,w)=>A.mapping&&w.mapping?0:A.mapping?-1:1))}},Ru={layer:3,outerStroke:{color:"red",width:5},innerStroke:{minVisibleSize:0},text:{backgroundColor:Gn,minVisibleSize:0}},Ou={layer:3,color:"red",text:{backgroundColor:Gn,minVisibleSize:0}},Bu=class extends kt{constructor(){super(...arguments),this._delay=100,this._manualTriggerDetection=!1,this._hovered=null,this._hoveredTextHidden=!1,this._onAnimate=({duration:A})=>{A&&(this._manualTriggerDetection=!0,this._resetHover())},this._onBeforeNewFrame=()=>{if(this._manualTriggerDetection&&!this._modules.graphics.isAnimating()){this._manualTriggerDetection=!1,this._modules.captor.triggerDetection();let A=this._modules.captor.getPointedElement();A&&this._hover(A)}},this._onClear=()=>{this._hovered=null,this._timeout&&this._modules.dom.clearTimeout(this._timeout)},this._resetHover=()=>{this._hovered&&(this._unhover(this._hovered),this._modules.captor.triggerUnhover()),this._timeout&&(this._modules.dom.clearTimeout(this._timeout),this._timeout=null)}}setRate(A){this._delay=A}updateNodeAttributes(A,w){this._hoverClass.update({nodeAttributes:A,fullOverwrite:w}),this._hoverExtremityHighlightedClass.update({nodeAttributes:A,fullOverwrite:w}),this._updateExtremityHighlightLayer()}updateEdgeAttributes(A,w){this._hoverClass.update({edgeAttributes:A,fullOverwrite:w}),this._updateExtremityHighlightLayer()}getHoverClassDefinition(){return this._hoverClass.getDefinition()}onMounted(){this._registerSettings(),this._hoverExtremityHighlightedClass=this._modules.classes.createClass({name:si,isBuiltin:!0,nodeAttributes:Ru}),this._hoverClass=this._modules.classes.createClass({name:ti,isBuiltin:!0,nodeAttributes:Ru,edgeAttributes:Ou}),this._modules.events.on("mouseover",(({target:A})=>A&&this._hover(A))).on("mouseout",(({target:A})=>A&&this._unhover(A))).on("animate",this._onAnimate).on("beforeNewFrame",this._onBeforeNewFrame).on("mouseout",this._resetHover).on("clearGraph",this._onClear);let e=()=>{this._hoverExtremityHighlightedClass.clearNodes(),this._hoverClass.getEdges().getExtremities().addClass(si)};this._modules.classes.onEdgeClassAdded(ti,e),this._modules.classes.onEdgeClassRemoved(ti,e)}_registerSettings(){this._modules.settings.register("cursor.node","pointer",((A,w)=>{this._hovered&&this._hovered.isNode&&(this._modules.graphics.removeCursorStyle(w),this._modules.graphics.addCursorStyle(A))})),this._modules.settings.register("cursor.edge","pointer",((A,w)=>{this._hovered&&!this._hovered.isNode&&(this._modules.graphics.removeCursorStyle(w),this._modules.graphics.addCursorStyle(A))})),this._modules.settings.register("nodeHover",!0,(A=>{!A&&this._hovered&&this._hovered.isNode&&this._unhover(this._hovered)})),this._modules.settings.register("edgeHover",!0,(A=>{!A&&this._hovered&&!this._hovered.isNode&&this._unhover(this._hovered)}))}_updateExtremityHighlightLayer(){let A=this._hoverClass.getDefinition().edgeAttributes,w=A?A.layer:void 0;this._hoverExtremityHighlightedClass.update({nodeAttributes:{layer:w},fullOverwrite:!1})}_removeTimeout(){this._timeout&&(this._modules.dom.clearTimeout(this._timeout),this._timeout=null)}_hover(A){let w=A.isNode?"nodeHover":"edgeHover";!this._modules.settings.get(w)||this._modules.graphics.isAnimating()||(this._removeTimeout(),this._timeout=this._modules.dom.setTimeout((()=>{this._modules.graphics.isAnimating()||(this._setElementHighlight(!0,A),this._hovered=A),this._timeout=null}),this._delay))}_unhover(A){this._removeTimeout(),this._hovered===A&&(this._setElementHighlight(!1,A),this._hovered=null)}_setElementHighlight(A,w){let T=this._modules.settings.get(w.isNode?"cursor.node":"cursor.edge");if(A?(this._modules.graphics.addCursorStyle(T),w.addClass(ti)):(this._modules.graphics.removeCursorStyle(T),w.removeClass(ti)),w.isNode){let T=this._modules.graph.getAttribute(w.isNode,"textHidden"),C=w._index;A&&(this._hoveredTextHidden=0!==T.get(C));let k=!A&&this._hoveredTextHidden;T.set(C,k)}}},ju=class extends kt{constructor(){super(...arguments),this.x=0,this.y=0}};function mv(A,w,T){let C=(w?A.getNodes():A.getEdges()).getData(T),k={};return C.forEach((A=>{if(!Array.isArray(A))return k[A]=1;A.forEach((A=>k[A]=1))})),"undefined"in k&&delete k.undefined,Object.keys(k).sort()}function gv(A,w,T,C){let{values:k={},fallback:N}=T,O=mv(A,C,w),j={},G=0;for(let A=0;A<O.length;++A){let w=O[A];w in k?j[w]=k[w]:(j[w]=N[G],G=(G+1)%N.length)}return j}function pv(A,w,T,C){let{fallback:k,stops:N={},values:O,reverse:j}=T,G=mv(A,C,w),H=1/0,W=-1/0;for(let A=0;A<G.length;A++){let w=+G[A];da(w)&&(H=Math.min(H,w),W=Math.max(W,w),G[A]=w)}let $={};if(!isFinite(H)){for(let A=0;A<G.length;A++)$[G[A]]=k;return $}let Z=function sO(A,{nbSlices:w,minValue:T,maxValue:C}){if(Array.isArray(A))return A.slice();let{min:k=T,max:N=C}=A,O=(N-k)/w,j=[];for(let A=1;A<w;++A)j.push(k+O*A);return j}(N,{nbSlices:Array.isArray(O)?O.length:O.nbSlices,minValue:H,maxValue:W}),se=function aO(A,w){if(Array.isArray(A))return A;let{min:T,max:C}=A,k=w.length+1,N=(C-T)/w.length,O=[];for(let A=0;A<k;A++)O.push(T+A*N);return O}(O,Z);j&&se.reverse();for(let A=0;A<G.length;++A){let w=G[A];if(isFinite(w)){let A=0;for(;A<Z.length&&Z[A]<=w;)A+=1;$[w]=se[A]}else $[w]=k}return $}var Vu=class extends kt{constructor(){super(...arguments),this._mappingList=[]}onMounted(){this._modules.events.on(["addStyleRule","updateStyleRule"],(({rule:A,options:w})=>{[...$i(w.nodeAttributes||{}),...$i(w.edgeAttributes||{})].forEach((w=>{w&&this._recursiveGetMapping(w).forEach((w=>w.assignTo(A.id)))}))})).on("removeStyleRule",(({rule:A})=>{this._mappingList.forEach((w=>w.unAssignTo(A.id)))})).on(["addNodes","addEdges","updateNodeData","updateEdgeData","removeNodes","beforeRemoveEdges","excludedStateChange","clearGraph"],(()=>{this._mappingList.forEach((A=>{let w=A.getAssignedRules();A.markAsInvalid(),w.forEach((A=>{this._modules.styleRules.refreshRule(A)}))})),this._modules.legend.refresh()}))}_recursiveGetMapping(A,w=[]){if(!A)return w;if(A.mapping)return w.push(A.mapping),w;if("object"!=typeof A)return w;let T=$i(A).map((A=>this._recursiveGetMapping(A)));return w.concat(...T)}createMapping({field:A,values:w={},fallback:T}={field:""}){if(A=Br(A),Array.isArray(T)?0===T.length&&(T=[void 0]):T=[T],!wn(w))throw new Error('"mapping" should be an object');return this._createMappingFunction(gv,A,{values:w,fallback:T})}createSlices({field:A,fallback:w,stops:T={},values:C,reverse:k=!1}={field:"",values:[]}){if(A=Br(A),!Array.isArray(C)&&!C.nbSlices&&(C.nbSlices=7),Array.isArray(T)&&Array.isArray(C)&&T.length!==C.length-1)throw new Error("there should be exactly one more value that stops");return this._createMappingFunction(pv,A,{fallback:w,stops:T,values:C,reverse:k})}_createMappingFunction(A,w,T){let C=new class{constructor(A,w){this._nodeMapping={valid:!1,values:{}},this._edgeMapping={valid:!1,values:{}},this._computeMapping=w,this._field=A,this._assignedRules=[]}getValue(A,w){let T=A.isNode,C=T?this._nodeMapping:this._edgeMapping;C.valid||(C.values=this._computeMapping(T),C.valid=!0);let k=A.getData(this._field);return Array.isArray(k)?"color"===w?k.map((A=>C.values[A])):C.values[k[0]]:C.values[k]}markAsInvalid(){this._nodeMapping.valid=!1,this._edgeMapping.valid=!1}getValues(A){return A?this._nodeMapping.values:this._edgeMapping.values}getField(){return this._field}isAssignedTo(A){return this._assignedRules.find((w=>w===A))}getAssignedRules(){return this._assignedRules.slice()}assignTo(A){this.isAssignedTo(A)||this._assignedRules.push(A)}unAssignTo(A){this._assignedRules=this._assignedRules.filter((w=>w!==A))}}(w,(C=>A(this._modules.graph,w,T,C)));this._mappingList.push(C);let s=(A,w,T)=>C.getValue(A,T);return s.mapping=C,s}createTemplate(A){if("string"!=typeof A)throw new TypeError('"template" should be a string');let w=[],T=0,C=!1;for(;!C;){let k=-1,N=A.indexOf("{{",T);-1!==N&&(k=A.indexOf("}}",N+2)),-1!==k?(w.push(A.substring(T,N)),w.push(A.substring(N+2,k)),T=k+2):(w.push(A.slice(T)),C=!0)}return function(A){let T=w[0];for(let C=1;C<w.length;C+=2)T+=A.getData(w[C]),T+=w[C+1];return T}}},Hu=class{constructor({duration:A,enabled:w}){this._duration=A||0,this._removalDuration=A||0,this.enabled=!1,this.shouldUndo=!1,this.destroyed=!1,this.shouldDo=!1!==w,this.shouldAnimate=this.shouldDo,this._error=null,this._whenApplied=new Promise(((A,w)=>{this._resolveFunction=A,this._rejectFunction=w}))}getDuration(){return this._duration}getAnimationDuration(A=!0){return this.shouldAnimate?A?this._duration:this._removalDuration:0}setDuration(A){void 0!==A&&(this._duration=A)}getRemovalDuration(){return this._removalDuration}setRemovalDuration(A){void 0!==A&&(this._removalDuration=A)}getContext(){return this._context}setContext(A){this._context=A}getError(){return this._error}setError(A){this._error=A}getOgma(){return this._ogma}resolve(){this._resolveFunction(this)}reject(){let A=this._error;return this._error=null,this._rejectFunction(A)}getName(){throw new Error("type not set")}getId(){return this._id}whenApplied(){return this._whenApplied}isEnabled(){return this.enabled}setEnabled(A){this.enabled=A}initialize({id:A,ogma:w}){this._id=A,this._ogma=w,this.resetContext()}enable(A){return this._ogma.modules.transformations.enable(this,A||0)}disable(A){return this._ogma.modules.transformations.disable(this,A||0)}toggle(A){return this.enabled?this.disable(A):this.enable(A)}getIndex(){return this._ogma.modules.transformations.getIndex(this)}setIndex(A){return this._ogma.modules.transformations.setIndex(this,A).then((()=>this))}setOptions(A){return this._ogma.modules.transformations.setOptions(this,re({duration:this._duration,enabled:this.enabled},A)).then((()=>this))}_setOptions(A){this._duration=void 0===A.duration?this._duration:A.duration}destroy(A){return this.destroyed=!0,this._ogma.modules.transformations.remove(this,A||0)}refresh(){return this._ogma.view.afterNextFrame().then((()=>this._refresh()))}_refresh(){return this._ogma.modules.transformations.refresh(!0)}resetContext(){this._context={virtualNodes:this._ogma.nodeList(),virtualEdges:this._ogma.edgeList()}}run(){throw new Error("run function not implemented")}cleanup(){throw new Error("cleanup function not implemented")}undo(){throw new Error("undo function not implemented")}onClearGraph(){this.resetContext()}},Wu=class extends Hu{constructor(A){super(A),this._getNodesToFilter=A.getNodesToFilter,this._getEdgesToFilter=A.getEdgesToFilter}run(){let A=this._ogma,w=this.getAnimationDuration(),T=this._getNodesToFilter(A),C=this._getEdgesToFilter(A,T);return Promise.all([T.addClass(fi,w),C.addClass(fi,w)]).then((()=>(T.setExcluded(!0),C.setExcluded(!0),ke(re({},this._context),{nodes:T,edges:C}))))}undo(){let A=this.getAnimationDuration(),{nodes:w,edges:T}=this._context;return w.setExcluded(!1),T.setExcluded(!1),w.addClass(fi),T.addClass(fi),Promise.all([w.removeClass(fi,A),T.removeClass(fi,A)])}resetContext(){super.resetContext(),this._context=ke(re({},this._context),{nodes:this._ogma.nodeList(),edges:this._ogma.edgeList()})}cleanup(){return Promise.resolve()}get context(){return this._context}},Xu=class extends Wu{constructor(A){let w=A.criteria;super(ke(re({},A),{getNodesToFilter:A=>A.getNodes().filter((A=>!w||!w(A))),getEdgesToFilter:(A,w)=>w.getAdjacentEdges()}))}getName(){return"node-filter"}_setOptions(A){super._setOptions(A);let w=A.criteria;this._getNodesToFilter=A=>A.getNodes().filter((A=>!w||!w(A)))}},$u=class extends Wu{constructor(A){super(ke(re({},A),{getNodesToFilter:A=>A.createNodeList(),getEdgesToFilter:w=>w.getEdges().filter((w=>!A.criteria||!A.criteria(w)))}))}getName(){return"edge-filter"}_setOptions(A){super._setOptions(A),this._getEdgesToFilter=w=>w.getEdges().filter((w=>!A.criteria||!A.criteria(w)))}};function ab(A){return"object"!=typeof A?{criteria:A,enabled:!0,duration:0}:A}var Yu=class extends kt{addNodeFilter(A){return this._modules.transformations.add(new Xu(ab(A)))}addEdgeFilter(A){return this._modules.transformations.add(new $u(ab(A)))}},dO=A=>A.stopPropagation(),lO=(A,w)=>{w.style.position="absolute",w.style.left="0",w.style.top="0",A.appendChild(w)},qu=class extends kt{constructor(){super(...arguments),this._elements=[],this._layers=[],this.readyCallbacks=[],this.render=(A,w,T,C)=>{let k=Ye(),{zoom:N,x:O,y:j,width:G,height:H}=C||this._modules.camera.getView();if(void 0===N||void 0===O||void 0===j||void 0===G||void 0===H)return null;let W=k*N;T.noClear||A.clearRect(0,0,G*k,H*k),T.isStatic||(A.save(),A.translate(G*k/2,H*k/2),A.rotate(C?-(C.angle||0):-this._modules.camera.getAngle()),A.translate(-O*W,-j*W),A.scale(W,W)),w(A),T.isStatic||A.restore()},this.createCanvas=(A,w)=>{let T,C,{width:k,height:N}=this._modules.camera.getSize(),O=w.canvas||Lt(k,N),j=w.ctx||O.getContext("2d"),d=(T=A)=>{j&&this.render(j,T,w)},u=()=>{let{width:A,height:w}=this._modules.camera.getSize(),T=Ye();O.width=A*T,O.height=w*T,O.style.width=`${A}px`,O.style.height=`${w}px`,d()};if(w.isStatic)this._modules.dom.addDirectWindowEventListener("resize",u),T=()=>{this._modules.dom.removeDirectWindowEventListener("resize",u)};else{let A,w=this._modules.camera.getCenter(),k=this._modules.camera.getZoom(),N=!1,j=0,G=500,b=()=>{N||(d(),N=!0,w=this._modules.camera.getCenter(),k=this._modules.camera.getZoom())},y=()=>{N||b();let{x:A,y:T}=this._modules.camera.getCenter(),C=A-w.x,j=T-w.y,G=-C*k,H=-j*k,W=this._modules.camera.getZoom()/k,$=-this._modules.camera.getAngle();O.style.transform=`\n          scale(${W})\n          rotate(${-$}rad)\n          translateX(${G}px)\n          translateY(${H}px)\n          rotate(${$}rad)\n        `.replace(/\n/g,"")};C=()=>!N||(d(),N=!1,O.style.transform="scale(1) translateX(0px) translateY(0px)",!1);let x=w=>{A&&clearTimeout(A),b()},D=w=>{Date.now()<j&&A&&clearTimeout(A),A=setTimeout(C,w.duration+G),b()};this._modules.events.on("dragStart",x).on("zoomStart",D).on("dragEnd",C).on(["viewChanged","zoom","rotate","move","animate"],y),this._modules.dom.addDirectWindowEventListener("resize",C),this._modules.dom.addDirectWindowEventListener("resize",u),this._modules.events.on("resize",u),T=()=>{this._modules.events.off(u).off(x).off(D).off(C).off(y),this._modules.dom.removeDirectWindowEventListener("resize",C),this._modules.dom.removeDirectWindowEventListener("resize",u)}}return O.style.touchAction="none",O.style.pointerEvents="none",u(),{element:O,removeListeners:T,refresh:A=>{(!C||C())&&d(A)},clear:()=>null==j?void 0:j.clearRect(0,0,O.width,O.height)}},this._createOverlay=A=>{let r=()=>{let{element:w,position:T}=A,{zoom:C,x:k,y:N,width:O,height:j}=this._modules.camera.getView();if(void 0===C||void 0===k||void 0===N||void 0===O||void 0===j)return null;let G=C,H=O/2,W=j/2,$=-this._modules.camera.getAngle(),Z=(T.x-k)*G,se=(T.y-N)*G;w.style.transformOrigin="top left",w.style.transform=`translate(${H}px, ${W}px) rotate(${$}rad) translate(${Z}px, ${se}px) ${A.scaled?`scale(${G}, ${G})`:""}`};this._modules.events.on(["viewChanged","zoom","rotate","move","animate"],r);let{element:w,size:T}=A;return T&&(w.style.width=`${T.width}`,w.style.height=`${T.height}`),w.addEventListener("mousemove",dO),r(),{element:w,removeListeners:()=>{this._modules.events.off(r)},updateTransformation:r}},this.addLayer=(A,w="layer",T=this._elements.length)=>{let C="string"==typeof A?cc(A):A;this._elements.push(C);let k={element:C};return k.type=w,k.getLevel=()=>this._elements.indexOf(C),k.moveTo=A=>(this._elements.splice(A,0,this._elements.splice(k.getLevel(),1)[0]),this._updateDom(this._elements),k),k.moveUp=()=>k.moveTo(k.getLevel()+1),k.moveDown=()=>k.moveTo(k.getLevel()-1),k.moveToTop=()=>k.moveTo(this._elements.length-1),k.moveToBottom=()=>k.moveTo(0),k.destroy=()=>this._removeLayer(k),k.hide=()=>(k.element&&(k.element.style.visibility="hidden"),k),k.show=()=>(k.element&&(k.element.style.visibility="visible"),k),k.isHidden=()=>"hidden"===k.element.style.visibility,k.setOpacity=A=>(k.element&&(k.element.style.opacity=A.toString()),k),k.getOpacity=()=>parseFloat(k.element.style.opacity||"1"),k.setPosition=A=>{if(k.element){let w=k.element.style;w.left=`${A.x}px`,w.top=`${A.y}px`}return k},k.setSize=A=>{if(k.element&&A){let{width:w,height:T}=A,C=k.element.style;C.width=`${w}px`,C.height=`${T}px`}return k},k.moveTo(T),this._layers.push(k),k},this.addCanvasLayer=(A,w={isStatic:!1,noClear:!1},T=this._elements.length)=>{let C=this.createCanvas(A,w),{element:k,removeListeners:N,refresh:O,clear:j}=C,G=this.addLayer(k,"canvas",T);return k.classList.add("ogma-canvas-layer"),G.destroy=()=>this._removeLayer(G,N),G.refresh=O,G.clear=j,G.draw=A,G.options=w,G},this.addOverlay=(A,w=this._elements.length)=>{"string"==typeof A.element&&(A.element=cc(A.element)),A.scaled=void 0===A.scaled||A.scaled;let T=this._createOverlay(A),{element:C,removeListeners:k,updateTransformation:N}=T,O=this.addLayer(C,"overlay",w);return O._onViewChange=N,O._onDestroy=k,O.destroy=()=>this._removeLayer(O,k),O.setPosition=w=>(A.position=w,N(),O),A.size&&O.setSize(A.size),O}}onMounted(){let A=this._modules.graphics.getDomElement();var w;this._updateDom=(w=A,A=>{for(;w.firstChild;)w.removeChild(w.firstChild);for(let T=0;T<A.length;++T)lO(w,A[T])});let T=A.firstChild;this._modules.events.on("viewExport",(({inputCanvas:A,outputCanvas:w,view:T})=>{let C=this._layers.sort(((A,w)=>A.getLevel()-w.getLevel())).filter((A=>"canvas"===A.type)),k=C.filter((A=>A.getLevel()<1)),N=C.filter((A=>A.getLevel()>=1)),O=w.getContext("2d");O.fillStyle=T.backgroundColor,T.renderBackground&&(null==O||O.fillRect(0,0,A.width,A.height)),k.forEach((A=>{this.render(O,A.draw,ke(re({},A.options),{noClear:!0}),T)})),null==O||O.drawImage(A,0,0,A.width,A.height),N.forEach((A=>{this.render(O,A.draw,ke(re({},A.options),{noClear:!0}),T)}))})),T&&(this.ogmaLayer=this.addLayer(T)),this.runCallbacks()}runCallbacks(){this.ogmaLayer&&(this.readyCallbacks.forEach((A=>A())),this.readyCallbacks=[])}whenReady(A){this.readyCallbacks.push(A),this.ogmaLayer&&this.runCallbacks()}_removeLayer(A,w){return A.element&&A.element.parentNode&&(this._elements.splice(A.getLevel(),1),w&&w(),A.element=null,this._updateDom(this._elements)),this._layers=this._layers.filter((w=>w!==A)),A}destroy(){this._elements=[]}},Zu=class{constructor(A){this._ogma=A}},fv=(A,w)=>{if(!A)throw new Error("Traversal options are required");if("function"!=typeof A.onNode)throw new Error("onNode callback is required");if(A.root=w.getNode(A.root),!A.root)throw new Error(`Root node '${A.root}' does not exist`);return A},Qu=class extends Zu{constructor(){super(...arguments),this.shortestPath=A=>this._ogma.modules.algorithms.shortestPath(A),this.hasCycle=A=>{let{nodes:w,edges:T}=A||{nodes:void 0,edges:void 0};return null!==this.detectCycle({nodes:w,edges:T})},this.getAllSimpleCycles=A=>{let{nodes:w,edges:T}=A||{nodes:void 0,edges:void 0};return w||(w=this._ogma.getNodes()),T||(T=w.getAdjacentEdges({bothExtremities:!0})),this._ogma.modules.algorithms.getAllSimpleCycles(w,T)},this.detectCycle=A=>{let{nodes:w,edges:T}=A||{nodes:void 0,edges:void 0};w||(w=this._ogma.getNodes()),T||(T=w.getAdjacentEdges({bothExtremities:!0}));let C=this._ogma.modules.algorithms.detectCycle(w,T);return C.size?C:null},this.minimumSpanningTree=A=>{let{nodes:w,edges:T,edgeCostFunction:C}=A||ke(re({},{nodes:void 0,edges:void 0}),{edgeCostFunction:void 0});return this._ogma.modules.algorithms.minimumSpanningTree(w,T,C)},this.dfs=A=>this._ogma.modules.algorithms.dfs(fv(A,this._ogma.modules.graph)),this.bfs=A=>this._ogma.modules.algorithms.bfs(fv(A,this._ogma.modules.graph)),this.betweenness=(A={})=>(A={nodes:A.nodes||this._ogma.getNodes(),edges:A.edges||this._ogma.getEdges(),directed:void 0!==A.directed&&A.directed,normalized:void 0===A.normalized||A.normalized},this._ogma.modules.algorithms.betweenness(A)),this.getMinimumEnclosingCircle=A=>{if(!A||0===A.size)throw new Error("getMinimumEnclosingCircle: no nodes provided");let w=A.getAttribute("x"),T=A.getAttribute("y"),C=A.getAttribute("radius"),[k,N,O]=Jn(w,T,C);return{x:k,y:N,radius:O}}}},Ju=Mg(W()),bv=A=>Promise.resolve(Ju.gexf(A)),Ev=A=>no(A).then((A=>Ju.gexf(A))),yv=A=>Promise.resolve(Ju.janus(A)),xv=(A,w)=>Promise.resolve(Ju.json(A,w)),Dv=(A,w)=>no(A).then((A=>Ju.json(A,w))),Av=A=>Promise.resolve(Ju.neo4j(A)),vv=A=>Promise.resolve(Ju.graphml(A)),Nv=A=>no(A).then((A=>Ju.graphml(A))),Ku=class extends Zu{constructor(){super(...arguments),this.gexf=A=>bv(A),this.gexfFromUrl=A=>Ev(A),this.janus=A=>yv(A),this.json=(A,w)=>xv(A,w),this.jsonFromUrl=(A,w)=>Dv(A,w),this.neo4j=A=>Av(A),this.graphml=A=>vv(A),this.graphmlFromUrl=A=>Nv(A)}},eg={json:xv,jsonFromUrl:Dv,gexf:bv,gexfFromUrl:Ev,janus:yv,neo4j:Av,graphml:vv,graphmlFromUrl:Nv},tg=class extends Zu{constructor(){super(...arguments),this.wait=A=>new Promise((w=>setTimeout(w,A))),this.initRandomGraph=A=>this._ogma.generate.random(A).then(this._ogma.setGraph).then((()=>this._ogma.view.locateGraph())).then((()=>this._ogma.view.afterNextFrame())),this.initGrid=A=>{let w=Math.ceil(Math.sqrt(A));return this._ogma.generate.grid({rows:w,columns:w}).then((A=>this._ogma.setGraph(A))).then((()=>this._ogma.view.locateGraph()))},this.initLine=A=>(this._ogma.setGraph({nodes:[{id:0,attributes:{x:0,y:0}},{id:1,attributes:A?{x:0,y:50}:{x:50,y:0}}],edges:[{id:0,source:1,target:0}]}),this._ogma.view.locateGraph()),this.initSingleNode=()=>(this._ogma.setGraph({nodes:[{id:0,attributes:{x:0,y:0}}],edges:[]}),this._ogma.view.locateGraph()),this.initContinuousRenderLoop=({triggerKey:A="r",start:w=!0}={})=>{let T=w,o=()=>{T&&this._ogma.modules.dom.beforeNextFrame().then(o)};document.addEventListener("keydown",(({key:w})=>{w===A&&(T=!T,o())})),o()},this.appendToBody=()=>{let A=document.createElement("div");A.style.position="absolute",A.style.top="0",A.style.left="0",A.style.bottom="0",A.style.right="0",document.body.appendChild(A),this._ogma.setContainer(A)},this.loadFile=A=>(A.endsWith(".gexf")?eg.gexfFromUrl(A):eg.jsonFromUrl(A)).then((A=>this._ogma.setGraph(A))).then((()=>this._ogma.view.locateGraph())).then((()=>this._ogma.view.afterNextFrame())),this.enableLasso=A=>{this._ogma.events.on("dragStart",(()=>{this._ogma.keyboard.isKeyPressed("ctrl")&&this._ogma.tools.lasso.enable(A)}))},this.randomizeGraph=({minX:A=0,minY:w=0,maxX:T=500,maxY:C=500}={})=>this._ogma.getNodes().setAttributes(this._ogma.getNodes().map((()=>({x:A+Math.random()*(T-A),y:w+Math.random()*(C-w)}))))}};var rg=class extends Zu{constructor(){super(...arguments),this.once=(A,w)=>(this._ogma.modules.events.once(A,w),this),this.removeListener=A=>{this._ogma.modules.events.off(A)},this.onNodesAdded=A=>(this._ogma.events.on("addNodes",A),this._ogma),this.onBeforeNodesRemoved=A=>(this._ogma.events.on("beforeRemoveNodes",A),this._ogma),this.onNodesRemoved=A=>(this._ogma.events.on("removeNodes",A),this._ogma),this.onEdgesAdded=A=>(this._ogma.events.on("addEdges",A),this._ogma),this.onBeforeEdgesRemoved=A=>(this._ogma.events.on("beforeRemoveEdges",A),this._ogma),this.onEdgesRemoved=A=>(this._ogma.events.on("removeEdges",A),this._ogma),this.onGraphCleared=A=>(this._ogma.events.on("clearGraph",A),this._ogma),this.onNodesClassAdded=(A,w)=>(this._ogma.modules.classes.onNodeClassAdded(A,w),this._ogma),this.onNodesClassRemoved=(A,w)=>(this._ogma.modules.classes.onNodeClassRemoved(A,w),this._ogma),this.onEdgesClassAdded=(A,w)=>(this._ogma.modules.classes.onEdgeClassAdded(A,w),this._ogma),this.onEdgesClassRemoved=(A,w)=>(this._ogma.modules.classes.onEdgeClassRemoved(A,w),this._ogma),this.onNodeDragStart=A=>(this._ogma.events.on("nodesDragStart",A),this._ogma),this.onNodeDragProgress=A=>(this._ogma.events.on("nodesDragProgress",A),this._ogma),this.onNodeDragEnd=A=>(this._ogma.events.on("nodesDragEnd",A),this._ogma),this.onDrop=A=>(this._ogma.events.on("drop",A),this._ogma),this.onNodesSelected=A=>this.onNodesClassAdded(ri,A),this.onNodesUnselected=A=>this.onNodesClassRemoved(ri,A),this.onEdgesSelected=A=>this.onEdgesClassAdded(ri,A),this.onEdgesUnselected=A=>this.onEdgesClassRemoved(ri,A),this.onNodeDataChange=A=>(this._ogma.events.on("updateNodeData",A),this._ogma),this.onEdgeDataChange=A=>(this._ogma.events.on("updateEdgeData",A),this._ogma),this.onAnimate=A=>(this._ogma.events.on("animate",A),this._ogma),this.onMouseMove=A=>(this._ogma.events.on("mousemove",A),this._ogma),this.onMouseButtonDown=A=>(this._ogma.events.on("mousedown",A),this._ogma),this.onMouseButtonUp=A=>(this._ogma.events.on("mouseup",A),this._ogma),this.onClick=A=>(this._ogma.events.on("click",A),this._ogma),this.onDoubleClick=A=>(this._ogma.events.on("doubleclick",A),this._ogma),this.onMouseWheel=A=>(this._ogma.events.on("mousewheel",A),this._ogma),this.onHover=A=>(this._ogma.events.on("mouseover",A),this._ogma),this.onUnhover=A=>(this._ogma.events.on("mouseout",A),this._ogma),this.onDragStart=A=>(this._ogma.events.on("dragStart",A),this._ogma),this.onDragProgress=A=>(this._ogma.events.on("dragProgress",A),this._ogma),this.onDragEnd=A=>(this._ogma.events.on("dragEnd",A),this._ogma),this.onGestureStart=A=>(this._ogma.events.on("gestureStart",A),this._ogma),this.onGestureProgress=A=>(this._ogma.events.on("gestureProgress",A),this._ogma),this.onGestureEnd=A=>(this._ogma.events.on("gestureEnd",A),this._ogma),this.onRendererStateChange=A=>(this._ogma.events.on("rendererStateChange",A),this._ogma),this.onZoomProgress=A=>(this._ogma.events.on("zoom",A),this._ogma),this.onViewChanged=A=>(this._ogma.events.on("viewChanged",A),this._ogma),this.onNodesConnected=A=>(this._ogma.events.on("connectNodes",A),this._ogma),this.onGeoModeEnabled=A=>(this._ogma.events.on("geoEnabled",A),this._ogma),this.onGeoModeDisabled=A=>(this._ogma.events.on("geoDisabled",A),this._ogma),this.onGeoModeLoaded=A=>(this._ogma.events.on("geoLoaded",A),this._ogma),this.onLayoutStart=A=>(this._ogma.events.on("layoutStart",A),this._ogma),this.onLayoutComplete=A=>(this._ogma.events.on("layoutEnd",A),this._ogma),this.onLayoutComputed=A=>(this._ogma.events.on("layoutComputed",A),this._ogma),this.onTooltipShown=A=>(this._ogma.events.on("tooltipShow",A),this._ogma),this.onTooltipHidden=A=>(this._ogma.events.on("tooltipHide",A),this._ogma),this.onTransformationEnabled=A=>(this._ogma.events.on("transformationEnabled",A),this._ogma),this.onTransformationDisabled=A=>(this._ogma.events.on("transformationDisabled",A),this._ogma),this.onTransformationSetIndex=A=>(this._ogma.events.on("transformationSetIndex",A),this._ogma),this.onTransformationDestroyed=A=>(this._ogma.modules.events.on("transformationDestroyed",A),this._ogma),this.onTransformationRefreshed=A=>(this._ogma.events.on("transformationRefresh",A),this._ogma)}on(A,w){return this._ogma.modules.events.on(A,w),this}off(A){return this._ogma.modules.events.off(A),this}onKeyPress(A,w){return this._ogma.modules.keyboard.onKeyPress(A,w),this._ogma}};function Tv(A){return A instanceof Vi?A.getId():A}function Sv(A){return A instanceof Xi?A.getId():A}function lb(A){return A instanceof Gi?A.getId():A instanceof Vi?[A.getId()]:At(A)?A.map(Tv):[Tv(A)]}function ub(A){return A instanceof Yi?A.getId():A instanceof Xi?[A.getId()]:At(A)?A.map(Sv):[Sv(A)]}function Ca(A,w,T){if(null!=A){if(Array.isArray(A))return A[0];if(w&&T){if("source"===A)return Ca(T.color.get(w.getSource()._index));if("target"===A)return Ca(T.color.get(w.getTarget()._index))}return A}}function cb(A){return null==A?null:"string"==typeof A||"number"==typeof A?`${A}`:A&&cb(A.content)}function cO(A){if(null!=A)return"string"==typeof A?A:A.style||"line"}var og=["color","radius","shape","text.content","x","y"],ag=["color","width","shape.body","text.content"];var lg="visible";function Pv(A,w,T,C){let k=function gO(A,w){return A?lb(A):"object"==typeof w?lb(w.nodes):w||lg}(w,C),N=function pO(A,w){return A?ub(A):"object"==typeof w?ub(w.edges):w||lg}(T,C);return{nodes:A.getNodes(k),edges:A.getEdges(N)}}function hb(A,{nodeAttributes:w,edgeAttributes:T,nodes:C,edges:k,filter:N,nodeData:O,edgeData:j}){let G=Pv(A,C,k,N);return{nodes:G.nodes.toJSON({attributes:w,data:O}),edges:G.edges.toJSON({attributes:T,data:j})}}function Hi(A,w,{styles:T,nodes:C,edges:k,filter:N,nodeData:O,edgeData:j}){let{nodes:G,edges:H}=function Lv(A){return"all"!==A?{nodes:["x","y"],edges:[]}:{nodes:og,edges:ag}}(T),W=hb(A,{nodeAttributes:G,edgeAttributes:H,nodes:C,edges:k,filter:N,nodeData:O,edgeData:j});if("original"===T){let T=function Iv(A,{nodes:w,edges:T}){let C=A.getOriginalAttributes();return{nodes:w.reduce(((A,w)=>(A[w.getId()]={x:C.nodes.x.get(w._index),y:C.nodes.y.get(w._index),color:Ca(C.nodes.color.get(w._index)),radius:C.nodes.radius.get(w._index),shape:C.nodes.shape.get(w._index),text:{content:C.nodes.text.content.get(w._index)}},A)),{}),edges:T.reduce(((A,w)=>(A[w.getId()]={color:Ca(C.edges.color.get(w._index)),width:C.edges.width.get(w._index),shape:{type:C.edges.shape.body.get(w._index)},text:{content:C.edges.text&&C.edges.text.content&&C.edges.text.content.get(w._index)}},A)),{})}}(w,Pv(A,C,k,N));for(let A of W.nodes)null!=A.id&&(A.attributes=T[A.id]);for(let A of W.edges)null!=A.id&&(A.attributes=T[A.id])}return"all"===T&&W.edges.forEach((({source:w,target:T,attributes:C})=>{if(C){let k=A.getNode(w);if("source"===C.color&&k){let A=k.getAttribute("color");C.color=Array.isArray(A)?A[0]:A}let N=A.getNode(T);if("target"===C.color&&N){let A=N.getAttribute("color");C.color=Array.isArray(A)?A[0]:A}}})),function Cv(A){return{nodes:A.nodes.map((({id:A,attributes:w={},data:T})=>{let{color:C,radius:k,shape:N,text:O,x:j,y:G}=w;return{id:A,x:j,y:G,color:Ca(C),size:k,shape:N,text:cb(O),data:T}})),edges:A.edges.map((({id:A,source:w,target:T,attributes:C={},data:k})=>{let{color:N,width:O,text:j,shape:G}=C;return{id:A,source:w,target:T,color:Ca(N),size:O,shape:cO(G),text:cb(j),data:k}}))}}(W)}function fO(A,w){for(let T=0;T<w.length;++T){if(null==A)return;A=A[w[T]]}return A}function _O(A,w,T){for(let T=0;T<w.length-1;++T){let C=w[T],k=A[C];void 0===k&&(k={},A[C]=k),A=k}A[w[w.length-1]]=T}function Ov(A,w){return null==A||Array.isArray(A)&&!A.length?w:A}function EO(A){return"string"==typeof A}function wv(A,w,T,C,k){let N="edges"===w,O={};return A.forEach(((A,j)=>{let G=k.get(j),H=Wo(Ov(T(G),w));if(!H.every(EO))throw Error(`The tab ${w} function returned an invalid value.`);let W=Wo(C(A.data,H));H.forEach(((w,T)=>{let C=Ov(W[T],{}),k=dd(re(re({internal___id:A.id},N?{internal___source:A.source,internal___target:A.target}:{}),C)).reduce(((A,{path:w,value:T})=>(A[w.join(".")]=T,A)),{});O[w]=O[w]||[],O[w].push(k)}))})),O}function Rv(A){if(!A.length)return[];let w=function bO(A){let w=re({},A[0]);for(let T of A)for(let A of Object.keys(T))A in w||(w[A]=void 0);return Object.keys(w)}(A),T=[w];for(let C of A)T.push(w.map((A=>C[A])));return T[0]=T[0].map((A=>A.replace("internal___",""))),T}var ug=/[\=\+\-\@\|\%]/;function yg(A){return void 0===A?"":A instanceof Date?A.toISOString():(A=>A.length>0&&ug.test(A[0])?`'${A=A.replace("|","|")}`:A)(""+A)}var _g={what:void 0,dataProperties:void 0,separator:",",textSeparator:'"',download:!0,filename:"graph.csv",filter:"visible",nodes:void 0,edges:void 0,nodeData:ur,edgeData:ur,styles:"none"};function Mv(A,w){let{what:T,dataProperties:C,nodes:k,edges:N,separator:O,textSeparator:j,download:G,nodeData:H,edgeData:W,filename:$,filter:Z}=Ft("string"==typeof w?{what:w}:w,_g),se=Hi(A.modules.graph,A.modules.individualAttributes,{styles:"none",nodes:k,edges:N,filter:Z,nodeData:H,edgeData:W});try{let A=function AO(A,{what:w,separator:T,textSeparator:C,dataProperties:k}){let N=new RegExp(C,"g");function s(A){return C+yg(A).replace(N,`${C}${C}`).replace(/\n/g,"\\n").replace(/\r/g,"")+C}if(C&&'"'!==C&&"'"!==C)throw new TypeError(`Invalid argument :"textSeparator" is not single-quote or double-quote, was ${C}`);if("nodes"!==w&&"edges"!==w)throw new TypeError('missing argument: "what": should have value "nodes" or "edges"');let O="nodes"===w;return function Fv(A,w,T){let C=new as,k=w?1:3,N=[];for(let O=0;O<A.length;++O){let j=A[O],G=new Array(k),H=j.data;if(T){let A={};T.forEach((w=>{let T=Br(w),C=fO(H,T);_O(A,T,C)})),H=A}let W=dd(H);G[0]=j.id,w||(G[1]=j.source,G[2]=j.target);for(let A=0;A<W.length;++A){let{path:w,value:T}=W[A];w.length&&(C.has(w)?G[C.get(w)]=T:(C.set(w,k),G[k]=T,k++))}N.push(G)}let O=[];return O.push("id"),w||(O.push("source"),O.push("target")),C.keys().forEach((A=>O.push(A[A.length-1]))),N.unshift(O),N.forEach((A=>A.length=k)),N}(O?A.nodes:A.edges,O,k).map((A=>A.map((A=>s(A))))).map((A=>A.join(T))).join("\n")}(se,{what:T,separator:O,textSeparator:j,dataProperties:C});return G&&fr(A,$,"text"),Promise.resolve(A)}catch(A){return Promise.reject(A)}}var Oa=A=>Math.round(255*A);function kv(A,w){if("integer"===w&&"number"==typeof A){if(A%1!=0)return"float"}else if("number"!=typeof A)return"boolean"==typeof A?"boolean":"string";return w}var mb=A=>"object"==typeof A&&null!==A&&A.constructor===Object;function gb(A,w={}){return cr(A,((A,T)=>{mb(A)?gb(A,w):w[T]=A})),w}var pg={creator:void 0,description:void 0,styles:"all",download:!0,filename:"graph.gexf",nodes:void 0,edges:void 0,nodeData:A=>A,edgeData:A=>A,filter:"visible"};function Bv(A,w={}){let{styles:T,nodes:C,edges:k,download:N,filename:O,creator:j,description:G,filter:H,nodeData:W,edgeData:$}=Ft(w,pg),Z=function NO(A,w){let T,C=new Fs,k=Pp(),N={},O={},j=0,G=0,H=k.createElement("gexf");H.setAttribute("xmlns","http://www.gexf.net/1.2draft"),H.setAttribute("xmlns:viz","http://www.gexf.net/1.2draft/viz"),H.setAttribute("xmlns:xsi","http://www.w3.org/2001/XMLSchema-instance"),H.setAttribute("xsi:schemaLocation","http://www.gexf.net/1.2draft http://www.gexf.net/1.2draft/gexf.xsd"),H.setAttribute("version","1.2");let W=k.createElement("meta");if(W.setAttribute("lastmodifieddate",Hg()),w.creator){let A=k.createElement("creator");T=k.createTextNode(""+w.creator),A.appendChild(T),W.appendChild(A)}if(w.description){let A=k.createElement("description");T=k.createTextNode(""+w.description),A.appendChild(T),W.appendChild(A)}let $=k.createElement("graph");$.setAttribute("mode","static");let Z=k.createElement("nodes");A.nodes.forEach((A=>{let w=k.createElement("node");if(w.setAttribute("id",String(A.id)),A.text&&w.setAttribute("label",oi(A.text)),mb(A.data)){let T=gb(A.data),C=k.createElement("attvalues");Object.keys(T).forEach((A=>{A in N||(N[A]={id:j,type:"integer"},j++);let w=T[A];N[A].type=kv(w,N[A].type);let O=k.createElement("attvalue");O.setAttribute("for",N[A].id),O.setAttribute("value",oi(w)),C.appendChild(O)})),w.appendChild(C)}if(A.color){let T=C.parseColor(A.color);if(T){let A=k.createElement("viz:color");A.setAttribute("r",Oa(T[0])),A.setAttribute("g",Oa(T[1])),A.setAttribute("b",Oa(T[2])),A.setAttribute("a",T[3]),w.appendChild(A)}}let T=k.createElement("viz:position");if(T.setAttribute("x",A.x),T.setAttribute("y",-A.y),w.appendChild(T),A.size){let T=k.createElement("viz:size");T.setAttribute("value",A.size),w.appendChild(T)}Z.appendChild(w)}));let se=k.createElement("attributes");se.setAttribute("class","node"),Object.keys(N).forEach((A=>{let w=k.createElement("attribute");w.setAttribute("id",N[A].id),w.setAttribute("title",A),w.setAttribute("type",N[A].type),se.appendChild(w)}));let ue=k.createElement("edges");A.edges.forEach((A=>{let w=k.createElement("edge");if(w.setAttribute("id",A.id.toString()),w.setAttribute("source",A.source),w.setAttribute("target",A.target),A.size&&w.setAttribute("weight",A.size),A.text&&w.setAttribute("label",oi(A.text)),mb(A.data)){let T=gb(A.data),C=k.createElement("attvalues");Object.keys(T).forEach((A=>{A in O||(O[A]={id:G,type:"integer"},G++);let w=T[A];O[A].type=kv(w,O[A].type);let N=k.createElement("attvalue");N.setAttribute("for",O[A].id),N.setAttribute("value",oi(w)),C.appendChild(N)})),w.appendChild(C)}if(A.color){let T=C.parseColor(A.color);if(T){let A=k.createElement("viz:color");A.setAttribute("r",Oa(T[0])),A.setAttribute("g",Oa(T[1])),A.setAttribute("b",Oa(T[2])),A.setAttribute("a",T[3]),w.appendChild(A)}}if(A.size){let T=k.createElement("viz:size");T.setAttribute("value",A.size),w.appendChild(T)}ue.appendChild(w)}));let ge=k.createElement("attributes");return ge.setAttribute("class","edge"),Object.keys(O).forEach((A=>{let w=k.createElement("attribute");w.setAttribute("id",O[A].id),w.setAttribute("title",A),w.setAttribute("type",O[A].type),ge.appendChild(w)})),$.appendChild(se),$.appendChild(ge),$.appendChild(Z),$.appendChild(ue),H.appendChild(W),H.appendChild($),k.appendChild(H),`<?xml version="1.0" encoding="UTF-8"?>${k.serialize()}`}(Hi(A.modules.graph,A.modules.individualAttributes,{styles:T,nodes:C,edges:k,filter:H,nodeData:W,edgeData:$}),{creator:j,description:G});return N&&fr(Z,O,"text"),Promise.resolve(Z)}var bg={graphId:"G",directedEdges:!0,styles:"all",download:!0,filename:"graph.graphml",nodes:void 0,edges:void 0,nodeData:A=>A,edgeData:A=>A,filter:"visible"};function Gv(A,w){let{styles:T,nodes:C,edges:k,download:N,filename:O,graphId:j,directedEdges:G,filter:H,nodeData:W,edgeData:$}=Ft(w,bg),Z=function SO(A,w){let T=new Fs,C=wp();function i(A){return T.parseColor(A)}function o(A){return T.toHexa(A)}function s(A,w){let T=i(w);T&&(A.r=T[0],A.g=T[1],A.b=T[2])}function a(A,w,T,k,N){T=T||{};let O=C.createElement(w);for(let A in T){if(!T.hasOwnProperty(A))continue;let w=T[A];void 0!==w&&O.setAttribute(A,w)}return(void 0!==k||N)&&("[object Object]"===Object.prototype.toString.call(k)&&(k=JSON.stringify(k)),O.appendChild(C.createTextNode(k))),A.appendChild(O),O}let k=["id","source","target"],N=["size","x","y","shape","text","color"],O={size:{for:"all",type:"double"},x:{for:"node",type:"double"},y:{for:"node",type:"double"},shape:{for:"all",type:"string"},color:{for:"all",type:"string"},r:{for:"all",type:"int"},g:{for:"all",type:"int"},b:{for:"all",type:"int"},a:{for:"all",type:"double"},text:{for:"all",type:"string"}};w.noStyles&&(delete O.color,delete O.r,delete O.g,delete O.b,delete O.a,delete O.shape,N.pop());let j=[],G=[];function m(A,w){let T={id:A.id};N.forEach((C=>{let k=A[C];"y"===C&&k&&(k=-parseFloat(k)),void 0!==k&&(T[("edge"===w?"edge_":"")+C]=k,"color"===C&&s(T,k))})),cr(A.data||{},((A,C)=>{-1!==N.indexOf(C)||-1!==k.indexOf(C)||(O[C]?O[C].for!==w&&(O[C].for="all"):O[C]={for:w,type:"string"},T[C]=A)})),"edge"===w?(T.source=A.source,T.target=A.target,G.push(T)):j.push(T)}A.nodes.forEach((A=>m(A,"node"))),A.edges.forEach((A=>m(A,"edge")));let H=a(C,"graphml",{xmlns:"http://graphml.graphdrawing.org/xmlns","xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","xsi:schemaLocation":"http://graphml.graphdrawing.org/xmlns http://www.yworks.com/xml/schema/graphml/1.1/ygraphml.xsd","xmlns:y":"http://www.yworks.com/xml/graphml","xmlns:java":"http://www.yworks.com/xml/yfiles-common/1.0/java","xmlns:sys":"http://www.yworks.com/xml/yfiles-common/markup/primitives/2.0","xmlns:x":"http://ww.yworks.com/xml/yfiles-common/markup/2.0"});cr(O,((A,w)=>{("node"===A.for||"all"===A.for)&&a(H,"key",{"attr.name":w,"attr.type":A.type,for:"node",id:w}),("edge"===A.for||"all"===A.for)&&a(H,"key",{"attr.name":w,"attr.type":A.type,for:"edge",id:"edge_"+w})})),a(H,"key",{id:"nodegraphics",for:"node","yfiles.type":"nodegraphics","attr.type":"string"}),a(H,"key",{id:"edgegraphics",for:"edge","yfiles.type":"edgegraphics","attr.type":"string"});let W=a(H,"graph",{edgedefault:w.directedEdges||void 0===w.directedEdges?"directed":"undirected",id:w.graphId?w.graphId:"G","parse.nodes":A.nodes.length,"parse.edges":A.edges.length,"parse.order":"nodesfirst"});function f(A,T){let C=a(A,"data",{key:"nodegraphics"}),k=a(C,"y:ShapeNode");a(k,"y:Geometry",{x:T.x,y:T.y,width:T.size,height:T.size}),w.noStyles||a(k,"y:Fill",{color:o(T.color),transparent:!1}),a(k,"y:NodeLabel",null,T.text||""),a(k,"y:Shape",{type:T.shape})}function _(A,T){let C=a(A,"data",{key:"edgegraphics"}),k=a(C,"y:PolyLineEdge");a(k,"y:LineStyle",{type:T.edge_type,color:w.noStyles?void 0:o(T.edge_color),width:T.edge_size}),a(k,"y:EdgeLabel",null,T.edge_label)}return j.forEach((A=>{let w=a(W,"node",{id:A.id});f(w,A),cr(A,((A,T)=>{-1===k.indexOf(T)&&a(w,"data",{key:T},A,!0)}))})),G.forEach((A=>{let w=a(W,"edge",{id:A.id,source:A.source,target:A.target});_(w,A),cr(A,((A,T)=>{-1===k.indexOf(T)&&a(w,"data",{key:T},A,!0)}))})),`<?xml version="1.0" encoding="UTF-8"?>\n${md(C)}`}(Hi(A.modules.graph,A.modules.individualAttributes,{styles:T,nodes:C,edges:k,filter:H,nodeData:W,edgeData:$}),{graphId:j,directedEdges:G,noStyles:"none"===T});return N&&fr(Z,O,"text"),Promise.resolve(Z)}var vg={nodeAttributes:["x","y","color","radius","shape","text"],edgeAttributes:["color","width","text"],nodeData:ur,edgeData:ur,filter:"visible",pretty:!1,download:!0,filename:"graph.json",anonymize:!1};function xg(A,w={}){let T=A.view.get(),C="number"==typeof w.margin?w.margin:0,k={pixelRatio:w.pixelRatio||Ye(),angle:0,backgroundColor:null,zoom:0,x:0,y:0,width:0,height:0,hideImages:!1,renderBackground:!w.exportCanvasLayers,isBufferDisplayable:ro};if(w.width&&w.height?(k.width=w.width,k.height=w.height):(k.width=T.width,k.height=T.height),w.clip)k.zoom=T.zoom,k.x=T.x,k.y=T.y;else{let N=function IO(A,w){return A.getBoundingBox().computeForZoom(w).extend(ws.fromValues(A.getAttribute("x"),A.getAttribute("y"),A.map((A=>A.getAttribute("radius")+A.getAttribute("innerStroke.width")+A.getAttribute("outerStroke.width")))))}(A.getNodes(w.filter),T.zoom);if(w.texts){let w=A.modules.labels.getTextsBoundingBox();w.isValid()&&N.extend(w)}(null==w.width||!isFinite(w.width)||null==w.height||!isFinite(w.height))&&function CO(A,w,T){let C=w.view.graphToScreenCoordinates(T.bottomLeft()),k=w.view.graphToScreenCoordinates(T.topRight()),N=k.x-C.x,O=k.y-C.y,j=Math.min(A.width/N,A.height/O);A.width=N*j,A.height=O*j}(k,A,N),k.width=Math.max(k.width,2*C),k.height=Math.max(k.height,2*C),k.x=N.cx,k.y=N.cy,k.zoom=Math.min((k.width-2*C)/N.width,(k.height-2*C)/N.height)}return A.modules.geo.isEnabled()?k.backgroundColor=null:void 0!==w.background&&(k.backgroundColor=w.background),k}function gu(A,w,T,C,k=!1){let N=ke(re({},T),{hideImages:k,angle:T.angle||0,currentTime:Ut(),isBufferDisplayable:A=>w.texts||!Rm(A)}),O={};if(!1===w.badges){let A={text:null,image:null};O.badges={topLeft:A,topRight:A,bottomRight:A,bottomLeft:A}}let j=A.styles.getClass(gi);return j&&j.update({nodeAttributes:O}),A.modules.graphics.export(C,N,w.filter||lg,w)}var Dg=A=>({download:!0,filter:"visible",filename:`graph.${A}`,clip:!1,margin:10,width:void 0,height:void 0,background:null,badges:!0,legend:void 0,texts:!0,preventOverlap:!0,images:!0,textWatermark:{content:"",fontFamily:"Arial",fontSize:48,fontStyle:void 0,fontColor:"red",repeat:!1,angle:0,alpha:.65,space:50,x:void 0,y:void 0},imageWatermark:{url:void 0,width:void 0,height:void 0,repeat:!1,angle:0,alpha:.65,space:50,x:void 0,y:void 0},imageCrossOrigin:void 0,exportCanvasLayers:!0,pixelRatio:void 0}),Ag={png:Dg("png"),jpg:Dg("jpg"),tiff:Dg("tiff"),gif:Dg("gif")};function PO(A){let{canvas:w,parameters:T}=A;return T.textWatermark.content&&Uv(w,T.textWatermark,kO,BO),T.imageWatermark.url?jg(T.imageWatermark.url).then((C=>(C&&(T.imageWatermark.content=C,Uv(w,T.imageWatermark,zO,GO)),A))):A}function wO(A){let{ogma:w,canvas:T,parameters:C}=A,k=w.modules.legend,N=null;return void 0===C.legend&&(N=!!k.enabled()&&k.getCurrentOptions()),!0===C.legend&&(N={}),N&&k.exportOnCanvas(T,N,A.parameters.pixelRatio),A}function RO(A){let{ogma:w,view:T}=A;return w.modules.geo.isEnabled()?w.modules.geo.exportBackground(T).then((w=>{let C=T.width*T.pixelRatio,k=T.height*T.pixelRatio,N=Lt(C,k),O=N.getContext("2d");return O.drawImage(w,(C-w.width)/2,(k-w.height)/2),O.drawImage(A.canvas,0,0),A.canvas=N,A})):A}function FO(A){let{ogma:w,parameters:T,canvas:C,view:k}=A,N=C.getContext("2d");return gu(w,T,k,"canvas",!T.images).then((O=>{try{let w=O.getContext("2d");if(!w)throw new Error("Failed to render graph");return w.getImageData(0,0,1,1),N.drawImage(O,0,0,C.width,C.height),A}catch(O){return zr(O),gu(w,T,k,"canvas",!0).then((w=>(N.drawImage(w,0,0,C.width,C.height),A)))}}))}function MO({canvas:A,parameters:w,type:T}){let C=A.toDataURL("image/"+T);return w.download&&fr(C,w.filename,"dataURL"),C}function pu(A,w,T){let C=Ft(w,Ag[T]);null===C.background&&(C.background=A.modules.graphics.getTransparentBackgroundColor());let k=xg(A,C);C.pixelRatio=k.pixelRatio;let N={ogma:A,parameters:C,canvas:Lt(k.width*k.pixelRatio,k.height*k.pixelRatio),view:k,type:T};return Promise.resolve().then((()=>N)).then(RO).then(FO).then(PO).then(wO).then(MO)}function kO(A,w,T,C){A.textAlign="center",A.textBaseline="middle",A.fillText(w,T,C)}function BO(A,w,T){return{width:A.measureText(w).width,height:T}}function GO(A,w,T,C,k){return{width:void 0===C?w.width:C,height:void 0===k?w.height:k}}function zO(A,w,T,C,k,N){A.drawImage(w,T-k/2,C-N/2,k,N)}function Uv(A,w,T,C){if(!w)return;if("object"!=typeof w)w={content:w};else if(!w.content)return;let{fontFamily:k,fontSize:N,fontStyle:O,fontColor:j,repeat:G,angle:H,alpha:W,space:$,content:Z}=w,se=A.getContext("2d"),ue=A.width,ge=A.height,ce=void 0===w.x?ue/2:w.x,_e=void 0===w.y?ge/2:w.y,me=w.height,pe=w.width;H=H/180*Math.PI,Tr(se,k,N,O),se.fillStyle=j,se.globalAlpha=W;let be=C(se,Z,N,pe,me);if(G){let A=be.width+$,w=be.height+$,C=Math.sqrt(ue*ue+ge*ge);se.save(),se.translate(0,0),se.rotate(H);for(let k=0;k<C;k+=A)for(let A=0;A<C;A+=w)T(se,Z,k,A,be.width,be.height),0!==A&&T(se,Z,k,-A,be.width,be.height);se.restore()}else se.save(),se.translate(ce,_e),se.rotate(H),T(se,Z,0,0,be.width,be.height),se.restore()}var Eg={download:!0,filename:"graph.svg",width:void 0,height:void 0,background:null,texts:!0,preventOverlap:!0,groupSemantically:!0,images:!0,badges:!0,embedFonts:!1,clip:!1,margin:10,prefix:"ogma"};function Vv(A,w){let T=Ft(w,Eg),{background:C,filename:k,download:N}=T,O=A.modules.graphics;null===C&&(T.background=O.getTransparentBackgroundColor());let j=xg(A,T);return gu(A,T,j,"svg",!T.images).then((A=>(A.removeAttribute("pointer-events"),A.setAttribute("version","1.1"),A.setAttributeNS(Ke,"xmlns",Qe),A.setAttributeNS(Ke,"xmlns:xlink",et),A))).then((w=>T.groupSemantically?function HO(A,w,T){let C=w.childNodes[2],k=C.childNodes,N={},O=T.prefix;for(let A=0;A<k.length;A++){let w=k[A],T=w.getAttribute(fn);null!=T&&(N[T]=N[T]||[],N[T].push(w))}let j=Object.keys(N),G=A.modules.graph,H=G.getNodeAttribute("id"),W=G.getEdgeAttribute("id"),$=lt("g",{class:`${O}-edges`}),Z=lt("g",{class:`${O}-nodes`});for(let A=0;A<j.length;A++){let w=j[A],T="n"===w.charAt(0),C=parseInt(w.substring(1)),k=N[w],G=oi((T?H:W).get(C).toString()),se=lt("g");se.setAttribute(`data-${T?"node":"edge"}-id`,G),se.setAttribute("class",`${O}-${T?"node":"edge"}`);for(let A=0;A<k.length;A++){let w=k[A];se.appendChild(w),w.removeAttribute(fn)}(T?Z:$).appendChild(se)}return C.appendChild($),C.appendChild(Z),w}(A,w,T):w)).then((A=>function XO(A,w){let T=function WO(A){let w=[].concat(Array.prototype.slice.call(A.getElementsByTagName("text")||[])),T=[],C={};for(let A=0;A<w.length;A++){let k=w[A].parentNode.getAttribute("font-family");if("string"==typeof k){let A=k.split(",");for(let w=0;w<A.length;w++){let k=A[w].replace(/['"]/g,"");""!==k&&!C[k]&&(C[k]=!0,T.push(k))}}}return{list:T,map:C}}(A).map;return Ap().then((A=>A.filter((A=>T[A.name])))).then((A=>vp(A,!!w.embedFonts))).then((w=>{if(0!==w.length){let T=lt("style");for(let A=0;A<w.length;A++)T.appendChild(Ya(w[A]));A.childNodes[0].appendChild(T)}return A}))}(A,T))).then((w=>function VO(A,w,T){return A.modules.geo.isEnabled()?A.modules.geo.exportBackground(ke(re({},w),{pixelRatio:1})).then((A=>{let w=lt("image",{width:A.width,height:A.height,x:0,y:0,href:A.toDataURL()});return T.insertBefore(w,T.children[0]),T})):Promise.resolve(T)}(A,j,w))).then((A=>{let w=`<?xml version="1.0" encoding="utf-8"?>${md(A)}`;return N&&fr(w,k,"text/xml"),w}))}var wg={what:void 0,dataProperties:void 0,filter:"visible",nodes:void 0,edges:void 0,download:!0,filename:"graph.xlsx",tab:void 0,nodeData:void 0,edgeData:void 0};function Hv(A,w={}){"string"==typeof w&&(w={what:w});let{what:T,nodes:C,edges:k,tab:N={nodes:()=>"nodes",edges:()=>"edges"},download:O,filename:j,dataProperties:G,filter:H,nodeData:W,edgeData:$}=Ft(w,wg);N.nodes||(N.nodes=()=>"nodes"),N.edges||(N.edges=()=>"edges");let Z=Hi(A.modules.graph,A.modules.individualAttributes,{styles:"none",nodes:C,edges:k,filter:H,nodeData:A=>A,edgeData:A=>A}),se=function YO(A,{what:w,tabFunctions:T,tabContentFunctions:C},k){let N=$t("XLSX")||$t("xlsx",{throwOnError:!0});if(!N)throw Error('The xlsx exports requires the "xlsx" peer dependency to be associated');let O=new Cg;if(w){if("nodes"!==w&&"edges"!==w)throw new TypeError(`Invalid argument: "what" is not "nodes" or "edges", was ${w}`);"nodes"===w&&(A.edges=[]),"edges"===w&&(A.nodes=[])}let j={};for(let w of["nodes","edges"]){let N=wv(A[w],w,T[w],C[w],k[w]);for(let A of Object.keys(N))j[A]=[...j[A]||[],...N[A]]}for(let A of Object.keys(j))O.SheetNames.push(A),O.Sheets[A]=qO(N,Rv(j[A]));return 0===O.SheetNames.length&&(O.SheetNames=["nodes","edges"],O.Sheets.nodes={},O.Sheets.edges={}),jo([jO(N.write(O,{bookType:"xlsx",bookSST:!1,type:"binary"}))])}(Z,{what:T,tabFunctions:N,tabContentFunctions:{nodes:W||(A=>ic(Qi(A||{}),G)),edges:$||(A=>ic(Qi(A||{}),G))}},{nodes:A.modules.graph.getNodes(Z.nodes.map((({id:A})=>A))),edges:A.modules.graph.getEdges(Z.edges.map((({id:A})=>A)))});return O&&fr(se,j,"blob"),Promise.resolve(se)}function qO(A,w){let T={},C={s:{c:1e7,r:1e7},e:{c:0,r:0}};for(let k=0;k!==w.length;++k){let N=w[k];for(let w=0;w!==N.length;++w){let O=N[w];C.s.r>k&&(C.s.r=k),C.s.c>w&&(C.s.c=w),C.e.r<k&&(C.e.r=k),C.e.c<w&&(C.e.c=w);let j={v:yg(O)};T[A.utils.encode_cell({c:w,r:k})]=j}}return C.s.c<1e7&&(T["!ref"]=A.utils.encode_range(C)),T}var Cg=class{constructor(){this.SheetNames=[],this.Sheets={}}};function jO(A){let w=new ArrayBuffer(A.length),T=new Uint8Array(w);for(let w=0;w!==A.length;++w)T[w]=255&A.charCodeAt(w);return w}var Lg=class extends Zu{constructor(A){super(A),this.csv=A=>Mv(this._ogma,A),this.xlsx=A=>(A&&A.dataProperties,Hv(this._ogma,A)),this.gexf=A=>Bv(this._ogma,A),this.graphml=(A={})=>Gv(this._ogma,A),this.json=(A={})=>function zv(A,w={}){w.anonymize&&(w={nodeAttributes:"all",edgeAttributes:"all",nodeData:ii,edgeData:ii,filter:w.filter||"all",download:w.download,pretty:w.pretty,filename:w.filename});let{nodeAttributes:T,edgeAttributes:C,nodeData:k,edgeData:N,filter:O,pretty:j,download:G,filename:H}=Ft(w,vg),W=hb(A.modules.graph,{nodeAttributes:T,edgeAttributes:C,filter:O,nodeData:k,edgeData:N}),$=j?JSON.stringify(W,null," "):JSON.stringify(W);return G&&fr($,H,"text"),Promise.resolve(W)}(this._ogma,A),this.svg=(A={})=>Vv(this._ogma,A),this.png=(A={})=>pu(this._ogma,A,"png"),this.jpg=(A={})=>pu(this._ogma,A,"jpg"),this.tiff=(A={})=>pu(this._ogma,A,"tiff"),this.gif=(A={})=>pu(this._ogma,A,"gif"),A.styles.createClass({name:gi,isBuiltin:!0})}},Fg=Mg($()),Pg=class extends Zu{constructor(){super(...arguments),this.balancedTree=A=>Promise.resolve(Fg.balancedTree.generate(Fg.balancedTree.configure(A))),this.barabasiAlbert=A=>Promise.resolve(Fg.barabasiAlbert.generate(Fg.barabasiAlbert.configure(A))),this.erdosRenyi=A=>Promise.resolve(Fg.erdosRenyi.generate(Fg.erdosRenyi.configure(A))),this.flower=A=>Promise.resolve(Fg.flower.generate(Fg.flower.configure(A))),this.grid=A=>Promise.resolve(Fg.grid.generate(Fg.grid.configure(A))),this.path=A=>Promise.resolve(Fg.path.generate(Fg.path.configure(A))),this.random=A=>Promise.resolve(Fg.random.generate(Fg.random.configure(A))),this.randomTree=A=>Promise.resolve(Fg.randomTree.generate(Fg.randomTree.configure(A)))}},Rg=class extends Zu{constructor(){super(...arguments),this.enable=A=>this._ogma.modules.geo.enable(A),this.disable=A=>this._ogma.modules.geo.disable(A),this.setOptions=A=>this._ogma.modules.geo.setOptions(A),this.getOptions=()=>this._ogma.modules.geo.getOptions(),this.getMap=()=>this._ogma.modules.geo.getMap(),this.enabled=()=>this._ogma.modules.geo.isEnabled(),this.getCenter=()=>this._ogma.modules.geo.getCenter(),this.getView=()=>this._ogma.modules.geo.getView(),this.getZoom=()=>this._ogma.modules.geo.getZoom(),this.setZoom=A=>this._ogma.modules.geo.setZoom(A),this.setView=(A,w,T)=>this._ogma.modules.geo.setView(A,w,T),this.setCenter=(A,w)=>this._ogma.modules.geo.setCenter(A,w),this.toggle=A=>this._ogma.modules.geo.toggle(A),this.resetCoordinates=()=>this._ogma.modules.geo.resetCoordinates(),this.getUnprojectedCoordinates=A=>this._ogma.modules.geo.getUnprojectedCoordinates(this._ogma.getNodes(A))}},Og=class extends Zu{constructor(){super(...arguments),this.isKeyPressed=A=>this._ogma.modules.keyboard.isPressed(A),this.resetKeys=()=>{this._ogma.modules.keyboard.resetKeys()}}},Bg={name:"concentric",configure:function(A,{graph:w,data:T}){if(void 0===A.centralNode)throw new Error('concentric layout: missing parameter "centralNode"');let C=ke(re({},A),{centralNode:function r(A,w){return w instanceof Vi?w:A.getNode(w)}(w,A.centralNode)}),{centralNode:k,nodes:N}=C,O=w.getNode(k);if(void 0===O)throw new Error('concentric layout: "centralNode" parameter is not valid');let j=O._index,{x:G,y:H}=O.getPosition(),W=N.getAttribute("layoutable"),$=w.getNodes(N)._indexes,Z=Array.from($.filter(((A,w)=>W[w])));-1===Z.indexOf(j)&&Z.push(j);let se=w.getNodeAttribute("radius").getMultiple($),ue=function i(A,w,T,C){if(w)return"random"===w?"random":"radius"===w?C.slice():"degree"===w?T.getDegree():A.getProperty(T,w)}(T,C.sortBy,N,se),ge=Z.reduce(((A,w,T)=>(A[w]=T,A)),{}),ce=Z.map(((A,w)=>w)),_e=new Set(A.edges.getExtremities()._indexes),me=Z.map((A=>w.topology.getAdjacentElements(!0,new Uint32Array([A])).filter((A=>_e.has(A))).map((A=>ge[A]))));return{sourceNodeIndex:Z.indexOf(j),centerX:"number"==typeof C.centerX?C.centerX:G,centerY:"number"==typeof C.centerY?C.centerY:H,list:Z,indexes:ce,size:Z.length,totalSize:Z.length,attributes:{adjacentNodes:me,size:se},sortAttr:ue,clockwise:void 0===C.clockwise||C.clockwise,circleHopRatio:C.circleHopRatio||5,allowOverlap:!!C.allowOverlap}},context:function(){return{dijkstra:function(A,w,T,C,k){let N=Math.pow(2,31)-1,O=new Int32Array(C),j=new Int32Array(C),G=new Int8Array(C);O.fill(N),j.fill(-1);for(let A=0;A<C;++A){let T=w[A];void 0!==T&&(O[T]=N,j[T]=-1)}O[k]=0;let H=0;for(;-1!==H;){let C=N;H=-1;for(let A=0;A<T;++A){let T=w[A],k=O[T];!G[T]&&k<C&&(C=k,H=T,G[T]=1)}if(H>-1){let w=A[H],T=C+1;w.forEach((A=>{let w=O[A];T<w&&(O[A]=T,j[A]=H)}))}}return O},determinePropertyType:function(A,w,T){return w.some((w=>"number"!==A[w]))?"string":"number"}}},update:function(A,w){let{attributes:T,indexes:C,size:k}=A,{sourceNodeIndex:N,centerX:O,centerY:j,sortAttr:G}=A,H=T.adjacentNodes,W=T.size,$=new Array(A.totalSize),Z=new Array(A.totalSize),se=w.dijkstra(H,C,A.size,A.totalSize,N),ue=0,ge={};for(let A=0;A<k;A++){let w=W[C[A]];w>ue&&(ue=w)}let ce=ue*A.circleHopRatio,_e=0,me=0,pe=Math.PI/9;for(let A=0;A<k;A++){let w=C[A],T=se[w],k=ge[T];k||(k=[],ge[T]=k),k.push(w)}let be=function e(A,w,T){return"random"===A?function(){return Math.random()-.5}:A?"number"===T.determinePropertyType(A,w,w.length)?function(w,T){return A[w]-A[T]}:function(w,T){return A[w]<A[T]?-1:1}:void 0}(G,C,w),Se="random"===G||G;return Object.keys(ge).sort(((A,w)=>parseInt(A)-parseInt(w))).forEach(((w,T)=>{let C=ge[w],k=C.length,N=0,G=me,H=2*Math.PI/k;if(0!==T&&!A.allowOverlap){let A=2*Math.PI*_e,w=0;N+=C.reduce(((A,w)=>A+W[w]),0),w=2*N*Math.SQRT2,w>A&&(_e+=w/(2*Math.PI)-_e)}Se&&(C.sort(be),A.clockwise||C.reverse());for(let w=0;w<k;w++){let T=C[w];$[T]=Math.cos(G)*_e+O,Z[T]=Math.sin(G)*_e+j;let se=W[T];G+=H*(A.allowOverlap?1:se/N*k)}_e+=ce,me+=pe})),{x:$,y:Z,indexes:A.list}},isRunning:function(){return!1},onSync:function({indexes:A,x:w,y:T}){return{indexes:A,x:w,y:T}}},_b=(A,w)=>A-w,Xg={name:"radial",imports:{minHeap:Co,bellmanFord:Oo,dijkstra:Po,johnson:Js,distance:Et,circleCircleIntersection:fl,circleSortCompare:_l,weightedStress:N_,distanceStress:T_,constrainedStress:ng,stressMinimizationStep:ig,removeRadialOverlap:Ul,linear:Cs,calculateRadii:I_},configure(A,{graph:w}){let T=A.nodes,C=T.size;function i(A,w){return null!=A&&isFinite(A)?A:w}if(void 0===A.centralNode)throw new Error('radial layout: missing parameter "centralNode"');let k=w.getNode(A.centralNode);if(void 0===k)throw new Error('radial layout: parameter "centralNode" is not valid');A.radiusRatio=i(A.radiusRatio,Math.SQRT2),A.radiusDelta=i(A.radiusDelta,0),A.nodeGap=i(A.nodeGap,10),A.repulsion=C*i(A.repulsion,1);let N=k.getPosition(),O=i(A.centerX,N.x),j=i(A.centerY,N.y),G=k._index;T.includes(k)||(T=T.concat(k.toList()));let H=T._indexes,W=T.getAttribute("layoutable");H=H.filter(((A,w)=>W[w]||A===G)),H.sort(_b);let $=H.length,Z=function ZO(A,w,T){let C=A.slice().sort(_b),k=[];for(let A=0,N=w.length;A<N;A++){let N=[],O=w[A],j=!1;for(let A=0,w=O.length;A<w;A++){let w=O[A];-1!==zg(C,w)&&(w===T&&(j=!0),N.push(w))}0!==N.length&&k[j?"unshift":"push"](N.sort(_b))}return k}(H,w.getConnectedComponents(T,{internalIndexes:!0}),G),se=w.degrees(H),ue=new Float32Array(w.getNodeAttribute("x").getMultiple(H)),ge=new Float32Array(w.getNodeAttribute("y").getMultiple(H)),ce=w.getNodeAttribute("radius").getMultiple(H),_e=w.getEdges()._indexes,me=w.getEdgeAttribute("source").getMultiple(_e),pe=w.getEdgeAttribute("target").getMultiple(_e),be=w.getAdjacencyList({internalIndexes:!0,weight:1,indexes:H});return{centerIndex:G,centerIndexPos:0,cx:O,cy:j,D:null,indexes:H,components:Z,normIndexes:null,radii:null,rings:null,x:ue,y:ge,degree:se,size:$,attributes:{size:ce,adjacency:be,weights:pe.map((()=>1)),sources:me,targets:pe},sortAttr:null,allowOverlap:!!A.allowOverlap,nodeGap:A.nodeGap,radiusRatio:A.radiusRatio,radiusDelta:A.radiusDelta,repulsion:A.repulsion,randomize:!("randomize"in A)||!!A.randomize,renderSteps:!!A.renderSteps,epsilon:i(A.epsilon,.001),maxSteps:i(A.maxIterations,100),iterationsPerRender:i(A.iterationsPerRender,20),step:-1,stress:Number.POSITIVE_INFINITY,prevStress:0,converged:!1,overlapRemoved:!1,done:!1}},context:()=>({data:null,gridPlacement(A,w,T=8){let C=A.length,k=new Float32Array(C),N=new Float32Array(C),O=0;for(let T=0,C=A.length;T<C;T++){let C=w[A[T]];C>O&&(O=C)}let j=O*T,G=Math.ceil(Math.sqrt(C)),H=Math.ceil(C/G),W=-Math.floor((H-1)*j/2),$=-Math.floor((G-1)*j/2);for(let A=0;A<G;A++)for(let w=0;w<H;w++)k[A*H+w]=W+w*j,N[A*H+w]=$+A*j;return{x:k,y:N}},connectComponents(A,w,T,C,k,N){let O;function a(A,w){let T=new Uint32Array(A.length+1);return T.set(A),T[A.length]=w,T}for(let j=1;j<A.length;j++){let G=A[j],H=0,W=0;G.forEach(((A,w)=>{let T=k.get(A);null!=T&&T>H&&(W=w,H=T)})),O=G[W];let $=w[N.get(O)];$.weights=$.weights||[],$.nodes=a($.nodes,T),$.weights.push(C);let Z=w[N.get(T)];Z.weights=Z.weights||[],Z.nodes=a(Z.nodes,O),Z.weights.push(C)}},correctSubgraphsDistances(A,w,T,C,k){let N=Array.prototype.reduce.call(A[T],((A,w,k)=>(k!==T&&w<C&&w>A&&(A=w),A)),0),O=C-N-1;for(let C=1;C<w.length;C++){let N=w[C];for(let w=0,C=N.length;w<C;w++){let C=k.get(N[w]);null!=C&&(A[T][C]-=O,A[C][T]-=O)}}},initialize(A,w){A.data=w,w.step=0;let T=new Map,C=new Map;w.normIndexes=w.indexes.reduce(((k,N,O)=>(k[O]=O,T.set(N,O),C.set(N,w.degree[O]),A.data&&N===w.centerIndex&&(A.data.centerIndexPos=O),k)),new Uint32Array(w.indexes.length));let k=w.centerIndexPos,N=w.components[0].length;A.connectComponents(w.components,w.attributes.adjacency,w.centerIndex,N,C,T);let O=Js({sources:w.attributes.sources,targets:w.attributes.targets,weights:w.attributes.weights,indexes:w.indexes,adjacency:w.attributes.adjacency,undirected:!0});A.correctSubgraphsDistances(O,w.components,k,N,T),w.D=O;let j=O[k],G={};for(let A=0,T=w.normIndexes.length;A<T;A++)if(A!==k){let T=j[A];G[T]=G[T]||[],G[T].push(w.normIndexes[A])}w.rings=G,w.radii=I_(k,w.rings,w.attributes.size,w.nodeGap,w.radiusRatio,w.radiusDelta)},removeOverlaps(A,w){if(!A.data)return;let T=A.data.centerIndexPos,C=w.attributes.size,{rings:k,radii:N}=w,O=w.x[T],j=w.y[T];for(let A in k){let T=k[A];for(let C of T){let T=N[A],k=w.x[C]-O,G=w.y[C]-j;k+G===0&&(k=Math.sin(C)*Math.random()*.001,G=Math.cos(C)*Math.random()*.001);let H=Math.sqrt(k*k+G*G),W=T;if(H-W<0){let A=W/H;w.x[C]=O+k*A,w.y[C]=j+G*A}}}for(let A in k){let T=k[A],N=Et(O,j,w.x[T[0]],w.y[T[0]]);Ul({X:w.x,Y:w.y,sizes:C,indexes:T,center:[O,j],R:N,gap:w.nodeGap,inPlace:!0})}}}),update(A,w){A||(A=w.data);let T,C=A.indexes,k=A.centerIndex;A.x=A.x||new Float32Array(A.size),A.y=A.y||new Float32Array(A.size),-1===A.step&&w.initialize(w,A);let N=A.repulsion,s=w=>A.radii&&A.radii[w]||1;if(0===A.step&&A.randomize&&(T=w.gridPlacement(A.indexes,A.attributes.size),A.x=T.x,A.y=T.y),!A.converged){let w=A.maxSteps,C=A.iterationsPerRender,k=A.step,O=Math.min(k+C,w),{D:j,x:G,y:H,size:W,centerIndexPos:$,normIndexes:Z}=A;for(;k<=O&&!A.converged;){let C=Cs(Math.min(k,w)/w);A.step=k++,T=ig(j,G,H,W,$,N,C,Z,s),A.x=T.x,A.y=T.y,A.prevStress=A.stress,A.stress=ng(j,G,H,W,$,N,C,Z),A.converged=A.converged||Math.abs(A.stress-A.prevStress)<=A.epsilon}}if(A.converged)if(A.overlapRemoved||A.allowOverlap){A.done=!0;let w=A.rings||{};A.rings=Object.keys(w).reduce(((A,T)=>(A[T]=w[T].map((A=>C[A])),A)),{})}else w.removeOverlaps(w,A,k),A.overlapRemoved=!0;return A},isRunning:({data:A})=>!(!A||A.converged&&(A.allowOverlap||A.done))||(A&&(A.step=-1),!1),onSync(A){if(A.renderSteps||A.done)return Yv(A)},onEnd:(A,w)=>Yv(A)};function Yv(A){let w=A.x,T=A.y,C=A.indexes.length,k=w[A.centerIndexPos]-A.cx,N=T[A.centerIndexPos]-A.cy;for(let A=0;A<C;A++)w[A]-=k,T[A]-=N;return{indexes:A.indexes,x:w,y:T}}
/**
* @preserve
* @linkurious/force-layout@0.5.6
* Ogma general-purpose force-directed layout
*/
function Ng(){var A=function(){var A=function(){function L(A){var w=function e(){var A=4022871197;return function(w){w=w.toString();for(var T=0;T<w.length;T++){var C=.02519603282416938*(A+=w.charCodeAt(T));C-=A=C>>>0,A=(C*=A)>>>0,A+=4294967296*(C-=A)}return 2.3283064365386963e-10*(A>>>0)}}();this.c=1,this.s0=w(" "),this.s1=w(" "),this.s2=w(" "),this.s0-=w(String(A)),this.s0<0&&(this.s0+=1),this.s1-=w(String(A)),this.s1<0&&(this.s1+=1),this.s2-=w(A),this.s2<0&&(this.s2+=1),w=null}return L.prototype.next=function(){var A=this;return function(){var w=2091639*A.s0+2.3283064365386963e-10*A.c;return A.s0=A.s1,A.s1=A.s2,A.s2=w-(A.c=0|w)}},L.prototype.nextDouble=function(){var A=this.next();return function(){return A()+11102230246251565e-32*(2097152*A()|0)}},L.prototype.nextInt32=function(){var A=this.next();return function(){return 4294967296*A()|0}},L}();function r(w){return new A(w.toString()).next()}var w=r(42);function s(A){w=r(A)}function a(){return 1e-6*(w()-.5)}var l=function(A){return A.x},u=function(A){return A.y},c=function(A){return A.r};function h(A,w,T,C){void 0===w&&(w=l),void 0===T&&(T=u),void 0===C&&(C=c);for(var k,N=function d(A){for(var w=A.length-1;w>=0;w--){var T=Math.floor(Math.random()*(w+1));T=Math.max(Math.min(T,w),0);var C=A[w];A[w]=A[T],A[T]=C}return A}(A.slice()),O=N.length,j=[],G=0;G<O;){var H=N[G];k&&p(k,w(H),T(H),C(H))?G++:(k=_(j=m(j,H,w,T,C),w,T,C),G=0)}return k}function m(A,w,T,C,k){var N=T(w),O=C(w),j=k(w),G={x:N,y:O,r:j};if(f(G,A,T,C,k))return[w];for(var H=0;H<A.length;++H){if(!g(G,se=T($=A[H]),ue=C($),ge=k($))&&f(b(se,ue,ge,N,O,j),A,T,C,k))return[A[H],w]}for(H=0;H<A.length-1;H++)for(var W=H+1;W<A.length;W++){var $=A[H],Z=A[W],se=T($),ue=C($),ge=k($),ce=T(Z),_e=C(Z),me=k(Z);if(!g(b(se,ue,ge,ce,_e,me),N,O,j)&&!g(b(se,ue,ge,N,O,j),ce,_e,me)&&!g(b(ce,_e,me,N,O,j),se,ue,ge)&&f(y(se,ue,ge,ce,_e,me,N,O,j),A,T,C,k))return[A[H],A[W],w]}throw new Error}function g(A,w,T,C){var k=A.r-C,N=w-A.x,O=T-A.y;return k>=0&&k*k>N*N+O*O}function p(A,w,T,C){var k=A.r-C+1e-6,N=w-A.x,O=T-A.y;return k>0&&k*k>N*N+O*O}function f(A,w,T,C,k){for(var N=0;N<w.length;++N){var O=w[N];if(!p(A,T(O),C(O),k(O)))return!1}return!0}function _(A,w,T,C){return 1===A.length?function E(A,w,T){return{x:A,y:w,r:T}}(w(A[0]),T(A[0]),C(A[0])):2===A.length?b(w(A[0]),T(A[0]),C(A[0]),w(A[1]),T(A[1]),C(A[1])):y(w(A[0]),T(A[0]),C(A[0]),w(A[1]),T(A[1]),C(A[1]),w(A[2]),T(A[2]),C(A[2]))}function b(A,w,T,C,k,N){var O=C-A,j=k-w,G=N-T,H=Math.sqrt(O*O+j*j);return{x:(A+C+O/H*G)/2,y:(w+k+j/H*G)/2,r:(H+T+N)/2}}function y(A,w,T,C,k,N,O,j,G){var H=A-C,W=A-O,$=w-k,Z=w-j,se=N-T,ue=G-T,ge=A*A+w*w-T*T,ce=ge-C*C-k*k+N*N,_e=ge-O*O-j*j+G*G,me=W*$-H*Z,pe=($*_e-Z*ce)/(2*me)-A,be=(Z*se-$*ue)/me,Se=(W*ce-H*_e)/(2*me)-w,Ee=(H*ue-W*se)/me,Te=be*be+Ee*Ee-1,Ce=2*(T+pe*be+Se*Ee),Ie=pe*pe+Se*Se-T*T,ze=-(Te?(Ce+Math.sqrt(Ce*Ce-4*Te*Ie))/(2*Te):Ie/Ce);return{x:A+pe+be*ze,y:w+Se+Ee*ze,r:ze}}for(var T=[0,1],C=[0,2],k=4;k<65535;k<<=2)for(var N=0,O=T.length;N<O;N++)T.push(T[N]|k),C.push((T[N]|k)<<1);function S(A,w){return(C[255&w]|T[255&A])+65536*(C[w>>8&255]|T[A>>8&255])+4294967296*(C[w>>16&255]|T[A>>16&255])}function P(A,w){var T=A^w,C=65535^T,k=65535^(A|w),N=A&(65535^w),O=T|C>>1,j=T>>1^T,G=k>>1^C&N>>1^k,H=T&k>>1^N>>1^N;j=(T=O)&(C=j)>>2^C&(T^C)>>2,G^=T&(k=G)>>2^C&(N=H)>>2,H^=C&k>>2^(T^C)&N>>2,j=(T=O=T&T>>2^C&C>>2)&(C=j)>>4^C&(T^C)>>4,G^=T&(k=G)>>4^C&(N=H)>>4,H^=C&k>>4^(T^C)&N>>4,G^=(T=O=T&T>>4^C&C>>4)&(k=G)>>8^(C=j)&(N=H)>>8;var W=A^w,$=(C=(H^=C&k>>8^(T^C)&N>>8)^H>>1)|65535^(W|(T=G^G>>1));return(($=1431655765&(($=858993459&(($=252645135&(($=16711935&($|$<<8))|$<<4))|$<<2))|$<<1))<<1|(W=1431655765&((W=858993459&((W=252645135&((W=16711935&(W|W<<8))|W<<4))|W<<2))|W<<1)))>>>0}var j=new Uint32Array(1024);var G=function L(A,w,T,C){this.left=null,this.right=null,this.data=null,this.code=A,this.data=w,this.left=T,this.right=C};var H,L,W=Math.clz32||function(A){for(var w=-2147483648,T=0;T<31;T+=1){if(w&A)return T;w>>>=1}return 32};function ae(A,w,T,C){var k=w[A[T]],N=w[A[C]];if(k===N)return T;var O,j,G=W(k^N),H=T,$=C-T;do{(O=H+($=$+1>>1))<C&&(j=w[A[O]],W(k^j)>G&&(H=O))}while($>1);return H}(L=H||(H={}))[L.HILBERT=1]="HILBERT",L[L.MORTON=0]="MORTON";var $=function(){function L(A,w){var T=void 0===w?{}:w,C=T.getX,k=T.getY,N=T.bucketSize,O=void 0===N?0:N,W=T.sfc,$=void 0===W?H.HILBERT:W;this.bucketSize=0,this._root=null;var Z=A.length,se=new Uint32Array(Z),ue=1/0,ge=1/0,ce=-1/0,_e=-1/0;this._x=C,this._y=k;var me=$===H.HILBERT?P:S;this._project=me;for(var pe=new Uint32Array(Z),be=0;be<Z;be++){var Se=C(Ie=A[be]),Ee=k(Ie);Se<ue&&(ue=Se),Ee<ge&&(ge=Ee),Se>ce&&(ce=Se),Ee>_e&&(_e=Ee),pe[be]=be}this._minX=ue,this._minY=ge,this._maxX=ce,this._maxY=_e;var Te=65535/Math.max(ce-ue,1),Ce=65535/Math.max(_e-ge,1);this._hw=Te,this._hh=Ce;for(be=0;be<Z;be++){var Ie=A[be];se[be]=me(Te*(C(Ie)-ue),Ce*(k(Ie)-ge))}(function z(A,w){for(var T=new Uint32Array(w.length),C=0;C<1024;C++)j[C]=0;var k=255;for(C=0;C<w.length;C++){var N=w[C];j[N&k]++,j[256+(N>>8&k)]++,j[512+(N>>16&k)]++,j[768+(N>>24&k)]++}for(var O=0;O<4;O++){var G=0,H=0,W=256*O;for(C=0;C<256;C++)G=j[C+W],j[C+W]=H,H+=G}for(C=0;C<w.length;C++)N=w[C],T[j[N&k]++]=C;for(C=0;C<w.length;C++)N=w[$=T[C]],A[j[256+(N>>8&k)]++]=$;for(C=0;C<w.length;C++)N=w[$=A[C]],T[j[512+(N>>16&k)]++]=$;for(C=0;C<w.length;C++){var $;N=w[$=T[C]],A[j[768+(N>>24&k)]++]=$}})(pe,se),this._root=0===O?function ee(A,w,T,C,k){for(var N=new G(null,null,null,null),O=[N],j=[C,k];0!==O.length;){var H=j.pop(),W=j.pop(),$=O.pop();if(H-W==0)$.code=T[W],$.data=A[w[W]];else{var Z=ae(w,T,W,H);$.code=Z,W<=Z&&($.left=new G(null,null,null,null),O.push($.left),j.push(W,Z)),H>Z&&($.right=new G(null,null,null,null),O.push($.right),j.push(Z+1,H))}}return N}(A,pe,se,0,Z-1):function X(A,w,T,C,k,N){for(var O=new G(null,null,null,null),j=[O],H=[C,k];0!==j.length;){var W=H.pop(),$=H.pop(),Z=j.pop();if(W-$<N){for(var se=new Array(W-$+1),ue=$,ge=0;ue<=W;ue++,ge++)se[ge]=A[w[ue]];Z.code=T[$],Z.data=se}else{var ce=ae(w,T,$,W);Z.code=ce,$<=ce&&(Z.left=new G(null,null,null,null),j.push(Z.left),H.push($,ce)),W>ce&&(Z.right=new G(null,null,null,null),j.push(Z.right),H.push(ce+1,W))}}return O}(A,pe,se,0,Z-1,O),this.bucketSize=O}return Object.defineProperty(L.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),L.prototype.inOrder=function(A,w){for(var T=this._root,C=[],k=!1;!k;)if(T)C.push(T),T=T.left;else if(0!==C.length){if(T=C.pop(),A.call(w,T))break;T=T.right}else k=!0;return this},L.prototype.preOrder=function(A,w){for(var T=[this._root];0!==T.length;){var C=T.pop();A.call(w,C)||(C.right&&T.push(C.right),C.left&&T.push(C.left))}return this},L.prototype.postOrder=function(A,w){var T,C=[],k=this._root;do{for(;k;)k.right&&C.push(k.right),C.push(k),k=k.left;k=C.pop(),T=C.length-1,k.right&&C[T]===k.right?(C[T]=k,k=k.right):(A.call(w,k),k=null)}while(0!==C.length);return this},L.prototype.map=function(A,w){var T=[];return this.inOrder((function(C){T.push(A.call(w,C))})),T},L.prototype.height=function(){return ne(this._root)},L.prototype.toString=function(A){void 0===A&&(A=function(A){return A.code.toString()});var w=[];return he(this._root,"",!0,(function(A){return w.push(A)}),A),w.join("")},L.prototype.size=function(){var A=0;return this.preOrder((function(){A++})),A},L.prototype.destroy=function(){return this._root=null,this},L}();function ne(A){return A?1+Math.max(ne(A.left),ne(A.right)):0}function he(A,w,T,C,k){if(A){C(w+(T?"^-- ":"|-- ")+k(A)+"\n");var N=w+(T?"    ":"|   ");A.left&&he(A.left,N,!1,C,k),A.right&&he(A.right,N,!0,C,k)}}var Z,se,ue,ge,ce,_e,me,pe,be,Se=0;function F(A,w,T,C){var k=C.X,N=C.Y,O=C.R,j=C.bucketSize;Se=A,null===T&&(T=new $(w,{getX:ue,getY:ge,bucketSize:j})).postOrder(Z);for(var G=w.length,H=0;H<G;H++)_e=w[H],me=k[_e],pe=N[_e],be=O[_e],T.preOrder(se);return T}var Ee,Te,Ce,Ie,ze,Pe,Re,Ue,Ve;function je(A,w,T,C){for(var k=T.sources,N=T.targets,O=T.X,j=T.Y,G=T.R,H=T.fx,W=T.fy,$=T.degrees,Z=T.weights,se=C.edgeStrength,ue=C.edgeLength,ge=0;ge<w.length;ge++){var ce=w[ge],_e=k[ce],me=N[ce],pe=$[_e]+1,be=$[me]+1,Se=se*Z[ce],Ee=O[me]+H[me]-O[_e]-H[_e]||a(),Te=j[me]+W[me]-j[_e]-W[_e]||a(),Ce=Ee*Ee+Te*Te,Ie=Math.sqrt(Ce),ze=ue+G[_e]+G[me];if(!(Ie<=ze)){var Pe=ze-Ie,Re=1/Math.min(pe,be),Ue=Math.min(1,A*Se*(Pe*Pe/Ce)*Re);Ee*=Ue,Te*=Ue;var Ve=be/(be+pe);H[_e]+=Ee*Ve,W[_e]+=Te*Ve,H[me]-=Ee*(1-Ve),W[me]-=Te*(1-Ve)}}}function ft(A,w,T,C,k){var N=C.X,O=C.Y,j=C.R,G=C.fx,H=C.fy,W=C.bucketSize;if(0===k.elasticity)return T;T||(T=new $(w,{getX:Ee,getY:Te,bucketSize:W})).postOrder(Ie);for(var Z=0;Z<w.length;Z++)Pe=w[Z],Re=N[Pe]+G[Pe],Ue=O[Pe]+H[Pe],Ve=j[Pe],T.preOrder(ze);return T}F.initialize=function(A,w,T){var C=A.length,k=w.X,N=w.Y,O=w.R,j=w.degrees,G=w.pinned,H=w.masses,W=w.nodeIds,$=T.scaling,Ee=T.defaultRadius,Te=T.bucketSize;w.bucketSize=void 0===Te?Math.floor(Math.log(C)):Te;for(var Ce=1/0,Ie=1/0,ze=-1/0,Pe=-1/0,Re=Math.PI*(3-Math.sqrt(5)),Ue=0,Ve=0;Ve<A.length;Ve++){var He=A[Ve],We=He.x,$e=He.y,Ye=He.r,qe=He.mass;if(isNaN(We)||isNaN($e)){var Qe=Ve*Re;We=(st=5*Math.sqrt(Ve))*Math.cos(Qe),$e=st*Math.sin(Qe)}Ye=Ye||Ee,k[Ve]=We,N[Ve]=$e,O[Ve]=Ye,G[Ve]=He.pinned?1:0,H[Ve]=void 0===qe?(1+j[Ve])*$:qe,W[Ve]=Ve,Ye>Ue&&(Ue=Ye),We<Ce&&(Ce=We),$e<Ie&&(Ie=$e),We>ze&&(ze=We),$e>Pe&&(Pe=$e)}if(A.length>1&&(ze-Ce<2*Ue||Pe-Ie<2*Ue)){var Ke=(Ce+ze)/2,et=(Ie+Pe)/2;for(Ve=0;Ve<C;Ve++)if(!G[Ve]){var st;Qe=Ve*Re,We=Ke+(st=5*Math.sqrt(Ve))*Math.cos(Qe),$e=et+st*Math.sin(Qe);k[Ve]=We,N[Ve]=$e,We<Ce&&(Ce=We),$e<Ie&&(Ie=$e),We>ze&&(ze=We),$e>Pe&&(Pe=$e)}}ue=function(A){return k[A]},ge=function(A){return N[A]},ce=function(A){return O[A]},Z=function(A){var w=A.X,T=A.Y,C=A.R,k=A.masses,N=A.bucketSize;return function(A){var O,j,G=0,H=0,W=0,$=0,Z=A.data;if(null!==Z)if(0!==N){var se=Z,_e=h(se,ue,ge,ce);G=_e.x,H=_e.y,W=_e.r;for(var me=0;me<se.length;me++)$+=k[se[me]]}else G=w[j=Z],H=T[j],W=C[j],$=k[j];else if(A.left&&A.right){var pe=A.left.cx,be=A.left.cy,Se=A.right.cx,Ee=A.right.cy,Te=A.left.r,Ce=A.right.r,Ie=Se-pe,ze=Ee-be,Pe=Ce-Te,Re=Math.sqrt(Ie*Ie+ze*ze);G=(pe+Se+Ie/Re*Pe)/2,H=(be+Ee+ze/Re*Pe)/2,W=(Re+Te+Ce)/2,$=A.left.mass+A.right.mass}else G=(O=A.left||A.right).cx,H=O.cy,W=O.r,$=O.mass;A.cx=G,A.cy=H,A.r=W,A.mass=$}}(w),se=function(A,w){var T=A.fx,C=A.fy,k=A.X,N=A.Y,O=A.R,j=A.masses,G=A.bucketSize,H=w.charge,W=w.theta;return w.friction,function(A){var w=0,$=0,Z=me-A.cx||a(),se=pe-A.cy||a(),ue=Z*Z+se*se,ge=be+A.r,ce=A.data;if(null!==ce){if(ce===_e)return!1;if(0!==G)for(var Ee=ce,Te=0;Te<Ee.length;Te++){var Ce=Ee[Te];Ce!==_e&&(ue=(Z=me-k[Ce]||a())*Z+(se=pe-N[Ce]||a())*se,ge=be+O[Ce],ue<1&&(ue=Math.sqrt(1*ue)),w=H*j[Ce],$=Se*w/ue,T[_e]+=Z*$,C[_e]+=se*$)}else ue<1&&(ue=Math.sqrt(1*ue)),w=H*A.mass,$=Se*w/ue,T[_e]+=Z*$,C[_e]+=se*$}else{var Ie=ge/W;if(ue>Ie*Ie)return ue<1&&(ue=Math.sqrt(1*ue)),w=H*A.mass,$=Se*w/ue,T[_e]+=Z*$,C[_e]+=se*$,!0}}}(w,T)},je.initialize=function(A,w){for(var T=w.edgeIds,C=w.sources,k=w.targets,N=w.degrees,O=w.weights,j=0;j<A.length;j++){var G=A[j],H=G.source,W=G.target,$=G.weight,Z=void 0===$?1:$;C[j]=H,k[j]=W,O[j]=Z,N[H]++,N[W]++,T[j]=j,O[j]=void 0===Z?1:Z}};function I(A,w,T,C){T.pinned;for(var k=T.X,N=T.Y,O=T.fx,j=T.fy,G=C.gravity,H=C.cx,W=C.cy,$=0,Z=0,se=w.length,ue=0;ue<se;ue++)$+=k[ue],Z+=N[ue];$=$/se-H,Z=Z/se-W;for(ue=0;ue<se;ue++){var ge=w[ue],ce=H-k[ge]||a(),_e=W-N[ge]||a(),me=G*A;O[ge]+=ce*me,j[ge]+=_e*me}}function V(A,w){return void 0===w&&(w=1),function de(A){for(var w=0,T=0,C=0,k=A;C<k.length;C++)w+=(W=k[C]).w*W.h,T=Math.max(T,W.w);A.sort((function(A,w){return w.h-A.h}));for(var N=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(w/.95)),T),h:1/0}],O=0,j=0,G=0,H=A;G<H.length;G++)for(var W=H[G],$=N.length-1;$>=0;$--){var Z=N[$];if(!(W.w>Z.w||W.h>Z.h)){if(W.x=Z.x,W.y=Z.y,j=Math.max(j,W.y+W.h),O=Math.max(O,W.x+W.w),W.w===Z.w&&W.h===Z.h){var se=N.pop();$<N.length&&(N[$]=se)}else W.h===Z.h?(Z.x+=W.w,Z.w-=W.w):W.w===Z.w?(Z.y+=W.h,Z.h-=W.h):(N.push({x:Z.x+W.w,y:Z.y,w:Z.w-W.w,h:W.h}),Z.y+=W.h,Z.h-=W.h);break}}}(A.map((function(A){return A.w+=A.maxr+w,A.h+=A.maxr+w,A})).sort((function(A,w){return A.w*A.h-w.w*w.h})))}ft.initialize=function(A,w,T){var C=w.X,k=w.Y,N=w.R;Ee=function(A){return C[A]},Te=function(A){return k[A]},Ce=function(A){return N[A]},Ie=function(A){var w=A.X,T=A.Y,C=A.R,k=A.bucketSize;return function(A){var N,O,j,G,H=A.data;if(null!==H)if(0!==k){var W=h(H,Ee,Te,Ce);N=W.x,O=W.y,j=W.r}else{var $=H;N=w[$],O=T[$],j=C[$]}else if(A.left&&A.right){var Z=A.left.cx,se=A.left.cy,ue=A.right.cx,ge=A.right.cy,ce=A.left.r,_e=A.right.r,me=ue-Z,pe=ge-se,be=_e-ce,Se=Math.sqrt(me*me+pe*pe);N=(Z+ue+me/Se*be)/2,O=(se+ge+pe/Se*be)/2,j=(Se+ce+_e)/2}else(G=A.left||A.right)&&(N=G.cx,O=G.cy,j=G.r);A.cx=N,A.cy=O,A.r=j}}(w),ze=function(A,w){var T=A.X,C=A.Y,k=A.R,N=A.fx,O=A.fy,j=A.bucketSize,G=w.elasticity,H=w.margin;return function(A){var w=A.data;if(null===w){_e=A.cx-Re,me=A.cy-Ue;var W=A.r+Ve;return _e*_e+me*me>W*W}if(0!==j)for(var $=w,Z=0;Z<$.length;Z++){var se;if((se=$[Z])>Pe){var ue=k[se];if((be=(_e=Re-T[se]-N[se])*_e+(me=Ue-C[se]-O[se])*me)<(pe=Ve+ue+H)*pe){0===_e&&(be+=(_e=a())*_e),0===me&&(be+=(me=a())*me);var ge=(pe-(Se=Math.sqrt(be)))*G/Se,ce=ue/pe;N[Pe]+=_e*ge*ce,O[Pe]+=me*ge*ce,N[se]-=_e*ge*(1-ce),O[se]-=me*ge*(1-ce)}}}else if((se=A.data)>Pe){var _e,me,pe,be,Se;if(ue=k[se],(be=(_e=Re-T[se])*_e+(me=Ue-C[se])*me)<(pe=Ve+ue+H)*pe)0===_e&&(be+=(_e=a())*_e),0===me&&(be+=(me=a())*me),Z=(pe-(Se=Math.sqrt(be)))*G/Se,ce=ue/pe,N[Pe]+=_e*Z*ce,O[Pe]+=me*Z*ce,N[se]-=_e*Z*(1-ce),O[se]-=me*Z*(1-ce)}}}(w,T)},I.initialize=function(A,w,T){var C=w.X,k=w.Y,N=T.cx,O=T.cy,j=A.length;if(void 0===N||void 0===O){N=O=0;for(var G=0;G<j;G++)N+=C[G],O+=k[G];N/=j,O/=j}T.cx=N,T.cy=O};var He=function(){function L(){this.ids=[],this.xmin=1/0,this.ymin=1/0,this.xmax=-1/0,this.ymax=-1/0,this.x=0,this.y=0,this.w=0,this.h=0,this.cx=0,this.cy=0,this.radius=0,this.mx=0,this.my=0,this.m=0,this.maxr=0}return L.prototype.add=function(A,w,T,C){this.ids.push(A),w-C<this.xmin&&(this.xmin=w-C),T-C<this.ymin&&(this.ymin=T-C),w+C>this.xmax&&(this.xmax=w+C),T+C>this.ymax&&(this.ymax=T+C),C>this.maxr&&(this.maxr=C),this.mx+=C*w,this.my+=C*T,this.m+=C},L.prototype.measure=function(A){return void 0===A&&(A=0),this.w=this.xmax-this.xmin+2*A,this.h=this.ymax-this.ymin+2*A,this.cx=this.mx/this.m,this.cy=this.my/this.m,this.x=this.xmin,this.y=this.ymin,this.radius=Math.sqrt(this.w*this.w+this.h*this.h)/2,this},L}();function ve(A,w){return(A+w)*(A+w+1)/2+w}function Me(A,w,T){var C=A.edgeIds,k=A.sources,N=A.targets,O=A.pinned,j=A.degrees,G=A.X,H=A.Y,W=A.R;void 0===w&&(w=0),void 0===T&&(T=.5);for(var $={},Z={},se=0,ue=C;se<ue.length;se++){var ge=ue[se],ce=k[ge],_e=N[ge];ce!==_e&&($[ce]=$[ce]||{},$[_e]=$[_e]||{},$[ce][_e]=!0,$[_e][ce]=!0)}Object.keys($).forEach((function(A){var w=Number(A),T=Object.keys($[Number(w)]);if(2===T.length){var C=T[0],k=T[1],N=function Le(A,w){return A<w?A*w+Math.pow(w-A-1,2)/4:A*w+Math.pow(A-w-1,2)/4}(Number(C),Number(k));N in Z||(Z[N]=[Number(k),Number(C)]),O[w]||Z[N].push(w)}})),Object.keys(Z).forEach((function(A){var C=Z[Number(A)],k=C[0],N=C[1],O=C.slice(2);if(!(O.length<3)){var $=G[k],se=H[k],ue=G[N],ge=H[N],ce=j[k],_e=.25+.5*ce/(ce+j[N]),me=$+(ue-$)*_e,pe=se+(ge-se)*_e,be=-(ge-se),Se=ue-$,Ee=Math.sqrt(Math.pow($-ue,2)+Math.pow(se-ge,2));be=-2*be/Ee,Se=-2*Se/Ee;var Te=Math.acos(be/Math.sqrt(be*be+Se*Se));w>0&&(Te<w||Te>Math.PI-w&&Te<=Math.PI?(be=2*Math.cos(Math.PI-w),Se=2*Math.sin(Math.PI-w)):(Te>2*Math.PI-w||Te>=Math.PI&&Te<Math.PI+w)&&(be=2*Math.cos(w),Se=2*Math.sin(w)));var Ce=0,Ie=1;O.sort((function(A,w){return W[w]-W[A]}));var ze=0,Pe=0,Re=Math.max(W[O[0]],W[O[1]])/2;O.length%2==1&&(Ce=1,me-=be*Re,pe-=Se*Re);for(var Ue=1+T,Ve=0;Ve<O.length;Ve++){var He=(Ce+Ve)%2,We=O[Ve],$e=Ve>=2?W[We]:Re,Ye=(He?ze:Pe)+$e;G[We]=me+be*Ie*Ye,H[We]=pe+Se*Ie*Ye,He?ze+=$e*Ue:Pe+=$e*Ue,Ie=-Ie}}}))}function xt(A,w,T,C){var k=T.X,N=T.Y,O=T.R,j=T.components,G=T.pinned,H=T.degrees,W=T.sources,$=T.targets,Z=T.edgeIds,se=C.update,ue=C.onUpdate,ge=C.placement,ce=C.placementOffset,_e=C.alignSiblings,me=C.siblingsMinAngle,pe=C.siblingsOffset;if(_e&&(Me({X:k,Y:N,R:O,degrees:H,pinned:G,sources:W,targets:$,edgeIds:Z},me,pe),se(A,k,N)),ge){var be=function tt(A,w,T,C){for(var k=0,N=[],O=0,j=C;O<j.length;O++){for(var G=j[O],H=new He,W=0,$=G;W<$.length;W++){var Z=$[W];H.add(Z,A[Z],w[Z],T[Z])}N.push(H.measure()),G.length>N[k].ids.length&&(k=N.length-1)}return{boxes:N,biggest:k}}(k,N,O,j),Se=be.boxes,Ee=be.biggest;if("spiral"===ge)!function oe(A,w,T,C,k){void 0===w&&(w=20);for(var N=0,O=A;N<O.length;N++){var j=O[N],G=h(j.ids,(function(A){return T[A]}),(function(A){return C[A]}),(function(A){return k[A]})),H=G.x,W=G.y,$=G.r;j.cx=H,j.cy=W,j.radius=$+w}for(var Z=A.slice().sort((function(A,w){return A.radius-w.radius})),se=Z.map((function(A){return{x:A.cx,y:A.cy,r:A.radius}})),ue=Z.pop(),ge=3*Math.PI/2,ce=ue.radius,_e=2*Math.PI,me=ue.cx,pe=ue.cy,be=[ue],De=function(){var A=Z[Z.length-1],w=ce+A.radius,T=me+Math.cos(ge)*w,C=pe+Math.sin(ge)*w;if(be.some((function(w){var k=w.cx-T,N=w.cy-C;return Math.sqrt(k*k+N*N)<w.radius+A.radius})))return ce+=1,"continue";A.x=T-A.w/2,A.y=C-A.h/2,A.cx=T,A.cy=C,se[Z.length-1].x=T,se[Z.length-1].y=C,be.push(Z.pop()),ge+=(2*A.radius+1)/w*1%_e};0!==Z.length;)De()}(Se,ce,k,N,O);else{if("box"!==ge)return;V(Se,ce)}for(var Te=Se[Ee].xmin-Se[Ee].x,Ce=Se[Ee].ymin-Se[Ee].y,Ie=0,ze=Se;Ie<ze.length;Ie++)for(var Pe=ze[Ie],Re=Pe.xmin,Ue=Pe.ymin,Ve=Re-Pe.x-Te,We=Ue-Pe.y-Ce,$e=0,Ye=Pe.ids;$e<Ye.length;$e++){var qe=Ye[$e];k[qe]-=Ve,N[qe]-=We}se(A,k,N),ue()}}function rt(A,w,T,C,k,N){var O,j=T.X,G=T.Y,H=T.nodeIds,W=T.edgeIds,$=T.layers,Z=T.movements,se=T.movementsPrev,ue=T.surfaces,ge=T.surfacesPrev,ce=C.nextTick,_e=C.cancelTick,me=C.batch,pe=C.steps,be=C.minMovement,Se=C.update,Ee=C.onUpdate,Te=C.autoStop,Ce=0,Ie=1,ze=1-Math.pow(.05,1/pe),Pe=!1,ot=function(){Pe=!0,_e(O),Ee(),N(Ce)},Re=!1,Pt=function(){var w=k(Ie+=(.001-Ie)*ze,H,W),T=$.length,C=!1,N=!1;if(Te){C=N=!0;for(var _e=Te.movementRatio,Ue=Te.surfaceRatio,Ve=0;Ve<T;Ve++)C&&Math.abs(1-ue[Ve]/ge[Ve])>Ue&&(C=!1),N&&Math.abs(Z[Ve]-se[Ve])>_e&&(N=!1)}C&&N&&!Re&&(ze=1-Math.pow(.001,1/Math.max(10,Ce)),Re=!0);var He=Pe||Ie<.05||0!==w&&w<=be;if(Ce%me==0&&(Se(A,j,G),Ee()),++Ce>=pe||He)return ot();for(Ve=0;Ve<T;Ve++)se[Ve]=Z[Ve],ge[Ve]=ue[Ve];O=ce(Pt)};return O=setTimeout(Pt),{done:!1,stop:function(){return ot(),this},get iterations(){return Ce}}}function ht(A,T,C,k,N,O){var j,G=C.X,H=C.Y,W=C.R,$=C.degrees,Z=C.nodeIds,se=C.edgeIds,ue=C.layers,ge=C.layer,ce=C.cluster,_e=C.masses,me=C.weights,pe=C.sources,be=C.targets,Se=k.cx,Ee=k.cy,Te=k.nextTick,Ce=k.cancelTick,Ie=k.update,ze=k.onUpdate,Pe=k.batch,Re=(k.maxIterations,k.steps),Ue=k.minMovement,Ve=ue.slice(),He=0;function Pt(){Ce(j),Ie(A,G,H),ze(),O(He)}for(var We={},$e=0;$e<T.length;$e++)We[Number(T[$e].id)||$e]=$e;var Ye=new Map;for($e=0;$e<se.length;$e++){var qe=se[$e];Ye.set(ve(pe[qe],be[qe]),qe)}for($e=0;$e<ue.length;$e++){for(var Qe=ue[$e],Ke=$e,et=0;et<Qe.length;et++){var st=Qe[et],at=ce[st];-1!==at&&(_e[at]+=_e[st])}for(et=0;et<T.length;et++){qe=T[et];var ut=Number(qe.id)||et,gt=qe.source,_t=qe.target,mt=me[We[ut]];if(ge[gt]===Ke&&ge[_t]===Ke){var vt=ce[gt],St=ce[_t];if(vt!==St){var kt=Ye.get(ve(vt,St));void 0!==kt&&(me[kt]+=mt)}}}}Z.length=0,se.length=0;var Mt,Nt,Dt=1,Bt=1-Math.pow(.1,1/Re/2),Ht=(Dt-.1)/Re,Wt=.5;return j=setTimeout((function Gb(){var C=N(Dt+=(0-Dt)*Bt,Z,se),k=Dt<=Wt||C<Ue;if(0===He||k){var O=Ve.pop();if(O){Mt&&(Nt=Mt.reduce((function(A,w){return Math.max(A,Se-G[w],Ee-H[w])}),0)),Z.push.apply(Z,O);for(var ue=0;ue<O.length;ue++){var ge=O[ue],me=ce[ge];if(-1!==me){var pe=$[ge]>1?2:1,be=W[me]+W[ge];_e[me]-=_e[ge],G[ge]=G[me]+pe*be*(2*w()-1),H[ge]=H[me]+pe*be*(2*w()-1)}else Mt&&(G[ge]=Se+2*Nt*(1-2*w()),H[ge]=Ee+2*Nt*(1-2*w()))}Mt=O;var Ce=Z.reduce((function(A,w){return A[w]=!0,A}),{});se.length=0;for(ue=0;ue<T.length;ue++){var Re=T[ue],$e=Re.source,Ye=Re.target;ge=Re.id;Ce[$e]&&Ce[Ye]&&se.push(We[Number(ge)])}k=!1,0===Ve.length?(Dt=.2,Wt=.1):(Dt=.1+2*Ht,Wt=.1)}}He%Pe==0&&(Ie(A,G,H),ze()),++He>=Infinity||k?Pt():j=Te(Gb)})),{done:!1,stop:function(){return Pt(),this},get iterations(){return He}}}function Ot(A,w,T,C){var k=T.X,N=T.Y,O=T.fx,j=T.fy,G=T.pinned,H=T.layer;T.masses;var W=T.layers,$=T.surfaces,Z=T.movements,se=C.maxDisplacement;Z.fill(0);for(var ue=0,ge=A.length,ce=1/0,_e=1/0,me=-1/0,pe=-1/0,be=se*se,Se=0;Se<ge;Se++){var Ee=O[$e=A[Se]]*=w,Te=j[$e]*=w,Ce=H[$e],Ie=Ee,ze=Te,Pe=k[$e],Re=N[$e];if(Ie*Ie+ze*ze>be){var Ue=Math.sqrt(Ie*Ie+ze*ze)/se;ze/=Ue,Ie/=Ue}G[$e]||(k[$e]+=Ie,N[$e]+=ze);var Ve=Math.sqrt(Ie*Ie+ze*ze);G[$e]||(Pe<ce&&(ce=Pe),Re<_e&&(_e=Re),Pe>ce&&(me=Pe),Re>_e&&(pe=Re),Z[Ce-1]+=Ve),ue+=Ce*Ve}for(var He=Math.max(me-ce,0),We=Math.max(pe-_e,0),$e=0;$e<W.length;$e++){for(var Ye=W[$e],qe=Ye.length,Qe=1/0,Ke=1/0,et=-1/0,st=-1/0,at=0,ut=0;ut<qe;ut++){var gt=Ye[ut];if(!G[gt])(Pe=k[gt])<Qe&&(Qe=Pe),(Re=N[gt])<Ke&&(Ke=Re),Pe>et&&(et=Pe),Re>st&&(st=Re),at++}var _t=et-Qe,mt=st-Ke,vt=Math.max(1,Math.sqrt(Math.pow(_t,2)+Math.pow(mt,2)));$[$e]=vt;var St=0===at?0:Z[$e]/at,kt=He*We||1;Z[$e]=St>at?St/kt:0}return ue}
/*! *****************************************************************************
  Copyright (c) Microsoft Corporation. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0

  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.

  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** */
var Je=function(){return Je=Object.assign||function(A){for(var w,T=1,C=arguments.length;T<C;T++)for(var k in w=arguments[T])Object.prototype.hasOwnProperty.call(w,k)&&(A[k]=w[k]);return A},Je.apply(this,arguments)},We=0,$e="undefined"==typeof window,Ye="undefined"!=typeof performance&&performance.now?performance:Date,qe=$e?function(A){var w=Ye.now(),T=Math.max(0,16-(w-We)),C=setTimeout((function(){return A(w+T)}),T);return We=w+T,C}:window.requestAnimationFrame,Qe=$e?function(A){return clearTimeout(A)}:window.cancelAnimationFrame;function mn(A,w,T){for(var C=0;C<A.length;C++){var k=A[C];k.x=w[C],k.y=T[C]}}var On=function(){},Ke={movementRatio:7e-8,surfaceRatio:.0025},et=function L(A){for(var w in void 0===A&&(A={}),this.onUpdate=On,this.update=mn,this.nextTick=qe,this.cancelTick=Qe,this.onEnd=On,this.charge=10,this.maxIterations=300,this.minMovement=.1,this.edgeLength=30,this.edgeStrength=3,this.friction=.1,this.elasticity=.9,this.margin=1,this.cx=void 0,this.cy=void 0,this.gravity=.01,this.theta=.34,this.batch=1,this.inertia=.9,this.integrator=0,this.multilevel=!1,this.placement="none",this.placementOffset=10,this.alignSiblings=!1,this.bucketSize=void 0,this.maxDisplacement=1e3,this.siblingsMinAngle=0,this.siblingsOffset=.15,this.steps=300,this.scaling=1,this.defaultRadius=1,this.autoStop=Ke,"autoStop"in A?A.autoStop&&("boolean"==typeof A.autoStop?A.autoStop=Ke:A.autoStop=Je({},A.autoStop,Ke)):A.steps,A)void 0!==A[w]&&(this[w]=A[w])};function gn(A,w,T){(function Jr(A,w,T){for(var C=T.sources,k=T.targets,N=T.degrees,O=T.nodeIds,j=T.edgeIds,G={},H=0;H<A.length;H++)G[H]=O[H]=H;for(H=0;H<w.length;H++){var W=w[H],$=W.source,Z=W.target,se=G[$],ue=G[Z];j[H]=H,C[H]=se,k[H]=ue,N[se]++,N[ue]++}})(A,w,T),function gr(A){for(var w=A.nodeIds,T=A.edgeIds,C=A.sources,k=A.targets,N=A.degrees,O=A.layer,j=A.layers,G=A.component,H=A.components,W=A.cluster,$=A.parent,Z=0,se=1,ue=new Uint32Array(w.length),ge=0;ge<w.length;ge++)ue[ge]=N[ge];var ce=new Array(w.length);for(ge=0;ge<T.length;ge++){var _e=T[ge],me=C[_e],pe=k[_e];ce[me]=ce[me]||[],ce[pe]=ce[pe]||[],ce[me].push(pe),ce[pe].push(me)}var be=new Uint8Array(w.length),Se=new Uint8Array(w.length);$.fill(-1);var Ee=0;for(ge=0;ge<w.length;ge++)if(0===be[ge]){for(var Te=[ge];0!==Te.length;){var Ce=Te.pop();0===be[Ce]&&(Te.push.apply(Te,ce[Ce]),be[Ce]=1,G[Ce]=Ee)}Ee++}var Ie=new Array(w.length);for(ge=0;ge<w.length;ge++)O[ge]=0,Ie[ge]=ge;for(;0!==Ie.length;){var ze=[],Pe=[];for(ge=0;ge<Ie.length;ge++)ue[Ie[ge]]<=Z&&(ze.push(ge),Pe.push(Ie[ge]));for(ge=0;ge<Pe.length;ge++){if(Se[Ue=Pe[ge]]=Z,O[Ue]=se,Qe=ce[Ue])for(var Re=0;Re<Qe.length;Re++)ue[Qe[Re]]--}for(ge=0;ge<Pe.length;ge++){var Ue;if(Qe=ce[Ue=Pe[ge]])for(Re=0;Re<Qe.length;Re++){var Ve=Qe[Re],He=O[Ve];if(void 0===He||He>se){$[Ue]=Ve;break}}}ze.reverse();for(ge=0;ge<ze.length;ge++)Ie.splice(ze[ge],1);if(se+=1,Ie.length>0){var We=1/0;for(ge=0;ge<Ie.length;ge++){var $e=ue[Ie[ge]];$e<We&&(We=$e)}We>=Z+1&&(Z=We,se=1)}}be.fill(0);for(ge=0;ge<w.length;ge++){var Ye=w[ge],qe=O[Ye];if(-1===$[Ye]||O[$[Ye]]===qe){Te=[Ye];for(be.fill(0);0!==Te.length;){if(!be[Ke=Te.pop()]){if(O[Ke]>qe){$[Ye]=Ke;break}var Qe=ce[Ke];be[Ke]=1,Qe&&Te.push.apply(Te,Qe)}}}}for(ge=0;ge<w.length;ge++){var Ke,et=G[Ke=w[ge]];H[et]=H[et]||[],H[et].push(Ke);var st=O[Ke]-1;j[st]=j[st]||[],j[st].push(Ke),W[Ke]=$[Ke]}}(T)}var st=function L(A){this.bucketSize=0;var w=A.nodes.length,T=A.edges.length;s(w+T),this.X=new Array(w),this.Y=new Array(w),this.R=new Array(w),this.fx=new Float32Array(w),this.fy=new Float32Array(w),this.vx=new Float32Array(w),this.vy=new Float32Array(w),this.pinned=new Uint8Array(w),this.masses=new Float32Array(w),this.weights=new Float32Array(T),this.lengths=new Float32Array(T),this.sources=new Uint16Array(T),this.targets=new Uint16Array(T),this.degrees=new Uint32Array(w),this.layer=new Uint32Array(w),this.parent=new Int32Array(w),this.cluster=new Int32Array(w),this.component=new Uint16Array(w),this.components=[],this.layers=[],this.nodeIds=new Array(w),this.edgeIds=new Array(T),gn(A.nodes,A.edges,this),this.movements=new Array(this.layers.length).fill(0),this.surfaces=new Array(this.layers.length).fill(0),this.movementsPrev=new Array(this.layers.length).fill(0),this.surfacesPrev=new Array(this.layers.length).fill(0)},at=function(){function L(A){this.promise=new Promise(A)}return L.prototype.then=function(A){return this.promise.then(A)},L.prototype.stop=function(){return this.simulation.stop(),this},Object.defineProperty(L.prototype,"iterations",{get:function(){return this.simulation.iterations()},enumerable:!0,configurable:!0}),L}(),ut={euler:function it(A,w,T,C){for(var k=T.X,N=T.Y,O=T.fx,j=T.fy,G=T.vx,H=T.vy,W=T.masses,$=T.pinned,Z=0,se=0,ue=A.length,ge=1/8,ce=0;ce<ue;ce++){var _e=A[ce],me=W[_e],pe=O[_e]/me,be=j[_e]/me;G[_e]+=pe*ge,H[_e]+=be*ge;var Se=.2*G[_e]*ge+.5*pe*ge*ge,Ee=.2*H[_e]*ge+.5*be*ge*ge;O[_e]=j[_e]=0,$[_e]||(k[_e]+=Se,N[_e]+=Ee,Z+=Math.abs(Se)*me,se+=Math.abs(Ee)*me)}return(Z*Z+se*se)/ue},verlet:Ot,leapfrog:function zt(A,w,T,C){for(var k=T.X,N=T.Y,O=T.fx,j=T.fy,G=T.vx,H=T.vy,W=T.pinned,$=T.masses,Z=A.length,se=0,ue=0;ue<Z;ue++){var ge=A[ue],ce=$[ge],_e=O[ge]/ce,me=j[ge]/ce,pe=G[ge]+1*_e,be=H[ge]+1*me,Se=1*pe,Ee=1*be;Se>1e4&&(Se=.1),Ee>1e4&&(Ee=.1),G[ge]=w*(pe+G[ge])/2,H[ge]=w*(be+H[ge])/2,O[ge]=j[ge]=0,W[ge]||(k[ge]+=Se,N[ge]+=Ee),se+=.5*(Se*Se+Ee*Ee)}return se}};function kr(A,w){var T=this;void 0===w&&(w={});var C,k,M=function(A){return void 0===A&&(A={nodes:[],edges:[]}),C=A.nodes,k=A.edges,s(ve(C.length,k.length)),new st(A)},U=function(A){return void 0===A&&(A={}),new et(A)},N=M(A),O=U(w);je.initialize(k,N),F.initialize(C,N,O),ft.initialize(C,N,O),I.initialize(C,N,O);var j,G=ut[O.integrator]||Ot,H=null,q=function(A,w,T){return H&&(H.destroy(),H=null),w.length<=1?0:(H=F(A,w,H,N),je(A,T,N,O),0!==O.elasticity&&ft(0,w,H,N,O),I(A,w,N,O),G(w,O.inertia,N,O))};return{setOptions:function(A){return void 0===A&&(A={}),O=U(A),T},setGraph:function(w){var C=w.nodes,k=w.edges;return N=M(A),je.initialize(k,N),F.initialize(C,N,O),ft.initialize(C,N,O),I.initialize(C,N,O),T},start:function(){return j=(O.multilevel?ht:rt)(C,k,N,O,q,(function(A){j.done||xt(C,0,N,O),O.onEnd(A),j.done=!0})),this},iterations:function(){return j.iterations},data:function(){return N},stop:function(){return j&&j.stop(),this},step:function(A){return void 0===A&&(A=1),q(A,N.nodeIds,N.edgeIds),O.update(C,N.X,N.Y),this}}}return kr.run=function(A,w){var T,C=new at((function(C){w.onEnd=C,T=kr(A,w).start()}));return C.simulation=T,C.stop=function(){return T.stop(),C},C},kr}();return A.apply(this,arguments)}var qg={name:"force",imports:{force:Ng},configure(A,{graph:w}){let T=A.nodes._indexes,C=w.getNodeAttribute("x").getMultiple(T),k=w.getNodeAttribute("y").getMultiple(T),N=w.getNodeAttribute("radius").getMultiple(T),O=w.getNodeAttribute("layoutable").getMultiple(T),j=A.edges,G=[],H=[],W={};void 0===A.edgeStrength&&(A.edgeStrength=.75),null==A.gravity&&(A.gravity=.015),null==A.siblingsOffset&&(A.siblingsOffset=0),null==A.theta&&(A.theta=.62),A.autoStop=!!A.autoStop,A.alignSiblings=!!A.alignSiblings;let $=A.radiusRatio||1.25;for(let w=0;w<A.nodes._indexes.length;w++){let T=A.nodes._indexes[w];W[T]=w,G.push({id:w,x:C[w],y:k[w],r:N[w]*$,pinned:!O[w]})}j.forEach((A=>{let w=W[A.getSource()._index],T=W[A.getTarget()._index];w!==T&&void 0!==w&&void 0!==T&&H.push({source:w,target:T})}));let Z=Ji(re({},A));return delete Z.nodes,delete Z.edges,{graph:{nodes:G,edges:H},options:Z,indexes:A.nodes._indexes,done:!1,x:C,y:k,chunkPeriod:250}},update:function(A,w){if(!w.simulation&&A){w.done=!1,w.graph=A.graph,w.options=A.options,w.indexes=A.indexes;let T=Date.now();A.options.nextTick=A=>Date.now()-T<=w.chunkPeriod?A():(T=Date.now(),setTimeout(A,0)),A.options.update=(A,T,C)=>{w.x=T,w.y=C},A.options.onEnd=()=>{w.done=!0,w.simulation=void 0},A.options.bucketSize=0;let C=Ng(A.graph,A.options).start(),{X:k,Y:N}=C.data();w.simulation=C,w.x=k,w.y=N}return{graph:w.graph,indexes:w.indexes,x:w.x,y:w.y}},context:function(){return{done:!1,graph:{nodes:[],edges:[]},x:null,y:null,indexes:null,chunkPeriod:250}},stop:function(A){A.done=!0,A.simulation&&(A.simulation.stop(),delete A.simulation)},isRunning:function(A){return!A.done||(A.done=!1,!1)},onSync:function({indexes:A,x:w,y:T}){return{indexes:A,x:w,y:T}}};function eP(A,w,T){let C,k,N=1/0;for(let T=0,O=w.length;T<O;T++){let j=w[T],G=w[(T+1)%O],H=Ah(A[0],A[1],j[0],j[1],G[0],G[1]);H<N&&(N=H,C=j,k=G)}return function tP(A,w,T,C,k,N,O){let j=lf(A,w,T,C,k,N),G=-(C-N),H=T-k,W=Math.sqrt(G*G+H*H);return G/=W,H/=W,[j.x-O*G,j.y-O*H]}(A[0],A[1],C[0],C[1],k[0],k[1],T)}function jv(A,w,T){let{duration:C=0,margin:k=5,referenceNodes:N,nodes:O}=w,j=N;j&&!(j instanceof Gi)&&(j=A.getNodes(j));let G=j||O.inverse(),H=G.getPosition().map((A=>[A.x,A.y])),W=T,$=O.getBoundingBox(),Z=G.getBoundingBox();Z.pad(Z.maxScaledSize);let se,ue=Jn(W.map((A=>A.x)),W.map((A=>A.y)),O.getAttribute("radius").map(Number)),[ge,ce]=ue,_e=ue[2]+Z.maxScaledSize+k,me=0,pe=0;if(function rP(A,w,T,C){for(let k=0;k<A.length;k++){let[N,O]=A[k],j=Math.abs(N-w),G=Math.abs(O-T);if(j+G<=C)return!0;if(!(j>C||G>C)&&j*j+G*G<=C*C)return!0}return!1}(H,ge,ce,_e))if(G.size<=3){if(bl(ge,ce,ue[2],Z.minX,Z.minY,Z.maxX,Z.maxY)){let A=function nP(A,w,T){let C,k=af(T.cx,T.cy,A,w,T.minX,T.minY,T.maxX,T.maxY),N=1/0,O={x:T.maxX,y:w};for(let T of k)C=Et(A,w,T.x,T.y),C<N&&(N=C,O=T);return O}(ge,ce,Z);se=Et(Z.cx,Z.cy,A.x,A.y);let w=function QO(A,w,T,C,k){return{x:A+k*(T-A),y:w+k*(C-w)}}(Z.cx,Z.cy,A.x,A.y,(se+_e)/se);me=w.x-ge,pe=w.y-ce}}else{let A=Dd.from(H,(A=>A[0]),(A=>A[1])),w=ji(A.triangles,H),T=H.length>3?ji(A.hull,H):function iP(A){let w=A.bottomLeft(),T=A.topRight();return[[w.x,w.y],[w.x,T.y],[T.x,T.y],[T.x,w.y]]}(Z),C=zl(G.getPosition(),10,_e,w,T),k=eP([ge,ce],T,_e);if(C.length>0){let A=Math.pow(ge-k[0],2)+Math.pow(ce-k[1],2);for(let w of C)me=ge-w[0],pe=ce-w[1],se=me*me+pe*pe,se<A&&(A=se,k=w.slice(0,2));me=k[0]-ge,pe=k[1]-ce}else me=k[0]-$.cx,pe=k[1]-$.cy}let be={layoutName:"incremental",ids:O.getId(),positions:{before:W,current:W}};if(me||pe){let T=W.map((A=>(A.x+=me,A.y+=pe,A)));if(w.locate){"boolean"==typeof w.locate&&(w.locate={});let k=A.modules.locate.layoutDataBoundingBox({x:H.map((A=>A[0])).concat(T.map((A=>A.x))),y:H.map((A=>A[1])).concat(T.map((A=>A.y))),indexes:A.getNodes()._indexes}),N=A.modules.locate.computeConfigForBounds(k,w.locate);A.modules.camera.setView(N,{duration:C,easing:w.locate.easing,ignoreZoomLimits:!0})}return be.positions.current=T,O.setAttributes(T,C).then((()=>be))}return O.setAttributes(W,C).then((()=>be))}function Tg(A,w,T){let C=Yl(w.modules.graph,A);if("boolean"!=typeof C.incremental&&"margin"in C.incremental&&!isFinite(C.incremental.margin))throw new Error("Incremental layout: margin has to be a positive number");let k=nt(C);return"boolean"!=typeof C.incremental&&(k.margin=C.incremental.margin,k.referenceNodes=C.incremental.referenceNodes),k.centralNode&&!k.centralNode.getAttribute("layoutable")?function sP(A,w,T){let{nodes:C,duration:k,centralNode:N}=w,O=C,j=O.reduce(((A,w)=>(A[w._index]=!0,A)),{}),G=A.getNodes();if(w.focusOnGroupShape)return T({nodes:O,duration:0}).then((()=>{let w=O.concat(N),C=w.getAttribute("layoutable");return w.setAttributes({layoutable:!1}),T({nodes:A.getNodes(),duration:k}).then((()=>w.setAttributes(C)))}));{let A=nt(w);return delete A.centralNode,A.incremental=!1,A.nodes=G,A.nodeMass=(A,w)=>(w+1)*(j[A._index]?1:2),T(A)}}(w,k,T):function oP(A,w,T){let C=nt(w);return C.duration=0,C.dryRun=!0,C.locate=!1,delete C.incremental,T(C).then((T=>jv(A,w,T.positions.current)))}(w,k,T)}var Kg={name:"forceLink",configure:function(A,{graph:w,camera:T,graphics:C}){let k,N=A.nodes._indexes,O=A.edges._indexes,j={},G={},H=N.length,W=O.length;var $=w.getObjectList(!0),Z=w.getObjectList(!1);(A.nodes||A.edges)&&(delete(A=nt(A)).nodes,delete A.edges);let se=w.getNodeAttribute("innerStroke.width").getMultiple(N),ue=w.getNodeAttribute("outerStroke.width").getMultiple(N),ge=w.degrees(N),ce=w.getNodeAttribute("x").getMultiple(N),_e=w.getNodeAttribute("y").getMultiple(N),me=w.getNodeAttribute("radius").getMultiple(N),pe=w.nodeList(N).getAttribute("layoutable"),be="function"==typeof A.nodeMass?A.nodeMass:function(A,w,T){return w+1};delete A.nodeMass;let Se="function"==typeof A.edgeWeight?A.edgeWeight:function(A){return 1};delete A.edgeWeight,isFinite(A.scalingRatio)||delete A.scalingRatio;let Ee=N.reduce(((A,w,T)=>(pe[T]||(A[w]=!0),A)),{}),Te=0,Ce=0,Ie=0,ze=T.getZoom();for(k=0;k<N.length;++k){let A=N[k],w=ce[k],T=_e[k],C=me[k]+(se[k]+ue[k])/ze;j[A]={id:A,x:w,y:T,degree:ge[k],size:C,pinned:!!Ee[A],mass:be($.get(A),ge[k],k)},Ie=Math.max(C,Ie)}if(H>1)for(k=0;k<H;k++){let A=j[N[k]];Te+=A.x,Ce+=A.y}Te/=H,Ce/=H;let Pe={x:Te,y:Ce},Re=w.edgeList(O),Ue=Re.getSource()._indexes,Ve=Re.getTarget()._indexes;for(k=0;k<W;k++){let A=O[k],w=Ue[k],T=Ve[k];j[w]&&j[T]&&(G[A]={source:w,target:T},G[A].weight=Se(Z.get(A)))}return{nodes:j,edges:G,maxSize:Ie,config:Ji(A),barycentre:Pe}},context:function(){return{chunkPeriod:250}},update:function(A,w){let T;!w.W&&A?(T={ppn:10,ppe:3,ppr:9,MAX_SUBDIVISION_RETRIES:3,maxForce:10,iterations:0,converged:!1,settings:{linLogMode:!1,outboundAttractionDistribution:!1,adjustSizes:!1,edgeWeightInfluence:0,scalingRatio:100,strongGravityMode:!0,gravity:1,slowDown:1,barnesHutOptimize:!1,barnesHutTheta:.5,startingIterations:10,iterationsPerRender:10,maxIterations:1e3,avgDistanceThreshold:.01,autoStop:!0,alignNodeSiblings:!0,nodeSiblingsScale:5,nodeSiblingsAngleMin:0}},w.W=T,function Ae(A,C){let k=function ie(A,w){let C,k,N,O,j=A.nodes,G=A.edges,H=A.maxSize,W=Object.keys(A.nodes),$=Object.keys(A.edges),Z=W.length*T.ppn,se=$.length*T.ppe,ue={},ge=Math.pow(10,Math.log(Math.max(H,1))-6),ce=ge/2,_e=Math.random,me=w.randomizeFactor||1;O="locally"===w.randomize?A=>A+_e()*me:"globally"===w.randomize?A=>_e()*me:A=>A+_e()*ge-ce;let pe=new Float32Array(Z),be=new Float32Array(se);for(C=k=0,N=W.length;C<N;C++){let A=W[C],w=j[A],N=w.x,G=w.y;w.pinned||(N=O(N),G=O(G)),ue[A]=k,pe[k]=N,pe[k+1]=G,pe[k+2]=0,pe[k+3]=0,pe[k+4]=0,pe[k+5]=0,pe[k+6]=w.mass,pe[k+7]=1,pe[k+8]=w.size,pe[k+9]=w.pinned||0,k+=T.ppn}for(C=k=0,N=$.length;C<N;C++){let A=G[$[C]];be[k]=ue[A.source],be[k+1]=ue[A.target],be[k+2]=A.weight||0,k+=T.ppe}return{nodes:pe,edges:be}}(A,C);w.NodeMatrix=k.nodes,w.EdgeMatrix=k.edges,T.nodesLength=w.NodeMatrix.length,T.edgesLength=w.EdgeMatrix.length}(A,A.config),T.settings=function s(A,w){for(let T in A)w[T]=A[T];return w}(A.config,T.settings),w.nodes=A.nodes,w.edges=A.edges,w.barycentre=A.barycentre):T=w.W;let C,k=w.NodeMatrix,N=w.EdgeMatrix;function Ne(){let A,w,O,j,G,H,W,$,Z,se,ue,ge,ce,_e,me,pe,be;for(O=0;O<T.nodesLength;O+=T.ppn)k[O+4]=k[O+2],k[O+5]=k[O+3],k[O+2]=0,k[O+3]=0;if(T.settings.outboundAttractionDistribution){for(Z=0,O=0;O<T.nodesLength;O+=T.ppn)Z+=k[O+6];Z/=T.nodesLength}if(T.settings.barnesHutOptimize){let N,j,G,H,Z=1/0,se=-1/0,ue=1/0,ge=-1/0;for(C=[],O=0;O<T.nodesLength;O+=T.ppn)Z=Math.min(Z,k[O+0]),se=Math.max(se,k[O+0]),ue=Math.min(ue,k[O+1]),ge=Math.max(ge,k[O+1]);let ce=se-Z,_e=ge-ue;ce>_e?(ue-=(ce-_e)/2,ge=ue+ce):(Z-=(_e-ce)/2,se=Z+_e),C[0]=-1,C[1]=(Z+se)/2,C[2]=(ue+ge)/2,C[3]=Math.max(se-Z,ge-ue),C[4]=-1,C[5]=-1,C[6]=0,C[7]=0,C[8]=0,A=1;for(O=0;O<T.nodesLength;O+=T.ppn)for(w=0,G=T.MAX_SUBDIVISION_RETRIES;;){if(C[w+5]>=0){N=k[O+0]<C[w+1]?k[O+1]<C[w+2]?C[w+5]:C[w+5]+T.ppr:k[O+1]<C[w+2]?C[w+5]+2*T.ppr:C[w+5]+3*T.ppr,C[w+7]=(C[w+7]*C[w+6]+k[O+0]*k[O+6])/(C[w+6]+k[O+6]),C[w+8]=(C[w+8]*C[w+6]+k[O+1]*k[O+6])/(C[w+6]+k[O+6]),C[w+6]+=k[O+6],w=N;continue}if(C[w+0]<0){C[w+0]=O;break}if(C[w+5]=A*T.ppr,W=C[w+3]/2,$=C[w+5],C[$+0]=-1,C[$+1]=C[w+1]-W,C[$+2]=C[w+2]-W,C[$+3]=W,C[$+4]=$+T.ppr,C[$+5]=-1,C[$+6]=0,C[$+7]=0,C[$+8]=0,$+=T.ppr,C[$+0]=-1,C[$+1]=C[w+1]-W,C[$+2]=C[w+2]+W,C[$+3]=W,C[$+4]=$+T.ppr,C[$+5]=-1,C[$+6]=0,C[$+7]=0,C[$+8]=0,$+=T.ppr,C[$+0]=-1,C[$+1]=C[w+1]+W,C[$+2]=C[w+2]-W,C[$+3]=W,C[$+4]=$+T.ppr,C[$+5]=-1,C[$+6]=0,C[$+7]=0,C[$+8]=0,$+=T.ppr,C[$+0]=-1,C[$+1]=C[w+1]+W,C[$+2]=C[w+2]+W,C[$+3]=W,C[$+4]=C[w+4],C[$+5]=-1,C[$+6]=0,C[$+7]=0,C[$+8]=0,A+=4,H=w+0,N=k[C[H]+0]<C[w+1]?k[C[H]+1]<C[w+2]?C[w+5]:C[w+5]+T.ppr:k[C[H]+1]<C[w+2]?C[w+5]+2*T.ppr:C[w+5]+3*T.ppr,C[w+6]=k[C[H]+6],C[w+7]=k[C[H]+0],C[w+8]=k[C[H]+1],C[N+0]=C[w+0],C[w+0]=-1,j=k[O+0]<C[w+1]?k[O+1]<C[w+2]?C[w+5]:C[w+5]+T.ppr:k[O+1]<C[w+2]?C[w+5]+2*T.ppr:C[w+5]+3*T.ppr,N===j){if(G--){w=N;continue}G=T.MAX_SUBDIVISION_RETRIES;break}C[j+0]=O;break}}if(T.settings.barnesHutOptimize)for(se=T.settings.scalingRatio,O=0;O<T.nodesLength;O+=T.ppn)for(w=0;;){if(C[w+5]>=0){if(pe=Math.sqrt((k[O+0]-C[w+7])*(k[O+0]-C[w+7])+(k[O+1]-C[w+8])*(k[O+1]-C[w+8])),2*C[w+3]/pe<T.settings.barnesHutTheta){if(ue=k[O+0]-C[w+7],ge=k[O+1]-C[w+8],T.settings.adjustSizes?pe>0?(be=se*k[O+6]*C[w+6]/pe/pe,k[O+2]+=ue*be,k[O+3]+=ge*be):pe<0&&(be=-se*k[O+6]*C[w+6]/pe,k[O+2]+=ue*be,k[O+3]+=ge*be):pe>0&&(be=se*k[O+6]*C[w+6]/pe/pe,k[O+2]+=ue*be,k[O+3]+=ge*be),C[w+4]<0)break;w=C[w+4];continue}w=C[w+5];continue}if(C[w+0]>=0&&C[w+0]!==O&&(ue=k[O+0]-k[C[w+0]+0],ge=k[O+1]-k[C[w+0]+1],pe=Math.sqrt(ue*ue+ge*ge),T.settings.adjustSizes?pe>0?(be=se*k[O+6]*k[C[w+0]+6]/pe/pe,k[O+2]+=ue*be,k[O+3]+=ge*be):pe<0&&(be=-se*k[O+6]*k[C[w+0]+6]/pe,k[O+2]+=ue*be,k[O+3]+=ge*be):pe>0&&(be=se*k[O+6]*k[C[w+0]+6]/pe/pe,k[O+2]+=ue*be,k[O+3]+=ge*be)),C[w+4]<0)break;w=C[w+4];continue}else for(se=T.settings.scalingRatio,j=0;j<T.nodesLength;j+=T.ppn)for(G=0;G<j;G+=T.ppn)ue=k[j+0]-k[G+0],ge=k[j+1]-k[G+1],T.settings.adjustSizes?(pe=Math.sqrt(ue*ue+ge*ge)-k[j+8]-k[G+8],pe>0?(be=se*k[j+6]*k[G+6]/pe/pe,k[j+2]+=ue*be,k[j+3]+=ge*be,k[G+2]+=ue*be,k[G+3]+=ge*be):pe<0&&(be=100*se*k[j+6]*k[G+6],k[j+2]+=ue*be,k[j+3]+=ge*be,k[G+2]-=ue*be,k[G+3]-=ge*be)):(pe=Math.sqrt(ue*ue+ge*ge),pe>0&&(be=se*k[j+6]*k[G+6]/pe/pe,k[j+2]+=ue*be,k[j+3]+=ge*be,k[G+2]-=ue*be,k[G+3]-=ge*be));for($=T.settings.gravity/T.settings.scalingRatio,se=T.settings.scalingRatio,O=0;O<T.nodesLength;O+=T.ppn)be=0,ue=k[O+0],ge=k[O+1],pe=Math.sqrt(ue*ue+ge*ge),T.settings.strongGravityMode?pe>0&&(be=se*k[O+6]*$):pe>0&&(be=se*k[O+6]*$/pe),k[O+2]-=ue*be,k[O+3]-=ge*be;for(se=1*(T.settings.outboundAttractionDistribution?Z:1),H=0;H<T.edgesLength;H+=T.ppe)j=N[H+0],G=N[H+1],W=N[H+2],me=Math.pow(W,T.settings.edgeWeightInfluence),ue=k[j+0]-k[G+0],ge=k[j+1]-k[G+1],T.settings.adjustSizes?(pe=Math.sqrt(ue*ue+ge*ge)-k[j+8]-k[G+8],T.settings.linLogMode?T.settings.outboundAttractionDistribution?pe>0&&(be=-se*me*Math.log(1+pe)/pe/k[j+6]):pe>0&&(be=-se*me*Math.log(1+pe)/pe):T.settings.outboundAttractionDistribution?pe>0&&(be=-se*me/k[j+6]):pe>0&&(be=-se*me)):(pe=Math.sqrt(ue*ue+ge*ge),T.settings.linLogMode?T.settings.outboundAttractionDistribution?pe>0&&(be=-se*me*Math.log(1+pe)/pe/k[j+6]):pe>0&&(be=-se*me*Math.log(1+pe)/pe):T.settings.outboundAttractionDistribution?(pe=1,be=-se*me/k[j+6]):(pe=1,be=-se*me)),pe>0&&(k[j+2]+=ue*be,k[j+3]+=ge*be,k[G+2]-=ue*be,k[G+3]-=ge*be);let Se,Ee,Te,Ce,Ie=0;if(T.settings.adjustSizes)for(O=0;O<T.nodesLength;O+=T.ppn)k[O+9]||(Se=Math.sqrt(k[O+2]*k[O+2]+k[O+3]*k[O+3]),Se>T.maxForce&&(k[O+2]=k[O+2]*T.maxForce/Se,k[O+3]=k[O+3]*T.maxForce/Se),Ee=k[O+6]*Math.sqrt((k[O+4]-k[O+2])*(k[O+4]-k[O+2])+(k[O+5]-k[O+3])*(k[O+5]-k[O+3])),Te=Math.sqrt((k[O+4]+k[O+2])*(k[O+4]+k[O+2])+(k[O+5]+k[O+3])*(k[O+5]+k[O+3]))/2,Ce=.1*Math.log(1+Te)/(1+Math.sqrt(Ee)),ce=k[O+0],_e=k[O+1],k[O+0]=k[O+0]+k[O+2]*(Ce/T.settings.slowDown),k[O+1]=k[O+1]+k[O+3]*(Ce/T.settings.slowDown),ue=k[O+0],ge=k[O+1],pe=Math.sqrt((ue-ce)*(ue-ce)+(ge-_e)*(ge-_e)),Ie+=pe);else for(O=0;O<T.nodesLength;O+=T.ppn)k[O+9]||(Ee=k[O+6]*Math.sqrt((k[O+4]-k[O+2])*(k[O+4]-k[O+2])+(k[O+5]-k[O+3])*(k[O+5]-k[O+3])),Te=Math.sqrt((k[O+4]+k[O+2])*(k[O+4]+k[O+2])+(k[O+5]+k[O+3])*(k[O+5]+k[O+3]))/2,Ce=k[O+7]*Math.log(1+Te)/(1+Math.sqrt(Ee)),k[O+7]=Math.min(1,Math.sqrt(Ce*(k[O+2]*k[O+2]+k[O+3]*k[O+3])/(1+Math.sqrt(Ee)))),ce=k[O+0],_e=k[O+1],k[O+0]=k[O+0]+k[O+2]*(Ce/T.settings.slowDown),k[O+1]=k[O+1]+k[O+3]*(Ce/T.settings.slowDown),ue=k[O+0],ge=k[O+1],pe=Math.sqrt((ue-ce)*(ue-ce)+(ge-_e)*(ge-_e)),Ie+=pe);if(T.iterations++,T.settings.autoStop&&(T.converged=T.iterations>T.settings.maxIterations||Ie/T.nodesLength<T.settings.avgDistanceThreshold,T.converged&&T.settings.alignNodeSiblings)){let A,w,C={},O={};for(H=0;H<T.edgesLength;H+=T.ppe)j=N[H+0],G=N[H+1],j!==G&&(C[j]=C[j]||{},C[G]=C[G]||{},C[j][G]=!0,C[G][j]=!0);Object.keys(C).forEach((T=>{var k=~~T;w=Object.keys(C[k]),2==w.length&&(A=w[0]+";"+w[1],A in O||(A=w[1]+";"+w[0],O[A]||(O[A]=[~~w[1],~~w[0]])),O[A].push(k))}));let W,$,Z,se,ue,ge,ce,_e,me,pe,be,Se,Ee,Te,Ce,Ie=T.settings.nodeSiblingsAngleMin;Object.keys(O).forEach((A=>{if($=O[A].shift(),Z=O[A].shift(),W=O[A].filter((A=>!k[A+9])),1==W.length)return;if(ge=k[$+0],ce=k[$+1],_e=k[Z+0],me=k[Z+1],se=Object.keys(C[$]).length,ue=Object.keys(C[Z]).length,pe=function u(A,w,T,C,k){return(k-C)*(A-w)/(T-w)+C}(se/(se+ue),0,1,1/4,3/4),Se=function g(A,w,T,C,k){return{x:A+(T-A)*k,y:w+(C-w)*k}}(ge,ce,_e,me,pe),Ee=function h(A,w,T,C){return{xi:-(C-w),yi:T-A,xiPrime:C-w,yiPrime:-(T-A)}}(ge,ce,_e,me),be=function a(A,w,T,C){let k=T-A,N=C-w;return Math.sqrt(k*k+N*N)}(ge,ce,_e,me),Te=function m(A,w){return{x:(A.xiPrime-A.xi)/w,y:(A.yiPrime-A.yi)/w}}(Ee,be),Ce=function c(A){return Math.acos(A.x/Math.sqrt(A.x*A.x+A.y*A.y))}(Te),2*Ie>Math.PI)throw new Error("ForceLink.Worker - Invalid parameter: angleMin must be smaller than 2 PI.");Ie>0&&(Ce<Ie||Ce>Math.PI-Ie&&Ce<=Math.PI?Te={x:2*Math.cos(Math.PI-Ie),y:2*Math.sin(Math.PI-Ie)}:(Ce>2*Math.PI-Ie||Ce>=Math.PI&&Ce<Math.PI+Ie)&&(Te={x:2*Math.cos(Ie),y:2*Math.sin(Ie)}));let w=0,N=1,j=1;W.length%2==1&&(j=0,w=1);for(let A=0;A<W.length;A++)k[W[A]+0]=Se.x+N*Te.x*j*(w||A>=2?T.settings.nodeSiblingsScale:2*T.settings.nodeSiblingsScale/3),k[W[A]+1]=Se.y+N*Te.y*j*(w||A>=2?T.settings.nodeSiblingsScale:2*T.settings.nodeSiblingsScale/3),N=-N,j+=(A+w)%2}))}}function Fe(A){let w=Object.keys(A),C={};for(let A=0;A<k.length;A+=T.ppn){let N=w[A/T.ppn];C[N]={id:N,x:k[A+0],y:k[A+1],pinned:k[A+9]}}return C}return function Xe(){if(T.settings.autoStop){let A=Date.now();for(;!(T.converged||Date.now()-A>=w.chunkPeriod);)Ne()}else{let A=0===T.iterations?T.settings.startingIterations:T.iterations+T.settings.iterationsPerRender;for(;T.iterations!==A;)Ne()}return{nodes:Fe(w.nodes),barycentre:w.barycentre}}()},isRunning:function(A){return!A.W.settings.autoStop||!A.W.converged||(A.W=void 0,!1)},stop:function(A){A.W&&(A.W.converged=!0)},onSync:function({nodes:A,barycentre:w},{graph:T}){let C,k,N,O,j,G,H,W,$=Object.keys(A),Z=$.length,se=0,ue=0,ge=new Array(Z),ce=new Array(Z),_e=new Array(Z),me=new Array(Z),[pe,be]=T.getAttributes(!0,["x","y"]);for(C=0;C<Z;C++)k=$[C],N=A[k],W=parseInt(k),ge[C]=W,me[C]=N.pinned,N.pinned?(O=pe.get(W),j=be.get(W)):(O=N.x,j=N.y),ce[C]=O,_e[C]=j,se+=O,ue+=j;for(G=se/Z-w.x,H=ue/Z-w.y,C=0;C<Z;C++)me[C]||(ce[C]-=G,_e[C]-=H);return{indexes:ge,x:ce,y:_e}}};var ec=Object.defineProperty,tc=Object.defineProperties,sc=Object.getOwnPropertyDescriptors,ac=Object.getOwnPropertySymbols,lc=Object.prototype.hasOwnProperty,hc=Object.prototype.propertyIsEnumerable,Jv=(A,w,T)=>w in A?ec(A,w,{enumerable:!0,configurable:!0,writable:!0,value:T}):A[w]=T,Nb=(A,w)=>{for(var T in w||(w={}))lc.call(w,T)&&Jv(A,T,w[T]);if(ac)for(var T of ac(w))hc.call(w,T)&&Jv(A,T,w[T]);return A},rN=(A,w)=>tc(A,sc(w)),uc={id:"__SENTINEL__",layer:-1,sink:!1,fixed:!1,parentIds:[],radius:0,ref:null},Sg=A=>A.data===uc,Tb=A=>A.data!==uc,gc=[],mP=(A,w)=>({id:A,layer:w,data:uc,children:gc,ref:null,x:0,y:0}),fc=class{constructor(A,w,T){this.data=A,this.prev=w,this.next=T}toString(){return this.data}},nN=A=>A.reduce(((A,w)=>(A[w]=!0,A)),{});function pP(A,w){let T=[A],C=nN(T),k=[A];for(;T.length;){let A=T.shift();for(let N of w[A])C[N]||(C[N]=!0,k.push(N),T.push(N))}return k}function Lb(A){return A.reduce(((A,{source:w,target:T})=>(A[w]=A[w]||[],A[T]=A[T]||[],A[w].push(T),A[T].push(w),A)),{})}function bP(A,w){let T=nN(w);return A.filter((A=>!(A in T)))}function Zr(A,w){A.forEach(((A,T)=>{A.forEach(((A,C,k)=>{w(A,C,k,T)}))}))}var eN=A=>{let w=Math.floor(A.length/2);return(A=[...A].sort(((A,w)=>A-w))).length%2!=0?A[w]:(A[w-1]+A[w])/2};function EP(A,w,T){let C=Lb(w),k=Object.keys(C),N=[];for(;k.length;){let A=pP(k[0],C);N.push(A),k=bP(k,A)}return T.skipSingletons?N:N.concat(function _P(A,w,T){let C=T||Lb(w||[]);return A.filter((({id:A})=>!(A in C)))}(A,w,C).map((({id:A})=>[A])))}var pc={down:()=>{},up:A=>A.y=-A.y,left:A=>{let w=A.x;A.x=-A.y,A.y=w},right:A=>{let w=A.x;A.x=A.y,A.y=-w}},Db=(A,w)=>isFinite(A)&&A>0?A:w;function AP(A,{componentsSeparation:w,layerSeparation:T,packing:C}){let k=T/2,N=[];for(let T of A){let A=T.nodes;if(T.isFake&&void 0!==T.w&&void 0!==T.h){N.push({w:T.w,h:T.h,x:void 0,y:void 0,dag:T});continue}if(1===T.nodes.length){let C=2*A[0].data.radius;N.push({w:C+w,h:C+k,x:void 0,y:void 0,dag:T});continue}let C=A.reduce(((A,{x:w,data:T})=>Math.min(A,w-T.radius||1)),1/0),O=A.reduce(((A,{x:w,data:T})=>Math.max(A,w+T.radius||1)),-1/0),j=A.reduce(((A,{y:w,data:T})=>Math.min(A,w-T.radius||1)),1/0),G=A.reduce(((A,{y:w,data:T})=>Math.max(A,w+T.radius||1)),-1/0),H=(O+C)/2;A.forEach((A=>{A.x-=H})),N.push({w:Math.abs(O-C)+w,h:Math.abs(G-j)+k,minX:C,x:void 0,y:void 0,dag:T})}if("singleline"!==C)!function xb(A){let w=0,T=0;for(let C of A)w+=C.w*C.h,T=Math.max(T,C.w);A.sort(((A,w)=>w.h-A.h));let C=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(w/.95)),T),h:1/0}],k=0,N=0;for(let w of A)for(let A=C.length-1;A>=0;A--){let T=C[A];if(!(w.w>T.w||w.h>T.h)){if(w.x=T.x,w.y=T.y,N=Math.max(N,w.y+w.h),k=Math.max(k,w.x+w.w),w.w===T.w&&w.h===T.h){let w=C.pop();A<C.length&&(C[A]=w)}else w.h===T.h?(T.x+=w.w,T.w-=w.w):w.w===T.w?(T.y+=w.h,T.h-=w.h):(C.push({x:T.x+w.w,y:T.y,w:T.w-w.w,h:w.h}),T.y+=w.h,T.h-=w.h);break}}return{w:k,h:N,fill:w/(k*N)||0}}(N);else{let A=0;for(let w of N)w.x=A,w.y=0,A+=w.w}return N}function vP(A,w={}){let{componentsSeparation:T,layerSeparation:C}=function DP(A){return{nodesSeparation:Db(A.nodesSeparation,0),componentsSeparation:Db(A.componentsSeparation,25),layerSeparation:Db(A.layerSeparation,50)}}(w);void 0===w.direction&&(w.direction="down");let k=AP(A,{layerSeparation:C,componentsSeparation:T,packing:w.packing});for(let A of k){let{x:T=0,y:C=0,w:k,dag:N}=A;for(let A of N.nodes)A.x+=T+k/2,A.y+=C,pc[w.direction](A)}}function SP(A,w,T){let C=Lb(w||[]),k=A.filter((({id:A})=>!(A in C))).sort(((A,w)=>w.radius-A.radius)),N=Math.sqrt(k.length),O=Math.floor(N),j=Math.ceil(N);O*j<k.length&&(O<j?O++:j++);let G=Math.max(1,(A=>A.reduce(((A,{radius:w})=>Math.max(A,2*w)),0))(k)),H=Math.max(T.nodesGridSeparation||0,1),W=G*j+H*(j-1),$=G*O+H*Math.max(O-1,0),Z=function TP(A,w){return Nb({nodes:A.map((A=>rN(Nb({},A),{data:A}))),isFake:!0},w)}(k,{w:W,h:$});return Z.nodes.forEach(((A,w)=>{let T=w%j,C=Math.floor(w/j);A.x=W*T/j,A.y=$*C/O})),Z}function LP(A){if(!A||!A.length)throw Error("Cannot stratify empty data");for(let w of A){if(!w)throw Error('Node data is "null"');if(null==w.id)throw Error('Node id contains a "null" value')}let w=A.map((A=>((A,w)=>({id:A,layer:-1,data:w,children:[],x:0,y:0}))(A.id,A))),T=w.reduce(((A,w)=>{if(A[w.id])throw Error(`The connected component contains id duplicates: ${w.id}`);return A[w.id]=w,A}),{}),C=[];for(let A of w){for(let w of A.data.parentIds){let C=T[w];if(!C)throw Error(`The node ${A.id} has a missing parent id ${w}`);C.children.push(A)}A.data.parentIds.length||C.push(A)}return{isFake:!1,nodes:IP(C)}}function IP(A){let w={},T=[];for(;A.length;){let C=A.pop();w[C.id]||(T.push(C),w[C.id]=!0,A.push(...C.children))}return T}function Sb(A,w,T){let C={};return w.forEach(((A,w)=>C[A.id]=w)),A.map((A=>(T[A.id]||[]).map((A=>C[A])).sort())).reduce(((A,w,T,C)=>{let k=w.length?w[w.length-1]:-1;for(let w=T+1;w<C.length;w++)A+=C[w].filter((A=>A<k)).length;return A}),0)}function OP(A,w,T){let C={},k={};T[-1]=-1,A.forEach((({id:A})=>{C[A]=[],(w[A]||[-1]).forEach((w=>C[A].push(T[w])))})),A.forEach((A=>k[A.id]=function CP(A){if(A.sort(((A,w)=>A-w)),0===A.length)return 0;let w=Math.floor(A.length/2);return A.length%2?A[w]:(A[w-1]+A[w])/2}(C[A.id])||0)),A.sort(((A,w)=>{let C=k[A.id]-k[w.id];return 0===C?T[w.id]-T[A.id]:C}))}function tN({layers:A,topDown:w,topDownAdj:T,bottomUpAdj:C,idToIndex:k,crossings:N}){let O=w?T:C;for(let C=w?0:A.length-1;w?C<A.length:C>=0;w?C++:C--){OP(A[C],O[C]||{},k);let w=C>0?Sb(A[C-1],A[C],T[C-1]):0,j=C<A.length-1?Sb(A[C],A[C+1],T[C]):0;j+w<(N[C]||0)+(N[C-1]||0)?(N[C]=j,C>0&&(N[C-1]=w),A[C].forEach(((A,w)=>k[A.id]=w))):A[C].sort(((A,w)=>k[A.id]-k[w.id]))}}function zP(A){if(A.nodes.some((A=>"layer"in A.data&&A.data.layer<0)))throw new Error("Some nodes have negative layering information");return A.nodes.some((A=>A.data&&!isNaN(A.data.layer)&&null!==A.data.layer))||function RP(A){let w={},T={},C={};A.nodes.forEach((A=>{C[A.id]=A}));let i=A=>{if(w[A.id])return T[A.id];w[A.id]=!0;let k=1/0;for(let w of A.children)k=Math.min(k,i(C[w.id])-1);return k===1/0&&(k=0),T[A.id]=k,k};A.nodes.forEach((A=>{0===A.data.parentIds.length&&i(A)}));let k=1/0;A.nodes.forEach((A=>{k=Math.min(k,T[A.id])})),A.nodes.forEach((A=>{T[A.id]-=k,A.layer=T[A.id]}))}(A),function FP(A){A.nodes.forEach((A=>{A.layer=null!=A.data.layer?A.data.layer:A.layer}))}(A),function kP(A){let w={};A.nodes.forEach((A=>{w[A.id]=[...w[A.id]||[],...A.children],A.children.forEach((T=>{w[T.id]=[...w[T.id]||[],A]}))}));let T=[];A.nodes.forEach((A=>{0===A.layer&&T.push(A)}));let C={},k={};for(A.nodes.forEach((A=>{-1!==A.layer&&(k[A.id]=A.layer)}));T.length;){let A=T.shift().id;for(let N of w[A])if(!C[N.id]){if(void 0===k[N.id]){let w=k[A]+1;k[N.id]=w,N.layer=w}C[N.id]=!0,T.push(N)}}}(A),function BP(A){if(A.nodes.some((A=>A.data.sink))){let w=A.nodes.reduce(((A,w)=>Math.max(A,w.layer)),-1/0);A.nodes.forEach((A=>{A.data.sink&&(A.layer=w+1)}))}}(A),function MP(A){if(A.nodes.every((A=>A.layer))){let w=A.nodes.reduce(((A,w)=>Math.min(A,w.layer)),1/0);A.nodes.forEach((A=>A.layer-=w))}}(A),function GP(A){let w=[];A.nodes.forEach((A=>w[A.layer]=0));let T=Array.from(w).reduce(((A,w,T)=>{if(0===T)return A.push(0),A;let C=A[T-1];return void 0!==w?(A.push(C),A):(A.push(C-1),A)}),[]);A.nodes.forEach((A=>A.layer+=T[A.layer]))}(A),function wP(A){let w=A.nodes.reduce(((A,w)=>w.data.fixed&&(null===A||A.layer>w.layer)?w:A),null);return w&&A.nodes.forEach((A=>A.ref=w.id)),A}(A)}var xc=class{constructor(A){this.data=A,this.length=0}append(A){return this.length++,this.head?this.tail=this.tail.next=new fc(A,this.tail):this.tail=this.head=new fc(A)}prepend(A){return this.length++,this.tail?this.head=this.head.prev=new fc(A,null,this.head):this.tail=this.head=new fc(A)}popBack(){this.length--;let A=this.tail;return(this.tail=this.tail.prev).next=null,A}popFront(){this.length--;let A=this.head;return(this.head=this.head.next).prev=null,A}popElement(A){let w=this.find(A);return w&&(this.length--,w.prev.next=w.next),w}find(A){let w=this.head;do{if(w.data===A)return w;w=w.next}while(w)}forEach(A){let w=this.head,T=0;do{A(w,T),T++}while(w=w.next)}toString(){for(var A=[this.head],w=this.head;w=w.next;)A.push(w);return A.map((A=>A.toString())).join(", ")}toArray(){let A=[],w=this.head;do{A.push(w)}while(w=w.next);return A}splitAtNode(A){let w=new xc(this.data),T=this.tail;for(w.prepend(this.popBack().data);T!==A;)T=this.popBack(),w.prepend(T.data);return w}},yc=-1,Ec=1e-5,Nc=[],HP=(A,w=20,T=50)=>new class{constructor(A,w,T){this.edges=[],this.nodeMap={},this.nodeIndexTopDown={},this.nodeToLayer={},this.longEdges={},this.virt={},this.height={},this.breadth={},this.first=[],this.totalW={},this.mDist={},this.X={},this.block={},this.nodeList=new class{constructor(){this.byId={},this.byIndex={},this.length=0}append(A,w){let T;return this.head?(T=new fc(A,this.tail),this.tail=this.tail.next=T):(T=new fc(A),this.tail=this.head=T),this.byId[w]=T,this.byIndex[this.length++]=T,T}find(A){let w=this.head;do{if(w.data===A)return w;w=w.next}while(w)}forEach(A){let w=this.head,T=0;do{A(w,T),T++}while(w=w.next)}},this.nodeDistance=w,this.layerDistance=T,this.layers=A;let{breadth:C,virt:k,height:N,nodeToLayer:O,nodeIndexTopDown:j,nodeMap:G,longEdges:H,edges:W}=this,$=0;Zr(this.layers,((A,w,T,C)=>{if(j[A.id]=$++,G[A.id]=A,O[A.id]=C,this.nodeList.append(A,A.id),A.children.forEach((w=>{let T=Sg(w)||Sg(A);W.push({source:A.id,target:w.id,virtual:T,id:W.length})})),H[A.id])return;let k=new xc({source:A.id,target:A.id});if(k.append(A),H[A.id]=k,!Tb(A))for(let w=0;w<A.children.length;w++){let T=A.children[w];if(Tb(T))continue;let C=T;for(;Sg(C);)k.append(C),H[C.id]=k,C=C.children[0];k.data.target=C.id}}));let Z=this.adjacencyList=function fP(A){return A.reduce(((A,{source:w,target:T})=>(A[w]=A[w]||[],A[w].push(T),A)),{})}(W);this.N=A.reduce(((A,w)=>A+w.length),0),this.Y=new Float32Array(A.length),this.first=A.map((A=>A[0])),A.forEach(((A,w)=>N[w]=0)),Zr(this.layers,((A,w,T,O)=>{let j=Z[A.id]?Z[A.id].length:0;k[A.id]=Sg(A)&&1===j,this.nodeToLayer[A.id]=O,k[A.id]?C[A.id]=0:(C[A.id]=2*A.data.radius,N[O]=Math.max(N[O]||0,2*A.data.radius))}));let se={},ue={};W.forEach((A=>{let w=A.source,T=A.target;se[T]=se[T]||[],se[T].push(w),ue[w]=ue[w]||[],ue[w].push(T)})),Object.values(se).forEach((A=>{A.sort(((A,w)=>this.nodeIndexTopDown[A]-this.nodeIndexTopDown[w]))})),Object.values(ue).forEach((A=>{A.sort(((A,w)=>this.nodeIndexTopDown[A]-this.nodeIndexTopDown[w]))})),this.neighbours={prev:se,next:ue}}computeMinNodeDistances(){let{layers:A,totalW:w}=this;Zr(A,(A=>{w[A.id]=0})),Zr(A,(A=>w[A.data.id]=0)),this.layers.forEach((A=>{w[A[0].id]=0,A.slice(1).forEach(((T,C)=>{let k=A[C].id,N=T.id;w[N]=w[k]+A[C].data.radius+T.data.radius+this.nodeDistance}))}))}decrossVirtualEdges(){this.layers.forEach((A=>{let w=-1;A.forEach((A=>{if(!this.virt[A.id])return;let T=this.neighbours.next[A.id][0];if(this.virt[T])if(-1!==w&&w>this.nodeIndexTopDown[T]){let w=this.longEdges[A.id],T=w.head.next,C=w.splitAtNode(T);C.forEach((A=>this.longEdges[A.data.id]=C))}else w=this.nodeIndexTopDown[T]}))}))}placeLongEdges(){let{X:A,layers:w}=this;Zr(w,(w=>A[w.id]=0));for(let T=1;T>=-1;T-=2){let C={},k=0,N={};Zr(w,(A=>N[A.id]=0)),N[uc.id]=0;let O=T;w.forEach((A=>{let w=1===O?A[0]:A[A.length-1];if(!N[w.id]){let A=this.longEdges[w.id];A&&(A.forEach((A=>{N[A.data.id]=k})),k++)}let T=1===O?0:A.length-1,C=T+O;for(;C>=0&&C<A.length;)w=A[C],N[w.id]||this.longEdges[w.id].forEach((w=>{N[w.data.id]=N[A[T].id]})),T=C,C+=O}));let j={};w.forEach((A=>{for(let w=1===O?0:A.length-1;1===O?w<A.length:w>=0;w+=O){let T=A[w],C=N[T.id];j[C]=j[C]||[],j[C].push(T.id)}}));let G={};this.nodeList.forEach((A=>G[A.data.id]=0));for(let A=0;A<k;A++){let w={done:!1,dist:0},k=j[A];for(let A of k)this.sortLongEdges(A,T,G,w,N,C);if(!w.done){let T=this.layers[this.nodeToLayer[j[A][0]]],C=[];T.forEach((A=>{for(let w of this.neighbours.prev[A.id]||Nc){let T=Math.abs(G[w]-G[A.id]);C.push(T)}})),0!==C.length&&(w.dist=eN(C))}for(let A of k)G[A]-=T*w.dist}Zr(w,(w=>A[w.id]+=G[w.id]/2))}}sortLongEdges(A,w,T,C,k,N){if(N[A])return!1;let O=!1,j=0,{nodeToLayer:G,totalW:H}=this,W=this.longEdges[A];W.forEach((A=>N[A.data.id]=!0)),W.forEach((A=>{let W=this.nodeList.byIndex[this.nodeIndexTopDown[A.data.id]-w];if(!W)return;let $=W.data.id,Z=A.data.id,se=G[$]===G[Z],ue=k[$]===k[Z];!se||!ue||(this.sortLongEdges($,w,T,C,k,N),(!O||w*(j-T[$])<w*(H[Z]-H[$]))&&(O=!0,j=T[$]+H[Z]-H[$]))})),W.forEach((A=>{T[A.data.id]=j;let N=this.nodeList.byId[A.data.id],O=1===w?N.next:N.prev;if(!O)return;let W=O.data.id,$=A.data.id,Z=G[W]===G[$],se=k[W]!==k[$],ue=w*(H[W]-H[$]-T[W]+T[$]);Z&&se&&(!C.done||ue>C.dist)&&(C.dist=ue,C.done=!0)}))}placeNonVirtualNodes(){let A={};Zr(this.layers,(w=>A[w.id]=-1));let{X:w,totalW:T,virt:C,nodeIndexTopDown:k,mDist:N,nodeList:O}=this,j={};Zr(this.layers,((A,k,N,O)=>{if(!C[A.id])return void(j[A.id]=!1);let G=this.nodeList.byId[A.id].next;for(;G&&this.nodeToLayer[G.data.id]===O&&!C[G.data.id];)G=G.next;j[A.id]=this.nodeToLayer[G.data.id]===O&&w[G.data.id]-w[A.id]<T[G.data.id]-T[A.id]+Ec})),Zr(this.layers,(({id:w})=>{j[w]&&-1===A[w]&&this.longEdges[w].forEach((({data:{id:T}})=>{T!==w&&(A[T]=k[T]<k[w]?1:0)}))})),Zr(this.layers,(({id:A})=>N[A]=T[A]));for(let T=0;T<2;T++)for(let G=T?this.layers.length-1:0;G>=0&&G<this.layers.length;T?G--:G++){let H=yc,W=this.layers[G];if(W.forEach((({id:G},W,$)=>{if(C[G]){if(H===yc){this.placeSequence(yc,G,$[0].id,O.byId[G].prev.data.id,T);for(let A=0;A<W;A++){let T=$[A].id;N[T]=N[G]-w[G]+w[T]}}else if(A[H]!==1-T){j[H]||this.placeSequence(H,G,O.byId[H].next.data.id,O.byId[G].prev.data.id,T);let w=1===T?this.neighbours.prev:this.neighbours.next,N=w[H][0],W=w[G][0];if(C[N]&&C[W])for(let w=k[N]+1;w<k[W];w++)A[O.byIndex[w].data.id]=T}H=G}})),H===yc)this.placeSequence(yc,yc,W[0].id,W[W.length-1].id,T),W.forEach((({id:A})=>N[A]=w[A]));else{this.placeSequence(H,yc,O.byId[H].next.data.id,W[W.length-1].id,T);for(let A=W.length-1;A>=0;A--){let T=W[A].id;if(T===H)break;N[T]=N[H]-w[H]+w[T]}}}}placeSequence(A,w,T,C,k,N=0){let O=this.nodeIndexTopDown[T],j=this.nodeIndexTopDown[C],{X:G,nodeIndexTopDown:H,mDist:W}=this;if(O===j)G[T]=this.placeNode(T,A,w,G[T],k);else if(O<j){let O=Math.floor((H[T]+H[C])/2),j=this.nodeList.byIndex[O],G=j.next.data.id,$=W[G]-W[j.data.id];this.placeSequence(A,w,T,j.data.id,k,N+1),this.placeSequence(A,w,G,C,k,N+1),this.combineSequences(A,w,T,C,G,j.data.id,k,$)}}calculateBends(A,w,T,C,k,N,O,j){let G=0,H=[],{X:W,mDist:$,neighbours:Z}=this,se=this.nodeIndexTopDown[T],ue=this.nodeIndexTopDown[C];for(let T=this.nodeList.byId[N],C=this.nodeIndexTopDown[T.data.id];C>=se&&C<=ue&&T;T=-1===A?T.prev:T.next,C=T&&this.nodeIndexTopDown[T.data.id]){let C=T.data.id,se=(0===w?Z.prev[C]:Z.next[C])||Nc,ue=0;for(let w of se)if(A*(W[w]-W[C])<Ec)ue++;else{ue--;let T=W[w]+$[N]-$[C];A*(W[N]-T)>-Ec?G++:(j===yc||A*(T-W[j]+$[j]-$[N])<Ec)&&A*(T-W[k])<O-Ec&&H.push({value:2,key:T})}let ge=W[C]+$[N]-$[C];A*(W[N]-ge)>-Ec?G+=ue:(j===yc||A*(ge-W[j]+$[j]-$[N])<Ec)&&A*(ge-W[k])<O-Ec&&H.push({value:ue,key:ge})}return j!==yc&&H.push({value:this.edges.length,key:W[j]-$[j]+$[N]}),H.sort((({key:A},{key:w})=>A-w)),{res:G,bends:H.reduce(((A,w,T)=>{if(T<H.length-1){let C=H[T+1];Math.abs(w.key-C.key)>Ec?w.value>0&&A.push(w):w.value+=C.value}else w.value>0&&A.push(w);return A}),[])}}combineSequences(A,w,T,C,k,N,O,j){let{X:G,mDist:H,nodeIndexTopDown:W}=this,{res:$,bends:Z}=this.calculateBends(-1,O,T,C,k,N,j,A),{res:se,bends:ue}=this.calculateBends(1,O,T,C,N,k,j,w);for(Z.length>0&&Z.reverse();G[k]-G[N]<j-Ec;){let A=0,w=0;if($<se){let w=Z.length;if(w>0){let w=Z.pop();A=w.value,G[N]=w.key}(0===w||G[k]-G[N]>j+Ec)&&(G[N]=G[k]-j)}else if($>se){let A=ue.length;if(A>0){let A=ue.pop();w=A.value,G[k]=A.key}(0===A||G[k]-G[N]>j+Ec)&&(G[k]=G[N]+j)}else{let T=(j-G[k]+G[N])/2,C=0===Z.length?T+1:G[N]-Z[Z.length-1].key,O=0===ue.length?T+1:ue[ue.length-1].key-G[k];C<T+Ec&&C<O+Ec&&(A=Z.pop().value),O<T+Ec&&O<C+Ec&&(w=ue.pop().value),T=Math.min(T,C,O),G[N]-=T,G[k]+=T}$+=A,se+=w}let ge,ce=this.nodeList.byId[N].prev;for(;ce&&W[ge=ce.data.id]>=W[T]&&G[N]-G[ge]<H[N]-H[ge];)G[ge]=G[N]-H[N]+H[ge],ce=ce.prev;for(ce=this.nodeList.byId[k].next;ce&&W[ge=ce.data.id]<=W[C]&&G[k]-G[ge]>H[k]-H[ge];)G[ge]=G[k]-H[k]+H[ge],ce=ce.next}placeNode(A,w,T,C,k){let{X:N,neighbours:O,mDist:j}=this,G=((0===k?O.prev:O.next)[A]||Nc).map((A=>N[A]));return 0===G.length?N[A]:(C=eN(G),w!==yc&&(C=Math.max(C,N[w]+j[A]-j[w])),T!==yc&&(C=Math.min(C,N[T]+j[A]-j[T])),C)}moveLongEdge(A,w,T){let{X:C,virt:k,totalW:N,nodeList:O}=this,{id:j}=A.data;if(T[j]||!k[j])return;let G=this.longEdges[j];if(!G)return;G.forEach((A=>T[A.data.id]=!0));let H=G.data.source,W=G.data.target,$=[];w<0?$.push(C[H]<C[W]?C[H]:C[W],C[H]<C[W]?C[W]:C[H]):w>0?$.push(C[H]<C[W]?C[W]:C[H],C[H]<C[W]?C[H]:C[W]):$.push(C[H],C[W]);let Z,se=$[0],ue=!1;for(;!ue&&0!==$.length;)Z=$.pop(),ue=!0,G.forEach((A=>{if(A.data!==this.first[this.nodeToLayer[A.data.id]]){let w=O.byId[A.data.id].prev.data;Z-C[w.data.id]<N[A.data.id]-N[w.data.id]&&this.moveLongEdge(w,-1,T),ue=ue&&Z-C[w.data.id]>=N[A.data.id]-N[w.data.id]-Ec}let w=this.layers[this.nodeToLayer[A.data.id]];if(A.data!==w[w.length-1]){let w=O.byId[A.data.id].next.data;Z-C[w.data.id]>N[A.data.id]-N[w.data.id]&&this.moveLongEdge(w,1,T),ue=ue&&Z-C[w.data.id]<=N[A.data.id]-N[w.data.id]+Ec}}));ue||(Z=se,G.forEach((A=>{if(A.data!==this.first[this.nodeToLayer[A.data.id]]){let w=O.byId[A.data.id].prev.data;Z=Math.max(Z,C[w.data.id]+N[A.data.id]-N[w.data.id])}let w=this.layers[this.nodeToLayer[A.data.id]];if(A.data!==w[w.length-1]){let w=O.byId[A.data.id].next.data;Z=Math.min(Z,C[w.data.id]+N[A.data.id]-N[w.data.id])}}))),G.forEach((A=>C[A.data.id]=Z))}moveLongEdges(){let A={};this.layers.forEach((w=>{let T=Math.floor(w.length/2);for(let C=T;C<w.length;C++)this.moveLongEdge(w[C],0,A);for(let C=T-1;C>=0;C--)this.moveLongEdge(w[C],0,A)}))}computeY(){let{Y:A,layers:w,height:T}=this;A[0]=0,w.slice(1).forEach(((w,C)=>{A[C+1]=A[C]+T[C+1]+this.layerDistance}))}straightenLongEdge(A,w){let{nodeList:T,longEdges:C,neighbours:k,X:N,Y:O,nodeToLayer:j,totalW:G}=this,H=C[A.id];if(w[A.id]||!k.prev[A.id]||1!==k.prev[A.id].length||!k.next[A.id]||1!==k.next[A.id].length||!(H&&H.length<2))return;w[A.id]=!0;let W=k.prev[A.id][0],$=k.next[A.id][0],Z=N[W]+(N[$]-N[W])*(O[j[A.id]]-O[j[W]])/(O[j[$]]-O[j[W]]);if(A!==this.first[j[A.id]]){let C=T.byId[A.id].prev.data;if(Z-N[C.id]<G[A.id]-G[C.id]-Ec&&this.straightenLongEdge(C,w,O),Z-N[C.id]<G[A.id]-G[C.id]-Ec)return}let se=this.layers[j[A.id]];if(A!==se[se.length-1]){let C=T.byId[A.id].next.data;if(N[C.id]-Z<G[C.id]-G[A.id]-Ec&&this.straightenLongEdge(C,w,O),N[C.id]-Z<G[C.id]-G[A.id]-Ec)return}N[A.id]=Z}straightenEdges(){let A={};this.layers.forEach((w=>{let T=Math.floor(w.length/2);for(let C=T;C<w.length;C++)this.straightenLongEdge(w[C],A);for(let C=T-1;C>=0;C--)this.straightenLongEdge(w[C],A)}))}run(){this.computeMinNodeDistances(),this.decrossVirtualEdges(),this.placeLongEdges(),this.placeNonVirtualNodes(),this.moveLongEdges(),this.computeY(),this.straightenEdges(),Zr(this.layers,((A,w,T,C)=>{A.x=this.X[A.id],A.y=this.Y[C]}))}}(A,w,T).run(),WP=(A,{nodeDistance:w,layerDistance:T,nodeLookup:C,customSort:k,shouldDecross:N=!0})=>{zP(A);let O=function XP(A){return A.nodes.reduce(((A,w)=>(A[w.layer]=A[w.layer]||[],A[w.layer].push(w),w.children=w.children.map((T=>{if(T.layer===w.layer+1)return T;let C=T;for(let k=T.layer-1;k>w.layer;k--){let N=mP(`${w.id}->${T.id}@${k}`,k);N.children=[C],A[k]=A[k]||[],A[k].push(N),C=N}return C})),A)),[])}(A);return A.nodes.length>1?(N&&(A=>{let w={},T=A.map((()=>({}))),C=A.map((()=>({})));A.forEach(((A,k)=>{A.forEach(((A,N)=>{w[A.id]=N,A.children.forEach((w=>{let N=w.layer;N>k?(T[k][A.id]=T[k][A.id]||[],T[k][A.id].push(w.id),C[N][w.id]=C[N][w.id]||[],C[N][w.id].push(A.id)):(T[N][w.id]=T[N][w.id]||[],T[N][w.id].push(A.id),C[k][A.id]=C[k][A.id]||[],C[k][A.id].push(w.id))}))}))}));let k=A.slice(1).map(((w,C)=>Sb(A[C],w,T[C])));for(let N=0;N<100;N++)tN({layers:A,topDown:!0,topDownAdj:T,bottomUpAdj:C,idToIndex:w,crossings:k}),tN({layers:A,topDown:!1,topDownAdj:T,bottomUpAdj:C,idToIndex:w,crossings:k})})(O),k&&O.forEach((A=>{A.sort(((A,w)=>k(C[A.id],C[w.id])))})),HP(O,w,T)):(A.nodes[0].x=0,A.nodes[0].y=0),function KP(A){A.nodes.forEach((A=>{A.data&&(A.children=A.children.filter(Tb))}))}(A),A};var vb=({id:A,layer:w,sink:T,radius:C,layoutable:k})=>({id:A,layer:void 0!==w?w:void 0,sink:T,radius:C||0,fixed:!1===k,parentIds:[],children:[],ref:null});var Ib=(A,w={})=>{if(!A||!A.nodes)return A;let T=rN(Nb({direction:"down",packing:"fit",nodesGridSeparation:1},w),{shouldDecross:!1!==w.shouldDecross}),{components:C,lookup:k}=((A,w={})=>{let T=(A.edges||[]).filter((({source:A,target:w})=>A!==w)),C={},k=new Map;for(let w of A.nodes)C[w.id]=w;let N=function yP(A,w,T){let C=w.reduce(((A,w)=>(A[w.source]=A[w.source]||[],A[w.source].push(w),A)),{}),{result:k}=A.reduce((function i(A,w){let{visited:k,stack:N,result:O}=A;if(k[w.id])return A;k[w.id]=N[w.id]=1;let j=C[w.id]||[];for(let w of j)N[w.target]?O.push(w):i(A,T[w.target]);return delete N[w.id],A}),{visited:{},stack:{},result:[]}),N=k.reduce(((A,{source:w,target:T})=>(A[w]=A[w]||{},A[w][T]=1,A)),{});return w.map((A=>{let{source:w,target:T,id:C}=A;return N[w]&&N[w][T]?{id:C,source:T,target:w}:A}))}(A.nodes,T,C).filter((A=>{let w=k.get(A.source);if(!w){let w=new Map;return w.set(A.target,!0),k.set(A.source,w),!0}return!w.get(A.target)&&(w.set(A.target,!0),!0)})),O=EP(A.nodes,N,{skipSingletons:"grid"===w.packing}),j=N.reduce(((A,w)=>(A[w.source]||(A[w.source]=vb(C[w.source])),A[w.target]||(A[w.target]=vb(C[w.target])),A[w.target].children.push(w.source),A[w.target].parentIds.push(w.source),A)),{});return{components:O.map((A=>A.map((A=>j[A]||vb(C[A]))))),lookup:C}})(A,T),N=function qP(A){let w={x:0,y:0},T=0;for(let C in A)w.x+=A[C].x||0,w.y+=A[C].y||0,T++;return w.x/=T,w.y/=T,w}(k),O=function $P(A,w,T){let C=[];for(let k of A){let A=LP(k);C.push(A),WP(A,{nodeDistance:T.nodesSeparation,layerDistance:T.layerSeparation,shouldDecross:T.shouldDecross,customSort:T.customSort,nodeLookup:w})}return C}(C,k,T);if("grid"===T.packing){let w=SP(A.nodes,A.edges,T);O.push(w)}return vP(O,T),function jP(A,w,T){let C=function YP(A){let w={x:0,y:0},T=0;for(let C of A)for(let A of C.nodes)w.x+=A.x||0,w.y+=A.y||0,T++;return w.x/=T,w.y/=T,w}(T),k=A.x-C.x,N=A.y-C.y;for(let A of T)for(let T of A.nodes){let A=w[T.id];!A||T.data&&T.data.fixed||(A.x=T.x+k,A.y=T.y+N)}}(N,k,O),A},jc={direction:"TB",nodeDistance:50,levelDistance:50,componentDistance:50,gapWidth:1,arrangeComponents:"fit",gridDistance:50,layer:"layer"},Uc={name:"hierarchical",imports:{sequential:Ib},configure:function(A,{graph:w,data:T}){function r(A,w,T=A.getNodes()){return w?w instanceof Gi?w:A.getNodes(w):T}let C=ke(re(re({},jc),A),{nodeList:A.nodes});C.direction=A.direction||jc.direction,C.layerSeparation=C.levelDistance,C.nodesSeparation=C.nodeDistance,C.componentsSeparation=C.componentDistance,C.gapDistance=C.gapWidth,C.packing=C.arrangeComponents;let k=re({},C),N=C.edges,O=C.nodeList;if(-1===["TB","BT","LR","RL"].indexOf(C.direction))throw new Error('direction should be one of the "TB", "BT", "LR", "RL"');if(-1===["fit","grid","singleLine"].indexOf(C.packing))throw new Error('arrangeComponents should be one of the "fit", "grid", "singleLine"');C.nodesGridSeparation=A.gridDistance||jc.gridDistance;let j=O.getId(),G=O.getAttribute("layoutable").reduce(((A,w,T)=>(A[j[T]]=w,A)),{}),H=O.getAttributes(["x","y"]).reduce(((A,w,T)=>(A[j[T]]=w,A)),{}),W=O.getAttribute("radius");if("string"!=typeof k.layer)throw new Error("'layer' should be the valid data field name");let $=r(w,C.roots,w.nodeList()),Z=T.getProperty(C.nodeList,k.layer),se=$.map((A=>{let w=-1;return C.nodeList.forEach(((T,C)=>{T===A&&(w=C)})),w}));for(let A of se)Z[A]=0;let ue=r(w,C.sinks,w.nodeList()).toArray().reduce(((A,w)=>(A[w.getId()]=!0,A)),{}),ge=j.map((A=>ue[A]));return{nodes:j,edges:N.map((A=>({id:A.getId(),source:A.getSource().getId(),target:A.getTarget().getId()}))),options:Ji(C),layoutable:G,radiuses:W,layers:Z,sinks:ge,coords:H}},context:Ze,update:function({nodes:A,edges:w,options:T,layoutable:C,radiuses:k,layers:N,sinks:O,coords:j}){let G=w.filter((({source:A,target:w})=>A in C&&w in C)),H={nodes:A.map(((A,w)=>({id:A,radius:k[w],layer:N[w],sink:O[w],layoutable:C[A],x:j[A].x,y:j[A].y}))),edges:G},{nodes:W}=Ib(H,{packing:{fit:"fit",singleLine:"singleline",grid:"grid"}[T.arrangeComponents],direction:{TB:"down",BT:"up",RL:"left",LR:"right"}[T.direction],layerSeparation:T.layerSeparation,nodesSeparation:T.nodesSeparation,componentsSeparation:T.componentsSeparation,nodesGridSeparation:T.nodesGridSeparation,evenDistribution:T.evenDistribution});return{positions:W}},isRunning:function(){return!1},onSync:function({positions:A},{graph:w}){return{indexes:A.map((({id:A})=>(w.getNode(A)||{_index:-1})._index)),x:A.map((({x:A})=>A)),y:A.map((({y:A})=>A))}}},Vc=ke(re({},Uc),{name:"sequential"}),Hc={name:"grid",configure:function(A,{graph:w,camera:T}){function r(A){return void 0===A||"number"==typeof A&&isFinite(A)&&A>0}let C=A.sortBy,k=A,N=k.nodes,O=Array.from(N._indexes),j=O.length,{rows:G,cols:H,rowDistance:W,colDistance:$}=function i(A,w,T,C,k){if(!r(w))throw new TypeError('"rows" should be a positive integer');if(!r(T))throw new TypeError('"cols" should be a positive integer');if(!r(C))throw new TypeError('"rowDistance" should be a positive number');if(!r(k))throw new TypeError('"colDistance" should be a positive number');if(w)return{rows:w,cols:Math.ceil(A/w),rowDistance:C,colDistance:k};if(T)return{cols:T,rows:Math.ceil(A/T),rowDistance:C,colDistance:k};let N=Math.ceil(Math.sqrt(A));return{cols:N,rows:Math.ceil(A/N),rowDistance:C,colDistance:k}}(j,k.rows,k.cols,k.colDistance,k.rowDistance),Z=function o(A,w,T,C,k){return"string"!=typeof A?C.map(((A,w)=>w)):"radius"===A?w.getAttribute(!0,"radius").getMultiple(C):"degree"===A?T.getDegree():"random"===A?C.map((()=>Math.random())):T.getData(A).map((A=>A||k))}(C,w,N,O,A.sortFallbackValue),se=N.getAttribute("layoutable"),ue=O.reduce(((A,w,T)=>(se[T]&&A.push({id:w,attr:Z[T]}),A)),[]),ge=N.getBoundingBox(),ce=.65*Math.max(ge.maxScaledSize,ge.maxFixedSize/T.getZoom()),_e=ge.minX+ce,me=ge.maxX-ce,pe=ge.minY+ce,be=ge.maxY-ce;return ge.width<ce*H*2&&(_e=ge.cx-ce*H+ce,me=ge.cx+ce*H-ce),ge.height<ce*G*2&&(pe=ge.cy-ce*G+ce,be=ge.cy+ce*G-ce),{sort:!!C,nodes:ue,reverse:!!k.reverse,cols:H,rows:G,minX:_e,maxX:me,minY:pe,maxY:be,rowDistance:W,colDistance:$}},update:function({sort:A,nodes:w,maxX:T,minX:C,maxY:k,minY:N,reverse:O,rows:j,cols:G,rowDistance:H,colDistance:W}){A&&w.sort(((A,w)=>{let T=A.attr,C=w.attr;return T<C?-1:T>C?1:0})),O&&w.reverse();let $=(T-C)/(G-1),Z=(k-N)/(j-1),se=C,ue=N;isFinite($)||($=0),isFinite(Z)||(Z=0),void 0!==H&&isFinite(H)&&($=H),void 0!==W&&isFinite(W)&&(Z=W);let ge=0,ce=0;return w.forEach((A=>{A.x=se+ge*$,A.y=ue+ce*Z,ge+=1,ge===G&&(ce+=1,ge=0)})),w},onSync:function(A){return{indexes:A.map((({id:A})=>A)),x:A.map((({x:A})=>A)),y:A.map((({y:A})=>A))}}},$c=class extends Zu{constructor(A){var w;super(A),this.stop=()=>this._ogma.modules.layouts.stop(),this.concentric=((w=A).modules.layouts.register(Bg),A=>w.modules.layouts.start(Bg.name,A)),this.radial=(A=>(A.modules.layouts.register(Xg),w=>{if(void 0===w.centralNode)throw new Error('concentric layout: missing parameter "centralNode"');if(w.maxIterations=w.maxIterations&&isFinite(w.maxIterations)?Math.floor(w.maxIterations):100,w.maxIterations<1)throw new RangeError("maxIterations must be a positive integer");if(w.iterationsPerRender=w.iterationsPerRender&&isFinite(w.iterationsPerRender)?Math.floor(w.iterationsPerRender):20,w.iterationsPerRender<1)throw new RangeError("iterationsPerRender must be a positive integer");if(w.epsilon=w.epsilon&&isFinite(w.epsilon)?w.epsilon:.001,w.epsilon<=0)throw new RangeError("epsilon has to be a positive number");return A.modules.layouts.start(Xg.name,w)}))(A),this.force=(A=>(A.modules.layouts.register(qg),(w={})=>{if(w.incremental)return Tg(w,A,A.layouts.force);if(void 0!==w.edgeStrength&&(!isFinite(w.edgeStrength)||w.edgeStrength<0))throw new Error("force layout: edgeStrength must be a positive number");if(void 0!==w.steps&&(!isFinite(w.steps)||w.steps<=0))throw new Error("force layout: 'steps' must be a positive integer");if(void 0!==w.edgeLength&&(!isFinite(w.edgeLength)||w.edgeLength<=0))throw new Error("force layout: 'edgeLength' must be positive");if(void 0!==w.gravity&&(!isFinite(w.gravity)||w.gravity<0||w.gravity>=1))throw new Error("force layout: 'gravity' must be between 0 and 1");if(void 0!==w.charge&&!isFinite(w.charge))throw new Error("force layout: 'charge' must be a number");if(void 0!==w.radiusRatio&&(!isFinite(w.radiusRatio)||w.radiusRatio<0))throw new Error("force layout: 'radiusRatio' must be a positive number");if(void 0!==w.theta&&(!isFinite(w.theta)||w.theta<0||w.theta>1))throw new Error("force layout: 'theta' must be between 0 and 1");if(!(void 0===w.cx&&void 0===w.cy||"number"==typeof w.cx&&"number"==typeof w.cy))throw new Error("force layout: both 'cx' and 'cy' must be numbers");if(void 0!==w.siblingsOffset&&!isFinite(w.siblingsOffset))throw new Error("force layout: 'siblingsOffset' must be a number");return A.modules.layouts.start(qg.name,w)}))(A),this.forceLink=(A=>(A.modules.layouts.register(Kg),(w={})=>w.incremental?Tg(w,A,A.layouts.forceLink):A.modules.layouts.start(Kg.name,w)))(A),this.hierarchical=(A=>(A.modules.layouts.register(Uc),(w={})=>(w.useWebWorker=!1,A.modules.layouts.start(Uc.name,w))))(A),this.sequential=(A=>(A.modules.layouts.register(Vc),(w={})=>{w.useWebWorker=!1;let T=ke(re({},w),{evenDistribution:!0});return A.modules.layouts.start(Vc.name,T)}))(A),this.grid=(A=>(A.modules.layouts.register(Hc),(w={})=>A.modules.layouts.start(Hc.name,w)))(A)}},qc=class extends Zu{constructor(){super(...arguments),this.move=A=>this._ogma.modules.virtualMouse.move(A),this.down=A=>this._ogma.modules.virtualMouse.down(A),this.up=A=>this._ogma.modules.virtualMouse.up(A),this.click=A=>this._ogma.modules.virtualMouse.click(A),this.rightClick=A=>this._ogma.modules.virtualMouse.rightClick(A),this.doubleclick=A=>this._ogma.modules.virtualMouse.doubleclick(A),this.drag=(A,w)=>this._ogma.modules.virtualMouse.drag(A,w),this.wheel=A=>this._ogma.modules.virtualMouse.wheel(A)}},Zc=class extends Zu{constructor(){super(...arguments),this.map=A=>this._ogma.modules.rules.createMapping(A),this.slices=A=>this._ogma.modules.rules.createSlices(A),this.template=A=>this._ogma.modules.rules.createTemplate(A)}},Qc=class extends Zu{constructor(){super(...arguments),this.setNodesVisibility=A=>this._ogma.modules.graphics.setNodesVisibility(A),this.setEdgesVisibility=A=>this._ogma.modules.graphics.setEdgesVisibility(A),this.setNodeTextsVisibility=A=>this._ogma.modules.graphics.setNodeTextsVisibility(A),this.setEdgeTextsVisibility=A=>this._ogma.modules.graphics.setEdgeTextsVisibility(A),this.addRule=(A={})=>this._ogma.modules.styleRules.addRule(A),this.getRuleList=()=>this._ogma.modules.styleRules.getRuleList(),this.addNodeRule=(A,w)=>{let T,C;return void 0===w?(T=A,C=void 0):(T=w,C=A),this.addRule({nodeAttributes:T,nodeSelector:C})},this.addEdgeRule=(A,w)=>{let T,C;return void 0===w?(T=A,C=void 0):(T=w,C=A),this.addRule({edgeAttributes:T,edgeSelector:C})},this.getNodeRules=()=>this.getRuleList().filter((A=>void 0===A.getDefinition().edgeAttributes)),this.getEdgeRules=()=>this.getRuleList().filter((A=>void 0===A.getDefinition().nodeAttributes)),this.createClass=A=>this._ogma.modules.classes.createClass(A),this.getClass=A=>this._ogma.modules.classes.getClassByName(A),this.getClassList=()=>this._ogma.modules.classes.getClassList(),this.setHoveredNodeAttributes=(A,w)=>{this._ogma.modules.hover.updateNodeAttributes(A,w)},this.setHoveredEdgeAttributes=(A,w)=>{this._ogma.modules.hover.updateEdgeAttributes(A,w)},this.setSelectedNodeAttributes=(A,w)=>this._ogma.modules.selection.setNodeAttributes(A,!!w),this.setSelectedEdgeAttributes=(A,w)=>this._ogma.modules.selection.setEdgeAttributes(A,!!w),this.setTheme=({nodeAttributes:A,edgeAttributes:w,selectedNodeAttributes:T,selectedEdgeAttributes:C,hoveredNodeAttributes:k,hoveredEdgeAttributes:N})=>{this._ogma.modules.pulses.setTheme(A&&A.pulse||{},w&&w.pulse||{}),this._ogma.modules.graphics.getAttributesManager().setDefaultAttributes(A||{},w||{}),this.setSelectedNodeAttributes(T||{}),this.setSelectedEdgeAttributes(C||{}),this.setHoveredNodeAttributes(k||{}),this.setHoveredEdgeAttributes(N||{})}}},Jc=class extends Zu{constructor(){super(...arguments),this.watchNodeObjectProperty=A=>this._ogma.modules.watcher.watchNodeObjectProperty(A),this.watchEdgeObjectProperty=A=>this._ogma.modules.watcher.watchEdgeObjectProperty(A),this.watchNodeNonObjectProperty=A=>this._ogma.modules.watcher.watchNodeNonObjectProperty(A),this.watchEdgeNonObjectProperty=A=>this._ogma.modules.watcher.watchEdgeNonObjectProperty(A)}},i_=class extends Zu{constructor(){super(...arguments),this.enable=A=>(this._ogma.modules.lasso.enable(A),this),this.disable=()=>(this._ogma.modules.lasso.disable(),this),this.enabled=()=>this._ogma.modules.lasso.enabled()}},s_=class extends Zu{constructor(){super(...arguments),this.enable=A=>(this._ogma.modules.connectNodes.enable(A),this),this.disable=()=>(this._ogma.modules.connectNodes.disable(),this),this.enabled=()=>this._ogma.modules.connectNodes.enabled()}},n_=class extends Zu{constructor(){super(...arguments),this.enable=A=>this._ogma.modules.legend.enable(A),this.disable=()=>this._ogma.modules.legend.disable(),this.enabled=()=>this._ogma.modules.legend.enabled(),this.getOptions=()=>this._ogma.modules.legend.getOptions(),this.export=A=>this._ogma.modules.legend.export(A)}},o_=class extends Zu{constructor(){super(...arguments),this.enable=A=>{this._ogma.modules.rectangleSelect.enable(A)},this.disable=()=>{this._ogma.modules.rectangleSelect.disable()},this.enabled=()=>this._ogma.modules.rectangleSelect.enabled()}},a_=class extends Zu{constructor(){super(...arguments),this.enable=A=>{this._ogma.modules.resizing.enable(A)},this.disable=()=>{this._ogma.modules.resizing.disable()},this.enabled=()=>this._ogma.modules.resizing.enabled()}},l_=class extends Zu{constructor(){super(...arguments),this.enable=A=>{this._ogma.modules.rewiring.enable(A)},this.disable=()=>{this._ogma.modules.rewiring.disable()},this.enabled=()=>this._ogma.modules.rewiring.enabled()}},d_=class extends Zu{constructor(){super(...arguments),this.enable=(A={})=>{this._ogma.modules.snapping.enable(A)},this.disable=()=>{this._ogma.modules.snapping.disable()},this.enabled=()=>this._ogma.modules.snapping.enabled()}},h_=class extends Zu{constructor(){super(...arguments),this.onNodeHover=(A,w={})=>{this._ogma.modules.tooltip.setHandler("hover.node",A,w)},this.onNodeClick=(A,w={})=>{this._ogma.modules.tooltip.setHandler("click.left.node",A,w)},this.onNodeRightClick=(A,w={})=>{this._ogma.modules.tooltip.setHandler("click.right.node",A,w)},this.onNodeDoubleClick=(A,w={})=>{this._ogma.modules.tooltip.setHandler("doubleclick.left.node",A,w)},this.onEdgeHover=(A,w={})=>{this._ogma.modules.tooltip.setHandler("hover.edge",A,w)},this.onEdgeClick=(A,w={})=>{this._ogma.modules.tooltip.setHandler("click.left.edge",A,w)},this.onEdgeRightClick=(A,w={})=>{this._ogma.modules.tooltip.setHandler("click.right.edge",A,w)},this.onEdgeDoubleClick=(A,w={})=>{this._ogma.modules.tooltip.setHandler("doubleclick.left.edge",A,w)},this.onBackgroundClick=(A,w={})=>{this._ogma.modules.tooltip.setHandler("click.left.background",A,w)},this.onBackgroundRightClick=(A,w={})=>{this._ogma.modules.tooltip.setHandler("click.right.background",A,w)},this.onBackgroundDoubleClick=(A,w={})=>{this._ogma.modules.tooltip.setHandler("doubleclick.left.background",A,w)},this.refresh=()=>this._ogma.modules.tooltip.refresh(),this.isShown=()=>this._ogma.modules.tooltip.isShown(),this.hide=()=>{this._ogma.modules.tooltip.hide()},this.show=(A,w)=>this._ogma.modules.tooltip.show(A,w)}},u_=class extends Zu{constructor(){super(...arguments),this.set=(A,w)=>this._ogma.modules.brand.set(A,w),this.remove=()=>{this._ogma.modules.brand.remove()}}},g_=class extends Zu{constructor(A){super(A),this.lasso=new i_(A),this.connectNodes=new s_(A),this.legend=new n_(A),this.rectangleSelect=new o_(A),this.resize=new a_(A),this.rewire=new l_(A),this.snapping=new d_(A),this.tooltip=new h_(A),this.brand=new u_(A)}};function QP(A,w,T){let C=A.getEdge(w.id||"");return!C||C.getTransformation()===T}var wa=A=>!0,Ra=A=>"";function Uo(A,w,T){return{}}var c_=class extends Hu{constructor(A){super(A),this._checkEdgeDataUpdate=!0,this._checkNodeDataUpdate=!0,this._nodeSelector=A.nodeSelector||wa,this._nodeGroupIdFunction=A.nodeGroupIdFunction||Ra,this._nodeGenerator=A.nodeGenerator||Uo,this._edgeSelector=A.edgeSelector||wa,this._edgeGroupIdFunction=A.edgeGroupIdFunction||Ra,this._edgeGenerator=A.edgeGenerator||Uo,this._edgeSource=A.edgeSource,this._edgeTarget=A.edgeTarget,this._separateEdgesByDirection=A.separateEdgesByDirection,this._groupSelfLoopEdges=!!A.groupSelfLoopEdges,this._groupEdges=A.groupEdges}_computeNodeGroupId(A){if(this._nodeGroupIdFunction)return this._nodeSelector(A)?this._nodeGroupIdFunction(A):void 0}_computeEdgeGroupId(A){if(this._edgeGroupIdFunction)return this._edgeSelector(A)?this._edgeGroupIdFunction(A):void 0}_addMetaNodes(){let A=this._id,w=this._ogma,T=w.getNodes().reduce(((A,w)=>w.getTransformation()===this?A.concat(w.getSubNodes()):A.concat(w.toList())),this._ogma.nodeList()),C=new Map;for(let A=0;A<T.size;++A){let w=T.get(A),k=this._computeNodeGroupId(w);if(void 0!==k){let A=C.get(k);A||(A={id:k,nodes:[]},C.set(k,A)),A.nodes.push(w)}}let k=Sr(C),N=k.map((({nodes:A})=>w.getNodes(A))),O=[];for(let w=0;w<k.length;++w){let T=k[w].id,C=N[w],j=this._nodeGenerator(C,T,this);void 0===j.id&&(j.id=Gu(T,A)),j.position=xl(C.getPosition()),O.push(j)}return w.addNodes(O.map((A=>({id:A.id,attributes:A.position}))),{virtual:!0}).then((()=>{let A=w.getNodes(O.map((A=>A.id)));A.replaceOriginalAttributes(O.map((A=>A.attributes)),["x","y","radius"]);let T=A.getData();for(let w=0;w<T.length;w++){let C=T[w],k=O[w];T[w]=nr(nr(C,k.data),this._context.nodeDataUpdates.get(A._indexes[w]))}return this._checkNodeDataUpdate=!1,A.setData(null,T),A.setVisible(!0),this._ogma.modules.grouping.setSubElements(A,N),N.forEach(((w,T)=>{this._ogma.modules.grouping.setMetaElement(w,A.get(T))})),A}))}_addMetaEdges(){let A=this._id,w=this._ogma,T=w.getEdges(),C=new Map,k=this._ogma.modules.graphics.getAttributesManager().getUsedEdgeAttributes().filter((A=>"curvature"!==A));for(let A=0;A<T.size;++A){let w=T.get(A),k=this._computeEdgeGroupId(w);if(void 0!==k){let A=this._edgeSource(w),T=this._edgeTarget(w),N=this._groupEdges?ew(k,A.getId(),T.getId(),this._separateEdgesByDirection):String(w.getId()),O=C.get(N);O||(O={id:N,source:A,target:T,edges:[]},C.set(N,O)),O.edges.push(w)}}let N=Sr(C),O=N.map((({edges:A})=>w.getEdges(A))),j=[];for(let T=0;T<N.length;++T){let C=N[T],G=C.id,H=O[T],W=this._groupEdges?this._edgeGenerator(H,G,this):tw(H,k);if(null!=W.id&&!QP(w,W,this))throw Error(`The id ${W.id} returned by the edgeGenerator function is not a unique id.`);void 0===W.id&&(W.id=Gu(G,A)),W.source=C.source.getId(),W.target=C.target.getId(),j.push(W)}return w.addEdges(function JP(A){return A.map((({id:A,source:w,target:T})=>({id:A,source:w,target:T})))}(j),{virtual:!0}).then((()=>{let A=w.getEdges(j.map((A=>A.id)));A.setAttributes(j.map((A=>A.attributes)));let T=A.getData();for(let A=0;A<T.length;A++){let w=j[A],C=T[A];T[A]=nr(C,w.data)}return this._checkEdgeDataUpdate=!1,A.setData(null,T),A.setVisible(!1),this._ogma.modules.grouping.setSubElements(A,O),O.forEach(((w,T)=>{this._ogma.modules.grouping.setMetaElement(w,A.get(T))})),A}))}_removeMetaEdge(A){A.forEach((A=>{let w=A.getSubEdges();if(!w)return;let T=A.getMetaEdge()||null;this._ogma.modules.grouping.setMetaElement(w,T),T&&this._ogma.modules.grouping.setSubElements(T.toList(),[w.concat((T.getSubEdges()||this._ogma.edgeList()).filter((w=>w!==A)))]),w.filter((A=>A.getTarget().isVisible()&&A.getSource().isVisible())).setVisible(!0)}))}_removeMetaNode(A){A.forEach((A=>{let w=A.getSubNodes();!w||(this._ogma.modules.grouping.setMetaElement(w,null),w.setVisible(!0))}))}_checkChanges(A,w){let T=w?this._context.nodeDataUpdates:this._context.edgeDataUpdates;for(let C=0;C<A.length;C++){let k=w?A[C].nodes.filter((A=>A.getTransformation()===this)):A[C].edges.filter((A=>A.getTransformation()===this));if(k.size)for(let w=0;w<k._indexes.length;w++){let N=T.get(k._indexes[w])||{},O=A[C].property,j=A[C].newValues[w];O?Nr(N,O,j):N=j,T.set(k._indexes[w],N)}}}_setOptions(A){this._nodeSelector=A.nodeSelector||this._nodeSelector,this._nodeGroupIdFunction=A.nodeGroupIdFunction||this._nodeGroupIdFunction,this._nodeGenerator=A.nodeGenerator||this._nodeGenerator,this._edgeSelector=A.edgeSelector||this._edgeSelector,this._edgeGroupIdFunction=A.edgeGroupIdFunction||this._edgeGroupIdFunction,this._edgeGenerator=A.edgeGenerator||this._edgeGenerator,this._edgeSource=A.edgeSource||this._edgeSource,this._edgeTarget=A.edgeTarget||this._edgeTarget,this._separateEdgesByDirection=void 0!==A.separateEdgesByDirection?!!A.separateEdgesByDirection:this._separateEdgesByDirection,this._groupSelfLoopEdges=void 0!==A.groupSelfLoopEdges?!!A.groupSelfLoopEdges:this._groupSelfLoopEdges,this._groupEdges=void 0!==A.groupEdges?!!A.groupEdges:this._groupEdges}resetContext(){super.resetContext(),this._context=ke(re({},this._context),{nodeDataUpdates:new Map,edgeDataUpdates:new Map})}initialize(A){super.initialize(A),this._ogma.events.on("updateNodeData",(({changes:A})=>{this._checkNodeDataUpdate?this._checkChanges(A,!0):this._checkNodeDataUpdate=!0})),this._ogma.events.on("updateEdgeData",(({changes:A})=>{this._checkEdgeDataUpdate?this._checkChanges(A,!1):this._checkEdgeDataUpdate=!0}))}};function ew(A,w,T,C){let k=w,N=T;return!C&&k.toString()>N.toString()&&(k=T,N=w),`${A}[${k}-${N}]`}function tw(A,w){let T=A.get(0);return{data:T.getData(),attributes:T.getAttributes(w)}}function Gu(A,w){return`gen_grp_${w}_${A}`}var m_=class extends c_{constructor({duration:A,enabled:w,padding:T=0,selector:C=wa,groupIdFunction:k=Ra,nodeGenerator:N=Uo,edgeGenerator:O=Uo,separateEdgesByDirection:j=!1,groupSelfLoopEdges:G=!1,groupEdges:H=!0,restorePositions:W=!0,showContents:$=!1,onCreated:Z}={}){super({nodeSelector:C,nodeGroupIdFunction:k,nodeGenerator:N,edgeSelector:A=>!(!A.getSource().getMetaNode()&&!A.getTarget().getMetaNode()),edgeGroupIdFunction:()=>"",edgeGenerator:O,edgeSource:A=>Ig(A.getSource()),edgeTarget:A=>Ig(A.getTarget()),separateEdgesByDirection:j,groupEdges:H,groupSelfLoopEdges:G,duration:A,enabled:w}),this._metaNodesIds=new Set,this._padding=T,this._showContents="function"!=typeof $?()=>$:$,this._restorePositions=W,this._onCreated=Z||((A,w,T,C)=>{})}getName(){return"node-grouping"}get context(){return this._context}get padding(){return this._padding}set padding(A){this._padding=A,this._refresh()}resetContext(){super.resetContext(),this._context=ke(re({},this._context),{metaNodes:this._ogma.nodeList(),metaEdges:this._ogma.edgeList(),subNodes:this._ogma.nodeList(),collapsedSubNodes:this._ogma.nodeList(),subEdges:this._ogma.edgeList(),subnodesVisibility:[],offsets:[]})}run(){let A,w,T=this._ogma,C=this.getAnimationDuration(),k=T.createNodeList(),N=T.createNodeList(),O=T.createEdgeList(),j=[],G=this._ogma.modules.grouping,H=[],W=new Set,$=new Set,Z=[];return this._addMetaNodes().then((w=>(A=w,Z=A.reduce(((A,w)=>{let T=w.getSubNodes();return A.concat(T?T.isVisible():[])}),[]),A.setVisible(!1),this._addMetaEdges()))).then((H=>(w=H,A.forEach((A=>{let w=A.getSubNodes(),T=A.getPosition(),C=this._showContents(A);if(!w||w.map((A=>!A.isVisible())).every((A=>A)))A.setVisible(!1);else if(w){if(C){W.add(A._index);let T=w.getAdjacentEdges({bothExtremities:!0});w.setVisible(!0),T.forEach((A=>$.add(A._index)))}else{W.delete(A._index),G.removeVisibleGroup(A),j.push(...w.getPosition().map((A=>(A.x=A.x-T.x,A.y=A.y-T.y,A)))),k=k.concat(w);let C=w.toArray();for(;0!==C.length;){let A=C.pop(),w=A.getSubNodes();w&&G.isVisibleGroup(A)&&(w.setVisible(!1),w.getAdjacentEdges({bothExtremities:!0}).setVisible(!1),C.push.apply(C,w.toArray()))}}N=N.concat(w)}})),O=w.getSubEdges().reduce(((A,w)=>{let T=w.filter((A=>{if($.has(A._index))return!1;let w=A.getSource().getMetaNode(),T=A.getTarget().getMetaNode();return!(w&&T&&G.isVisibleGroup(w)&&G.isVisibleGroup(T)&&w===T)}));return A.concat(T)}),T.createEdgeList()),k.setAttributes(k.getPosition().map(((A,w)=>{let T=j[w];return A.x-=T.x,A.y-=T.y,A})),C)))).then((()=>{k.setVisible(!1),O.setVisible(!1),A.setVisible(!0),this._ogma.modules.events.fire("groupingRun",{metaNodes:A,padding:isNaN(+this._padding)?A.map((A=>(0,this._padding)(A)||0)):this._padding}),w.filter((A=>this._groupSelfLoopEdges||A.getSource()!==A.getTarget())).setVisible(!0)})).then((()=>{let C=new Set;A.forEach((A=>{let w=W.has(A._index),k=A.getSubNodes();if(k){let N=k.getAdjacentEdges({filter:"all",bothExtremities:!0});if(w){let O=k.reduce(((A,w)=>{let T=G.getNodeDepth(w);return C.add(w._index),T<A?T:A}),0);N.forEach((A=>$.add(A._index))),G.addVisibleGroup(A,-1+O),this._metaNodesIds.has(A.getId())||(this._metaNodesIds.add(A.getId()),H.push(function rw(A){return A&&"function"===A.then?A:Promise.resolve(A)}(this._onCreated(A,w,k,N)).then(T.view.afterNextFrame)))}}})),w.forEach((A=>{let w=Math.min(G.getNodeDepth(A.getSource()),G.getNodeDepth(A.getTarget()));A.setAttribute("layer",w)})),O=O.filter((A=>!$.has(A._index))),k=k.filter((A=>!C.has(A._index))),T.removeNodes(this.context.metaNodes.subtract(A),{virtual:!0}),T.removeEdges(this.context.metaEdges.subtract(w),{virtual:!0}),this._ogma.modules.graphics.getAttributesManager().update()})).then((()=>Promise.all(H))).then((()=>({metaNodes:A,metaEdges:w,subnodesVisibility:Z,collapsedSubNodes:k,virtualNodes:A,virtualEdges:w,subNodes:N,nodeDataUpdates:this._context.nodeDataUpdates,edgeDataUpdates:this._context.edgeDataUpdates,subEdges:O,offsets:j})))}undo(){let{metaNodes:A,metaEdges:w,subnodesVisibility:T,subNodes:C,offsets:k,collapsedSubNodes:N,subEdges:O}=this._context,j=this.getAnimationDuration(),G=this._ogma.modules.grouping,H=this._ogma.getNodes(N.getMetaNode()).getPosition(),W=H.map(((A,w)=>function nw(A,w){return{x:A.x+w.x,y:A.y+w.y}}(A,k[w])));return C.forEach(((A,w)=>A.setVisible(T[w]))),O.setVisible(!0),G.setMetaElement(C,null),G.setMetaElement(O,null),A.setVisible(!1),w.setVisible(!1),N.setAttributes(H).then((()=>this._restorePositions?N.setAttributes(W,j):Promise.resolve(N)))}cleanup(){let A=this._ogma,w=this._context,{metaNodes:T,metaEdges:C}=w;return Promise.all([()=>this._ogma.modules.grouping.resetOffsets(),A.removeEdges(C,{virtual:!0}),A.removeNodes(T,{virtual:!0})]).then((()=>Promise.resolve()))}_setOptions({duration:A,enabled:w,padding:T,selector:C,groupIdFunction:k,nodeGenerator:N,edgeGenerator:O,separateEdgesByDirection:j,groupSelfLoopEdges:G,groupEdges:H,restorePositions:W,showContents:$,onCreated:Z}={}){super._setOptions({nodeSelector:C,nodeGroupIdFunction:k,nodeGenerator:N,edgeSelector:A=>!(!A.getSource().getMetaNode()&&!A.getTarget().getMetaNode()),edgeGroupIdFunction:()=>"",edgeGenerator:O,edgeSource:A=>Ig(A.getSource()),edgeTarget:A=>Ig(A.getTarget()),separateEdgesByDirection:j,groupEdges:H,groupSelfLoopEdges:G,duration:A,enabled:w}),this._padding=void 0!==T?T:this.padding,this._showContents=void 0!==$?"function"!=typeof $?()=>$:$:this._showContents,this._restorePositions=void 0===W?this._restorePositions:W,this._onCreated=Z||this._onCreated}};function Ig(A){return A.getMetaNode()||A}function Uu(A,w,T,C,k,N){if(k-C<=T)return;let O=C+k>>1;dN(A,w,O,C,k,N%2),Uu(A,w,T,C,O-1,N+1),Uu(A,w,T,O+1,k,N+1)}function dN(A,w,T,C,k,N){for(;k>C;){if(k-C>600){let O=k-C+1,j=T-C+1,G=Math.log(O),H=.5*Math.exp(2*G/3),W=.5*Math.sqrt(G*H*(O-H)/O)*(j-O/2<0?-1:1);dN(A,w,T,Math.max(C,Math.floor(T-j*H/O+W)),Math.min(k,Math.floor(T+(O-j)*H/O+W)),N)}let O=w[2*T+N],j=C,G=k;for(zu(A,w,C,T),w[2*k+N]>O&&zu(A,w,C,k);j<G;){for(zu(A,w,j,G),j++,G--;w[2*j+N]<O;)j++;for(;w[2*G+N]>O;)G--}w[2*C+N]===O?zu(A,w,C,G):(G++,zu(A,w,G,k)),G<=T&&(C=G+1),T<=G&&(k=G-1)}}function zu(A,w,T,C){wb(A,T,C),wb(w,2*T,2*C),wb(w,2*T+1,2*C+1)}function wb(A,w,T){let C=A[w];A[w]=A[T],A[T]=C}function lN(A,w,T,C){let k=A-T,N=w-C;return k*k+N*N}var iw=A=>A[0],ow=A=>A[1],f_=class{constructor(A,w=iw,T=ow,C=64,k=Float64Array){this.nodeSize=C,this.points=A;let N=A.length<65536?Uint16Array:Uint32Array,O=this.ids=new N(A.length),j=this.coords=new k(2*A.length);for(let C=0;C<A.length;C++)O[C]=C,j[2*C]=w(A[C]),j[2*C+1]=T(A[C]);Uu(O,j,C,0,O.length-1,0)}range(A,w,T,C){return function Rb(A,w,T,C,k,N,O){let j,G,H=[0,A.length-1,0],W=[];for(;H.length;){let $=H.pop(),Z=H.pop(),se=H.pop();if(Z-se<=O){for(let O=se;O<=Z;O++)j=w[2*O],G=w[2*O+1],j>=T&&j<=k&&G>=C&&G<=N&&W.push(A[O]);continue}let ue=Math.floor((se+Z)/2);j=w[2*ue],G=w[2*ue+1],j>=T&&j<=k&&G>=C&&G<=N&&W.push(A[ue]);let ge=($+1)%2;(0===$?T<=j:C<=G)&&(H.push(se),H.push(ue-1),H.push(ge)),(0===$?k>=j:N>=G)&&(H.push(ue+1),H.push(Z),H.push(ge))}return W}(this.ids,this.coords,A,w,T,C,this.nodeSize)}within(A,w,T){return function Fb(A,w,T,C,k,N){let O=[0,A.length-1,0],j=[],G=k*k;for(;O.length;){let H=O.pop(),W=O.pop(),$=O.pop();if(W-$<=N){for(let k=$;k<=W;k++)lN(w[2*k],w[2*k+1],T,C)<=G&&j.push(A[k]);continue}let Z=Math.floor(($+W)/2),se=w[2*Z],ue=w[2*Z+1];lN(se,ue,T,C)<=G&&j.push(A[Z]);let ge=(H+1)%2;(0===H?T-k<=se:C-k<=ue)&&(O.push($),O.push(Z-1),O.push(ge)),(0===H?T+k>=se:C+k>=ue)&&(O.push(Z+1),O.push(W),O.push(ge))}return j}(this.ids,this.coords,A,w,T,this.nodeSize)}};function aw(A){let w=Math.sin(A*Math.PI/180);return(A=.5-.25*Math.log((1+w)/(1-w))/Math.PI)<0?0:A>1?1:A}var p_=class extends m_{constructor(A){super(ke(re({},A),{selector:w=>{let T=this.getPosition(w);return T&&!isNaN(T.x)&&!isNaN(T.y)&&(!A.selector||A.selector(w))},groupIdFunction:w=>{let T=A.groupIdFunction?A.groupIdFunction(w):"geo-cluster";return T||(T="geo-cluster"),`${T}-${this.getNodeId(w)}`},nodeGenerator:(w,T,C)=>{let k=A.nodeGenerator?A.nodeGenerator(w,T,C):{};k||(k={});let N=this.getCoords(w.get(0));return k.data?k.data=nr(k.data,N):k.data=N,k}})),this._groupingRadius=void 0===A.radius?60:A.radius,this._generateIdFunction=A.groupIdFunction||(()=>""),this._shouldEnable=A.enabled,this._shouldRefreshClusters=!0}initialize(A){super.initialize(A);let w=this._ogma;this._ogma.modules.events.on("beforeGeoCameraMove",(({zoom:A})=>{!this.enabled||!w.geo.enabled()||this.getClosestZoomLevel(A).zoom===this._currentClusters.zoom||(this._shouldRefreshClusters=!1,this._refresh())})),w.events.on("geoDisabled",(()=>{!this.isEnabled()||this.disable(0).then((()=>{this._shouldEnable=!0}))})),w.events.on("geoEnabled",(()=>{!this._shouldEnable||this.enable(0)}))}getPosition(A){return{x:A.getData(this._ogma.modules.geo.latitudePath),y:A.getData(this._ogma.modules.geo.longitudePath)}}getMercatorPosition(A){return{x:(w=A.getData(this._ogma.modules.geo.longitudePath),w/360+.5),y:aw(A.getData(this._ogma.modules.geo.latitudePath))};var w}getNodeId(A){var w;return(null==(w=this._currentClusters.idToCluster.get(A._index))?void 0:w.id)||""}enable(A){return this._ogma&&!this._ogma.modules.geo.isEnabled()?(this._shouldEnable=!0,Promise.resolve()):super.enable(A)}disable(A){return this._shouldEnable=!1,super.disable(A)}getCoords(A){var w;let T=(null==(w=this._currentClusters.idToCluster.get(A._index))?void 0:w.center)||{x:0,y:0},C={};return this.setToPropertyPath(C,this._ogma.modules.geo.latitudePath,T.x),this.setToPropertyPath(C,this._ogma.modules.geo.longitudePath,T.y),C}setToPropertyPath(A,w,T){if("string"==typeof w)return this.setToPropertyPath(A,w.split("."),T);{let C=A;w.forEach(((A,k)=>{k===w.length-1?C[A]=T:C[A]||(C[A]={}),C=C[A]}))}}nodeToElement(A){return{nodeId:A._index,generatedId:this._generateIdFunction(A),nodes:this._ogma.nodeList(new Uint32Array([A._index])),radius:A.getAttribute("radius"),center:this.getPosition(A),mercatorCenter:this.getMercatorPosition(A),zoom:1/0}}getCluster(A){let w=A.reduce(((w,T)=>({x:w.x+T.center.x/A.length,y:w.y+T.center.y/A.length})),{x:0,y:0}),T=A.reduce(((w,T)=>({x:w.x+T.mercatorCenter.x/A.length,y:w.y+T.mercatorCenter.y/A.length})),{x:0,y:0}),C=A.reduce(((A,T)=>{let C=w.x-T.center.x,k=w.y-T.center.y,N=T.radius+Math.sqrt(C*C+k*k);return Math.max(N,A)}),0);return{nodes:this._ogma.nodeList(new Uint32Array(A.map((({nodeId:A})=>A)))),generatedId:A[0].generatedId,center:w,mercatorCenter:T,radius:C}}onePassCluster(A){var w,T;let C=A.map((A=>this.nodeToElement(A))),k=(null==(w=this._ogma.geo.getMap())?void 0:w.getMaxZoom())||22,N=(null==(T=this._ogma.geo.getMap())?void 0:T.getMinZoom())||0,O=[];for(let A=k;Math.abs(A-N)>.01;A-=1*(k-N)/19){let w=[],T=new f_(C,(({mercatorCenter:A})=>A.x),(({mercatorCenter:A})=>A.y),16,Float32Array);C.forEach((k=>{if(k.zoom<=A)return;let N=this._groupingRadius/(256*Math.pow(2,k.zoom-1)),O=T.within(k.mercatorCenter.x,k.mercatorCenter.y,N).map((A=>C[A])).filter((w=>w.zoom>A&&w&&w.generatedId===k.generatedId));O.length||(O=[k]),O.forEach((w=>w.zoom=A)),w.push(ke(re({},this.getCluster(O)),{zoom:A,id:`${A.toFixed(2)}-${w.length}`}))})),O.push({zoom:A,clusters:w})}return O.map((({zoom:A,clusters:w})=>{let T=new Map;return w.forEach((A=>{A.nodes.forEach((({_index:w})=>T.set(w,A)))})),{zoom:A,idToCluster:T}}))}getClosestZoomLevel(A){return this._clustersByZoom.reduce(((w,T)=>Math.abs(A-T.zoom)<Math.abs(A-w.zoom)?T:w))}run(){var A;this._shouldRefreshClusters&&(this._clustersByZoom=this.onePassCluster(this._ogma.getNodes().filter((A=>this._nodeSelector(A)))));let w=(null==(A=this._ogma.geo.getMap())?void 0:A.getZoom())||0;return this._currentClusters=this.getClosestZoomLevel(w),this.whenApplied().then((()=>{this._ogma.view.afterNextFrame().then((()=>{this._ogma.modules.geo.updateProjection()}))})),this._shouldRefreshClusters=!0,super.run()}_setOptions(A){super._setOptions(ke(re({},A),{selector:w=>{let T=this.getPosition(w);return T&&!isNaN(T.x)&&!isNaN(T.y)&&(!A.selector||A.selector(w))},groupIdFunction:w=>{let T=A.groupIdFunction?A.groupIdFunction(w):"geo-cluster";return T||(T="geo-cluster"),`${T}-${this.getNodeId(w)}`},nodeGenerator:(w,T,C)=>{let k=A.nodeGenerator?A.nodeGenerator(w,T,C):{};k||(k={});let N=this.getCoords(w.get(0));return k.data?k.data=nr(k.data,N):k.data=N,k}})),this._groupingRadius=void 0===A.radius?this._groupingRadius:A.radius,this._generateIdFunction=A.groupIdFunction||this._generateIdFunction,this._shouldRefreshClusters=!0,this._shouldEnable=A.enabled,this._ogma.modules.geo.filter._refresh(),this._refresh()}},y_=class extends c_{constructor({selector:A=wa,duration:w,enabled:T,groupIdFunction:C=Ra,generator:k=Uo,separateEdgesByDirection:N=!1}={}){super({nodeSelector:null,nodeGroupIdFunction:null,nodeGenerator:null,edgeSelector:A,edgeGroupIdFunction:C,edgeGenerator:k,edgeSource:A=>A.getSource(),edgeTarget:A=>A.getTarget(),separateEdgesByDirection:N,groupEdges:!0,duration:w,enabled:T})}getName(){return"edge-grouping"}get context(){return this._context}resetContext(){super.resetContext(),this._context=ke(re({},this._context),{metaEdges:this._ogma.edgeList(),subEdges:this._ogma.edgeList(),invalidMetaEdges:this._ogma.edgeList(),invalidSubEdges:this._ogma.edgeList()})}run(){let A,w,T=this.getAnimationDuration();return this._addMetaEdges().then((C=>{A=C,w=A.getSubEdges().reduce(((A,w)=>A.concat(w)),this._ogma.createEdgeList());let k=this._context.invalidSubEdges.subtract(w),N=w.reduce(((A,w)=>(A[w.getId()]=!0,A)),{});return Promise.all([...A.map(((A,w)=>{let C=A.getParallelEdges({filter:"visible"}),k=C.filter((A=>!N[A.getId()])).reduce(((A,w)=>(A[w.getId()]=!0,A)),{});return k[A.getId()]=!0,C.setAttribute("curvature",C.map((w=>this._ogma.modules.curvatureManager.computeCurvature(N[w.getId()]?A:w,"all",(A=>k[A.getId()])))),T)})),k.setAttribute("curvature",this._getCurvatures(k),T)])})).then((()=>(w.setVisible(!1),A.setVisible(!0),ke(re({},this._context),{metaEdges:A,subEdges:w,virtualEdges:A,invalidMetaEdges:this._context.metaEdges.subtract(A),invalidSubEdges:w}))))}undo(){let{metaEdges:A,subEdges:w}=this._context,T=this.getAnimationDuration(!1);return this._removeMetaEdge(A),A.setVisible(!1),w.filter((A=>A.getSource().isVisible()&&A.getTarget().isVisible())).setVisible(!0),A.setVisible(!1),this._context.invalidSubEdges=this._context.subEdges,w.getParallelEdges().setAttribute("curvature",this._getCurvatures(w),T)}_getCurvatures(A){return A.map((A=>this._ogma.modules.curvatureManager.computeCurvature(A,"visible",(A=>!0))))}cleanup(){let{virtualEdges:A,invalidMetaEdges:w}=this._context;return this._ogma.removeEdges(A.concat(w),{virtual:!0}).then((()=>(this._context.metaEdges=this._ogma.edgeList(),this._context.virtualEdges=this._ogma.edgeList(),this._context.invalidMetaEdges=this._ogma.edgeList(),this._context.invalidSubEdges=this._ogma.edgeList(),Promise.resolve())))}_setOptions({selector:A,duration:w,enabled:T,groupIdFunction:C,generator:k,separateEdgesByDirection:N}){super._setOptions({nodeSelector:void 0,nodeGroupIdFunction:void 0,nodeGenerator:void 0,edgeSelector:A,edgeGroupIdFunction:C,edgeGenerator:k,edgeSource:A=>A.getSource(),edgeTarget:A=>A.getTarget(),separateEdgesByDirection:N,groupEdges:!0,duration:w,enabled:T})}},lw=()=>"",hN=()=>({}),b_=class extends Hu{constructor(A){super(A),this._bundleEdges=!0,this._groupSelfLoopEdges=!1,this._isCleaningUp=!1,this._isRunning=!1,this._onPreAddGraph=Ze,this._onBeforeAdd=A=>{if(this._isCleaningUp||!this.enabled)return;let{isNode:w,objects:T}=A;mN(A.objects,w?this._groupNodes(T):this._groupEdges(T)),this._shouldSetVirtual=!0},this._onAfterAdd=A=>{!this._shouldSetVirtual||(this._shouldSetVirtual=!1,this._setVirtual(A.nodes||A.edges,!!A.nodes))},this._onRequestElementsToDelete=A=>{if(A.virtual)return;let w=A.elementsToRemove.isNode,T=w?this._ogma.getNodes:this._ogma.getEdges,C=w?this._context.metaNodesSet:this._context.metaEdgesSet,k=w?this._context.nodeGroups:this._context.edgeGroups,N=w?this._ogma.removeNodes:this._ogma.removeEdges,O=A.elementsToRemove.size,j=T(Array.from(C)),G=A.elementsToRemove.slice();if(A.elementsToRemove=A.elementsToRemove.subtract(j),A.elementsToRemove.size===O)return;let H=G.subtract(A.elementsToRemove);if(H.forEach((A=>{k.delete(A.getId())})),w){let A=H.getAdjacentEdges().filter((A=>A.isVirtual()));this._ogma.removeEdges(A)}N(H,{virtual:!0})},this._nodeToGroupId=A.groupIdFunction||lw,this._bundleEdges=!0,this._groupSelfLoopEdges=!!A.groupSelfLoopEdges,this._nodeGenerator=A.nodeGenerator||hN,this._edgeGenerator=A.edgeGenerator||hN,this._shouldSetVirtual=!1,this._selector=A.selector,this.shouldDo=void 0===A.enabled||!!A.enabled}initialize(A){super.initialize(A),this._ogma.events.on("preAddElements",this._onBeforeAdd).on("requestElementsToDelete",this._onRequestElementsToDelete).on("preAddGraph",this._onPreAddGraph).on(["postAddGraph","addNodes","addEdges"],this._onAfterAdd),this.shouldDo&&(this.enable(),this.shouldDo=!1)}enable(){return this.enabled?Promise.resolve():(this.enabled=!0,this.shouldDo=!0,this.shouldUndo=!1,this._isRunning=!0,this._ogma.export.json({download:!1,edgeAttributes:"all",nodeAttributes:"all"}).then((A=>Promise.all([A,this._ogma.clearGraph()]))).then((([A])=>A)).then((A=>this._ogma.setGraph(A))).then((()=>(this.resolve(),this._isRunning=!1,Promise.resolve()))))}disable(){return this.enabled?(this.enabled=!1,this.shouldDo=!1,this.shouldUndo=!1,this.cleanup().then((()=>{Promise.resolve()}))):Promise.resolve()}run(){return this.enabled||!this.shouldDo?Promise.resolve(this._context):this._ogma.export.json({download:!1,edgeAttributes:"all",nodeAttributes:"all"}).then((A=>Promise.all([A,this._ogma.clearGraph()]))).then((([A])=>A)).then((A=>this._ogma.setGraph(A))).then((()=>Promise.resolve(this._context)))}undo(){return Promise.resolve(this._context)}getName(){return"node-clustering"}cleanup(){if(this._isRunning)return Promise.resolve();this._isCleaningUp=!0;let A=this._ogma.getNodes(Array.from(this._context.metaNodesSet)),w=this._ogma.getEdges(Array.from(this._context.metaEdgesSet)),T=this._getSubNodes(),C=this._getSubEdges();return this.resetContext(),this._ogma.removeNodes(A,{virtual:!0}).then((()=>this._ogma.removeEdges(w,{virtual:!0}))).then((()=>this._ogma.addNodes(T))).then((()=>this._ogma.addEdges(C))).then((()=>{this._isCleaningUp=!1,Promise.resolve()}))}resetContext(){this._isRunning||(super.resetContext(),this._context=ke(re({},this._context),{nodeGroups:new Map,edgeGroups:new Map,metaNodesSet:new Set,metaEdgesSet:new Set,nodeToGroupId:new Map}))}getSubNodes(A){let w=this._context.nodeGroups.get(A.getId());return w?w.nodes:[]}getSubEdges(A){let w=this._context.edgeGroups.get(A.getId());return w?w.edges:[]}_getSubNodes(){return Array.from(this._context.nodeGroups.values()).reduce(((A,{nodes:w})=>(A.push(...w),A)),[])}_getSubEdges(){return Array.from(this._context.edgeGroups.values()).reduce(((A,{edges:w})=>(A.push(...w),A)),[])}_setVirtual(A,w){if(!A)return;let T=w?this._context.metaNodesSet:this._context.metaEdgesSet,C=A.filter((A=>T.has(A.getId())));this._ogma.modules.graph.storage.fetch(w).getFlexArray("virtual").setMultiple(C._indexes,1),w?this._context.virtualNodes=this._context.virtualNodes.concat(C):this._context.virtualEdges=this._context.virtualEdges.concat(C)}setContext(A){}_computeEdgeGroupId(A){if(this._bundleEdges){let w=this._context.nodeToGroupId.get(A.source),T=this._context.nodeToGroupId.get(A.target);return w>T?`${T}:${w}`:`${w}:${T}`}}_groupEdges(A){let w=this._id,T=new Map,C=this._context.nodeToGroupId;this._context.edgeGroups.forEach((A=>{A.newEdges=[],T.set(A.id,A)}));for(let w=0;w<A.length;++w){let k=A[w],N=this._computeEdgeGroupId(k);if(void 0!==N){let A=C.get(k.source)||k.source,w=C.get(k.target)||k.target,O=T.get(N);O||(O={id:N,source:A,target:w,edges:[],newEdges:[]},T.set(N,O)),O.edges.push(k),O.newEdges.push(k)}}let k=Sr(T),N=k.map((({edges:A})=>A)),O=[];for(let A=0;A<k.length;++A){let T=k[A];if(!T.newEdges.length)continue;let C=T.id,j=N[A],G=this._edgeGenerator(j,C,this);void 0===G.id&&(G.id=Gu(C,w)),G.source=T.source,G.target=T.target,T.metaEdge=G,this._context.metaEdgesSet.add(G.id),this._context.edgeGroups.get(G.id)||this._context.edgeGroups.set(G.id,T),(this._groupSelfLoopEdges||G.source!==G.target)&&O.push(G)}return this._ogma.view.afterNextFrame().then((()=>{this._context.edgeGroups.forEach((({newEdges:A,metaEdge:w})=>{if(!(A.length&&w&&w.id&&w.attributes))return;let T=this._ogma.getEdge(w.id);null==T||T.setAttributes(w.attributes)}))})),O}_groupNodes(A){let w=this._id,T=new Map;this._context.nodeGroups.forEach((A=>{A.newNodes=[],T.set(A.id,A)}));let C=[];for(let w=0;w<A.length;w++){let k=A[w];if(this._selector&&!this._selector(k)){C.push(k);continue}k.id=vc(k.id);let N=this._nodeToGroupId(k);if(void 0!==N){let A=T.get(N);A||(A={id:N,nodes:[],newNodes:[]},T.set(N,A)),A.nodes.push(k),A.newNodes.push(k)}else this._context.nodeToGroupId.set(k.id,k.id)}let k=Sr(T),N=k.map((({nodes:A})=>A)),O=k.map((({newNodes:A})=>A)),j=[];for(let A=0;A<k.length;++A){if(!k[A].newNodes.length)continue;let T=k[A].id,C=N[A],G=this._nodeGenerator(C,T,this);k[A].metaNode=G,void 0===G.id&&(G.id=Gu(T,w));for(let w of O[A])this._context.nodeToGroupId.set(w.id,G.id);this._context.metaNodesSet.add(G.id),this._context.nodeGroups.get(G.id)||this._context.nodeGroups.set(G.id,k[A]),j.push(G)}return j.push(...C),this._ogma.view.afterNextFrame().then((()=>{this._context.nodeGroups.forEach((({newNodes:A,metaNode:w})=>{if(!(A.length&&w&&w.id&&w.attributes))return;let T=this._ogma.getNode(w.id);null==T||T.setAttributes(w.attributes)}))})),j}_setOptions(A){this._nodeToGroupId=A.groupIdFunction||this._nodeToGroupId,this._groupSelfLoopEdges=void 0!==A.groupSelfLoopEdges?!!A.groupSelfLoopEdges:this._groupSelfLoopEdges,this._nodeGenerator=A.nodeGenerator||this._nodeGenerator,this._edgeGenerator=A.edgeGenerator||this._edgeGenerator,this._selector=A.selector||this._selector}};function mN(A,w){let T=w.length;return A.length=T,A.splice(0,T,...w),A}function uw(A){return null!=A}function fN(A,w){return{source:A.getId(),target:w.getId()}}var z_=class extends Hu{constructor(A){super(A);let{selector:w=ni,neighborIdFunction:T=ii,nodeGenerator:C=(()=>({})),edgeGenerator:k=fN}=A;this._generateIds=A=>w&&w(A)&&T(A)||null,this._nodeGenerator=C,this._edgeGenerator=k||fN}getName(){return"neighbor-generation"}run(){let A=this._id,w=this._ogma,T=this.getAnimationDuration(),C=w.getNodes(),k=new Map;for(let A=0;A<C.size;++A){let w=C.get(A),T=(N=this._generateIds(w),(Array.isArray(N)?N:N?[N]:null)||[]).filter(uw);if(T)for(let A=0;A<T.length;++A){let C=T[A],N=k.get(C);N||(N=[],k.set(C,N)),N.push(w)}}var N;let O,j,G=new Array(k.size),H=[],W=oo(k),$=Sr(k).map((A=>w.getNodes(A)));for(let w=0;w<G.length;++w){let T=W[w],C=$[w],k=this._nodeGenerator(T,C);k.id=`_gen_${A}_${T}`;let N=xl(C.getPosition());k.attributes=k.attributes||{},k.attributes.x=N.x,k.attributes.y=N.y,G[w]=k}return w.addNodes(G.map((A=>({id:A.id,attributes:A.attributes}))),{virtual:!0}).then((()=>{O=w.getNodes(G.map((A=>A.id))),O.replaceOriginalAttributes(G.map((A=>A.attributes)),["x","y"]),O.setData(null,G.map((A=>A.data)));for(let A=0;A<O.size;++A){let w=O.get(A),T=$[A];for(let A=0;A<T.size;++A){let C=T.get(A),k=this._edgeGenerator(C,w);!k.source&&!k.target&&(k.source=C.getId(),k.target=w.getId()),k.id||(k.id=`${k.source}-${k.target}`),H.push(k)}}return w.addEdges(H,{virtual:!0})})).then((()=>(j=w.getEdges(H.map((A=>A.id))),O.setVisible(!0),j.setVisible(!0),O.addClass(_i),j.addClass(_i),w.removeNodes(this._context.virtualNodes.subtract(O),{virtual:!0}),w.removeEdges(this._context.virtualEdges.subtract(j),{virtual:!0}),Promise.all([O.removeClass(_i,T),j.removeClass(_i,T)])))).then((()=>({virtualNodes:O,virtualEdges:j})))}undo(){let{virtualNodes:A,virtualEdges:w}=this._context;if(!w||!A)return Promise.resolve(this._context);let T=this.getAnimationDuration();return Promise.all([A.addClass(_i,T),w.addClass(_i,T)]).then((()=>{A.setVisible(!1),w.setVisible(!1)}))}cleanup(){let{virtualEdges:A,virtualNodes:w}=this._context;if(A&&w){let T=w.filter((A=>!A.isVisible())),C=A.filter((A=>!A.isVisible()));this._ogma.removeNodes(T,{virtual:!0}),this._ogma.removeEdges(C,{virtual:!0})}return Promise.resolve()}_setOptions(A){let{selector:w,neighborIdFunction:T,nodeGenerator:C,edgeGenerator:k}=A;this._generateIds=w?A=>w&&w(A)&&T(A)||null:this._generateIds,this._nodeGenerator=C||this._nodeGenerator,this._edgeGenerator=k||this._edgeGenerator,super._setOptions(A)}};var D_=class extends Hu{constructor(A){super(A),this._selector=A.selector||ro,this._dataFunction=A.dataFunction||Ze}run(){let A=this.getAnimationDuration(),w=this._ogma,T=w.getNodes().filter(this._selector?this._selector:A=>!0),C=[],k=new Map;for(let A=0;A<T.size;++A){let w=T.get(A),N=w.getAdjacentEdges(),O=this._dataFunction(w);for(let A=0;A<N.size;++A){let T=N.get(A),j=T.getSource(),G=T.getTarget();if(j!==G&&void 0!==O){let A=j===w?G:j,T=k.get(A);T||(T=[],k.set(A,T)),T.push(O)}C.push(T)}}let N=w.getEdges(C),O=w.getNodes(oo(k)),j=Sr(k),G=O.getData(),H=new Array(O.size);for(let A=0;A<H.length;++A){let w=j[A],T=G[A];for(let A=0;A<w.length;++A)T=nr(T,w[A]);H[A]=T}return Promise.all([T.addClass(_i,A),N.addClass(_i,A)]).then((()=>(T.setVisible(!1),N.setVisible(!1),O.setData(H),ke(re({},this._context),{hiddenNodes:T,hiddenEdges:N,nodesWithDataChange:O,oldDataList:G}))))}getName(){return"neighbor-merging"}get context(){return this._context}resetContext(){super.resetContext(),this._context=ke(re({},this._context),{hiddenNodes:this._ogma.nodeList(),hiddenEdges:this._ogma.edgeList(),nodesWithDataChange:this._ogma.nodeList(),oldDataList:[]})}undo(){let{hiddenNodes:A,hiddenEdges:w,nodesWithDataChange:T,oldDataList:C}=this._context;A.setVisible(!0),w.setVisible(!0),A.addClass(_i),w.addClass(_i);let k=this.getAnimationDuration();return Promise.all([A.removeClass(_i,k),w.removeClass(_i,k)]).then((()=>{T.setData(C)}))}cleanup(){return Promise.resolve()}_setOptions(A){this._selector=A.selector||this._selector,this._dataFunction=A.dataFunction||this._dataFunction,super._setOptions(A)}};function hw(A,w){return A.size===w.size&&A.filter((A=>w.includes(A))).size>0}var R_=class extends Hu{constructor(A){super(A),this._selector=A.selector||(A=>!1),this._edgeGenerator=A.edgeGenerator||(()=>({}))}getName(){return"node-collapsing"}get context(){return this._context}resetContext(){super.resetContext(),this._context=ke(re({},this._context),{hiddenNodes:this._ogma.nodeList(),hiddenEdges:this._ogma.edgeList()})}run(){let A=this._ogma,w=this.getAnimationDuration(),T=A.getNodes().filter(this._selector),C=T.getAdjacentEdges(),k=[],N=T.map((A=>A.getAdjacentNodes().filter((A=>!this._selector(A)))));for(let A=0;A<T.size;A++)for(let w=A;w<T.size;w++){let C=T.get(A),k=T.get(w);if(this._ogma.modules.graph.getEdgesBetweenTwoNodes(C,k).size>0&&(N[A].size||N[w].size)&&!hw(N[A],N[w]))throw Error(`addNodeCollapsing: invalid connected nodes [${C.getId()}] and [${k.getId()}] to be collapsed. The addNodeCollapsing function supports only disconnected nodes.`)}for(let w=0;w<T.size;++w){let C=T.get(w),O=N[w];for(let w=0;w<O.size-1;++w){let T=O.get(w),N=this._ogma.modules.graph.getEdgesBetweenTwoNodes(C,T);if(T!==C)for(let j=w+1;j<O.size;++j){let w=O.get(j),G=this._ogma.modules.graph.getEdgesBetweenTwoNodes(C,w),H=this._edgeGenerator(C,T,w,N,G);if(H){let O=Wo(H);for(let j=0;j<O.length;++j)k.push(mw(A,O[j],j,C,T,w,N,G))}}}}return A.addEdges(k,{virtual:!0}).then((()=>this._ogma.getEdges(k.map((A=>A.id))).addClass(_i))).then((A=>Promise.all([A.removeClass(_i,w),T.addClass(_i,w),C.addClass(_i,w)]))).then((([w])=>(T.setVisible(!1),C.setVisible(!1),w.setVisible(!0),A.removeEdges(this.context.virtualEdges.subtract(w),{virtual:!0}),this._ogma.modules.graphics.getAttributesManager().update(),ke(re({},this._context),{virtualEdges:w,hiddenNodes:T,hiddenEdges:C}))))}undo(){let{hiddenNodes:A,hiddenEdges:w}=this._context,T=this._ogma,C=this.getAnimationDuration(),k=this._context.virtualEdges||T.createEdgeList();return A.setVisible(!0),w.setVisible(!0),Promise.all([A.addClass(_i),w.addClass(_i)]).then((()=>Promise.all([k.addClass(_i,C),A.removeClass(_i,C),w.removeClass(_i,C)]))).then((()=>{k.setVisible(!1)}))}cleanup(){let A=this._context.virtualEdges||this._ogma.createEdgeList();return this._ogma.removeEdges(A,{virtual:!0})}_setOptions(A){this._selector=A.selector||this._selector,this._edgeGenerator=A.edgeGenerator||this._edgeGenerator,super._setOptions(A)}};function mw(A,w,T,C,k,N,O,j){let G,H;if(void 0!==w.source&&(G=A.getNode(w.source),G!==k&&G!==N))throw new Error([`addNodeCollapsing: edge generator produced RawEdge with invalid source [${w.source}]`,`expected to be [${k.getId()}] or [${N.getId()}]`].join("; "));if(void 0!==w.target&&(H=A.getNode(w.target),H!==k&&H!==N))throw new Error([`addNodeCollapsing: edge generator produced RawEdge with invalid target [${w.target}]`,`expected to be [${k.getId()}] or [${N.getId()}]`].join("; "));if(G&&H&&G===H)throw new Error(`addNodeCollapsing: edge generator produced RawEdge with same source and target [${G.getId()}]`);if(G&&!H)H=G===k?N:k;else if(H&&!G)G=H===k?N:k;else if(!G&&!H){let A=!0;for(let w=0;w<O.size;++w)O.get(w).getSource()===k&&(A=!1);for(let w=0;w<j.size;++w)j.get(w).getTarget()===N&&(A=!1);A?(G=N,H=k):(G=k,H=N)}return G&&H?ke(re({},w),{id:`_gen_${C.getId()}_${G.getId()}_${H.getId()}_${T}`,source:G.getId(),target:H.getId()}):{}}var B_=class extends Hu{constructor(A){super(A),this._nodeSelector=A.nodeSelector||(A=>!0),this._edgeSelector=A.edgeSelector||(A=>!0),this._nodeDataFunction=A.nodeDataFunction||null,this._edgeDataFunction=A.edgeDataFunction||null}getName(){return"virtual-properties"}get context(){return this._context}resetContext(){super.resetContext(),this._context=ke(re({},this._context),{nodes:this._ogma.nodeList(),oldNodesData:[],edges:this._ogma.edgeList(),oldEdgesData:[]})}run(){let A=this._ogma,w=this._context;return this._nodeDataFunction&&(w.nodes=A.getNodes().filter(this._nodeSelector),w.oldNodesData=EN(w.nodes,this._nodeDataFunction)),this._edgeDataFunction&&(w.edges=A.getEdges().filter(this._edgeSelector),w.oldEdgesData=EN(w.edges,this._edgeDataFunction)),Promise.resolve(w)}undo(){let{nodes:A,oldNodesData:w,edges:T,oldEdgesData:C}=this._context;return A&&A.setData(w),T&&T.setData(C),Promise.resolve()}cleanup(){return Promise.resolve()}_setOptions(A){this._nodeSelector=A.nodeSelector||this._nodeSelector,this._edgeSelector=A.edgeSelector||this._edgeSelector,this._nodeDataFunction=A.nodeDataFunction||this._nodeDataFunction,this._edgeDataFunction=A.edgeDataFunction||this._edgeDataFunction,super._setOptions(A)}};function EN(A,w){let T=[];for(let C=0;C<A.size;++C){let k=A.get(C),N=k.getData(),O=w(k),j=nr(N,O);T.push(N),k.setData(j)}return T}var j_=class extends Zu{constructor(A){super(A),this.getList=()=>this._ogma.modules.transformations.getList(),this.clear=()=>this._ogma.modules.transformations.clear(),this.afterNextUpdate=()=>this._ogma.modules.transformations.whenApplied();let{addNodeGrouping:w,addEdgeGrouping:T,addGeoClustering:C}=(k=A,{addNodeGrouping:(A={})=>k.modules.transformations.add(new m_(A)),addEdgeGrouping:(A={})=>k.modules.transformations.add(new y_(A)),addGeoClustering:A=>{if(k.modules.transformations.getList().find((A=>"geo-clustering"===A.getName())))throw new Error("Trying to add more than one geo clustering. Please refer to the documentation about this issue.");return k.modules.transformations.add(new p_(A))}});var k;this.addNodeGrouping=w,this.addEdgeGrouping=T,this.addGeoClustering=C;let{addNodeClustering:N}=(A=>({addNodeClustering:(w={})=>A.modules.transformations.add(new b_(w))}))(A);this.addNodeClustering=N;let{addNodeFilter:O,addEdgeFilter:j,getNodeFilters:G,getEdgeFilters:H}=(A=>({addNodeFilter:w=>A.modules.filters.addNodeFilter(w),addEdgeFilter:w=>A.modules.filters.addEdgeFilter(w),getNodeFilters:()=>A.modules.transformations.getList().filter((A=>"node-filter"===A.getName())),getEdgeFilters:()=>A.modules.transformations.getList().filter((A=>"edge-filter"===A.getName()))}))(A);this.addNodeFilter=O,this.addEdgeFilter=j,this.getNodeFilters=G,this.getEdgeFilters=H;let{addNeighborGeneration:W,addNeighborMerging:$}=(A=>({addNeighborGeneration:w=>A.modules.transformations.add(new z_(w)),addNeighborMerging:w=>A.modules.transformations.add(new D_(w))}))(A);this.addNeighborGeneration=W,this.addNeighborMerging=$;let{addNodeCollapsing:Z}=(A=>({addNodeCollapsing:(w={})=>A.modules.transformations.add(new R_(w))}))(A);this.addNodeCollapsing=Z;let{addVirtualProperties:se}=(A=>({addVirtualProperties:w=>A.modules.transformations.add(new B_(w))}))(A);this.addVirtualProperties=se}},U_=class extends Zu{constructor(){super(...arguments),this.setZoom=(A,w)=>this._ogma.modules.camera.setZoom(A,w),this.zoomIn=A=>this._ogma.geo.enabled()?this._ogma.modules.geo.zoomIn():this._ogma.modules.camera.zoomIn(A),this.zoomOut=A=>this._ogma.geo.enabled()?this._ogma.modules.geo.zoomOut():this._ogma.modules.camera.zoomOut(A),this.getZoom=()=>this._ogma.modules.camera.getZoom(),this.setCenter=(A,w)=>this._ogma.modules.camera.setCenter(A,w),this.move=(A,w)=>this._ogma.modules.camera.move(A,w),this.moveToBounds=(A,w)=>{if(!(A&&A instanceof ws)){if(!At(A)||4!==A.length)throw new Error("ogma.view.zoomToBounds requires a BoundingBox as a parameter");{let[w,T,C,k]=A;A=ws.from({minX:w,minY:T,maxX:C,maxY:k})}}return this._ogma.modules.camera.moveToBounds(A,w)},this.moveTo=(A,w)=>this._ogma.modules.camera.moveTo(A,w),this.getCenter=()=>this._ogma.modules.camera.getCenter(),this.setAngle=(A,w)=>this._ogma.modules.camera.setAngle(A,w),this.rotate=(A,w)=>this._ogma.modules.camera.rotate(A,w),this.getAngle=()=>this._ogma.modules.camera.getAngle(),this.set=(A,w)=>this._ogma.modules.camera.setView(A,w),this.get=()=>this._ogma.modules.camera.getView(),this.graphToScreenCoordinates=A=>this._ogma.modules.camera.graphToScreenCoordinates(A),this.screenToGraphCoordinates=A=>this._ogma.modules.camera.screenToGraphCoordinates(A),this.getImageData=()=>this._ogma.modules.graphics.getImageData(),this.getElementAt=A=>this._ogma.modules.captor.getElementAt(A),this.getElementsInView=()=>{let{width:A,height:w}=this.get(),T=this.screenToGraphCoordinates({x:0,y:0}),C=this.screenToGraphCoordinates({x:A,y:w});return this._ogma.modules.spatial.query(T.x,T.y,C.x,C.y)},this.getBounds=()=>{let{width:A,height:w}=this.getSize(),T=this.screenToGraphCoordinates({x:0,y:0}),C=this.screenToGraphCoordinates({x:A,y:w});return{cx:(T.x+C.x)/2,cy:(T.y+C.y)/2,width:C.x-T.x,height:C.y-T.y,minX:T.x,minY:T.y,maxX:C.x,maxY:C.y}},this.getElementsInside=(A,w,T,C,k=!0)=>{let{spatial:N,camera:O}=this._ogma.modules;if(k){let k=O.graphToScreenCoordinates({x:A,y:w}),j=O.graphToScreenCoordinates({x:T,y:C});return N.queryProjected(k.x,k.y,j.x,j.y)}return N.queryProjected(A,w,T,C)},this.beforeNextFrame=()=>this._ogma.modules.dom.beforeNextFrame(),this.afterNextFrame=()=>this._ogma.modules.dom.afterNextFrame(),this.setFullScreen=A=>this._ogma.modules.dom.setFullScreen(A),this.isFullScreen=()=>this._ogma.modules.dom.isFullScreen(),this.forceResize=()=>this._ogma.modules.dom.forceResize(),this.getSize=()=>this._ogma.modules.dom.getDimensions(),this.setSize=A=>{if(!A||isNaN(A.width)||isNaN(A.height))throw new Error("Size must follow the format { width: number, height: number }");if(A.width<0)throw new Error("width must be positive");if(A.height<0)throw new Error("height must be positive");return this._ogma.modules.dom.setDimensions(A),Promise.resolve()},this.locateGraph=A=>this._ogma.modules.locate.locateGraph(A),this.locateRawGraph=(A,w)=>this._ogma.modules.locate.locateRawGraph(A,w),this.getGraphBoundingBox=({withTexts:A=!1}={})=>this._ogma.modules.locate.getGraphBoundingBox(A),this.animationInProgress=()=>this._ogma.modules.locate.isLocating()||this._ogma.modules.camera.animationInProgress(),this.getTextBoundingBox=A=>{if(!A)throw new Error("ogma.view.getTextBoundingBox: item must be a Node or an Edge");let w=A.getAttribute("text");return null==w||""===w?null:A.isNode?this._ogma.modules.labels.getTextsBoundingBox(A.toList()):this._ogma.modules.labels.getTextsBoundingBox(void 0,A.toList())}}},V_=class extends Zu{addLayer(A,w){return this._ogma.modules.layers.addLayer(A,"layer",w)}addCanvasLayer(A,w,T){return this._ogma.modules.layers.addCanvasLayer(A,w,T)}addOverlay(A,w){if(!A.position)throw new Error("options.position argument is required");return this._ogma.modules.layers.addOverlay(A,w)}},X_=1,$_=[class{getNodesByClassName(A,w){return this.modules.classes.getClassByName(A,!0).getNodes()}getEdgesByClassName(A,w){return this.modules.classes.getClassByName(A,!0).getEdges()}},class{getHoveredElement(){return this.modules.captor.getPointedElement()}getPointerInformation(){return this.modules.captor.getCursorInformation()}},class{setContainer(A){this.modules.dom.setContainer(A)}getContainer(){return this.modules.dom.getContainer()}},class{addNodes(A,w){return mi(this.modules.graph,!0,A,w)}addEdges(A,w){return mi(this.modules.graph,!1,A,w)}addNode(A,w){return cs(this.modules.graph,!0,A,w)}addEdge(A,w){return cs(this.modules.graph,!1,A,w)}removeNodes(A,w){return function $E(A,w,T){return us(A,!0,w,T)}(this.modules.graph,A,w)}removeEdges(A,w){return function QE(A,w,T){return us(A,!1,w,T)}(this.modules.graph,A,w)}removeNode(A,w){return function jE(A,w,T){return us(A,!0,[w],T)}(this.modules.graph,A,w)}removeEdge(A,w){return function ZE(A,w,T){return us(A,!1,[w],T)}(this.modules.graph,A,w)}getNodes(A){return this.modules.graph.getNodes(A)}getEdges(A){return this.modules.graph.getEdges(A)}getNode(A){return this.modules.graph.getNode(A)}getEdge(A){return this.modules.graph.getEdge(A)}clearGraph(){this.modules.graph.clear()}setGraph(A,w){return this.modules.graph.clear(),this.addGraph(A,w)}addGraph(A,w){return function JE(A,{nodes:w=[],edges:T=[]},C={}){if(A.fireEvent("preAddGraph",{name:"preAddGraph"}),!C.batchSize)return Promise.all([_d(A,!0,w,C),_d(A,!1,T,C)]).then((([w,T])=>(A.fireEvent("postAddGraph",{name:"postAddGraph"}),A.fireEvent("addGraph",{nodes:w,edges:T}),{nodes:w,edges:T})));let k;return mi(A,!0,w,C).then((w=>(k=w,mi(A,!1,T,C)))).then((A=>({nodes:k,edges:A}))).then((w=>(A.fireEvent("postAddGraph",{name:"postAddGraph"}),A.fireEvent("addGraph",{name:"addGraph"}),w)))}(this.modules.graph,A,w)}createNodeList(){return this.getNodes([])}createEdgeList(){return this.getEdges([])}getConnectedComponents(A={}){return this.modules.graph.getConnectedComponents(this.getNodes(A.filter),A)}getConnectedComponentByNode(A,w){let T=this.modules.graph.getNode(A);if(void 0===T)throw new Error(`getComponentByNode: cannot find node ${A}`);return this.modules.graph.getConnectedComponentByNode(T,w)[0]}},class{reloadFonts(){this.modules.graphics.reloadFonts()}},class{clearSelection(){return this.modules.selection.clear()}getSelectedNodes(){return this.modules.selection.getSelectedNodes()}getNonSelectedNodes(){return this.modules.selection.getNonSelectedNodes()}getSelectedEdges(){return this.modules.selection.getSelectedEdges()}getNonSelectedEdges(){return this.modules.selection.getNonSelectedEdges()}},class{setOptions(A){return this.modules.settings.update(A)}getOptions(){return this.modules.settings.get()}}],q_={version:"4.3.5",commit:"9ae5e2c6",buildTime:"Wed Nov 02 2022 16:11:35 GMT+0000 (Coordinated Universal Time)"},Z_=class{constructor(A={}){this.node=A=>new Vi(A,this),this.edge=A=>new Xi(A,this),this.nodeList=A=>new Gi(A||new Uint32Array(0),this),this.edgeList=A=>new Yi(A||new Uint32Array(0),this),this._onReady=[],this.build=q_,this._init(A)}_init(A){this._initParameters=A,this._debug=!!A.debug,this._token=X_++,this.modules=new class{constructor(A,w){this._ogma=A,"webgl"===tl&&Cn.cacheInitData(Cn.createInitData()),this.settings=new ol(A),this.events=new sl(A),this.dom=new Nt(A,w.dimensions),this.animations=new xd(A),this.camera=new Ka(A),this.graph=new zs(A),this.data=new Dt(A),this.graphics=new il(A),this.layers=new qu(A),this.individualAttributes=new nl(A),this.algorithms=new Od(A),this.position=new ju(A),this.touch=new Jl(A),this.mouse=new ql(A),this.virtualMouse=new gh(A),this.spatial=new Dl(A),this.captor=new Zh(A),this.interactions=new Gh(A),this.classes=new ll(A),this.cameraInteractions=new $a(A,!!w.debug),this.hover=new Bu(A),this.keyboard=new mu(A),this.selection=new nd(A),this.styleRules=new ph(A),this.legend=new Du(A),this.sync=new ad(A),this.rules=new Vu(A),this.transformations=new id(A),this.filters=new Yu(A),this.locate=new Xl(A),this.drag=new Kh(A),this.grouping=new td(A),this.pulses=new cd(A),this.curvatureManager=new Bd(A),this.workers=new Zd(A),this.layouts=new ih(A),this.watcher=new hh(A),this.rectangleSelect=new Ch(A),this.labels=new Vh(A,w),this.brand=new Sd(A),this.lasso=new Sh(A),this.rewiring=new tu(A),this.resizing=new su(A),this.snapping=new mh(A),this.connectNodes=new ou(A),this.tooltip=new uu(A),this.geo=new wd(A),Object.keys(this).forEach((A=>{let w=this[A];w instanceof kt&&(w._setModules(this),w.onMounted())})),A.onReady((()=>{Object.keys(this).forEach((A=>{let T=this[A];T instanceof kt&&T.onReady(w)}))}))}destroy(){Object.keys(this).forEach((A=>{let w=this[A];w instanceof kt&&w.destroy(this._ogma)}))}}(this,A),this.styles=new Qc(this),this.algorithms=new Qu(this),this.export=new Lg(this),this.keyboard=new Og(this),this.generate=new Pg(this),this.layouts=new $c(this),this.parse=new Ku(this),this.transformations=new j_(this),this.tools=new g_(this),this.view=new U_(this),this.mouse=new qc(this),this.events=new rg(this),this.schema=new Jc(this),this.rules=new Zc(this),this.geo=new Rg(this),this.layers=new V_(this),this.debug=new tg(this),this._onReady.forEach((A=>A(this))),this.safelyBindToInstance(),this.modules.events.register(["destroy"]),this.build={version:"4.3.5",commit:"9ae5e2c6",buildTime:"Wed Nov 02 2022 16:11:35 GMT+0000 (Coordinated Universal Time)"}}safelyBindToInstance(){for(let A of Object.getOwnPropertyNames(Z_.prototype))"function"==typeof Z_.prototype[A]&&(this[A]=this[A].bind(this))}onReady(A){this._onReady.push(A)}_destroy(){if(!this._token)throw new Error('"destroy" called twice on the same instance of Ogma');this._onReady=[],this.modules.destroy(),this.modules=null}destroy(){this.modules.events.fire("destroy",{}),this._destroy()}isDestroyed(){return!this.modules}reset(){let A=this._initParameters;this._destroy(),this._init(A)}isDebug(){return this._debug}},Q_=Z_;Q_.libraries=se,Q_.geometry=Ol,Q_.build=q_,Q_.algorithms=Td,Q_.utils=qi,Q_.algorithms=Td,Q_.utils=qi,Q_.parse=eg,Q_.build=q_,function Jb(A,w){w.forEach((w=>{Object.getOwnPropertyNames(w.prototype).forEach((T=>{Object.defineProperty(A.prototype,T,Object.getOwnPropertyDescriptor(w.prototype,T)||Object.create(null))}))}))}(Q_,$_);var J_,em=Q_,tm=Mg(W()),im=em;return J_=Z,Yb(w({},"__esModule",{value:!0}),J_)})();return void 0!==Ogma?Ogma:void 0}));